<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>CodeSaw</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://haotianmcihael.github.io/"/>
  <updated>2022-03-16T10:24:50.818Z</updated>
  <id>http://haotianmcihael.github.io/</id>
  
  <author>
    <name>HaotianMichael</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>MIT6.824(Spring 2021)-MapReduce</title>
    <link href="http://haotianmcihael.github.io/2022/01/03/MIT6-824-Spring-2021-MapReduce/"/>
    <id>http://haotianmcihael.github.io/2022/01/03/MIT6-824-Spring-2021-MapReduce/</id>
    <published>2022-01-03T14:29:59.000Z</published>
    <updated>2022-03-16T10:24:50.818Z</updated>
    
    <content type="html"><![CDATA[<h3 id="abstract">Abstract</h3><p>æœ€è¿‘ç»ˆäºæœ‰æ—¶é—´ç ”ç©¶ä¸€ä¸‹MITçš„<a href="https://pdos.csail.mit.edu/6.824/schedule.html" target="_blank" rel="noopener">ç¥è¯¾</a><code>6.824</code>ã€‚</p><p>è¿™é—¨è¯¾æ•™<code>Distributed System</code>ï¼Œå³å¤šå°ç‰©ç†éš”ç¦»çš„è®¡ç®—æœºé€šè¿‡ç½‘ç»œæ¥åè°ƒï¼Œå…±åŒå®Œæˆä¸€è‡´æ€§ä»»åŠ¡ï¼Œå¯ä»¥æ˜¯è®¡ç®—ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å­˜å‚¨ä»»åŠ¡ã€‚</p><p><strong>åˆ†å¸ƒå¼ç³»ç»Ÿ</strong>å’Œå•æœºç›¸æ¯”ï¼Œé™¤äº†æœ‰å¾ˆå¤šé«˜å¹¶å‘çš„<code>Partial Failures</code>ï¼Œæ›´å¤šçš„æ˜¯ç¡¬ä»¶è€åŒ–ï¼Œæ–­ç”µï¼Œç½‘å¡å¤±çµç­‰è¿™ç§ç°å®é—®é¢˜ã€‚å› æ­¤è®¾è®¡ä½æˆæœ¬é«˜æ€§èƒ½ç³»ç»Ÿä»¥åŠå¤„ç†å¹¶å‘å’Œç½‘ç»œé—®é¢˜â€”â€”<strong><code>Performance</code>æ€§èƒ½å’Œ<code>Fault Tolerance</code>å®¹é”™</strong>æ˜¯è¿™é—¨è¯¾çš„æ ¸å¿ƒã€‚</p><p>è¯¾ç¨‹å…±æœ‰20ä¸ª<code>Lectures</code>å’Œ4ä¸ª<code>labs</code>ã€‚å’Œ<code>6.828</code>ä¸€æ ·é‡è§†å®è·µâ€”â€”<strong>çœ‹è®ºæ–‡ï¼ŒæŸ¥èµ„æ–™ï¼Œåš<code>lab</code></strong>~ç®€å•ç²—æš´ã€‚æ‰€ä»¥å­¦ä¹ è¿‡ç¨‹åŸºæœ¬ä¸Šå°±æŒ‰ç…§å¦‚ä¸‹æ¨è¿›ï¼š</p><ul><li>æå‰çœ‹<code>Lecture</code>è¦æ±‚çš„<code>papers</code></li><li>å¬<a href="https://www.bilibili.com/video/BV1R7411t71W?spm_id_from=333.999.0.0" target="_blank" rel="noopener">å¯¹åº”</a>çš„<code>Lectures</code></li><li>æŸ¥æ‰¾<code>lab</code>ç›¸å…³çš„å­¦ä¹ èµ„æ–™</li><li>åš<code>lab</code></li></ul><p>ä¹‹å‰åš<code>6.828</code>çš„æ—¶å€™å°±å‘ç°æˆ‘åœ¨åšè¿™ç§<strong>å­¦ä¹ è¿‡ç¨‹å¾ˆé•¿ï¼Œæ€è€ƒå†…å®¹åˆå¾ˆæ·±</strong>çš„è¯¾ç¨‹è®­ç»ƒæ—¶å¾ˆå®¹æ˜“é’»ç‰›è§’å°–è€Œè®©è‡ªå·±ä¹±äº†èŠ‚å¥ï¼Œæ€ç»´å¦‚è‹¥ä¸èƒ½æ”¾æ¾ä¸‹æ¥æ•ˆæœè‚¯å®šä¸ä¼šå¤ªå¥½â€”â€”å¸Œæœ›è¿™æ¬¡èƒ½å°½é‡è°ƒæ•´è¿‡æ¥ã€‚</p><a id="more"></a><h3 id="paper">Paper</h3><p>è®ºæ–‡<a href="https://pdos.csail.mit.edu/6.824/papers/mapreduce.pdf" target="_blank" rel="noopener">MapReduce:Simplified Data Processing on Large Clusters</a>æ˜¯å…³äºGoogleå·²ç»æ·˜æ±°æ‰çš„<strong>å¤§è§„æ¨¡æ•°æ®é›†å¤„ç†ç¼–ç¨‹æ¶æ„<code>MapReduce</code></strong>ã€‚å½“æ—¶çš„Googleé¢ä¸´åœ¨å¤šå°æœºå™¨ä¸Šçš„å¤§è§„æ¨¡æ•°æ®é›†å¤„ç†æ¯”å¦‚è®¡ç®—<code>PageRank</code>æˆ–è€…å¯¹æ‰€æœ‰æ–‡ä»¶è¿›è¡Œ<code>grep</code>ç­‰ã€‚</p><p>è€Œç»Ÿä¸€åŒ–ç¼–ç¨‹æ¨¡å‹å¯ä»¥å¾ˆå¥½çš„æŠ½è±¡æ‰å› ä¸ºå¤§è§„æ¨¡é›†ç¾¤å¯¼è‡´çš„<strong>å¹¶è¡Œï¼Œç½‘ç»œï¼Œå®¹é”™</strong>ç­‰é—®é¢˜â€”â€”å°†è¿™äº›ç»†èŠ‚éšè—èµ·æ¥ï¼Œåªç•™ä¸€ä¸ªä¾›ç¨‹åºå‘˜ä½¿ç”¨çš„ç¼–ç¨‹æ¥å£å¯ä»¥å¤§å¤§æé«˜å¼€å‘æ•ˆç‡ã€‚è€Œå·¥ä¸šçº§<code>MapReduce</code>çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ª<strong>åˆ©ç”¨æ™®é€šæœºå™¨ç»„æˆçš„å¤§è§„æ¨¡è®¡ç®—é›†ç¾¤è¿›è¡Œå¹¶è¡Œï¼Œé«˜å®¹é”™ï¼Œé«˜æ€§èƒ½çš„å¤§æ•°æ®å¤„ç†å‡½æ•°æ¡†æ¶ã€‚</strong></p><h4 id="ç†è®ºæ¨¡å‹">ç†è®ºæ¨¡å‹</h4><p>ç†è®ºæ¨¡å‹å€Ÿé‰´äº<code>Lisp</code>è¯­è¨€ä¸­çš„<code>map/reduce</code>å‡½æ•°ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span>  <span class="title">map</span><span class="params">(<span class="built_in">string</span> key, <span class="built_in">string</span> value)</span> </span>&#123;</span><br><span class="line"><span class="comment">//key:  æ–‡æ¡£å</span></span><br><span class="line"><span class="comment">//value: æ–‡æ¡£å†…å®¹</span></span><br><span class="line"><span class="keyword">for</span> each word w in value:</span><br><span class="line">EmitIntermediate(w, <span class="string">"1"</span>);  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reduce</span> <span class="params">(<span class="built_in">string</span> key, Iterator values)</span> </span>&#123;</span><br><span class="line"><span class="comment">//key: ä¸€ä¸ªå•è¯</span></span><br><span class="line"><span class="comment">//value: è®¡æ•°å€¼åˆ—è¡¨</span></span><br><span class="line"><span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> each v in value:</span><br><span class="line">result  += ParseInt(v);</span><br><span class="line">Emit(toString(result));  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸¤ä¸ªå‡½æ•°æ¨¡å‹çš„ç±»å‹åˆ†åˆ«æ˜¯:</p><ul><li>map: (k1, v1) â€”&gt; list(k2, v2)</li><li>reduce: (k2, list(v)) â€”&gt; list(v2)</li></ul><p>å¯¹äºä¸€ä¸ª<code>map</code>æ“ä½œï¼Œå°†<code>key</code>æ–‡æ¡£ä¸­çš„å†…å®¹æŒ‰ç…§ä¸€å®šæ–¹å¼è¯»å–ï¼Œå¹¶ç»Ÿè®¡å…¶ä¸­çš„<code>w</code>é¡¹çš„é¢‘ç‡<code>value</code>å¹¶è¾“å‡ºåˆ°ä¸€ä¸ªä¸­é—´æ–‡ä»¶ä¸Šã€‚è€Œ<code>reduce</code>ä»ä¸­é—´æ–‡ä»¶ä¸­è¯»å–å¹¶è¿­ä»£å…¶<code>lists</code>ï¼Œå°†å¯¹åº”çš„<code>key</code>é¡¹ç»Ÿè®¡ã€‚</p><p><img src="1.png" width="50%" height="50%" alt=""></p><p>è¿™ä¸€æ¨¡å‹å¯ä»¥å¾ˆå¥½çš„å¤„ç†å¹¶è¡ŒåŒ–æ“ä½œâ€”â€”<strong>å› ä¸º<code>map</code>çš„è¿‡ç¨‹å¯ä»¥åœ¨å¤šå°æœºå™¨ä¸Šå¹¶è¡Œå®Œæˆè€Œæ²¡æœ‰ä¾èµ–ã€‚<code>reduce</code>è¿‡ç¨‹ä¹Ÿæ˜¯ã€‚ä½†æ˜¯æ•´ä½“<code>reduce</code>å’Œ<code>map</code>ä¹‹é—´å­˜åœ¨ç€é¡ºåºä¾èµ–å…³ç³»å³å¿…é¡»æ˜¯ç›¸åº”çš„<code>map</code>æ“ä½œç»“æŸæ‰å¯ä»¥å”¤é†’<code>reduce</code>æ“ä½œã€‚</strong></p><p>è¿™æ ·çš„è¯æ‰€æœ‰çš„ä¾èµ–å’Œåè°ƒè¿‡ç¨‹éƒ½è¢«éšè—åœ¨<code>map</code>å’Œ<code>reduce</code>å‡½æ•°çš„<strong>æ•°æ®åˆ†å‘</strong>ä¹‹é—´ï¼Œè€Œå¼€å‘è€…å¯ä»¥å®Œå…¨ä¸ç”¨è€ƒè™‘åˆ†å¸ƒå¼ç»†èŠ‚è€Œå•ç‹¬ç¼–å†™è¿™ä¸¤ä¸ªå‡½æ•°ä»¥è¾¾åˆ°è‡ªå·±çš„ç›®çš„ã€‚</p><h4 id="å®ç°">å®ç°</h4><p>ä»å®ç°è§’åº¦çœ‹ç³»ç»Ÿçš„å¾ˆå¤šè¡Œä¸ºæ˜¯ç”±<code>MapReduce</code>å†…ç½®çš„åº“å®Œæˆçš„ã€‚è¿™é‡Œæœ‰å‡ ä¸ªå®¹æ˜“æ··æ·†çš„æ¦‚å¿µï¼š</p><ul><li><code>user program</code>ï¼šç”¨æˆ·ç¨‹åºï¼Œä¼šè¢«å¤šæ¬¡<code>fork</code>æˆä¸º<code>master</code>å’Œ<code>worker</code><br></li><li><p><code>master</code>: ä¸»èŠ‚ç‚¹ï¼Œç”¨æ¥å°†<code>task</code>åˆ†é…ç»™ç›¸åº”çš„<code>worker</code>ï¼Œè®°å½•å·¥ä½œèŠ‚ç‚¹çš„å½“å‰çŠ¶æ€å’Œå£°æ˜å‘¨æœŸ</p></li><li><code>task</code>ï¼š<code>map</code>ä»»åŠ¡æˆ–è€…<code>reduce</code>ä»»åŠ¡ï¼Œç”±ç›¸åº”çš„<code>worker</code>å®Œæˆ</li><li><code>worker</code>: å·¥ä½œèŠ‚ç‚¹ï¼Œç”¨æ¥å®Œæˆç›¸åº”çš„<code>task</code></li><li><p><code>user-defined map/reduce</code>: å¼€å‘è€…è‡ªå®šä¹‰çš„<code>map/reduce</code>å‡½æ•°</p></li></ul><p><img src="2.png" width="50%" height="50%" alt=""></p><h5 id="è¾“å…¥é¢„å¤„ç†">è¾“å…¥é¢„å¤„ç†</h5><p>é¦–å…ˆåº“å‡½æ•°ä¼šå°†è¾“å…¥æ–‡ä»¶åˆ‡åˆ†æˆ<code>M</code>ä»½ï¼Œå¹¶åœ¨ä¸€ä¸ªé›†ç¾¤çš„è‹¥å¹²å°æœºå™¨ä¸Šå¯åŠ¨ç¨‹åºçš„å¤šä¸ªå‰¯æœ¬ã€‚å‰¯æœ¬ä¸­é™¤äº†æœ‰ä¸€ä¸ªä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œå…¶ä»–éƒ½æ˜¯å·¥ä½œèŠ‚ç‚¹ã€‚</p><p>ä¸»èŠ‚ç‚¹å°†Mä¸ªmapä»»åŠ¡Rä¸ªreduceä»»åŠ¡åˆ†é…ç»™ç©ºé—²çš„å·¥ä½œèŠ‚ç‚¹ï¼ˆç†è§£<code>task</code>åœ¨è¢«åˆ†é…ç»™<code>worker</code>åä¸¤è€…æ˜¯ä¸€ä¸ªæ„æ€ï¼‰ã€‚</p><h5 id="mapå·¥ä½œèŠ‚ç‚¹åŒºåˆ†å·¥ä½œèŠ‚ç‚¹å’Œç”¨æˆ·å‡½æ•°">mapå·¥ä½œèŠ‚ç‚¹ï¼ˆåŒºåˆ†å·¥ä½œèŠ‚ç‚¹å’Œç”¨æˆ·å‡½æ•°ï¼‰</h5><p>æ¯ä¸€ä¸ªè¢«åˆ†é…mapçš„å·¥ä½œèŠ‚ç‚¹éœ€è¦è¯»å–ç›¸åº”å†…å®¹å¹¶è§£æå‡º<code>key/value</code>å¯¹ï¼Œ<strong>å¹¶å°†è¿™äº›ä½œä¸ºå‚æ•°æä¾›ç»™ç”¨æˆ·è‡ªå®šä¹‰çš„mapå‡½æ•°ï¼Œ</strong>è€Œå‡½æ•°è¾“å‡ºçš„ä¸­é—´ç»“æœç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚</p><p>ç¼“å­˜çš„ä¸­é—´<code>key/value</code>å¯¹ä¼šè¢«åˆ’åˆ†ä¸ºRå—å¹¶å†™å…¥æœ¬åœ°ç£ç›˜ï¼Œè€Œè¿™äº›æ•°æ®å¯¹åœ¨ç£ç›˜ä¸­çš„ç›¸åº”ä½ç½®ä¼šè¢«ä¼ å›ä¸»èŠ‚ç‚¹â€”â€”ç”±ä¸»èŠ‚ç‚¹å†ä¼ ç»™ç›¸åº”çš„reduceå·¥ä½œèŠ‚ç‚¹ã€‚</p><h5 id="reduceå·¥ä½œèŠ‚ç‚¹åŒºåˆ†å·¥ä½œèŠ‚ç‚¹å’Œç”¨æˆ·å‡½æ•°">reduceå·¥ä½œèŠ‚ç‚¹ï¼ˆåŒºåˆ†å·¥ä½œèŠ‚ç‚¹å’Œç”¨æˆ·å‡½æ•°ï¼‰</h5><p>ä¿è¯mapæ“ä½œç»“æŸåï¼Œä¸»èŠ‚ç‚¹å”¤é†’reduceå·¥ä½œèŠ‚ç‚¹å¹¶å‘ŠçŸ¥å…¶ä¸­é—´è¾“å‡ºçš„ç£ç›˜ä½ç½®ã€‚reduceå·¥ä½œèŠ‚ç‚¹ä½¿ç”¨RPCè°ƒç”¨è·å–è¿™äº›ä¸­é—´æ•°æ®ã€‚<strong>å½“reduceè¯»å–å®Œæ‰€æœ‰çš„æ•°æ®ï¼Œéœ€è¦æŒ‰ç…§keyå¯¹å…¶è¿›è¡Œæ’åºï¼Œæ˜¯ä¸ºäº†æœ€åè¿­ä»£å™¨ç»Ÿè®¡è®¡æ•°æä¾›å‰ç½®æ¡ä»¶ã€‚</strong>æœ€åreduceå·¥ä½œèŠ‚ç‚¹è¿­ä»£æ’å¥½åºçš„ä¸­é—´æ•°æ®ï¼Œå¹¶å°†æ¯ä¸€ä¸ªä¸­é—´keyå’Œå®ƒå…³è”ä¸€ç»„ä¸­é—´valueä¼ é€’ç»™ç”¨æˆ·å®šä¹‰çš„reduceå‡½æ•°ã€‚</p><h5 id="shuffleè¿‡ç¨‹æ ¸å¿ƒçŠ¶æ€æœº">shuffleè¿‡ç¨‹ï¼ˆæ ¸å¿ƒçŠ¶æ€æœºï¼‰</h5><p>æ•´ä¸ªmapå’Œreduceä¹‹é—´çš„æ•°æ®shuffleæ˜¯ç³»ç»Ÿåˆ†å¸ƒå¼çš„æ ¸å¿ƒï¼Œå…³é”®å°±æ˜¯mapç”Ÿæˆçš„ä¸­é—´æ–‡ä»¶åŠå…¶å‘½åã€‚</p><p><img src="3.png" width="50%" height="50%" alt=""></p><p>å¦‚ä¸Šå›¾ï¼Œå‡è®¾æœ‰5ä¸ªmapå·¥ä½œèŠ‚ç‚¹å’Œ3ä¸ªreduceå·¥ä½œèŠ‚ç‚¹ã€‚</p><ul><li>mapå·¥ä½œèŠ‚ç‚¹çš„è¾“å‡ºåˆ†ä¸º3ç±»ï¼Œåˆ†åˆ«ç”±<code>R0</code>ï¼Œ<code>R1</code>å’Œ<code>R2</code>å¤„ç†ï¼Œ<strong>å½“mapçš„è§£æå‡½æ•°ä¸€è‡´æ—¶ï¼Œç›¸åŒçš„keyä¸€å®šè¢«åˆ†åˆ°äº†åŒä¸€ä¸ªä¸­é—´æ–‡ä»¶ä¸­ã€‚</strong>å³<code>0-0.txt</code>ã€<code>1-0.txt</code>å’Œ<code>0-2.txt</code>ä¸‰ä¸ªæ–‡ä»¶ä¸­<code>key</code>ç±»å‹çš„äº¤é›†æ˜¯ç©ºé›†ã€‚</li><li><code>md5(key)%R</code>è®¡ç®—mapæœ€ç»ˆè¾“å‡ºè½å…¥åˆ°å“ªä¸ªä¸­é—´æ–‡ä»¶</li><li>ä¸­é—´æ–‡ä»¶å‘½åï¼šmapä»»åŠ¡ç¼–å·-reduceä»»åŠ¡ç¼–å·</li></ul><p>å› æ­¤5ä¸ªmapæ“ä½œç»“æŸåä¼šç”Ÿæˆ5*3çš„ä¸­é—´æ–‡ä»¶çŸ©é˜µã€‚</p><ul><li>mapç»“æŸåï¼Œ3ä¸ªreduceå·¥ä½œèŠ‚ç‚¹é€šè¿‡RPCåˆ†åˆ«è·å–çŸ©é˜µçš„æ¯ä¸€åˆ—æ–‡ä»¶æ•°æ®</li></ul><p>æ¯”å¦‚R0è°ƒç”¨<code>0-0.txtã€1-0.txtã€2-0.txtã€3-0.txtã€4-0.txt</code>ã€‚å› ä¸ºåŒä¸€åˆ—ä¸­ç±»å‹ç›¸åŒï¼Œæ‰€ä»¥åªéœ€è¦å†…éƒ¨æ’åºã€‚</p><p>æ‰€è°“<code>shuffle</code>å°±æ˜¯map/reduceå¯¹ä¸­é—´æ–‡ä»¶çš„è¡Œåˆ—æ“ä½œï¼Œå…¶ç»“æœæ˜¯å°†ä¸­é—´æ–‡ä»¶è¿›ä¸€æ­¥å¤„ç†æˆä¸º<code>&lt;value, list&lt;key&gt;&gt;</code>ä½œä¸ºç”¨æˆ·å®šä¹‰reduceå‡½æ•°çš„è¾“å…¥è¿›è¡Œè®¡æ•°ç»Ÿè®¡ã€‚</p><h5 id="æœ€ç»ˆè¾“å‡º">æœ€ç»ˆè¾“å‡º</h5><p>reduceå·¥èŠ‚ç‚¹å¤„ç†å®Œè®¡æ•°åï¼Œå°†ç»“æœè¾“å‡ºåˆ°ç£ç›˜ä¸Šä½œä¸ºä¸‹ä¸€æ¬¡<code>MapReduce</code>çš„è¾“å…¥ã€‚</p><h4 id="å·¥ä¸šçº§å¤„ç†">å·¥ä¸šçº§å¤„ç†</h4><p>åœ¨æ¡†æ¶å®ç°çš„è¿‡ç¨‹ä¸­å‡ºç°äº†å¾ˆå¤šçš„ç»†èŠ‚ã€‚Googleåœ¨å°†<code>MapReduce</code>å·¥ä¸šåŒ–è½åœ°çš„è¿‡ç¨‹ä¸­ä¹Ÿå°†è¿™äº›å½±å“ç³»ç»Ÿ<strong>æ€§èƒ½</strong>å’Œ<strong>å¯é æ€§</strong>çš„ä¸»è¦å› ç´ è¿›è¡Œäº†ä¼˜åŒ–â€”â€”è€Œä¸€ä¸ªä¼˜ç§€çš„ç³»ç»Ÿæœ¬èº«å°±æ˜¯åœ¨å®è·µä¸­ä¸æ–­è¿­ä»£å‡ºæ¥çš„ï¼Œè¿™é‡Œç®€å•æ¦‚æ‹¬ä¸€ä¸‹ï¼Œä¸åšè¯¦ç»†è®¨è®ºã€‚</p><h5 id="å®¹é”™">å®¹é”™</h5><p><strong>åˆ†å¸ƒå¼å®¹é”™çš„æœ¬è´¨å°±æ˜¯å¦‚ä½•åœ¨ä¸å¯é çš„ç¡¬ä»¶ä¸Šæ„å»ºå¯é çš„è½¯ä»¶ã€‚</strong>å› ä¸ºæ˜¯å¤§è§„æ¨¡é›†ç¾¤ï¼Œæ‰€ä»¥å¾ˆéš¾é¿å…<code>Partial Failure</code>â€”â€”ä»å®ç°è§’åº¦çœ‹å°±æ˜¯å„ä¸ªèŠ‚ç‚¹çš„å®¹é”™ã€‚</p><ul><li>ä¸»èŠ‚ç‚¹ï¼šä¸»èŠ‚ç‚¹å¥”æºƒä¹‹åä¼šcoredumpåˆ°ä¸€ä¸ªæ¢å¤æ–‡ä»¶ä¸­ï¼Œé‡å¯åå¯ä»¥ä»æœ€è¿‘çš„æ¢å¤ç‚¹é‡æ–°æ‰§è¡ŒMapReduce</li><li>å·¥ä½œèŠ‚ç‚¹ï¼šå¥”æºƒåä¸€èˆ¬éƒ½è¦å°†å½“å‰çš„taské‡æ–°åˆ†é…åˆ°ä¸€ä¸ªèŠ‚ç‚¹å®Œæˆ<ul><li>mapï¼šè¾“å‡ºæ˜¯ä¸€ä¸ªä¸­é—´æ–‡ä»¶æ‰€ä»¥ç¬¦åˆåŸå­æäº¤å³åé¢çš„ä»»åŠ¡ä¼šå°†æ–‡ä»¶è¦†ç›–</li><li>reduceï¼šå…¶è¾“å‡ºæ˜¯ä¸€ä¸ªæŒä¹…æ€§çš„æ–‡ä»¶æ‰€ä»¥éœ€è¦é‡å‘½åä¸€ä¸ªæ–°çš„æ–‡ä»¶é˜²æ­¢å†²çª</li></ul></li></ul><h5 id="åŠ é€Ÿ">åŠ é€Ÿ</h5><p>å½“å‡ºç°å¤§è§„æ¨¡çš„æœºå™¨èŠ‚ç‚¹æ—¶ï¼Œå¾ˆå¤šæ€§èƒ½é—®é¢˜ä¼šæˆä¸ºä¼˜åŒ–çš„æ–¹å‘ã€‚æ¯”å¦‚è¿›ä¸€æ­¥ä¼˜åŒ–ç½‘ç»œå’Œç£ç›˜æ€§èƒ½ã€‚</p><ul><li>å±€éƒ¨æ€§ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè¾“å…¥æ–‡ä»¶ä¼ åˆ°mapèŠ‚ç‚¹ï¼Œmapä¸­é—´æ–‡ä»¶ä¼ åˆ°reduceèŠ‚ç‚¹éƒ½éœ€è¦ç½‘ç»œå¸¦å®½ã€‚å¯ä»¥è€ƒè™‘å°†mapç›´æ¥åˆ†é…åˆ°æœ¬åœ°ç£ç›˜ä¸Šç­‰æ“ä½œå¢åŠ å¹¶è¡Œæ€§ã€‚</li><li>ä»»åŠ¡ç²’åº¦ï¼šMä¸ªmapèŠ‚ç‚¹ï¼ŒRä¸ªreduceèŠ‚ç‚¹ã€‚åˆ†é…å¤ªå¤šèŠ‚ç‚¹å¯¼è‡´ç½‘ç»œå¸¦å®½ä¸å¤Ÿï¼Œåˆ†é…å¤ªå°‘å¯¼è‡´å¹¶è¡Œåº¦ä¸å¤Ÿã€‚</li><li>è´Ÿè½½å‡è¡¡ï¼šä¸åŒçš„å·¥ä½œèŠ‚ç‚¹æ€§èƒ½ä¹Ÿä¸åŒï¼Œå¦‚æœç³»ç»Ÿå¡åœ¨æœ€åå‡ ä¸ªèŠ‚ç‚¹å¯¼è‡´è´Ÿè½½è¿‡é«˜èŠ±è´¹æ—¶é—´è¿‡é•¿ï¼Œå°±ä¼šè®©æ•´ä¸ªç³»ç»Ÿå¤„äºä¸å¹³è¡¡çš„çŠ¶æ€ã€‚</li></ul><h3 id="lecture12">Lecture1~2</h3><h4 id="goè¯­è¨€ç¯å¢ƒé…ç½®">goè¯­è¨€ç¯å¢ƒé…ç½®</h4><p>ä½œä¸ºä¸€ä¸ª<code>VIM</code>é‡åº¦ç”¨æˆ·æˆ‘å·²ç»ä¸ç”¨IDEå¾ˆå¤šå¹´äº†ã€‚å°±è‡ªè¡Œé…ç½®äº†<code>Vim-Go</code>å¼€å‘ç¯å¢ƒã€‚</p><h5 id="goå®‰è£…é…ç½®">Goå®‰è£…é…ç½®</h5><p>æˆ‘ç”¨<code>MacOs Catalina</code>ç¯å¢ƒï¼Œä¸‹è½½å®‰è£…å°±ä¸è¯´äº†ã€‚ä¸»è¦å…³æ³¨<code>Go</code>ç¯å¢ƒå˜é‡ï¼Œéœ€è¦å†™å…¥ç›¸åº”çš„<code>SHELL</code>é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘çš„åœ¨<code>.zshrc</code>ä¸­ï¼š</p><ul><li><code>GOROOT</code>: Goè¯­è¨€çš„å®‰è£…ç›®å½•ï¼Œä¸€èˆ¬æ˜¯<code>/usr/local/go</code></li><li><code>GOPATH</code>: å·¥ä½œåŒºå³å†™ä»£ç çš„ç›®å½•ï¼Œä¸€èˆ¬åˆ†ä¸ºä¸‰ä¸ªå­ç›®å½•ï¼š<ul><li><code>src</code><br></li><li><code>bin</code></li><li><code>pkg</code></li></ul></li><li><code>GOBIN</code>: å­˜æ”¾GOè¯­è¨€å¯æ‰§è¡Œæ–‡ä»¶çš„ç›®å½•ï¼ˆè¿™é‡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸»è¦æŒ‡é€šè¿‡<code>go get</code>ä¸‹è½½å¹¶ç¼–è¯‘å¥½çš„åº“ï¼Œä¾›ç›´æ¥è°ƒç”¨çš„ï¼‰</li><li><code>PATH</code>: éœ€è¦å°†å½“å‰çš„å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•æ”¾åˆ°PATHä¸‹é¢</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># æ³¨æ„&quot;&quot;çš„ä½¿ç”¨</span><br><span class="line">export GOROOT=/usr/local/go</span><br><span class="line">export GOPATH=~/go/golib:~/go/goproject    #è¿™é‡Œè®¾ç½®äº†ä¸¤ä¸ªå·¥ä½œåŒº</span><br><span class="line">export GOBIN=~/go/gobin</span><br><span class="line">export PATH=&quot;$GOROOT/bin:$GOBIN:$PATH&quot;</span><br></pre></td></tr></table></figure><h5 id="é•œåƒ">é•œåƒ</h5><p>å› ä¸ºGithubå’ŒGoå®˜ç½‘ä¸å¤ªå¥½ç”¨ï¼Œæ‰€ä»¥ä½¿ç”¨é•œåƒæ¥ä¸‹è½½éœ€è¦çš„åº“æ¯”è¾ƒæ–¹ä¾¿ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Mac/Linuxç¯å¢ƒä¸‹</span><br><span class="line">export GO111MODULE=on</span><br><span class="line">export GOPROXY=https://goproxy.cn</span><br></pre></td></tr></table></figure><h5 id="äºŒè¿›åˆ¶å·¥å…·">äºŒè¿›åˆ¶å·¥å…·</h5><p><code>vim-go</code>æ˜¯ä¸€ä¸ªå¼€å‘<code>go</code>çš„<code>vim</code>æ’ä»¶ã€‚æˆ‘ä½¿ç”¨<code>vundle</code>åŒ…ç®¡ç†å·¥å…·æ¥ç®¡ç†<code>vim</code>æ’ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># å¦‚ä½•ä½¿ç”¨vundleè‡ªè¡ŒGoogle</span><br><span class="line">Plugin &apos;fatih/vim-go&apos;</span><br></pre></td></tr></table></figure><p>å› ä¸ºè¿™ä¸ªæ’ä»¶å¯åŠ¨è¿˜éœ€è¦ä¸€äº›å’ŒäºŒè¿›åˆ¶å·¥å…·ï¼Œå…·ä½“çš„åˆ—è¡¨å¯æ‰“å¼€<code>&quot;~/.vim/bundle/vim-go/plugin/go.vim&quot;</code>å¦‚ä¸‹ï¼š</p><p><img src="4.png" width="50%" height="50%" alt=""></p><p>å¸¸è§„åšæ³•æ˜¯åœ¨<code>vim</code>å‘½ä»¤è¡Œæ¨¡å¼ä¸‹é¢ç›´æ¥æ‰§è¡Œ<code>:GoInstallBinaries</code>æ¥è‡ªåŠ¨å®‰è£…ã€‚å¦‚æœæ²¡æœ‰å®‰è£…ä»£ç†çš„è¯å°½ç®¡æœ‰é•œåƒè¿˜æ˜¯å¾ˆå®¹æ˜“å‡ºé”™ï¼Œæ‰€ä»¥æˆ‘çš„åšæ³•æ˜¯ä¸€ä¸ªä¸€ä¸ªä»å®˜ç½‘ä¸Š<code>go get</code>ç„¶å<code>go insatll</code>æ‰‹åŠ¨å®‰è£…ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go get github.com/go-delve/delve/cmmd/dlv     #ä»å®˜ç½‘ä¸Šç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶å·¥å…·</span><br><span class="line">$ go install github.com/go-delve/delve/cmmd/dlv@laatest   #ä½¿ç”¨go installæ‰‹åŠ¨å®‰è£…</span><br></pre></td></tr></table></figure><p>å¦‚æœæŒ‰ç…§å‰é¢çš„æ–¹å¼é…ç½®å¥½äº†ç¯å¢ƒå˜é‡ï¼Œé‚£è¿™äº›äºŒè¿›åˆ¶å·¥å…·å°±ä¼šè¢«å®‰è£…åœ¨<code>~/go/gobin</code>ç›®å½•ä¸‹ã€‚éªŒè¯æ–¹å¼å°±æ˜¯æ‰“å¼€<code>vim</code>ä¹‹åä¸ä¼šæœ‰æ’ä»¶æŠ¥é”™ä¿¡æ¯ã€‚</p><h3 id="lab1">Lab1</h3><h3 id="to-conclude">To conclude</h3><p>åœ¨å­¦ä¹ è¿‡ç¨‹ç”¨åˆ°çš„èµ„æ–™åˆ—ä¸¾å¦‚ä¸‹:</p><p><a href="https://mit-public-courses-cn-translatio.gitbook.io/mit6-824/" target="_blank" rel="noopener">MIT6.824ä¸­æ–‡ç¿»è¯‘</a></p><p><a href="https://go-zh.org/doc/" target="_blank" rel="noopener">Goæ–‡æ¡£</a></p><p><a href="https://book.itsfun.top/gopl-zh/" target="_blank" rel="noopener">Goè¯­è¨€åœ£ç»</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;abstract&quot;&gt;Abstract&lt;/h3&gt;
&lt;p&gt;æœ€è¿‘ç»ˆäºæœ‰æ—¶é—´ç ”ç©¶ä¸€ä¸‹MITçš„&lt;a href=&quot;https://pdos.csail.mit.edu/6.824/schedule.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ç¥è¯¾&lt;/a&gt;&lt;code&gt;6.824&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é—¨è¯¾æ•™&lt;code&gt;Distributed System&lt;/code&gt;ï¼Œå³å¤šå°ç‰©ç†éš”ç¦»çš„è®¡ç®—æœºé€šè¿‡ç½‘ç»œæ¥åè°ƒï¼Œå…±åŒå®Œæˆä¸€è‡´æ€§ä»»åŠ¡ï¼Œå¯ä»¥æ˜¯è®¡ç®—ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å­˜å‚¨ä»»åŠ¡ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åˆ†å¸ƒå¼ç³»ç»Ÿ&lt;/strong&gt;å’Œå•æœºç›¸æ¯”ï¼Œé™¤äº†æœ‰å¾ˆå¤šé«˜å¹¶å‘çš„&lt;code&gt;Partial Failures&lt;/code&gt;ï¼Œæ›´å¤šçš„æ˜¯ç¡¬ä»¶è€åŒ–ï¼Œæ–­ç”µï¼Œç½‘å¡å¤±çµç­‰è¿™ç§ç°å®é—®é¢˜ã€‚å› æ­¤è®¾è®¡ä½æˆæœ¬é«˜æ€§èƒ½ç³»ç»Ÿä»¥åŠå¤„ç†å¹¶å‘å’Œç½‘ç»œé—®é¢˜â€”â€”&lt;strong&gt;&lt;code&gt;Performance&lt;/code&gt;æ€§èƒ½å’Œ&lt;code&gt;Fault Tolerance&lt;/code&gt;å®¹é”™&lt;/strong&gt;æ˜¯è¿™é—¨è¯¾çš„æ ¸å¿ƒã€‚&lt;/p&gt;
&lt;p&gt;è¯¾ç¨‹å…±æœ‰20ä¸ª&lt;code&gt;Lectures&lt;/code&gt;å’Œ4ä¸ª&lt;code&gt;labs&lt;/code&gt;ã€‚å’Œ&lt;code&gt;6.828&lt;/code&gt;ä¸€æ ·é‡è§†å®è·µâ€”â€”&lt;strong&gt;çœ‹è®ºæ–‡ï¼ŒæŸ¥èµ„æ–™ï¼Œåš&lt;code&gt;lab&lt;/code&gt;&lt;/strong&gt;~ç®€å•ç²—æš´ã€‚æ‰€ä»¥å­¦ä¹ è¿‡ç¨‹åŸºæœ¬ä¸Šå°±æŒ‰ç…§å¦‚ä¸‹æ¨è¿›ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æå‰çœ‹&lt;code&gt;Lecture&lt;/code&gt;è¦æ±‚çš„&lt;code&gt;papers&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¬&lt;a href=&quot;https://www.bilibili.com/video/BV1R7411t71W?spm_id_from=333.999.0.0&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å¯¹åº”&lt;/a&gt;çš„&lt;code&gt;Lectures&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;æŸ¥æ‰¾&lt;code&gt;lab&lt;/code&gt;ç›¸å…³çš„å­¦ä¹ èµ„æ–™&lt;/li&gt;
&lt;li&gt;åš&lt;code&gt;lab&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¹‹å‰åš&lt;code&gt;6.828&lt;/code&gt;çš„æ—¶å€™å°±å‘ç°æˆ‘åœ¨åšè¿™ç§&lt;strong&gt;å­¦ä¹ è¿‡ç¨‹å¾ˆé•¿ï¼Œæ€è€ƒå†…å®¹åˆå¾ˆæ·±&lt;/strong&gt;çš„è¯¾ç¨‹è®­ç»ƒæ—¶å¾ˆå®¹æ˜“é’»ç‰›è§’å°–è€Œè®©è‡ªå·±ä¹±äº†èŠ‚å¥ï¼Œæ€ç»´å¦‚è‹¥ä¸èƒ½æ”¾æ¾ä¸‹æ¥æ•ˆæœè‚¯å®šä¸ä¼šå¤ªå¥½â€”â€”å¸Œæœ›è¿™æ¬¡èƒ½å°½é‡è°ƒæ•´è¿‡æ¥ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Golang" scheme="http://haotianmcihael.github.io/categories/Golang/"/>
    
    
      <category term="Distributed System" scheme="http://haotianmcihael.github.io/tags/Distributed-System/"/>
    
      <category term="MapReduce" scheme="http://haotianmcihael.github.io/tags/MapReduce/"/>
    
      <category term="MIT6.824" scheme="http://haotianmcihael.github.io/tags/MIT6-824/"/>
    
  </entry>
  
  <entry>
    <title>Type system, a Sketchy view.</title>
    <link href="http://haotianmcihael.github.io/2021/06/16/Type-system-a-Sketchy-view/"/>
    <id>http://haotianmcihael.github.io/2021/06/16/Type-system-a-Sketchy-view/</id>
    <published>2021-06-15T18:02:32.000Z</published>
    <updated>2022-03-16T10:35:29.552Z</updated>
    
    <content type="html"><![CDATA[<h3 id="abstract">Abstract</h3><p><code>Type system</code>çš„åŸºæœ¬ç›®çš„æ˜¯é˜²æ­¢åœ¨ç¨‹åºè¿è¡Œæ—¶å‘ç”Ÿ<code>execution error</code>ã€‚è¿™ç§<code>Informal statement</code>å³éå½¢å¼åŒ–æè¿°æœ‰å¾ˆå¤šå†…æ¶µï¼šé¦–å…ˆè¯¥å¦‚ä½•ä¸¥æ ¼å®šä¹‰<code>execution error</code>ï¼›å…¶æ¬¡åœ¨è¿™ç§å®šä¹‰ä¸‹ï¼Œæè¿°<code>absence of execution error</code>ä¹Ÿæ˜¯<code>Type syatem</code>å¾ˆ<code>nontrivial</code>çš„æ€§è´¨â€”â€”å½“ä¸€å¥—ç¼–ç¨‹è¯­è¨€çš„æ‰€æœ‰è¿è¡Œæ—¶è¡Œä¸ºéƒ½èƒ½ç¡®ä¿è¿™ç§æ€§è´¨çš„è¯ï¼Œæˆ‘ä»¬å°±è¯´è¯¥è¯­è¨€æ˜¯<code>type sound</code>çš„ã€‚äº‹å®è¯æ˜ä¸ºäº†æ›´åŠ æ²¡æœ‰æ­§ä¹‰çš„æè¿°ç¼–ç¨‹è¯­è¨€çš„<code>type soundness</code>ï¼Œéœ€è¦åšå¤§é‡çš„åˆ†æå’Œè¯æ˜ã€‚å› æ­¤é’ˆå¯¹<code>Type system</code>çš„åˆ†ç±»ï¼Œæè¿°å’Œç ”ç©¶è¿‡ç¨‹é€æ¸æ¼”å˜æˆä¸ºä¸€å¥—<code>formal discipline</code>å³å½¢å¼åŒ–ä½“ç³»ã€‚ <span class="math display">\[\frac{\Gamma_{1} \vdash \Im_{1}  ...  \Gamma_{n} \vdash \Im_{n}}{\Gamma \vdash \Im}\]</span></p><p><code>The formalization of Type system</code>éœ€è¦ä¸€å¥—ç²¾ç¡®çš„ç¬¦å·å’Œå®šä¹‰ç³»ç»Ÿï¼Œä»¥ä¾¿å¯¹è¿™äº›å½¢å¼å±æ€§è¿›è¡Œä¸¥æ ¼çš„è¯æ˜ä»¥ç¡®ä¿å…¶æ­£ç¡®æ€§ã€‚ä½†æ˜¯åº”è¯¥åŠ¡å®ï¼Œç›´è§‰ä¸»ä¹‰â€”â€”å³å½¢å¼åŒ–çš„ç›®çš„ä¸èƒ½ä»¥ç‰ºç‰²<code>Type system</code>çš„æ˜“ç”¨æ€§å’Œæµç•…æ€§ä¸ºä»£ä»·ã€‚è¿™æ ·çš„è®¾è®¡ä¸ä»…å¯ä»¥é¿å…å„å¼å„æ ·çš„è¿è¡Œæ—¶é™·é˜±ï¼Œè€Œä¸”å¯ä»¥ä¿ƒè¿›è¯­è¨€è®¾è®¡çš„<code>regularity</code>å’Œ<code>orthogonality</code>ã€‚</p><p>ä¸€ä¸ª<strong>ä¸¥æ ¼æ­£ç¡®</strong>çš„<code>Type system</code>å¯ä»¥å¯¹ä¸€é—¨è¯­è¨€å®šä¹‰çš„å„ä¸ªé‡è¦æ€§è´¨è¿›è¡Œ<strong>å®Œæ•´</strong>çš„åˆ¤æ–­ã€‚è€Œéå½¢å¼åŒ–çš„æè¿°ç”šè‡³åšä¸åˆ°å®Œæ•´æ¦‚æ‹¬è¯­è¨€çš„<code>type structure</code>åˆ™æ›´è°ˆä¸ä¸Šå®ç°ä¸Šçš„å”¯ä¸€æ€§ã€‚æ¯”å¦‚ä¸åŒçš„ç¼–è¯‘å™¨å¯¹äºåŒä¸€å¥—è¯­è¨€<code>Type system</code>çš„å®ç°å¾€å¾€ä¸å°½ç›¸åŒï¼Œç”šè‡³æœ‰ä¸€äº›<code>type unsound</code>çš„è¯­è¨€å®šä¹‰å¯¼è‡´ä¸€æ®µä»£ç æ˜æ˜é€šè¿‡<code>typechecker</code>çš„æ£€æŸ¥ä½†åœ¨è¿è¡Œæ—¶å¥”æºƒæ‰ã€‚ç†æƒ³æƒ…å†µä¸‹æˆ‘ä»¬è¯´<code>formal Type system</code>åº”è¯¥æ˜¯æ‰€æœ‰<code>typed programming languages</code>å†…æ ¸å®šä¹‰çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ ·çš„è¯ï¼Œ<code>typechecking</code>ç®—æ³•å°±å¯ä»¥ä¸¥æ ¼æŒ‰ç…§ç²¾ç¡®çš„ç±»å‹<code>spec</code>æ‰§è¡Œï¼Œä»æŸç§ç¨‹åº¦ä¸Šè¯¥è¯­è¨€å¯ä»¥çœ‹æˆæ˜¯<code>Type sound</code>çš„ã€‚</p><a id="more"></a><h3 id="introduction">Introduction</h3>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;abstract&quot;&gt;Abstract&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;Type system&lt;/code&gt;çš„åŸºæœ¬ç›®çš„æ˜¯é˜²æ­¢åœ¨ç¨‹åºè¿è¡Œæ—¶å‘ç”Ÿ&lt;code&gt;execution error&lt;/code&gt;ã€‚è¿™ç§&lt;code&gt;Informal statement&lt;/code&gt;å³éå½¢å¼åŒ–æè¿°æœ‰å¾ˆå¤šå†…æ¶µï¼šé¦–å…ˆè¯¥å¦‚ä½•ä¸¥æ ¼å®šä¹‰&lt;code&gt;execution error&lt;/code&gt;ï¼›å…¶æ¬¡åœ¨è¿™ç§å®šä¹‰ä¸‹ï¼Œæè¿°&lt;code&gt;absence of execution error&lt;/code&gt;ä¹Ÿæ˜¯&lt;code&gt;Type syatem&lt;/code&gt;å¾ˆ&lt;code&gt;nontrivial&lt;/code&gt;çš„æ€§è´¨â€”â€”å½“ä¸€å¥—ç¼–ç¨‹è¯­è¨€çš„æ‰€æœ‰è¿è¡Œæ—¶è¡Œä¸ºéƒ½èƒ½ç¡®ä¿è¿™ç§æ€§è´¨çš„è¯ï¼Œæˆ‘ä»¬å°±è¯´è¯¥è¯­è¨€æ˜¯&lt;code&gt;type sound&lt;/code&gt;çš„ã€‚äº‹å®è¯æ˜ä¸ºäº†æ›´åŠ æ²¡æœ‰æ­§ä¹‰çš„æè¿°ç¼–ç¨‹è¯­è¨€çš„&lt;code&gt;type soundness&lt;/code&gt;ï¼Œéœ€è¦åšå¤§é‡çš„åˆ†æå’Œè¯æ˜ã€‚å› æ­¤é’ˆå¯¹&lt;code&gt;Type system&lt;/code&gt;çš„åˆ†ç±»ï¼Œæè¿°å’Œç ”ç©¶è¿‡ç¨‹é€æ¸æ¼”å˜æˆä¸ºä¸€å¥—&lt;code&gt;formal discipline&lt;/code&gt;å³å½¢å¼åŒ–ä½“ç³»ã€‚ &lt;span class=&quot;math display&quot;&gt;\[
\frac{\Gamma_{1} \vdash \Im_{1}  ...  \Gamma_{n} \vdash \Im_{n}}{\Gamma \vdash \Im}
\]&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;The formalization of Type system&lt;/code&gt;éœ€è¦ä¸€å¥—ç²¾ç¡®çš„ç¬¦å·å’Œå®šä¹‰ç³»ç»Ÿï¼Œä»¥ä¾¿å¯¹è¿™äº›å½¢å¼å±æ€§è¿›è¡Œä¸¥æ ¼çš„è¯æ˜ä»¥ç¡®ä¿å…¶æ­£ç¡®æ€§ã€‚ä½†æ˜¯åº”è¯¥åŠ¡å®ï¼Œç›´è§‰ä¸»ä¹‰â€”â€”å³å½¢å¼åŒ–çš„ç›®çš„ä¸èƒ½ä»¥ç‰ºç‰²&lt;code&gt;Type system&lt;/code&gt;çš„æ˜“ç”¨æ€§å’Œæµç•…æ€§ä¸ºä»£ä»·ã€‚è¿™æ ·çš„è®¾è®¡ä¸ä»…å¯ä»¥é¿å…å„å¼å„æ ·çš„è¿è¡Œæ—¶é™·é˜±ï¼Œè€Œä¸”å¯ä»¥ä¿ƒè¿›è¯­è¨€è®¾è®¡çš„&lt;code&gt;regularity&lt;/code&gt;å’Œ&lt;code&gt;orthogonality&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ª&lt;strong&gt;ä¸¥æ ¼æ­£ç¡®&lt;/strong&gt;çš„&lt;code&gt;Type system&lt;/code&gt;å¯ä»¥å¯¹ä¸€é—¨è¯­è¨€å®šä¹‰çš„å„ä¸ªé‡è¦æ€§è´¨è¿›è¡Œ&lt;strong&gt;å®Œæ•´&lt;/strong&gt;çš„åˆ¤æ–­ã€‚è€Œéå½¢å¼åŒ–çš„æè¿°ç”šè‡³åšä¸åˆ°å®Œæ•´æ¦‚æ‹¬è¯­è¨€çš„&lt;code&gt;type structure&lt;/code&gt;åˆ™æ›´è°ˆä¸ä¸Šå®ç°ä¸Šçš„å”¯ä¸€æ€§ã€‚æ¯”å¦‚ä¸åŒçš„ç¼–è¯‘å™¨å¯¹äºåŒä¸€å¥—è¯­è¨€&lt;code&gt;Type system&lt;/code&gt;çš„å®ç°å¾€å¾€ä¸å°½ç›¸åŒï¼Œç”šè‡³æœ‰ä¸€äº›&lt;code&gt;type unsound&lt;/code&gt;çš„è¯­è¨€å®šä¹‰å¯¼è‡´ä¸€æ®µä»£ç æ˜æ˜é€šè¿‡&lt;code&gt;typechecker&lt;/code&gt;çš„æ£€æŸ¥ä½†åœ¨è¿è¡Œæ—¶å¥”æºƒæ‰ã€‚ç†æƒ³æƒ…å†µä¸‹æˆ‘ä»¬è¯´&lt;code&gt;formal Type system&lt;/code&gt;åº”è¯¥æ˜¯æ‰€æœ‰&lt;code&gt;typed programming languages&lt;/code&gt;å†…æ ¸å®šä¹‰çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ ·çš„è¯ï¼Œ&lt;code&gt;typechecking&lt;/code&gt;ç®—æ³•å°±å¯ä»¥ä¸¥æ ¼æŒ‰ç…§ç²¾ç¡®çš„ç±»å‹&lt;code&gt;spec&lt;/code&gt;æ‰§è¡Œï¼Œä»æŸç§ç¨‹åº¦ä¸Šè¯¥è¯­è¨€å¯ä»¥çœ‹æˆæ˜¯&lt;code&gt;Type sound&lt;/code&gt;çš„ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="ğ›Œ" scheme="http://haotianmcihael.github.io/categories/%F0%9D%9B%8C/"/>
    
    
      <category term="PL" scheme="http://haotianmcihael.github.io/tags/PL/"/>
    
      <category term="Type System" scheme="http://haotianmcihael.github.io/tags/Type-System/"/>
    
  </entry>
  
  <entry>
    <title>NJUé™æ€ç¨‹åºåˆ†æ(5-IFDS-And-Soundiness)</title>
    <link href="http://haotianmcihael.github.io/2021/06/06/NJU%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90-5-IFDS/"/>
    <id>http://haotianmcihael.github.io/2021/06/06/NJUé™æ€ç¨‹åºåˆ†æ-5-IFDS/</id>
    <published>2021-06-06T15:54:46.000Z</published>
    <updated>2022-03-16T09:57:13.902Z</updated>
    
    <content type="html"><![CDATA[<h3 id="abastract">Abastract</h3><p>åœ¨<code>IFDS</code>å‡ºç°ä¹‹å‰ï¼Œç»å…¸<code>intra-procedural analysis</code>æ¡†æ¶(<font color="red">D</font>,<font color="green">L</font>,<font color="blue">F</font>)å¯¹äºç¨‹åºåˆ†æé—®é¢˜çš„ç ”ç©¶è¿˜åœç•™åœ¨â‘ å¤šé¡¹å¼æ—¶é—´å¤„ç†<code>specific individual problem</code>æ¯”å¦‚<code>constant propagation/pointer analysis</code>â‘¡å¤šé¡¹å¼æ—¶é—´å¤„ç†<code>locally separable proble</code>ï¼ˆç»å…¸<code>bit-vector/gen-kill</code>é—®é¢˜â€”â€”<code>reaching definitions,available expressions,live variabl</code>çš„è¿‡ç¨‹é—´åˆ†æï¼‰â‘¢å¯¹æ™®éåˆ†æé—®é¢˜æä¾›<strong>éå¤šé¡¹å¼æ—¶é—´</strong>çš„ç®—æ³•æ–¹æ¡ˆã€‚</p><p>éšç€<code>POPL'1995</code>å‘è¡¨çš„<a href="http://web.cs.ucla.edu/~harryxu/courses/253/sp2013/papers/popl95.pdf" target="_blank" rel="noopener">Precise Interprocedural Dataflow Analysis via Graph Reachability</a>é€šè¿‡å°†ä¸€ç±»<code>inter-procedural analysis</code>é—®é¢˜è½¬åŒ–ä¸º<code>a special kind of graph-reachability problem</code>å›¾å¯è¾¾æ€§é—®é¢˜â€”â€”<font color="red"><code>IFDS</code></font>æ¡†æ¶æ¨ªç©ºå‡ºä¸–ã€‚<strong><code>IFDS</code>é™¤äº†é’ˆå¯¹<code>separable problems</code>ï¼Œè¿˜é’ˆå¯¹åŒ…æ‹¬<code>truly-live variables,copy constant propagation,possibly-uninitialized variablestruly-live variables</code>åœ¨å†…çš„<code>non-separable problems</code>ç­‰ä¸€å¤§ç±»æ™®éæ€§åˆ†æé—®é¢˜éƒ½æä¾›äº†å¤šé¡¹å¼æ—¶é—´çš„ç²¾ç¡®è§£å†³æ‰‹æ®µã€‚</strong>ç”±äº<code>IFDS</code>æœ¬èº«çš„çº¦æŸï¼Œä½œè€…åœ¨<code>Theoretical Computer Science'1996</code>ä¸Šè¿˜å‘è¡¨è¿‡ä¸€ç¯‡<a href="https://pdf.sciencedirectassets.com/271538/1-s2.0-S0304397500X00448/1-s2.0-0304397596000722/main.pdf?X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMr%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLWVhc3QtMSJIMEYCIQDHEEjOJdEm0cLtUB%2BHaJKZnI%2BPN5tMP4ElOR%2FgbYtzIgIhAJLujFNrXghpU6i4dLJlbR4WmRz%2FBokVzMrouNR8thheKvoDCEMQBBoMMDU5MDAzNTQ2ODY1IgwWTLJMo41Prpn%2F%2FEgq1wPGTtVLFsiVIF9uO3Jqe%2Fc7DNIZ2aCoMKASRnKPldZG3DL%2Fkla1b4JCb1utfraGJZeeG8LZFHTKpNPPAfY8Ax4cYe2D2fM1efeJUEv%2FGD2v21Ge7INGhUegLgtSJXoz%2FTGqXHronY0wS56U4dQHPyuDJ9pJYu8tQi5bCN93m1E%2BvoIrIoPK1IBlinh9LCUHfggCjlfJcrUWdkz6FvAO9pGlBB2bSWVrDJQZhf6k8%2FEA5%2BXg3GaNvYrHvzSnNokhfIAooqmnr9POzK6%2B3%2Fx0h%2Bs4dh9hNMSBVThSuNZlmYyRaRKHAukdzlgx7Lu9cQrKYEbMA9sr6UbY1CBGWM0IkEQ7hmxoPj3%2BkLlagNcZRd2FVg7zQcCPjdYrEeuUM6FicieZyU64gwrF%2Fl2Jq9GQPaZpYcndiEruIB8ggW%2F6moNCZs2IDLW40fNnp3Hm32GGMPuJDgPa9Yg7iD9Rfrr7uPhjSB8oKcpFqUKwmYqMn4W6pM74elsDHPsbw%2FsaqXNJCU42md6tfWSTBmByS3IQHgs6NpJWs3QckjVDmQYfTXv%2FgpMfrR%2FVnq7q6gGUgGrsgttCWa9VagHvZlUoLrIsFwlkjVjx7LNyflLfYyQBjsMjVKKQ7qw9kLMwrfi2kQY6pAGC4F0%2Bu4eJObfe5rQlGYJgI2OFVr6PyiBiTn4XcTtHOC2fbkj4Rre9Pj4QydLxF0oSXJqJCXkBJhzxpC9ouKJpDzYffbmPkpIA6rzdujGyRGluGCeiM2cOu7JtFEx1nvPsB%2BLlMN8JJBJQL3QWxnV36yu6ycImjADRWzn2Oe1Hn59BdoZO9nzL8zTLFHgS9jRZeYlTJQnh6FZe4I4upbqHwxemIw%3D%3D&amp;X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Date=20220313T104326Z&amp;X-Amz-SignedHeaders=host&amp;X-Amz-Expires=300&amp;X-Amz-Credential=ASIAQ3PHCVTY3WOOQG6M%2F20220313%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Signature=d189220faa10689b60977d689048eeee379847ff107227365fec1a7742463d7d&amp;hash=c12a21daeaec6fe0aaf5b9fb5ec0259bf755743c2eea8ab65f566cece9ee2d36&amp;host=68042c943591013ac2b2430a89b270f6af2c76d8dfd086a07176afe7c76c2c61&amp;pii=0304397596000722&amp;tid=spdf-17632b09-bb7d-4bc0-9605-080c373f0575&amp;sid=d0b19308547fc443ae8b53f5ca290b286a01gxrqa&amp;type=client&amp;ua=50040252510d525a5a05&amp;rr=6eb42b298d006da7" target="_blank" rel="noopener">Precise interprocedural dataflow analysis with applications to constant propagation</a>æå‡º<code>IDE</code>æ¡†æ¶æ¥å¤„ç†<code>interprocedural constant propagation</code>ç­‰<code>IFDS</code>æ¡†æ¶å¤„ç†ä¸äº†çš„<code>non-distributive</code>é—®é¢˜ã€‚è¿™ä¸¤ç¯‡è®ºæ–‡ä¸ºç¨‹åºåˆ†æé¢†åŸŸå¼•å…¥æ–°çš„è¡€æ¶²ã€‚</p><p>è¿‘å¹´<code>Sparse Value IFDS,Disk-Assisted IFDS</code>ç­‰è¯¾é¢˜ä¸€ç›´æ˜¯å­¦æœ¯ç•Œçš„ç ”ç©¶çƒ­ç‚¹ã€‚åœ¨å·¥ä¸šç•Œæ¯”å¦‚<a href="https://linkspringer.53yu.com/content/pdf/10.1007%2F978-3-030-17465-1.pdf" target="_blank" rel="noopener">phasar</a>ç­‰ç¨‹åºåˆ†æå·¥å…·ä¸­<code>IFDS/IDE</code>ä¹Ÿæœ‰å…·ä½“<a href="https://github.com/secure-software-engineering/phasar" target="_blank" rel="noopener">å®ç°</a>ã€‚</p><a id="more"></a><h3 id="cfl-reachability">CFL-Reachability</h3><p>é¦–å…ˆä»‹ç»å›¾å¯è¾¾æ€§çš„æ¦‚å¿µã€‚</p><h4 id="feasible-and-realizable-paths">Feasible and Realizable Paths</h4><p>è¿‡ç¨‹é—´æ•°æ®æµåˆ†æçœŸæ­£ç”¨äºå·¥ç¨‹è½åœ°ä¹‹åçš„å¤æ‚åº¦å¾€å¾€æ˜¯å¾ˆé«˜çš„ï¼Œå³<code>ICFG</code>çš„è¾¹å‡ºç°è·¯åŠ²çˆ†ç‚¸å¯¼è‡´åˆ†æé€Ÿåº¦å˜æ…¢ã€‚ç©¶å…¶æ ¹æœ¬åŸå› ï¼Œæ˜¯å› ä¸ºåœ¨è¿™äº›<code>edges</code>ä¸­æœ‰ä¸€äº›å±äºä¸å¯è¾¾è¾¹â€”â€”<code>Infeasible paths</code>ã€‚</p><p>Paths in CFG that do not correspond to actual executions is Infeasible paths.</p><p>å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿå°½å¯èƒ½çš„é˜²æ­¢<code>CFG</code>è¢«<code>Infeasible paths</code>æ‰€æ±¡æŸ“ï¼Œè®©åˆ†ææµå›¾è¾¹çš„æ›´åŠ ç®€æ´ï¼ŒåŠ¿å¿…å¤§å¤§æå‡åˆ†æé€Ÿåº¦ã€‚<strong>ä½†æ˜¯å®é™…æƒ…å†µä¸‹è¿™ç§<code>infeasible paths</code>å¾€å¾€æ— æ³•åˆ¤å®šã€‚</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">foo(int age) &#123;    //ageåªä¼šæ˜¯Positiveï¼Œæ‰€ä»¥ä¸€æ¡åˆ†æ”¯è‚¯å®šä¸ä¼šè¢«æ‰§è¡Œ</span><br><span class="line">if(age &gt;= 0) </span><br><span class="line">r = age;</span><br><span class="line">else </span><br><span class="line">r = -1;  //ä½†æ˜¯ç¨‹åºåœ¨é™æ€æ—¶è¯¥æ¡è·¯å¾„æ— æ³•åˆ¤å®šå…¶å¯æ‰§è¡Œæ€§</span><br><span class="line">return r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="realizable-paths">Realizable Paths</h5><p>The paths in which &quot;returns&quot; are matched with corresponding &quot;calls&quot;.</p><p>å¦‚æœä¸€æ¡è°ƒç”¨è¾¹ï¼Œå…¶return-edgeå¯ä»¥æ­£ç¡®åŒ¹é…åˆ°å…¶call-edgeï¼Œåˆ™ç§°è¿™æ¡è¾¹æ˜¯<code>realizable</code>çš„ã€‚<strong>æ—¢ç„¶<code>infeasible</code>ä¸å¯åˆ¤å®šï¼Œä¾¿å¼•å…¥å…¶å­é›†â€”â€”å› ä¸º<code>realizable paths</code>å¯èƒ½ä¸ä¼šè¢«æ‰§è¡Œåˆ°ï¼Œä½†æ˜¯<code>unrealizable paths</code>åˆ™ä¸€å®šä¸ä¼šè¢«æ‰§è¡Œåˆ°ï¼Œè€Œ<code>unrealizable paths</code>åˆ™æ˜¯å¯åˆ¤å®šçš„ã€‚</strong></p><p><img src="1.png" width="50%" height="50%" alt=""></p><p><strong>å¯»æ‰¾è¿™æ ·çš„<code>realizable paths</code>æ¥æ˜¯<code>IFDS</code>é¡ºåˆ©æ‰§è¡Œçš„å‰æï¼Œ</strong>ä¸‹é¢å¼•å…¥ä¸€ç§ç³»ç»Ÿçš„æ–¹å¼è¯†åˆ«<code>realizable paths</code>â€”â€”<code>CFL-Reachability</code>ã€‚</p><h4 id="cfl-reachabiligy">CFL-Reachabiligy</h4><p>A path is considered to connect two nodes A and B, or<font color="red"> B is reachable from A</font>. Only if the concatenation of the labels on the edges of the path is a word in a specified <font color="red">context-free language</font>.</p><p>å¯¹äºAå’ŒBä¸¤ä¸ª<code>node</code>ä¹‹é—´æœ‰ä¸€æ¡<code>path</code>ï¼ˆä¸€ç³»åˆ—<code>edge</code>ç»„æˆçš„ï¼Œæ¢å¥è¯è¯´Bå¯è¾¾Aï¼‰å¹¶ä¸”è¿™æ¡<code>path</code>ä¸Šçš„æ‰€æœ‰<code>edge</code>çš„<code>labels</code>æ„æˆçš„å•è¯æ˜¯<strong>ç”±äº‹å…ˆè§„å®šçš„context-free languageå®šä¹‰å¥½çš„åˆæ³•å•è¯çš„è¯ï¼Œ</strong>å°±è¯´<font color="red">B is CFL-Reachable from A.</font></p><h5 id="context-free-grammer">context-free grammer</h5><p>ä¸Šä¸‹æ–‡æ— å…³è¯­è¨€<code>context-free language</code>æŒ‡çš„æ˜¯ç”±ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•<code>context-free grammer</code>äº§ç”Ÿçš„è¯­è¨€ã€‚</p><p>ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•æ˜¯ä¸€ç§å½¢å¼è¯­è¨€ç”¨äºæè¿°æŸç§è¯­æ³•ï¼Œå®ƒçš„ä¸»è¦å½¢å¼å°±æ˜¯ï¼šS âŸ¶ ğª. è¿™æ˜¯ä¸€ç§äº§ç”Ÿå¼ã€‚Sä»£è¡¨éç»ˆç»“ç¬¦è€Œğªä»£è¡¨ä¸€ç³»åˆ—ç»ˆç»“ç¬¦æˆ–è€…ç©ºæ ¼ã€‚æ¯”å¦‚CFGçš„æ–‡æ³•å¦‚ä¸‹çš„è¯ï¼š</p><ul><li>S âŸ¶ aSb</li><li>S âŸ¶ â„‡</li></ul><p>è¿™é‡Œçš„ğªå°±æ˜¯<code>aSb/â„‡</code>ï¼Œä¸Šä¸‹æ–‡æ— å…³<code>context-free</code>çš„æ„æ€å°±æ˜¯è¯´åœ¨<strong>ä»»ä½•å‡ºç°Sçš„åœ°æ–¹</strong>éƒ½å¯ä»¥ä½¿ç”¨<code>aSb/â„‡</code>æ¥æ›¿æ¢ã€‚</p><h5 id="partially-balanced-parenthesis-problem">Partially Balanced-Parenthesis Problem</h5><p>å°†å¯»æ‰¾<code>realizable paths</code>æŠ½è±¡æˆä¸ºå…¸å‹çš„æ‹¬å·åŒ¹é…é—®é¢˜ã€‚è¿™é‡Œçš„<code>Partially</code>æŒ‡çš„æ˜¯)<sub>i</sub>ä¸€å®šä¼šæœ‰ä¸€ä¸ª(<sub>i</sub>åŒ¹é…ï¼Œæ¢å¥è¯è®²å°±æ˜¯è¯´å¯¹äºæ¯ä¸€ä¸ª<code>return-edge</code>éƒ½æœ‰ä¼šæœ‰ä¸€ä¸ª<code>call-edge</code>åŒ¹é…ï¼Œä½†æ˜¯æ¯ä¸€ä¸ª<code>call-edge</code>å´ä¸ä¸€å®šæœ‰è¿”å›å€¼ï¼ˆæ¯”å¦‚<code>realizable but not infeasiable paths</code>ï¼‰ã€‚<strong>é—®é¢˜çš„æ•´ä¸ªå»ºæ¨¡è¿‡ç¨‹ä¸ºï¼šå¯¹<code>control-flow graph</code>ä¸Šçš„æ‰€æœ‰<code>edge</code>éƒ½åŠ ä¸Šä¸€ä¸ª<code>label</code>ï¼Œå¯¹äºä¸€ä¸ª<code>call</code>è¯­å¥<code>i</code>ï¼Œå…¶<code>call-edge</code>è¢«æ ‡è®°ä¸º(<sub>i</sub>å…¶<code>return-edge</code>è¢«æ ‡è®°ä¸º)<sub>i</sub>ï¼Œè€Œå…¶ä½™æ‰€æœ‰çš„<code>edge</code>éƒ½è¢«æ ‡è®°ä¸º<code>e</code>ã€‚</strong></p><p>A path is a realizable path if thee path' word is in the language L(realizable).æ¯”å¦‚</p><ul><li><font color="green">(<sub>1</sub>(<sub>2Â </sub>e )<sub>2</sub>)<sub>1</sub></font><font color="red">(<sub>3Â </sub></font></li><li><font color="green">(<sub>1</sub>(<sub>2 </sub>e )<sub>2</sub>)<sub>1</sub></font><font color="red">(<sub>3 </sub>(<sub>4</sub></font></li><li><font color="green">(<sub>1</sub>(<sub>2 </sub>e e e )<sub>2</sub>)<sub>1</sub></font><font color="red">(<sub>3 </sub>(<sub>4</sub></font></li><li><font color="blue">e e</font><font color="green">(<sub>1</sub>(<sub>2 </sub>e e e )<sub>2</sub>)<sub>1</sub></font><font color="red">(<sub>3 </sub>(<sub>4</sub></font> <font color="blue">e</font></li></ul><p>åˆ™æ ¹æ®æ‹¬å·åŒ¹é…è®¾è®¡çš„ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•å¦‚ä¸‹ï¼š</p><p><font color="blue">realizable</font> âŸ¶ <font color="green">mathched</font> <font color="blue">realizable</font></p><p>â€‹ âŸ¶ <font color="red">(<sub>i</sub></font> <font color="blue">realizable</font></p><p>â€‹ âŸ¶ <font color="blue">â„‡</font></p><p><font color="green">mathched</font> âŸ¶ <font color="red">(<sub>i</sub></font> <font color="green">mathched</font> <font color="red">)<sub>i</sub></font></p><p>â€‹ âŸ¶ <font color="blue">e</font></p><p>â€‹ âŸ¶ <font color="blue">â„‡</font></p><p>â€‹ âŸ¶ <font color="green">mathched matched</font></p><p><img src="2.png" width="50%" height="50%" alt=""></p><h3 id="ifds">IFDS</h3><p><code>IFDS</code>æ˜¯<code>Interproceduralï¼ŒFiniteï¼ŒDistributiveï¼ŒSubset Problems</code>çš„ç®€ç§°ã€‚æ€»ç»“æ¥å°±è¯´ï¼šIFDS is for interprocedural data flow analysis with <font color="red">distributive</font> flow functions over <font color="red">finite</font> domains.</p><p><code>IFDS</code>å°†ä¸€å¤§ç±»æ•°æ®æµåˆ†æé—®é¢˜è½¬åŒ–æˆä¸ºäº†å›¾å¯è¾¾æ€§é—®é¢˜è¿›è¡Œå¤„ç†ï¼Œç›¸æ¯”è¾ƒäºè¿­ä»£æ•°æ®æµæ¡†æ¶æä¾›äº†å¤šé¡¹å¼æ—¶é—´çš„ç²¾ç¡®å¤„ç†ã€‚ä½†æ˜¯<code>IFDS</code>å¿…é¡»åœ¨ä¸€å®šçš„çº¦æŸä¸‹æ‰å¯ä»¥ï¼š</p><p>å¾ˆå¤šæ™®éçš„æ•°æ®æµåˆ†æé—®é¢˜éƒ½æ˜¯<code>subset problem</code>â€”â€”é›†åˆçš„<code>union/intersection</code>ç­‰ï¼›è€Œ<code>Interprocedural</code>æŒ‡çš„æ˜¯å…¨ç¨‹åºåˆ†æï¼›<strong>è€Œè¯¥åˆ†æé—®é¢˜è¿˜æœ‰å¿…é¡»æœ‰ä¸€ä¸ª<code>distributive flow function</code>å¹¶ä¸”å…¶<code>domains</code>è¿˜æ˜¯<code>finite</code>æ‰å¯ä»¥ç”¨<code>IFDS</code>æ¥å¤„ç†ã€‚</strong></p><p>å°±æ¯”å¦‚<code>constant propagation</code>å°±ä¸å¯ä»¥ç”¨<code>IFDS</code>å¤„ç†ï¼Œå› ä¸ºå…¶<code>domains</code>æ˜¯ç†è®ºä¸Šæ‰€æœ‰çš„å¸¸æ•°æ‰€ä»¥æ˜¯<code>Infinite</code>ï¼Œè€Œä¸”è¯¥åˆ†ææœ¬èº«ä¹Ÿä¸æ˜¯<code>Distributive</code>ã€‚</p><h4 id="overview-of-ifds">Overview of IFDS</h4><h5 id="mrp">MRP</h5><p>è·Ÿ<code>Intra-procedural analysis</code>ä½¿ç”¨<code>meet-over-all-paths</code>æ¥è¡¡é‡åˆ†æçš„ç²¾åº¦ä¸€æ ·ï¼Œ<code>IFDS</code>ä¹Ÿä½¿ç”¨<code>meet-over-all-realizable-paths</code>æ¥è¡¡é‡å…¶åˆ†æç²¾åº¦ã€‚</p><p>æ ¹æ®MOP<sub>n</sub> = âŠ”<font color="green">(pâˆŠPaths(start, n))</font>pf<sub>p</sub>(âŠ¥)çš„å®šä¹‰ï¼Œå¯¹äºæ¯ä¸€ä¸ª<code>node</code>ç‚¹nï¼ŒMOP<sub>n</sub>è¡¨ç¤ºåœ¨<code>CFG</code>ä¸Šçš„<code>start</code>ç‚¹åˆ°<code>node</code>ç‚¹næ‰€æœ‰çš„<code>paths</code>çš„<code>union/intersection</code>æ“ä½œã€‚</p><p>è€Œæ ¹æ®MRP<sub>n</sub> = âŠ”<font color="green">(pâˆŠRPaths(start, n))</font>pf<sub>p</sub>(âŠ¥)çš„å®šä¹‰ï¼Œå¯¹äºæ¯ä¸€ä¸ª<code>node</code>ç‚¹nï¼ŒMRP<sub>n</sub>è¡¨ç¤ºåœ¨<code>CFG</code>ä¸Šçš„<code>start</code>ç‚¹åˆ°<code>node</code>ç‚¹næ‰€æœ‰çš„<font color="red">realizable pathsï¼ˆè¿™äº›pathsçš„labelæ„æˆçš„wordç¬¦åˆ<code>realizalble</code>è¯­è¨€çš„ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼‰</font>çš„<code>union/intersection</code>æ“ä½œã€‚</p><p>æ ¹æ®ä¸¤ä¸ªç²¾åº¦è®¡ç®—æ–¹å¼çš„å®šä¹‰å¯ä»¥çœ‹å‡ºï¼ŒMRP<sub>n</sub>å¯¹é‚£äº›<code>unrealizable paths</code>è¿›è¡Œäº†å‰ªæä¼˜åŒ–ï¼Œå› æ­¤å…¶ç»“æœä¹Ÿæ¯”MOP<sub>n</sub>æ›´ç²¾ç¡®â€”â€”MRP<sub>n</sub> â‰¼ MOP<sub>n</sub>ã€‚</p><h5 id="algorithm">Algorithm</h5><p>é¦–å…ˆä»æ€»ä½“ä¸Šæ¦‚æ‹¬ä¸€ä¸‹<code>IFDS</code>çš„ç®—æ³•æ¡†æ¶ï¼š</p><p>è¾“å…¥ï¼šç¨‹åº<code>P</code>ï¼Œæ•°æ®æµåˆ†æé—®é¢˜<code>Q</code></p><ul><li>ä¸ºç¨‹åº<code>P</code>å»ºç«‹<code>superGraph G*</code>ï¼Œå¹¶æ ¹æ®åˆ†æé—®é¢˜<code>Q</code>ä¸º<code>G*</code>çš„æ¯ä¸€ä¸ª<code>edge</code>å®šä¹‰<code>flow functionsï¼ˆä½¿ç”¨ğ›Œè¡¨è¾¾å¼ï¼‰</code>(å¯ä»¥å¯¹æ¯”<code>intra-procedural analysis</code>ä¸ºæ¯ä¸€ä¸ª<code>node</code>å»ºç«‹<code>flow functinos</code>)</li><li>é€šè¿‡å°†<code>flow functions</code>è½¬åŒ–ä¸º<code>representation relations</code>ï¼ˆä¸€ç§å­å›¾ï¼‰çš„å½¢å¼æ¥å»ºç«‹ç¨‹åº<code>P</code>çš„<code>exploded supergraph G#</code></li><li>æœ€ååœ¨<code>G#</code>ä¸Šåº”ç”¨<code>tabulations algorithm</code>å°±å¯ä»¥å°†ç¨‹åº<code>Q</code>çš„åˆ†æé—®é¢˜å½“åšå›¾å¯è¾¾æ€§é—®é¢˜ä»è€Œæ±‚è§£ï¼ˆæ‰¾åˆ°<code>MRP solutions</code>ï¼‰</li></ul><p><font color="purple">Let n be a program point, data fact d âˆŠ MRP<sub>n</sub>, iff there is a realizable path in G# from &lt;S<sub>main</sub>, 0&gt; to &lt;n, d&gt;.</font></p><p><img src="3.png" width="50%" height="50%" alt=""></p><h4 id="supergraph-and-flow-functions">SuperGraph and Flow Functions</h4><h5 id="supergraph">SuperGraph</h5><p>å¼•å…¥<code>supergraph G* = (N*, E*)</code>ï¼Œ å¯¹äºè¿‡ç¨‹é—´æ•°æ®æµåˆ†æï¼Œæ¯ä¸€ä¸ª<code>procedure</code>éƒ½æ˜¯ä¸€ä¸ªæ§åˆ¶æµå›¾<code>G</code>ï¼Œæ¯ä¸€ä¸ª<code>G</code>éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„<code>start node</code><font color="blue">s<sub>pÂ </sub></font>å’Œ<code>exit node</code><font color="blue">e<sub>p</sub></font>ã€‚<code>IFDS</code>æ¡†æ¶å¤„ç†çš„å…¨ç¨‹åºçš„<code>superGraph G*</code>å°±æ˜¯è¿™äº›æ§åˆ¶æµå›¾çš„é›†åˆ{G<sub>1</sub>, G<sub>2</sub>....}ã€‚</p><p>è¿‡ç¨‹é—´åˆ†ææœ€é‡è¦çš„<code>procedure call</code>åˆ™éœ€è¦ä¸€ä¸ª<code>node</code>ç‚¹<font color="red">Call<sub>p</sub></font>å’Œä¸€ä¸ª<code>node</code>ç‚¹ <font color="red">Ret<sub>p</sub></font>ã€‚<code>G*</code>å¯¹äºæ¯ä¸€ä¸ª<code>procedure call</code>éƒ½éœ€è¦ä¸‰æ¡è¾¹ï¼š</p><ul><li><code>intra-procedural call-to-return-site edge</code>ï¼š<font color="red">Call<sub>pÂ </sub></font> âŸ¶ <font color="red">Ret<sub>p</sub></font></li><li><code>inter-procedural call-to-start edge</code>: <font color="red">Call<sub>p </sub></font> âŸ¶ <font color="blue">s<sub>p </sub></font></li><li><code>inter-procedural exit-to-return-site edge</code>: <font color="blue">e<sub>p</sub></font> âŸ¶ <font color="red">Ret<sub>p</sub></font></li></ul><h5 id="flow-functions">Flow Functions</h5><p>è®¾è®¡<code>flow function</code>æ˜¯æ ¹æ®å…·ä½“çš„ç¨‹åºåˆ†æé—®é¢˜ï¼Œä½¿ç”¨<code>ğ›Œ-expression</code>è¡¨ç¤ºçš„ã€‚</p><h4 id="exploded-supergraph-and-tabulation-algorithm">Exploded Supergraph and Tabulation Algorithm</h4><h5 id="exploded-supergraph">Exploded SuperGraph</h5><p>é€šè¿‡å°†<code>flow function</code>è½¬æ¢æˆä¸º<code>representation relations</code>å­å›¾æ¥å»ºé€ <code>exploded superGraph G#</code>ã€‚</p><p>æ¯ä¸€ä¸ª<code>flow function</code>è¢«ä¸€ä¸ª<code>2(D + 1)</code>ä¸ª<code>node</code>ç»„æˆçš„<code>Graph</code>ä»£è¡¨ï¼Œ<font color="blue">å…¶ä¸­<code>D</code>è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ª<code>dataflow facts</code>çš„<strong>æœ‰é™é›†åˆ</strong>ã€‚</font></p><p><img src="4.png" width="50%" height="50%" alt=""></p><p>è¿™é‡Œçš„<code>representation relation</code>R<sub>f</sub> âŠ† (D â‹ƒ 0) X (D â‹ƒ 0)ï¼Œç¬¦åˆå¦‚ä¸‹è§„åˆ™ï¼š</p><ul><li>{0, 0} <code>Edge</code>: <font color="red">0 âŸ¶ 0</font></li><li>{(0, y)|yâˆŠf(âˆ…)} <code>Edge:</code> <font color="red">0 âŸ¶ d<sub>1</sub></font></li><li>{(x, y)| yâˆ‰f(âˆ…) and yâˆŠf({x})} <code>Edge</code>: <font color="red">d<sub>1</sub> âŸ¶ d<sub>2</sub></font></li></ul><p>å…¶ä¸­<code>0</code>å’Œ<code>0</code>ä¹‹é—´è‡ªåŠ¨è¿ä¸€æ¡è¾¹ï¼›å¦‚æœåœ¨æ²¡æœ‰è¾“å…¥çš„æƒ…å†µä¸‹è¾“å‡ºä¸º<code>y</code>åˆ™è‡ªåŠ¨è¿ä¸€æ¡<code>0</code>åˆ°d<sub>1</sub>çš„è¾¹ï¼›å¦‚æœè¾“å…¥ä¸º<code>x</code>è€Œè¾“å‡ºæ˜¯<code>f</code>å¹¶ä¸”è¾“å…¥ä¸ºâˆ…çš„æ—¶å€™çš„è¾“å‡ºä¸ä¸º<code>y</code>ï¼Œåˆ™éœ€è¦åœ¨ä¸¤ä¸ª<code>dataflow facts</code>ä¹‹é—´è¿ä¸€æ¡è¾¹ã€‚</p><p>åœ¨å°†<code>superGraph G*</code>è½¬åŒ–ä¸º<code>exploded superGraph G#</code>çš„è¿‡ç¨‹ä¸­ï¼šå’Œä¼ ç»Ÿæ•°æ®æµåˆ†æä¸ä¸€æ ·çš„æ˜¯â€”â€”å…¶ä¸­çš„<code>edge</code>ä»£è¡¨äº†ä¸€ä¸ª<code>flow functino</code>ã€‚æ‰€ä»¥åœ¨è½¬åŒ–æ—¶å€™<code>G*</code>çš„æ¯ä¸€ä¸ª<code>node</code>éƒ½è¢«è½¬åŒ–æˆä¸º<code>D+1</code>ä¸ª<code>nodes</code>ï¼Œè€Œä¸€æ¡<code>edge</code>åˆ†åˆ«è¿æ¥çš„ä¸¤ä¸ª<code>D+1</code>ä¸ª<code>nodes</code>ï¼ˆæ•…ä¸€ä¸ª<code>flow function</code>è¢«è½¬åŒ–ä¸º<code>2(D+1)ä¸ªnode</code>ç»„æˆçš„å­å›¾ï¼‰å…±åŒè¢«è½¬åŒ–æˆä¸º<code>representation relation</code>å­å›¾ã€‚</p><h5 id="edge-00">Edge 0âŸ¶0</h5><p>å¯¹äºä¸€ä¸ªç‰¹å®šçš„æ•°æ®æµåˆ†æé—®é¢˜ï¼Œå®ƒæœ‰<code>D</code>ä¸ª<code>data facts</code>ã€‚ä½†æ˜¯åœ¨æ„é€ <code>exploded superGraph</code>çš„æ—¶å€™ä¸ºä»€ä¹ˆä¸€ä¸ª<code>node</code>éœ€è¦è½¬æ¢æˆä¸º<code>D + 1</code>ä¸ª<code>nodes</code>å‘¢ï¼Ÿ</p><p>å›é¡¾ä¸€ä¸‹ä¼ ç»Ÿçš„æ•°æ®æµåˆ†æï¼Œå¦‚æœæƒ³è¦ç¡®å®šä¸€ä¸ª<code>program point</code>æ˜¯å¦è¿˜ä¿æŒä¸€ä¸ª<code>data fact</code>æ¯”å¦‚<code>definition</code>æ˜¯å¦æ˜¯<code>reachable</code>çš„ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­ä»ç¨‹åºå…¥å£åˆ°è¯¥<code>program point</code>çš„æµåŠ¨ä¸­è¯¥<code>data fact</code>æ˜¯å¦ä¼šä¼ æ’­åˆ°è¯¥ç‚¹ã€‚</p><p><img src="5.png" width="50%" height="50%" alt=""></p><p>å³OUT[p] = f4â—‹f3â—‹f2â—‹f1(IN[n1])ã€‚å‡†ç¡®çš„è¯´<strong>Data facts are propagated via the composition of flow functions.</strong>â€”â€”è¿™é‡Œæœ€é‡è¦çš„æ˜¯ä¸€ä¸ª<strong>composition</strong>çš„æ¦‚å¿µï¼Œå®é™…ä¸Šå¯¹äº<code>IFDS</code>æ¡†æ¶æ¥è¯´ï¼Œå¦‚ä½•åœ¨å¦‚å›¾å¯è¾¾æ€§é—®é¢˜ä¸­å®ç°è¿™ç§è¿æ¥ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ•´ä¸ªåˆ†æçš„ç»“æœæ— æ³•æ²¿ç€<code>edge</code>è¿›è¡Œä¼ æ’­ï¼Œè€Œ<code>Glue Edge:0âŸ¶0</code>ä¾¿è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><h5 id="tabulation-algorithm">Tabulation Algorithm</h5><p>æœ€åä¸€æ­¥åœ¨æ„å»ºå¥½<code>G#</code>ä¹‹åï¼Œæœ€ç»ˆåœ¨å…¶ä¸Šåº”ç”¨<code>Tabulation</code>ç®—æ³•æ¥å¯»æ‰¾ä»&lt;S<sub>main</sub>, 0&gt;å¼€å§‹çš„æ‰€æœ‰<code>realizable paths</code>æ¥å†³å®šè¯¥åˆ†æé—®é¢˜çš„æ‰€æœ‰<code>MRP solutions</code>ã€‚</p><p>ç†è§£ä¸€ä¸‹æ•´ä¸ªç®—æ³•çš„æ ¸å¿ƒï¼š</p><p><font color="purple">Let n be a program point, data fact d âˆŠ MRP<sub>n</sub>, iff there is a realizable path in G# from &lt;S<sub>main</sub>, 0&gt; to &lt;n, d&gt;.</font></p><p>é¦–å…ˆè§£é‡Š&lt;S,d&gt;æŒ‡çš„æ˜¯åœ¨<code>program point</code>ç‚¹Sçš„ä¸€ä¸ª<code>data fact</code>å³<code>d</code>ã€‚å¦‚æœå¯¹äºä¸€ä¸ª<code>program point</code>ç‚¹<code>n</code>ï¼Œå¦‚æœåœ¨<code>G#</code>ä¸Šå¯ä»¥ä»&lt;S<sub>main</sub>, 0&gt;åˆ°&lt;<font color="red">n</font>,<font color="blue">d</font>&gt;æœ‰ä¸€æ¡<code>realizable path</code>â€”â€”åˆ™å°±è¯´<code>data fact d</code>åœ¨<code>program point n</code>è¿™ä¸€ç‚¹æ˜¯holdsçš„ã€‚</p><p>å…³äºè¯¥ç®—æ³•çš„æ ¸å¿ƒæš‚æ—¶ä¸æ·±å…¥ç†è§£ã€‚æ¯”å¦‚è¿™é‡Œçš„<code>summary</code>æ€æƒ³ä¹Ÿæ˜¯ä¸ºäº†å¤„ç†åŒä¸€ä¸ªæ–¹æ³•è¢«å†—ä½™å¤„ç†ã€‚</p><h4 id="distributivity">Distributivity</h4><p>è¿™é‡Œæˆ‘ä»¬äº†è§£ä¸€ä¸‹<code>IFDS</code>çš„å¯åˆ†é…æ€§<code>Distributivity</code>ï¼š</p><ul><li>F(X ^ Y) = F(X) ^ F(Y)</li></ul><p>è€Œæ ¹æ®å®šä¹‰ï¼Œå¯¹äºå¤„ç†<code>constant propagation</code>æ¥è¯´æ¯”å¦‚<code>z = x + y</code>ï¼Œéœ€è¦åŒæ—¶è€ƒè™‘ä¸¤ä¸ªè¾“å…¥ï¼Œ<strong>è€Œ<code>IFDS</code>ä¸€æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªè¾“å…¥:F(x)^F(y)ã€‚æœ¬è´¨ä¸Šæ¯ä¸€ä¸ª<code>representation relation</code>åªèƒ½å¤„ç†å¦‚æœ<code>x</code>å­˜åœ¨åˆ™...ï¼Œä½†æ˜¯æ— æ³•å¤„ç†å¦‚æœ<code>x and y</code>åŒæ—¶å­˜åœ¨åˆ™...ã€‚</strong>æ•…å¸¸é‡ä¼ æ’­æ˜¯ä¸å¯åˆ†é…çš„ã€‚</p><p>In IFDS, each data fact(circle) and its propagation(edges) could be handled independently, and doing so will affect the correctness of the final results.</p><p>å°±æ˜¯è¯´å…¶<code>data fact</code>å’Œ<code>edge</code>éƒ½æ˜¯å¯ä»¥åˆ†å¼€å¤„ç†ï¼Œåˆ°æœ€åä¸€æ­¥æ‰è¿›è¡Œ<code>union/intersection</code>â€”â€”å³å¯åˆ†é…æ€§ã€‚è€Œ<code>Pointer analysis</code>å› ä¸ºéœ€è¦å¤„ç†åˆ«å<code>alias</code>ä¿¡æ¯ï¼Œè¿™æ ·çš„è¯éœ€è¦è€ƒè™‘å¤šä¸ªè¾“å…¥ä¿¡æ¯â€”â€”æ•…å…¶æœ¬è´¨ä¸Šä¹Ÿä¸æ˜¯å¯åˆ†é…æ€§çš„ã€‚</p><h3 id="soundiness">Soundiness</h3><p>è™½ç„¶æ‰€æœ‰çš„ç¨‹åºåˆ†æç®—æ³•éƒ½åœ¨å¼ºè°ƒå…¶å¯ä»¥æ•æ‰åˆ°æ‰€æœ‰çš„ç¨‹åºè¿è¡Œæ—¶è¡Œä¸ºã€‚ä½†æ˜¯å­¦æœ¯ç•Œå’Œå·¥ä¸šç•Œçš„ç†è®ºå’Œå·¥å…·åœ¨å®é™…åº”ç”¨ä¸­éƒ½ä¼šäº§ç”Ÿ<code>unsound</code>çš„ç»“æœã€‚<strong>è¿™æ˜¯å› ä¸ºç¼–ç¨‹è¯­è¨€æœ¬èº«ä¼šæœ‰ä¸€äº›<code>Hard Feature</code>å¯¼è‡´ç¨‹åºåˆ†ææ— æ³•è¿›è¡Œã€‚</strong></p><ul><li>Java: Reflectionï¼Œnative codeï¼Œdynamic class loading ...</li><li>C/C++: Pointer arithmetic, function pointer...</li></ul><p>è¿™äº›ç‰¹æ€§ä½¿å¾—ç¨‹åºåˆ†æç²¾åº¦å—æŸã€‚æ•…å­¦æœ¯ç•Œå¼•å…¥ä¸€ä¸ªæ–°è¯<code>Soundiness</code>è¡¨ç¤ºï¼š</p><p>A soundy analysis typically means that the analysis is mostly sound, with well-identified unsound treatments to hard/specific language features.</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;abastract&quot;&gt;Abastract&lt;/h3&gt;
&lt;p&gt;åœ¨&lt;code&gt;IFDS&lt;/code&gt;å‡ºç°ä¹‹å‰ï¼Œç»å…¸&lt;code&gt;intra-procedural analysis&lt;/code&gt;æ¡†æ¶(&lt;font color=&quot;red&quot;&gt;D&lt;/font&gt;,&lt;font color=&quot;green&quot;&gt;L&lt;/font&gt;,&lt;font color=&quot;blue&quot;&gt;F&lt;/font&gt;)å¯¹äºç¨‹åºåˆ†æé—®é¢˜çš„ç ”ç©¶è¿˜åœç•™åœ¨â‘ å¤šé¡¹å¼æ—¶é—´å¤„ç†&lt;code&gt;specific individual problem&lt;/code&gt;æ¯”å¦‚&lt;code&gt;constant propagation/pointer analysis&lt;/code&gt;â‘¡å¤šé¡¹å¼æ—¶é—´å¤„ç†&lt;code&gt;locally separable proble&lt;/code&gt;ï¼ˆç»å…¸&lt;code&gt;bit-vector/gen-kill&lt;/code&gt;é—®é¢˜â€”â€”&lt;code&gt;reaching definitions,available expressions,live variabl&lt;/code&gt;çš„è¿‡ç¨‹é—´åˆ†æï¼‰â‘¢å¯¹æ™®éåˆ†æé—®é¢˜æä¾›&lt;strong&gt;éå¤šé¡¹å¼æ—¶é—´&lt;/strong&gt;çš„ç®—æ³•æ–¹æ¡ˆã€‚&lt;/p&gt;
&lt;p&gt;éšç€&lt;code&gt;POPL&#39;1995&lt;/code&gt;å‘è¡¨çš„&lt;a href=&quot;http://web.cs.ucla.edu/~harryxu/courses/253/sp2013/papers/popl95.pdf&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Precise Interprocedural Dataflow Analysis via Graph Reachability&lt;/a&gt;é€šè¿‡å°†ä¸€ç±»&lt;code&gt;inter-procedural analysis&lt;/code&gt;é—®é¢˜è½¬åŒ–ä¸º&lt;code&gt;a special kind of graph-reachability problem&lt;/code&gt;å›¾å¯è¾¾æ€§é—®é¢˜â€”â€”&lt;font color=&quot;red&quot;&gt;&lt;code&gt;IFDS&lt;/code&gt;&lt;/font&gt;æ¡†æ¶æ¨ªç©ºå‡ºä¸–ã€‚&lt;strong&gt;&lt;code&gt;IFDS&lt;/code&gt;é™¤äº†é’ˆå¯¹&lt;code&gt;separable problems&lt;/code&gt;ï¼Œè¿˜é’ˆå¯¹åŒ…æ‹¬&lt;code&gt;truly-live variables,copy constant propagation,possibly-uninitialized variablestruly-live variables&lt;/code&gt;åœ¨å†…çš„&lt;code&gt;non-separable problems&lt;/code&gt;ç­‰ä¸€å¤§ç±»æ™®éæ€§åˆ†æé—®é¢˜éƒ½æä¾›äº†å¤šé¡¹å¼æ—¶é—´çš„ç²¾ç¡®è§£å†³æ‰‹æ®µã€‚&lt;/strong&gt;ç”±äº&lt;code&gt;IFDS&lt;/code&gt;æœ¬èº«çš„çº¦æŸï¼Œä½œè€…åœ¨&lt;code&gt;Theoretical Computer Science&#39;1996&lt;/code&gt;ä¸Šè¿˜å‘è¡¨è¿‡ä¸€ç¯‡&lt;a href=&quot;https://pdf.sciencedirectassets.com/271538/1-s2.0-S0304397500X00448/1-s2.0-0304397596000722/main.pdf?X-Amz-Security-Token=IQoJb3JpZ2luX2VjEMr%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLWVhc3QtMSJIMEYCIQDHEEjOJdEm0cLtUB%2BHaJKZnI%2BPN5tMP4ElOR%2FgbYtzIgIhAJLujFNrXghpU6i4dLJlbR4WmRz%2FBokVzMrouNR8thheKvoDCEMQBBoMMDU5MDAzNTQ2ODY1IgwWTLJMo41Prpn%2F%2FEgq1wPGTtVLFsiVIF9uO3Jqe%2Fc7DNIZ2aCoMKASRnKPldZG3DL%2Fkla1b4JCb1utfraGJZeeG8LZFHTKpNPPAfY8Ax4cYe2D2fM1efeJUEv%2FGD2v21Ge7INGhUegLgtSJXoz%2FTGqXHronY0wS56U4dQHPyuDJ9pJYu8tQi5bCN93m1E%2BvoIrIoPK1IBlinh9LCUHfggCjlfJcrUWdkz6FvAO9pGlBB2bSWVrDJQZhf6k8%2FEA5%2BXg3GaNvYrHvzSnNokhfIAooqmnr9POzK6%2B3%2Fx0h%2Bs4dh9hNMSBVThSuNZlmYyRaRKHAukdzlgx7Lu9cQrKYEbMA9sr6UbY1CBGWM0IkEQ7hmxoPj3%2BkLlagNcZRd2FVg7zQcCPjdYrEeuUM6FicieZyU64gwrF%2Fl2Jq9GQPaZpYcndiEruIB8ggW%2F6moNCZs2IDLW40fNnp3Hm32GGMPuJDgPa9Yg7iD9Rfrr7uPhjSB8oKcpFqUKwmYqMn4W6pM74elsDHPsbw%2FsaqXNJCU42md6tfWSTBmByS3IQHgs6NpJWs3QckjVDmQYfTXv%2FgpMfrR%2FVnq7q6gGUgGrsgttCWa9VagHvZlUoLrIsFwlkjVjx7LNyflLfYyQBjsMjVKKQ7qw9kLMwrfi2kQY6pAGC4F0%2Bu4eJObfe5rQlGYJgI2OFVr6PyiBiTn4XcTtHOC2fbkj4Rre9Pj4QydLxF0oSXJqJCXkBJhzxpC9ouKJpDzYffbmPkpIA6rzdujGyRGluGCeiM2cOu7JtFEx1nvPsB%2BLlMN8JJBJQL3QWxnV36yu6ycImjADRWzn2Oe1Hn59BdoZO9nzL8zTLFHgS9jRZeYlTJQnh6FZe4I4upbqHwxemIw%3D%3D&amp;amp;X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;amp;X-Amz-Date=20220313T104326Z&amp;amp;X-Amz-SignedHeaders=host&amp;amp;X-Amz-Expires=300&amp;amp;X-Amz-Credential=ASIAQ3PHCVTY3WOOQG6M%2F20220313%2Fus-east-1%2Fs3%2Faws4_request&amp;amp;X-Amz-Signature=d189220faa10689b60977d689048eeee379847ff107227365fec1a7742463d7d&amp;amp;hash=c12a21daeaec6fe0aaf5b9fb5ec0259bf755743c2eea8ab65f566cece9ee2d36&amp;amp;host=68042c943591013ac2b2430a89b270f6af2c76d8dfd086a07176afe7c76c2c61&amp;amp;pii=0304397596000722&amp;amp;tid=spdf-17632b09-bb7d-4bc0-9605-080c373f0575&amp;amp;sid=d0b19308547fc443ae8b53f5ca290b286a01gxrqa&amp;amp;type=client&amp;amp;ua=50040252510d525a5a05&amp;amp;rr=6eb42b298d006da7&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Precise interprocedural dataflow analysis with applications to constant propagation&lt;/a&gt;æå‡º&lt;code&gt;IDE&lt;/code&gt;æ¡†æ¶æ¥å¤„ç†&lt;code&gt;interprocedural constant propagation&lt;/code&gt;ç­‰&lt;code&gt;IFDS&lt;/code&gt;æ¡†æ¶å¤„ç†ä¸äº†çš„&lt;code&gt;non-distributive&lt;/code&gt;é—®é¢˜ã€‚è¿™ä¸¤ç¯‡è®ºæ–‡ä¸ºç¨‹åºåˆ†æé¢†åŸŸå¼•å…¥æ–°çš„è¡€æ¶²ã€‚&lt;/p&gt;
&lt;p&gt;è¿‘å¹´&lt;code&gt;Sparse Value IFDS,Disk-Assisted IFDS&lt;/code&gt;ç­‰è¯¾é¢˜ä¸€ç›´æ˜¯å­¦æœ¯ç•Œçš„ç ”ç©¶çƒ­ç‚¹ã€‚åœ¨å·¥ä¸šç•Œæ¯”å¦‚&lt;a href=&quot;https://linkspringer.53yu.com/content/pdf/10.1007%2F978-3-030-17465-1.pdf&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;phasar&lt;/a&gt;ç­‰ç¨‹åºåˆ†æå·¥å…·ä¸­&lt;code&gt;IFDS/IDE&lt;/code&gt;ä¹Ÿæœ‰å…·ä½“&lt;a href=&quot;https://github.com/secure-software-engineering/phasar&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å®ç°&lt;/a&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://haotianmcihael.github.io/categories/Java/"/>
    
    
      <category term="PL" scheme="http://haotianmcihael.github.io/tags/PL/"/>
    
      <category term="Software-Analysis" scheme="http://haotianmcihael.github.io/tags/Software-Analysis/"/>
    
  </entry>
  
  <entry>
    <title>NJUé™æ€ç¨‹åºåˆ†æ(4-Taint-Analysis)</title>
    <link href="http://haotianmcihael.github.io/2021/06/03/NJU%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90-4-Taint-Analysis/"/>
    <id>http://haotianmcihael.github.io/2021/06/03/NJUé™æ€ç¨‹åºåˆ†æ-4-Taint-Analysis/</id>
    <published>2021-06-02T16:33:35.000Z</published>
    <updated>2022-03-16T09:59:27.918Z</updated>
    
    <content type="html"><![CDATA[<h3 id="abstract">Abstract</h3><p>åŒç¬¦å·æ‰§è¡Œä¸€æ ·ï¼Œ<code>Taint-Analysis</code>ä¹Ÿæ˜¯åˆ†æä»£ç å®‰å…¨æ¼æ´ï¼Œæ£€æµ‹æ”»å‡»æ–¹å¼çš„é‡è¦æ‰‹æ®µã€‚å¯¹äº<code>Web</code>åº”ç”¨ç¨‹åºä¸­å­˜åœ¨ç€çš„å¤§é‡å®‰å…¨æ¼æ´,å¦‚è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œ<code>SQL</code>æ³¨å…¥ç­‰~æ±¡ç‚¹åˆ†æéƒ½å¯ä»¥è¿›è¡Œæœ‰æ•ˆåœ°æ£€æµ‹ã€‚è€Œæ±¡ç‚¹ä¼ æ’­æŠ€æœ¯æ˜¯å½“å‰<code>Taint-Analysis</code>é¢†åŸŸçš„é‡è¦è¯¾é¢˜ï¼Œ<strong>é€šè¿‡å’Œé™æ€ç¨‹åºåˆ†ææŠ€æœ¯ç›¸ç»“åˆï¼Œåœ¨ä¸è¿è¡Œä»£ç ä¸”ä¸ä¿®æ”¹ä»£ç çš„å‰æä¸‹é€šè¿‡åˆ†æç¨‹åºå˜é‡ä¹‹é—´çš„ç›¸äº’ä¾èµ–å…³ç³»ä»¥æ­¤è·å¾—æ›´é«˜æ•ˆï¼Œæ›´ç²¾ç¡®çš„åˆ†æç»“æœã€‚</strong></p><p>Taint analysis tracks how tainted data flow through the program and observes if they can flow to locations of interest(call sinks).</p><p>æ¯”å¦‚é€šè¿‡åˆ©ç”¨é™æ€æŒ‡é’ˆåˆ†æç®—æ³•å®Œæˆç®€åŒ–çš„æ˜¾å¼æµ<code>explicit flow</code>åˆ†æï¼Œä¸è®¨è®º<a href="https://www.k0rz3n.com/2019/03/01/%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF/" target="_blank" rel="noopener">è·¯å¾„çˆ†ç‚¸</a>å’Œå…¶ä»–åŠ¨æ€æ¼æ´åˆ†ææŠ€æœ¯ã€‚</p><a id="more"></a><h3 id="information-flow-security">Information Flow Security</h3><p>å½“æœåŠ¡å™¨å’Œå®¢æˆ·æœºåœ¨ç½‘ç»œä¸Šè¿›è¡Œé€šä¿¡çš„æ—¶å€™å°±ä¼šå­˜åœ¨<code>Information Flow</code>ï¼Œä»è€Œäº§ç”Ÿäº†ç›¸åº”çš„å®‰å…¨é—®é¢˜â€”â€”Prevent unwanted information flowã€‚å¦‚ä½•é˜²æ­¢å®¢æˆ·ç«¯çš„ä¿¡æ¯ä¸è¢«æµå…¥åˆ°é»‘å®¢æ‰‹ä¸­ï¼Œç›®å‰ä¸»æµæœ‰ä¸¤ç§é€”å¾„ï¼š</p><h4 id="access-control">Access Control</h4><p>é€šè¿‡ä½¿ç”¨<strong>æƒé™</strong>çš„æ–¹å¼æ¥æ§åˆ¶ç¨‹åºæ˜¯å¦å¯ä»¥è®¿é—®æ•æ„Ÿæ•°æ®ï¼Œä¸»è¦æ˜¯é€šè¿‡ç®¡ç†<strong>å¦‚ä½•è·å–æ•°æ®</strong>çš„æ–¹å¼æ¥å®Œæˆæ•°æ®ä¿æŠ¤ï¼Œä½†æ˜¯å®ƒä»…ä»…å¯ä»¥ä¿è¯è·å–æ—¶çš„ä¿æŠ¤ï¼Œä½†æ˜¯è·å–åˆ°æ•°æ®ä¹‹åå‘¢ï¼Ÿ</p><h4 id="information-flow-security-1">Information Flow Security</h4><p><font color="red">ä¿¡æ¯æµå®‰å…¨</font>æ˜¯ä¸€ç§<code>end to end</code>çš„æ•°æ®ä¿æŠ¤æ–¹å¼ï¼Œå®ƒè¿½è¸ªä¿¡æ¯æµæ˜¯å¦‚ä½•åœ¨ç¨‹åºä¸­æµåŠ¨çš„æ¥ç¡®ä¿ç¨‹åºèƒ½æ›´å®‰å…¨çš„å¤„ç†æ•æ„Ÿæ•°æ®ï¼Œä¸»è¦æ˜¯é€šè¿‡ç®¡<strong>å¦‚ä½•ä¼ æ’­æ•°æ®</strong>çš„æ–¹å¼æ¥å®Œæˆæ•°æ®ä¿æŠ¤ã€‚</p><p>è¿™ä¸¤ç§æ–¹å¼å…±åŒä½œç”¨ï¼Œæ‰å¯ä»¥çœŸæ­£ä¿è¯æ•æ„Ÿæ•°æ®çš„å®‰å…¨ã€‚</p><p>ä¸‹é¢ä»‹ç»ä¿¡æ¯æµçš„æ¦‚å¿µ:å¦‚æœåœ¨å˜é‡<code>x</code>ä¸­çš„ä¿¡æ¯è¢«ä¼ å…¥åˆ°äº†å˜é‡<code>y</code>ä¸­ï¼Œé‚£ä¹ˆåœ¨<code>xâ€”â€”&gt;y</code>ä¹‹é—´å°±æœ‰ä¿¡æ¯æµã€‚è€Œå®ç°ä¿¡æ¯æµå®‰å…¨å®é™…ä¸Šè¿˜éœ€è¦ä¸¤ç§æ–¹å¼ï¼š</p><h5 id="security-levels">security levels</h5><p>é€šè¿‡å°†ä¿¡æ¯æµåˆ†ä¸ºä¸åŒçš„ç­‰çº§æ¥æ§åˆ¶æ•°æ®çš„è·å–æƒé™ï¼Œæœ€åŸºæœ¬çš„æ¨¡å‹å°±æ˜¯<code>two-level policy</code>ï¼Œåˆ†ä¸º<code>H</code>å’Œ<code>L</code>ä¸¤ä¸ªçº§åˆ«ï¼Œ<code>H</code>æŒ‡çš„æ˜¯å®‰å…¨ç­‰çº§é«˜çš„æ•æ„Ÿä¿¡æ¯ï¼Œ<code>L</code>æŒ‡çš„æ˜¯æ•æ„Ÿä¿¡æ¯ä½çš„å¯å…¬å¼€ä¿¡æ¯ã€‚æ¯”å¦‚</p><ul><li><code>h = getPassword();</code> hä¸º<code>H</code></li><li><code>Broadcast(l);</code> lä¸º<code>L</code></li></ul><p>å¯¹äºæ›´å¤æ‚çš„æ•°æ®æ¨¡å‹ï¼Œå®‰å…¨ç­‰çº§å®é™…ä¸Šå¯ä»¥æŒ‰ç…§<code>lattice</code>æ¥è¿›è¡Œå»ºæ¨¡ã€‚</p><h5 id="information-flow-policy">information flow policy</h5><p>åœ¨ä¸åŒç­‰çº§çš„ä¿¡æ¯æµä¹‹é—´é‡‡å–ä¸ä¸€æ ·çš„å®‰å…¨ç­–ç•¥ã€‚æ¯”å¦‚<strong>Noninterference policy</strong>è§„å®šé«˜çº§åˆ«çš„ä¿¡æ¯æµæ•°æ®ä¸å¯ä»¥å½±å“(should not interfere with)ä½çº§åˆ«çš„ä¿¡æ¯æµã€‚<strong>æ¢å¥è¯è®²ï¼Œæœºå™¨çš„æ“ä½œä¸èƒ½ä½¿å¾—ä¿¡æ¯æµä»é«˜çº§åˆ«çš„æ•°æ®ä¼ æ’­åˆ°ä½çº§åˆ«çš„æ•°æ®ä¸­ã€‚</strong></p><p><img src="1.png" width="50%" height="50%" alt=""></p><p>è¿™ç§å®‰å…¨ç­–ç•¥éœ€è¦ä½¿å¾—ä¿¡æ¯æµåªèƒ½æ²¿ç€<code>lattice</code>çš„<code>upwards</code>æ–¹å‘è¿›è¡Œä¼ æ’­ã€‚å¯ä»¥æ˜¯<code>Hâ€”â€”&gt;Hã€Lâ€”â€”&gt;Lã€Lâ€”â€”&gt;H</code>ä½†æ˜¯ä¸å¯ä»¥æ˜¯<code>Hâ€”â€”&gt;L</code>ã€‚</p><h3 id="confidentiality-and-integrity">Confidentiality and Integrity</h3><p><strong>ä¿å¯†æ€§</strong>å’Œ<strong>å®Œæ•´æ€§</strong>ä»å¦ä¸€ä¸ªè§†è§’è§£è¯»äº†å®‰å…¨ç­–ç•¥<code>information flow policy</code>å¦‚ä½•ä»æœ¬è´¨ä¸Šä¿è¯ä¿¡æ¯æµå®‰å…¨ã€‚</p><p>å¯¹äºå·²ç»åˆ†çº§å¥½çš„ä¿¡æ¯ï¼Œé«˜çº§åˆ«çš„ä¿¡æ¯ä¸å¯ä»¥æµåˆ°ä½çº§åˆ«çš„ä¿¡æ¯ä¸­å¯ä»¥çœ‹æˆæ˜¯ä¸ºäº†ä¿å¯†æ€§ï¼Œé˜²æ­¢æ•°æ®æ³„éœ²ã€‚è€Œä½çº§åˆ«çš„ä¿¡æ¯ä¹Ÿä¸èƒ½æµåˆ°é«˜çº§åˆ«çš„ä¿¡æ¯ä¸­å¯ä»¥çœ‹æˆæ˜¯ä¸ºäº†ä¿æŠ¤æ•°æ®çš„å®Œæ•´æ€§ã€‚ä¿å¯†æ€§å·²ç»ä»‹ç»è¿‡äº†ï¼Œè¿™é‡Œä»‹ç»ä¸€ä¸‹å®Œæ•´æ€§ã€‚</p><h4 id="integrity">Integrity</h4><p>å®Œæ•´æ€§éœ€è¦ä¿è¯ä¸€äº›æ— å…³ç´§è¦çš„ä¿¡æ¯æµæ— æ³•æ±¡æŸ“ï¼Œç ´åé‡è¦çš„æ•æ„Ÿä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = readInput();  //untrusted</span><br><span class="line">cmd = &quot;...&quot; + x;</span><br><span class="line">execute(cmd);    //critical (trusted)</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ä¸€äº›å¸¸è§çš„æ³¨å…¥é”™è¯¯åŸºæœ¬ä¸Šéƒ½æ˜¯å› ä¸ºç ´åäº†æ•°æ®çš„å®Œæ•´æ€§æ‰å¯¼è‡´å®‰å…¨é—®é¢˜ï¼š</p><ul><li>Command injection</li><li>SQL injection</li><li>XSS attacks</li></ul><p><strong>å¯¹äºå·²ç»åˆ†å¥½çº§åˆ«çš„æ•°æ®æ¥è¯´ï¼Œä¿è¯å®‰å…¨å°±æ˜¯éœ€è¦åœ¨ä»é«˜çº§åˆ«æ•°æ®å‘ä½çº§åˆ«çš„ä¿¡æ¯æµä¸­é˜²æ­¢æ³„éœ²çš„åŒæ—¶ï¼Œè¿˜éœ€è¦åœ¨ä»ä½çº§åˆ«æ•°æ®å‘é«˜çº§åˆ«æ•°æ®çš„ä¿¡æ¯æµä¸­é˜²æ­¢æ±¡æŸ“ã€‚ç¡®ä¿åšåˆ°æ ¹æ®ä¸åŒçš„ä¿¡æ¯æµå‘åº”ç”¨ä¸åŒçš„ä¿¡æ¯æµå®‰å…¨ç­–ç•¥ã€‚</strong></p><p>ä»æ›´åŠ å¹¿æ³›çš„è§’åº¦æ¥çœ‹çš„è¯ï¼Œä¿¡æ¯é‡Œå®‰å…¨éœ€è¦ä¿è¯çš„æ˜¯ä¿¡æ¯çš„æ­£ç¡®æ€§ï¼Œå®Œæ•´æ€§ä»¥åŠæ•°æ®çš„ä¸€è‡´æ€§ï¼š</p><ul><li>æ­£ç¡®æ€§ï¼šé«˜çº§åˆ«çš„æ•°æ®é˜²æ­¢è¢«æ±¡æŸ“</li><li>å®Œæ•´æ€§ï¼šæ•°æ®å¾—åˆ°æ­£ç¡®å­˜å‚¨</li><li>ä¸€è‡´æ€§ï¼šä¿è¯åœ¨è¯»å†™ä¸Šæ•°æ®èƒ½ä¿æŒä¸€è‡´</li></ul><h3 id="explicit-flows-and-convert-channels">Explicit Flows and Convert Channels</h3><p>è¿™é‡Œå¼•å…¥ä¸¤ä¸ªå®‰å…¨é¢†åŸŸå¸¸è§çš„æ¦‚å¿µï¼Œæ˜¾å¼<code>explicit</code>å’Œéšå¼<code>implicit</code>ã€‚</p><p>å¯¹äºä¸€äº›åŸºæœ¬çš„ä¿¡æ¯æµä¼ æ’­éƒ½æ˜¯æ˜¾å¼çš„æ¯”å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Xh = Yh;</span><br><span class="line">Xl = Yh;</span><br><span class="line">Xl = Yl + Zh</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ•°æ®éƒ½æ˜¯ç›´æ¥é€šè¿‡èµ‹å€¼æˆ–è€…å¼•ç”¨è¿™äº›æ˜¾å¼çš„ä¿®æ”¹è¯­å¥ç›´æ¥è¿›è¡Œä¼ æ’­çš„ï¼Œæˆä¸ºæ˜¾ç¤ºæµã€‚è€Œå¯¹äºä¸‹é¢è¿™äº›æƒ…å†µï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">secret = getSecret();</span><br><span class="line">if(secret &lt; 0)&#123;</span><br><span class="line">public = 1;</span><br><span class="line">&#125;else &#123;</span><br><span class="line">public = 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µå±äºéšå¼æµâ€”â€”å³æ•°æ®çš„ä¼ æ’­éƒ½æ˜¯é€šè¿‡ä¸€äº›è¢«æ•æ„Ÿæ•°æ®æ§åˆ¶çš„<code>if/while</code>è¯­å¥æ¥å®Œæˆçš„ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œpublicæ˜¯ä½çº§åˆ«æ•°æ®å¯ä»¥ç›´æ¥è¢«è§‚æµ‹åˆ°ï¼Œè€Œsecretæ˜¯é«˜çº§åˆ«çš„æ•æ„Ÿæ•°æ®ï¼Œä½†æ˜¯æˆ‘ä»¬é€šè¿‡è§‚æµ‹åˆ°publicçš„å€¼æ˜¯å¦ä¸º1è¿˜æ˜¯0å°±å¯ä»¥åˆ¤æ–­å‡ºé«˜çº§åˆ«æ•°æ®çš„æœ€ç»ˆå€¼ï¼Œè¿™å°±æ˜¯éšå¼æµä¼ æ’­ã€‚</p><p><strong>éšå¼æµçš„æ•°æ®æ˜¯é€šè¿‡ç¨‹åºçš„æ§åˆ¶æµä¿¡æ¯è¿›è¡Œä¼ æ’­çš„ã€‚</strong>ä¹Ÿæ˜¯å®‰å…¨é¢†åŸŸæœ€éš¾ä»¥å¤„ç†çš„ä¸€ç±»å®‰å…¨é—®é¢˜ã€‚</p><h3 id="taint-analysis">Taint Analysis</h3><p>æ±¡ç‚¹åˆ†ææ˜¯ä¿¡æ¯æµå®‰å…¨é¢†åŸŸæœ€å¸¸è§çš„æ£€æµ‹æ‰‹æ®µã€‚æ±¡ç‚¹åˆ†æå°†æ•°æ®åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li><code>tainted data</code>: æ•´ä¸ªåˆ†æéœ€è¦å…³æ³¨åˆ°çš„æ±¡ç‚¹æ•°æ®</li><li><code>other data</code>: å…¶ä»–æ•°æ®</li></ul><p>æ±¡ç‚¹æ•°æ®çš„æ¥æºè¢«æˆä¸º<code>sources</code>ï¼Œä»å®ç°è§’åº¦æ±¡ç‚¹æ•°æ®é€šå¸¸æ¥è‡ªäºå‡½æ•°çš„è¿”å›å€¼ï¼Œå³åœ¨æŒ‡é’ˆåˆ†æéœ€è¦å¤„ç†çš„<code>Call</code>è¯­å¥ã€‚</p><p>Taint analysis tracks how tainted data flow through the program and observes if they can flow to locations of interest(called sinks).</p><p>æ±¡ç‚¹åˆ†æå°±æ˜¯é€šè¿‡è¿½è¸ªä»<code>sources</code>å‘å‡ºçš„æ±¡ç‚¹æ•°æ®æ˜¯å¦‚ä½•åœ¨æ•°æ®æµä¸Šä¼ æ’­çš„ï¼Œå¹¶è§‚å¯Ÿè¿™äº›æ±¡ç‚¹æ•°æ®æ˜¯å¦ä¼šæµåˆ°æ•æ„Ÿæºä¸­(sinks)ã€‚ä¸éš¾çœ‹å‡ºï¼Œ<strong>æ±¡ç‚¹åˆ†ææ—¢å¯ä»¥æ£€æµ‹é«˜çº§åˆ«çš„æ•°æ®æ˜¯å¦è¢«æ³„éœ²â€”â€”ä¿å¯†æ€§ï¼Œä¹Ÿå¯ä»¥æ£€æµ‹ä½çº§åˆ«æ•°æ®æ˜¯å¦é€ æˆæ±¡æŸ“â€”â€”å®Œæ•´æ€§ã€‚</strong></p><p>è€Œç©¶å…¶æœ¬è´¨ï¼Œæ±¡ç‚¹åˆ†æå°±æ˜¯åœ¨é—®ï¼šæ±¡ç‚¹æ•°æ®æ˜¯å¦å¯ä»¥æµåˆ°æ•æ„Ÿæºä¸­â€”â€”è€Œè¿™å’ŒæŒ‡é’ˆåˆ†æçš„ç›®çš„ä¸è°‹è€Œåˆï¼Œ<strong>å³æ±¡ç‚¹åˆ†æ/æŒ‡é’ˆåˆ†æçš„ç›®çš„éƒ½æ˜¯ä¸ºäº†è¿½è¸ªæ±¡ç‚¹æ•°æ®/æŠ½è±¡å¯¹è±¡æ˜¯å¦‚ä½•åœ¨ç¨‹åºä¸­ä¼ æ’­çš„</strong>ï¼š</p><ul><li>Can tainted data flow to a sink?</li><li>Which tainted data a pointer (at a sink)can point to?</li></ul><h4 id="domains-and-notations">Domains and Notations</h4><p>å¦‚ä½•ä½¿ç”¨æŒ‡é’ˆåˆ†ææ¥å¯¹æ±¡ç‚¹åˆ†æè¿›è¡Œå»ºæ¨¡ï¼Œåªéœ€å®Œæˆ<code>tainted data</code>âŸ¶<code>object</code>,<code>sources</code>âŸ¶ <code>allocation sites</code>è¿™ä¸¤ä¸ªæ˜ å°„ã€‚</p><ul><li><font color="red">Variables</font>: x, y âˆŠ V<br></li><li>Fields: f, g âˆŠ F</li><li>Objects: o<sub>i</sub>ï¼Œo<sub>j</sub> âˆŠ O</li><li>Tainted data: t<sub>i</sub>ï¼Œt<sub>j</sub> âˆŠ T âŠ‚ O æ±¡ç‚¹æ•°æ®å°±æ˜¯åœ¨è°ƒç”¨ç‚¹äº§ç”Ÿçš„å¯¹è±¡ä¸­è¢«ç‰¹æ®Šæ ‡è®°çš„éƒ¨åˆ†</li><li><font color="red">Instance fiedls</font>: o<sub>i</sub>.f, o<sub>j</sub>.g âˆŠ O x F</li><li><font color="red">Pointers</font>: Pointer = V â‹ƒ (O x F)</li><li>Points-to relations: pt: Pointer âŸ¶ ğ“Ÿ(O)</li></ul><p>å…¶ä¸­t<sub>i</sub>ä»£è¡¨äº†ä»<code>call-site</code>è°ƒç”¨ç‚¹<code>i</code>äº§ç”Ÿçš„æ±¡ç‚¹æ•°æ®ã€‚ğ“Ÿ(O)ä»£è¡¨äº†Oçš„å¹‚é›†ï¼Œ<code>pt(p)</code>ä»£è¡¨äº†æŒ‡é’ˆå˜é‡<code>p</code>çš„æŒ‡å‘é›†åˆã€‚</p><h4 id="taint-analysis-input-outputs">Taint Analysis: Input &amp; Outputs</h4><p>æ±¡ç‚¹åˆ†æçš„è¾“å…¥ä¸º<code>sources</code>â€”â€”ä¸€ç³»åˆ—è¿”å›å€¼äº§ç”Ÿæ±¡ç‚¹æ•°æ®çš„å‡½æ•°é›†åˆï¼Œ<code>Sinks</code>â€”â€”ä¸€äº›æ•æ„Ÿå‡½æ•°çš„é›†åˆï¼Œä¸€æ—¦æ±¡ç‚¹æ•°æ®æµå…¥è¿™äº›å‡½æ•°å°†ä¼šè§¦å‘å®‰å…¨é—®é¢˜ã€‚</p><p>æ±¡ç‚¹åˆ†æçš„è¾“å‡ºæ˜¯<code>TaintFlows</code>:æ±¡ç‚¹æ•°æ®å’ŒSinkså‡½æ•°çš„pairsé›†åˆã€‚<strong>æ¯”å¦‚&lt;t<sub>i</sub>, m&gt;è¡¨ç¤ºä»<code>call-sites</code>è°ƒç”¨ç‚¹<code>i</code>äº§ç”Ÿçš„<code>tainted-data</code>å¯èƒ½ä¼šæµå…¥<code>sink-method</code></strong>ã€‚</p><h4 id="call">Call</h4><p>æ•´ä¸ªæ±¡ç‚¹åˆ†æéœ€è¦å¤„ç†çš„è§„åˆ™å’ŒæŒ‡é’ˆåˆ†æå¤§ä½“ä¸€è‡´ï¼Œè€Œå¯¹äºè°ƒç”¨è¯­å¥<code>Call</code>çš„å¤„ç†éœ€è¦å®Œæˆä¸¤ç§â€”â€”<code>sources</code>å’Œ<code>sinks</code>çš„å¤„ç†ï¼Œåˆ†åˆ«ç”¨äºäº§ç”Ÿæ±¡ç‚¹æ•°æ®å’Œäº§ç”Ÿæ±¡ç‚¹ä¿¡æ¯æµã€‚</p><h5 id="sources">Sources</h5><p><img src="2.png" width="50%" height="50%" alt=""></p><p>è§„åˆ™çš„å‰ææ˜¯å¦‚æœè°ƒç”¨è¾¹é›†åˆ<code>CG</code>ä¸­å­˜åœ¨ä»<code>l</code>åˆ°<code>m</code>çš„ä¸€æ¡è°ƒç”¨è¾¹â€”â€”<code>lâŸ¶m</code>ï¼Œè€Œ<code>m</code>æ°å¥½æ˜¯<code>sources</code>å‡½æ•°é›†åˆä¸­çš„å…ƒç´ ï¼Œåˆ™éœ€è¦å°†è¯¥è°ƒç”¨è¯­å¥çš„æŒ‡é’ˆå˜é‡é›†åˆ<code>pt(r)</code>åŠ ä¸Šä¸€æ¡æ±¡ç‚¹æ•°æ®t<sub>i</sub>ã€‚</p><h5 id="sinks">Sinks</h5><p><img src="3.png" width="50%" height="50%" alt=""></p><p>è¯¥è§„åˆ™çš„å‰ææ˜¯å¦‚æœè°ƒç”¨è¾¹é›†åˆ<code>CG</code>ä¸­å­˜åœ¨ä¸€æ¡è°ƒç”¨è¾¹â€”â€”<code>lâŸ¶m</code>ï¼Œè€Œ<code>m</code>æ°å¥½å±äº<code>sinks</code>å‡½æ•°é›†åˆä¸­çš„å…ƒç´ ï¼Œè€Œåœ¨<code>m</code>çš„å‚æ•°ä¸­è¿˜å­˜åœ¨ç€æ±¡ç‚¹æ•°æ®é›†åˆä¸­çš„å…ƒç´ t<sub>j</sub>ï¼Œåˆ™ä¼šäº§ç”Ÿä¸€æ¡<code>TaintFlows</code>ä»t<sub>j</sub>åˆ°<code>m</code>å‡½æ•°å³&lt;t<sub>j</sub>,m&gt;ã€‚</p><p>æ±¡ç‚¹åˆ†æçš„å­¦ä¹ è‡³æ­¤ç»“æŸã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;abstract&quot;&gt;Abstract&lt;/h3&gt;
&lt;p&gt;åŒç¬¦å·æ‰§è¡Œä¸€æ ·ï¼Œ&lt;code&gt;Taint-Analysis&lt;/code&gt;ä¹Ÿæ˜¯åˆ†æä»£ç å®‰å…¨æ¼æ´ï¼Œæ£€æµ‹æ”»å‡»æ–¹å¼çš„é‡è¦æ‰‹æ®µã€‚å¯¹äº&lt;code&gt;Web&lt;/code&gt;åº”ç”¨ç¨‹åºä¸­å­˜åœ¨ç€çš„å¤§é‡å®‰å…¨æ¼æ´,å¦‚è·¨ç«™è„šæœ¬æ”»å‡»ï¼Œ&lt;code&gt;SQL&lt;/code&gt;æ³¨å…¥ç­‰~æ±¡ç‚¹åˆ†æéƒ½å¯ä»¥è¿›è¡Œæœ‰æ•ˆåœ°æ£€æµ‹ã€‚è€Œæ±¡ç‚¹ä¼ æ’­æŠ€æœ¯æ˜¯å½“å‰&lt;code&gt;Taint-Analysis&lt;/code&gt;é¢†åŸŸçš„é‡è¦è¯¾é¢˜ï¼Œ&lt;strong&gt;é€šè¿‡å’Œé™æ€ç¨‹åºåˆ†ææŠ€æœ¯ç›¸ç»“åˆï¼Œåœ¨ä¸è¿è¡Œä»£ç ä¸”ä¸ä¿®æ”¹ä»£ç çš„å‰æä¸‹é€šè¿‡åˆ†æç¨‹åºå˜é‡ä¹‹é—´çš„ç›¸äº’ä¾èµ–å…³ç³»ä»¥æ­¤è·å¾—æ›´é«˜æ•ˆï¼Œæ›´ç²¾ç¡®çš„åˆ†æç»“æœã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Taint analysis tracks how tainted data flow through the program and observes if they can flow to locations of interest(call sinks).&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚é€šè¿‡åˆ©ç”¨é™æ€æŒ‡é’ˆåˆ†æç®—æ³•å®Œæˆç®€åŒ–çš„æ˜¾å¼æµ&lt;code&gt;explicit flow&lt;/code&gt;åˆ†æï¼Œä¸è®¨è®º&lt;a href=&quot;https://www.k0rz3n.com/2019/03/01/%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;è·¯å¾„çˆ†ç‚¸&lt;/a&gt;å’Œå…¶ä»–åŠ¨æ€æ¼æ´åˆ†ææŠ€æœ¯ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://haotianmcihael.github.io/categories/Java/"/>
    
    
      <category term="PL" scheme="http://haotianmcihael.github.io/tags/PL/"/>
    
      <category term="Software-Analysis" scheme="http://haotianmcihael.github.io/tags/Software-Analysis/"/>
    
  </entry>
  
  <entry>
    <title>NJUé™æ€ç¨‹åºåˆ†æ(3-Pointer-Analysis)</title>
    <link href="http://haotianmcihael.github.io/2021/05/14/NJU%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90-3-Pointer-Analysis/"/>
    <id>http://haotianmcihael.github.io/2021/05/14/NJUé™æ€ç¨‹åºåˆ†æ-3-Pointer-Analysis/</id>
    <published>2021-05-13T17:34:59.000Z</published>
    <updated>2022-03-16T10:08:39.152Z</updated>
    
    <content type="html"><![CDATA[<h3 id="abstract">Abstract</h3><p>è¿‡ç¨‹é—´åˆ†æéœ€è¦åŸºäºç¨‹åºçš„<code>Call Graph</code>æ¥å®Œæˆã€‚ç”±äº<code>CHA Analysis</code>è¿‡åº¦è¿½æ±‚é€Ÿåº¦é€ æˆè¯¯æŠ¥â€”â€”è€Œ<code>false positive</code>å¯¹äºå¸¸é‡ä¼ æ’­è¿™æ ·çš„<code>must</code>åˆ†ææ¥è¯´æ˜¯ä¸å¯æ¥å—çš„ã€‚å› æ­¤æŒ‡é’ˆåˆ†æåœ¨<code>POPL'1980</code>è¢«ç¬¬ä¸€æ¬¡æå‡º<a href="https://static.aminer.org/pdf/PDF/000/546/844/interprocedural_data_flow_analysis_in_the_presence_of_pointers_procedure.pdf" target="_blank" rel="noopener">Interprocedural Data Flow Analysis in the Presence of Pointers, Procedure Variables, and Label Variables</a>ã€‚</p><p>Pointer Analysis computes an over-approximation of the set of which memory-locations(objects) a pointer can point to.</p><p>æŒ‡é’ˆåˆ†æé™¤äº†å¯ä»¥æ„å»º<code>Call Graph</code>ç­‰ç¨‹åºåŸºæœ¬ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç”¨äºç¼–è¯‘ä¼˜åŒ–ï¼Œç¨‹åºé²æ£’æ€§å’Œå®‰å…¨ç­‰å„ä¸ªé¢†åŸŸï¼Œæ˜¯æœ€åŸºç¡€çš„é™æ€åˆ†æç®—æ³•ä¹‹ä¸€â€”â€”æ¯”å¦‚æµè¡Œçš„åˆ«ååˆ†æ<code>Alias Analysis</code>å°±æ˜¯ä»æŒ‡é’ˆåˆ†æä¸­æ´¾ç”Ÿå‡ºæ¥çš„:Alias information can be derived from points-to relations.åœ¨æŒ‡é’ˆåˆ†æçš„è¾“å‡ºæŒ‡å‘å…³ç³»ä¸­æ˜¯å¦æœ‰ä¸¤ä¸ªæŒ‡é’ˆå¯ä»¥æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚</p><a id="more"></a><h3 id="introduction">Introduction</h3><p>æŒ‡é’ˆåˆ†ææ˜¯ä¸€ç§<code>may</code>åˆ†æï¼Œè¾“å…¥æ—¶æ•´ä¸ªç¨‹åºï¼Œåˆ†æç»“æœçš„è¾“å‡ºæ˜¯ç±»ä¼¼äºmapçš„ä¸€ç³»åˆ—æŒ‡å‘å…³ç³»<code>Points-to relations</code>ã€‚</p><p><img src="1.png" width="50%" height="50%" alt=""></p><h4 id="keyfactors">KeyFactors</h4><p>ä½œä¸ºä¸€é¡¹æ¯”è¾ƒå¤æ‚çš„æŠ€æœ¯ï¼ŒæŒ‡é’ˆåˆ†ææ¡†æ¶çš„<strong>ç²¾åº¦</strong>å’Œ<strong>é€Ÿåº¦</strong>å–å†³äºå››ä¸ªå¾ˆä¸»è¦çš„å› ç´ ï¼š</p><table><colgroup><col style="width: 15%"><col style="width: 34%"><col style="width: 49%"></colgroup><thead><tr class="header"><th>Factor</th><th>Problem</th><th>Choice</th></tr></thead><tbody><tr class="odd"><td>Heap abtraction</td><td>How to model heap memory?</td><td><font color="red">Allocation-site</font>/Storeless</td></tr><tr class="even"><td>Context sensitivity</td><td>How to model calling contexts?</td><td><font color="red">Context-sensitive/Context-insensitive</font></td></tr><tr class="odd"><td>Flow sensitivity</td><td>How to model control flow?</td><td>Flow-sensitive/<font color-red="">Flow-insensitive</font></td></tr><tr class="even"><td>Analysis scope</td><td>Which parts of program should be analyzed?</td><td><font color="red">Whole-program</font>/Demand-driven</td></tr></tbody></table><h5 id="heap-abstraction">Heap Abstraction</h5><p>å¦‚ä½•æŠ½è±¡å †æ“ä½œï¼Œæ¯”å¦‚å¾ªç¯å’Œé€’å½’ä¼šåœ¨åŠ¨æ€è¿è¡Œæ—¶åˆ›å»ºå¾ˆå¤šçš„å †å¯¹è±¡ï¼Œå¦‚ä½•å°†è¿™äº›<code>unbounded</code>çš„æ“ä½œè¿›ä¸€æ­¥ç®€åŒ–æŠ½è±¡æˆ<code>finite</code>çš„é™æ€åˆ†æå¯¹è±¡ã€‚</p><p><img src="2.png" width="50%" height="50%" alt=""></p><p>å­¦æœ¯ç•Œæœ‰ä¸¤ä¸ªæµæ´¾æ¥å®Œæˆå †æŠ½è±¡ï¼š<code>Store based model</code>å’Œ<code>Storeless model</code>ã€‚æœ¬èŠ‚è¯¾ä»‹ç»ç¬¬ä¸€ä¸ªæµæ´¾ä¸‹é¢çš„<code>Allocation sites</code>æ–¹æ³•æ¥å¯¹æ‰€æœ‰å †å¯¹è±¡å®Œæˆå»ºæ¨¡â€”â€”<code>One abstract object per allocation site</code>ã€‚<strong>å³æ¯ä¸€ä¸ªåˆ†é…ç‚¹<code>new</code>çš„å †å¯¹è±¡éƒ½æŠ½è±¡åˆ°ä¸€ä¸ª<code>object</code>ä¸­ã€‚</strong></p><h5 id="context-sensitivity">Context Sensitivity</h5><p>åœ¨å‡½æ•°è°ƒç”¨çš„æ—¶å€™ä¼šäº§ç”Ÿä¸Šä¸‹æ–‡<code>context</code>ã€‚<strong>ä¸€ä¸ª<code>method</code>è¢«è°ƒç”¨å¤šæ¬¡çš„è¯å¦‚ä½•å¯¹æ¯ä¸€æ¬¡çš„ä¸Šä¸‹æ–‡è¿›è¡ŒæŠ½è±¡ã€‚</strong>å…³äºä¸Šä¸‹æ–‡æŠ½è±¡ä¹Ÿæœ‰ä¸¤ç§æµæ´¾:</p><ul><li><code>Context-sensitive</code>: å¯¹æ¯ä¸€æ¬¡è°ƒç”¨éƒ½åŒºåˆ«å¯¹å¾…ï¼Œå…·ä½“è°ƒç”¨å…·ä½“åˆ†æ</li><li><code>Context-insensitive</code>: å¯¹ä¸€ä¸ª<code>method</code>çš„æ‰€æœ‰è°ƒç”¨éƒ½mergeåˆ°ä¸€èµ·ï¼Œä¸€æ¬¡æ€§å¤„ç†</li></ul><p>ä¸Šä¸‹æ–‡æ•æ„Ÿæ˜¯æé«˜é™æ€åˆ†ææ•ˆç‡éå¸¸æœ‰æ•ˆçš„å·¥å…·ä¹‹ä¸€ï¼Œæ˜¯è¿™é—¨è¯¾éœ€è¦è®¨è®ºçš„é‡ç‚¹ã€‚</p><h5 id="flow-sensitivity">Flow Sensitivity</h5><p>å¦‚ä½•å¯¹æ§åˆ¶æµæŠ½è±¡ï¼Œä¹Ÿæœ‰ä¸¤ç§æµæ´¾ï¼š</p><ul><li><code>Flow-sensitive</code>: ç¡®ä¿ç¨‹åºçš„æ‰§è¡Œé¡ºåº<code>execution order</code>ï¼Œç»´æŠ¤æ¯ä¸€ä¸ªç¨‹åºç‚¹çš„<code>points-to relations</code>è¡¨</li><li><code>Flow-insensitive</code>:å¿½ç•¥æ‰§è¡Œé¡ºåºï¼Œç»´æŠ¤æ•´ä¸ªç¨‹åºçš„æŒ‡å‘è¡¨</li></ul><p>ç›®å‰å­¦æœ¯ç•Œè¿˜æ²¡æœ‰ç›´æ¥ç ”ç©¶è¡¨æ˜<code>flow sensitivity</code>ç›¸æ¯”äº<code>flow insensitivity</code>å¯¹<code>Java</code>è¿™æ ·çš„OOPè¯­è¨€ä¼šæœ‰å¤šå°‘ä¼˜åŠ¿ã€‚</p><h5 id="analysis-scope">Analysis Scope</h5><p>åœ¨è¿›è¡ŒæŒ‡é’ˆåˆ†æçš„æ—¶å€™ï¼Œå¦‚ä½•é€‰å–éœ€è¦åˆ†æçš„ç¨‹åºæ®µï¼Ÿ</p><ul><li>Whole-program</li><li>Demand-driven</li></ul><p>æ˜¯ç›´æ¥åˆ†ææ•´å¥—ç¨‹åºè¿˜æ˜¯ä»¥éœ€æ±‚ä¸ºé©±åŠ¨è¿›è¡Œç‰¹å®šç¨‹åºç‰‡æ®µçš„åˆ†æã€‚å®é™…ä¸Šå¦‚æœéœ€æ±‚å¾ˆå¤šçš„è¯ï¼Œå•ç‹¬åˆ†æçš„å¤æ‚åº¦å’Œç›´æ¥è¿›è¡Œæ•´å¥—ç¨‹åºåˆ†æçš„å¤æ‚åº¦ä¸ç›¸ä¸Šä¸‹ã€‚</p><h4 id="concerned-statements">Concerned Statements</h4><p>ä¸Šè¿°çš„<code>Key Factors</code>æ˜¯å…·æœ‰å…¨å±€æ€§è´¨çš„-<strong>å³é’ˆå¯¹æ•´ä¸ªæŒ‡é’ˆç®—æ³•æ¡†æ¶</strong>ï¼Œé‚£åœ¨å®ç°ä¸Š-<strong>å³é’ˆå¯¹<code>Java</code>ç¼–ç¨‹è¯­è¨€çš„å…·ä½“æŒ‡é’ˆåˆ†ææ¡†æ¶</strong>æ¥è¯´ï¼Œæ›´ç»†ç²’åº¦çš„<code>Concerned Statements</code>ä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><h5 id="pointers-in-java">Pointers in Java</h5><p>é¦–å…ˆéœ€è¦æ€»ç»“ä¸€ä¸‹<code>Java</code>ä¸­æ‰€æœ‰å¯ä»¥ç”¨ä½œæŒ‡é’ˆçš„å£°æ˜ã€‚</p><ul><li><code>Local variableï¼šx</code></li><li><code>Static field: C.f</code></li><li><code>Instance field: x.f</code></li><li><code>Array element: array[i]</code></li></ul><p>å…±æœ‰4ä¸­å…·ä½“çš„æŒ‡é’ˆç±»å‹â€”â€”<code>static field</code>æ˜¯ä¸€ç§å…¨å±€å˜é‡ã€‚æ•°ç»„å…ƒç´ åœ¨åˆ†ææ—¶å¯ä»¥å¿½ç•¥æ‰ç´¢å¼•ï¼Œçœ‹æˆæ˜¯å¯ä»¥æŒ‡å‘ä»»ä½•æ•°ç»„å…ƒç´ <strong>field</strong>çš„æŒ‡é’ˆç±»å‹<code>array.arr</code>ï¼Œå› æ­¤ä¹Ÿè¢«çœ‹æˆæ˜¯ä¸€ç§<code>Instance field</code>ã€‚<font color="red">ç»¼ä¸Šæ¥çœ‹ï¼Œé’ˆå¯¹Javaè¯­è¨€çš„æŒ‡é’ˆåˆ†æä¸»è¦å¤„ç†<code>Local variable</code>å’Œ<code>instance field</code>ä¸¤ç§æŒ‡é’ˆç±»å‹ã€‚</font></p><h5 id="pointer-affecting-statements">Pointer-Affecting Statements</h5><p>æ˜ç¡®äº†æŒ‡é’ˆåˆ†æç ”ç©¶å¯¹è±¡<strong><code>Pointers</code>çš„å…·ä½“ç±»å‹</strong>ä¹‹åï¼Œç»§ç»­æ€è€ƒå…¨ç¨‹åºçš„æŒ‡é’ˆåˆ†æå¦‚ä½•æ›´å…·ä½“çš„å®Œæˆå®ç°ï¼Ÿå°±è¯­å¥æœ¬èº«æ¥è¯´ä¾‹å¦‚<code>if/for/break</code>è¿™æ ·çš„æ§åˆ¶æµå¹¶ä¸ä¼šå¯¹æŒ‡é’ˆåˆ†æçš„ç»“æœé€ æˆå½±ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çœŸæ­£çš„<font color="red">pointer-affecting statements</font>å¦‚ä¸‹ï¼š</p><ul><li><code>New:      x = new T()</code></li><li><code>Assign:    x = y</code></li><li><code>Store:  x.f = y</code></li><li><code>Load:  y = x.f</code></li><li><code>Call:    r = x.k(a, ...)</code> é‡ç‚¹å…³æ³¨<code>virtual calls</code></li></ul><h3 id="foundations">Foundations</h3><h4 id="rules">Rules</h4><h5 id="domains-and-notations">Domains and Notations</h5><p>æŒ‡é’ˆåˆ†ææ˜¯ä¸€ç§ä»¥æŒ‡å‘å…³ç³»ä½œä¸ºä¼ é€’ä¿¡æ¯çš„æ•°æ®æµåˆ†æã€‚æ‰€ä»¥å…¶ç†è®ºä¹Ÿéœ€è¦å¼•å…¥åŸŸå’ŒæŸäº›ç¬¦å·è§£é‡Šï¼š</p><ul><li><font color="red">Variable</font>: x, y âˆŠ V</li><li>Fields: f,g âˆŠ F</li><li>Objects: o<sub>i</sub>,o<sub>jÂ </sub>âˆŠ O (Allocation sites)</li><li><font color="red">Instance fields</font>: o<sub>i</sub>.f, o<sub>j</sub>.g âˆŠ Oâ¨‰F</li><li><font color="red">Pointers</font>: Pointer = Vâ‹ƒ(Oâ¨‰F)</li></ul><p>å…¶ä¸­Variableè¡¨ç¤ºç¨‹åºä¸­çš„æ‰€æœ‰å˜é‡æŒ‡é’ˆç±»å‹ã€‚Objectå’ŒFieldsåˆ†åˆ«æŒ‡çš„æ˜¯ç¨‹åºä¸­åˆ†é…å †å¯¹è±¡çš„åˆ›å»ºç‚¹å’ŒæŠ½è±¡å †å¯¹è±¡ä¸­çš„åŸŸâ€”â€”å¯¹è±¡å’ŒåŸŸç»„åˆèµ·æ¥çš„Instance Fieldsä¹Ÿè¡¨ç¤ºç¨‹åºä¸­ä¸€ç§æŒ‡é’ˆã€‚<strong>PointersæŒ‡çš„æ˜¯ç¨‹åºä¸­æ‰€æœ‰çš„<code>variable</code>å’Œ<code>instance field</code>â€”â€”<code>V â‹ƒ (O x F)</code>ã€‚</strong></p><p>æœ€åå¼•å…¥<strong>æŒ‡å‘å…³ç³»<code>pt</code>(å…¶æœ¬èº«å°±æ˜¯ä¸€ç§æ˜ å°„ï¼Œ ä»£è¡¨æŒ‡é’ˆå¯èƒ½æŒ‡å‘çš„å¯¹è±¡çš„é›†åˆ)</strong>ï¼š</p><ul><li><p><font color="blue">Points-to relations</font>: <code>pt: Pointer âŸ¶ ğ“Ÿ(O)</code></p><ul><li><p><code>ğ“Ÿ(O)</code>è¡¨ç¤ºå¯¹è±¡Oçš„<code>powerset</code></p></li><li><p><code>pt(p)</code>è¡¨ç¤ºæŒ‡é’ˆpçš„<strong>æŒ‡å‘å…³ç³»é›†åˆ</strong></p></li></ul></li></ul><p><strong>ç†è§£ä¸Šï¼ŒæŒ‡é’ˆæŒ‡å‘å¯¹è±¡â€”â€”æŒ‡é’ˆpçš„å€¼åŸŸå°±æ˜¯<code>V â‹ƒ (O x F)</code>ï¼Œå¯¹è±¡oçš„å€¼åŸŸå°±æ˜¯<code>ğ“Ÿ(allocation sites)</code>ã€‚<code>pâŸ¶o â‰¡ oâˆŠpt(p)</code>å³æŒ‡é’ˆpæŒ‡å‘å¯¹è±¡oç­‰ä»·äºå¯¹è±¡oå±äºæŒ‡é’ˆpçš„æŒ‡å‘å…³ç³»é›†åˆã€‚</strong></p><p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¼•å…¥å¦‚ä½•å¤„ç†<code>Pointer-Affecting Statements</code>çš„å½¢å¼åŒ–Rulesï¼š</p><p><img src="3.png" width="50%" height="50%" alt=""></p><p>åˆ†æ•°ä¸Šé¢æ˜¯å‰æ<code>premise</code>è€Œä¸‹é¢æ˜¯ç»“è®º<code>conclusion</code>ã€‚</p><ul><li><p>New: <code>New</code>è§„åˆ™ä¸­çš„o<sub>i</sub> è¡¨ç¤ºä¸€ä¸ª<code>Allocation site</code>åœ¨è¿™ä¸€ç‚¹åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæŒ‡é’ˆåˆ†æå¦‚ä½•å¤„ç†ä¸€ä¸ª<code>New</code>è¯­å¥â€”â€”<strong>å³æ‰§è¡Œå®Œè¿™æ¡è¯­å¥åè®©xæŒ‡å‘o<sub>i</sub>å³o<sub>i</sub> âˆŠ pt(x)</strong>ã€‚</p></li><li><p>Assign: å¦‚æœo<sub>i</sub>å±äºyçš„æŒ‡å‘é›†ï¼Œ<strong>é‚£åœ¨æ‰§è¡Œå®Œè¿™æ¡è¯­å¥åo<sub>i</sub>åˆ™éœ€è¦åŠ å…¥åˆ°xçš„æŒ‡å‘é›†ä¸­ã€‚</strong></p></li><li><p>Store: å°†æ–°å¯¹è±¡ä¿å­˜åˆ°è¯¥å¯¹è±¡çš„ä¸€ä¸ªåŸŸfâ€”â€”å¦‚æœxæŒ‡å‘o<sub>i</sub>è€ŒyæŒ‡å‘o<sub>j</sub>ï¼Œ<strong>é‚£æ‰§è¡Œå®Œè¿™æ¡è¯­å¥ä¹‹åo<sub>i</sub>.féœ€è¦æŒ‡å‘o<sub>j</sub>ã€‚</strong></p></li><li><p>Load: å°†æŸä¸ªå¯¹è±¡çš„åŸŸfåŠ è½½åˆ°æ–°å¯¹è±¡ä¸­â€”â€”å¦‚æœxæŒ‡å‘o<sub>i</sub>è€Œo<sub>i</sub>çš„åŸŸfæŒ‡å‘o<sub>j</sub>ï¼Œ<strong>é‚£æ‰§è¡Œå®Œåå°†o<sub>j</sub>åŠ å…¥åˆ°yçš„æŒ‡é’ˆé›†å½“ä¸­ã€‚</strong></p></li></ul><h4 id="how-to-implement-pointer-analysis">How to Implement Pointer Analysis</h4><p>åœ¨ç¡®å®šå¥½Domainå’ŒRulesä¹‹åå¼€å§‹æ˜ç¡®å¦‚ä½•å®ç°<strong>å…¨ç¨‹åºçš„æŒ‡é’ˆåˆ†æç®—æ³•</strong>ã€‚</p><p>Essentiallyï¼Œpointer analysis is to <font color="red">propagate</font> points-to information among pointers(variables &amp; fields).</p><p><strong>åœ¨ä¸¤ç§æŒ‡é’ˆ(<code>variable</code>å’Œ<code>fields</code>)ä¹‹é—´æ ¹æ®<code>Pointer-Affecting Statements</code>å»ºç«‹å’Œä¼ é€’æŒ‡å‘å…³ç³»<code>points-to</code>ã€‚</strong>ä»å¦ä¸€ä¸ªè§’åº¦æ¥è¯´æŒ‡é’ˆåˆ†æå°±æ˜¯åœ¨è§£å†³æŒ‡é’ˆä¹‹é—´çš„<code>inclusion constraints</code>å³å¯¹äº<code>x = y</code>è¯­å¥æŒ‡é’ˆxä¸€å®šåŒ…å«æŒ‡é’ˆyçš„æ‰€æœ‰æŒ‡å‘ä¿¡æ¯ã€‚<strong>è€Œå…³é”®çš„æ˜¯å½“<code>pt(x)</code>æ›´æ–°æ—¶ï¼Œè¿™äº›æ”¹å˜ä¹Ÿéœ€è¦ä¼ é€’ç»™xçš„å…¶ä»–ç›¸å…³æŒ‡é’ˆ</strong>ã€‚</p><p>è€Œåœ¨å®ç°ä¸Šï¼Œæˆ‘ä»¬ç”¨<code>Graph</code>æ¥è¿æ¥ç›¸å…³è”çš„æŒ‡é’ˆï¼Œå½“<code>pt(x)</code>æ›´æ–°æ—¶ï¼Œå°†æ›´æ–°çš„æ•°æ®æµï¼ˆæ•°æ®æµåˆ†ææ ¹æ®Domainä¸åŒè€Œä¸åŒï¼ŒæŒ‡å‘å…³ç³»ä¹Ÿæ˜¯ä¸€ç§æ•°æ®æµä¿¡æ¯ï¼‰ä¼ é€’ç»™<code>x</code>çš„åç»§å…ƒç´ ï¼Œè¿™ä¸ªå›¾å°±æ˜¯<code>Pointer Flow Graph</code>ã€‚</p><h5 id="pointer-flow-graphpfg">Pointer Flow Graph(PFG)</h5><p>ä¸€ä¸ªç¨‹åºçš„<code>PFG</code>æ˜¯ä¸€ç§è¡¨ç¤º<code>points-to</code>ä¿¡æ¯å¦‚ä½•åœ¨<code>pointers</code>ä¹‹é—´æµåŠ¨çš„æœ‰å‘å›¾ï¼Œå›¾ä¸­çš„èŠ‚ç‚¹ä»£è¡¨äº†<code>V â‹ƒ (O â¨‰ F)</code>â€”â€”å˜é‡æˆ–è€…<strong>æŠ½è±¡å¯¹è±¡</strong>(å› ä¸ºPFGæ˜¯é™æ€åˆ†æå»ºç«‹çš„ï¼Œæ‰€ä»¥æ˜¯æŠ½è±¡çš„å †å¯¹è±¡)çš„åŸŸï¼Œè¾¹ä»£è¡¨äº†å¯¹è±¡åœ¨æŒ‡é’ˆä¹‹é—´çš„æµåŠ¨å…³ç³»<code>Pointer â¨‰ Pointer</code>â€”â€”æ¯”å¦‚<code>xâŸ¶y</code>ä»£è¡¨äº†æŒ‡é’ˆxçš„æŒ‡å‘å¯¹è±¡é›†åˆ<font color="red">å¯èƒ½(æŒ‡é’ˆåˆ†ææ˜¯<code>may</code>åˆ†æ)ä¼šæµåŠ¨åˆ°</font>yçš„æŒ‡å‘é›†åˆã€‚</p><p>PFGä¸­çš„èŠ‚ç‚¹å°±æ˜¯ç¨‹åºä¸­çš„å„ç§æŒ‡é’ˆï¼Œè€Œè¾¹æ˜¯æ ¹æ®æŒ‡é’ˆåˆ†æçš„Ruleså»ºç«‹çš„ã€‚</p><p><img src="4.png" width="50%" height="50%" alt=""></p><p>æœ‰äº†PFGï¼ŒæŒ‡é’ˆåˆ†æé—®é¢˜å°±å¯ä»¥çœ‹æˆæ˜¯åœ¨PFGä¸Šæ±‚å…¶<strong>ä¼ é€’é—­åŒ…</strong>çš„é—®é¢˜ï¼Œæ¯”å¦‚PFGä¸­aç‚¹åˆ°bç‚¹æ˜¯å¯è¾¾çš„ï¼Œé‚£aä¸­çš„æ•°æ®æµä¿¡æ¯å°±å¯ä»¥ç›´æ¥æµåˆ°bèŠ‚ç‚¹ä¸Šã€‚</p><p>ç»¼ä¸Šï¼ŒæŒ‡é’ˆåˆ†æçš„æ€è·¯ä¸»è¦æœ‰ä¸¤éƒ¨åˆ†ï¼šåˆ›å»ºPFGâ€”â€”&gt;åœ¨PFGä¸Šä¼ é€’æŒ‡å‘ä¿¡æ¯ã€‚è€Œéš¾ç‚¹åœ¨äºè¿™ä¸¤è€…æ˜¯äº’ç›¸ä¾èµ–çš„ã€‚ä¸ºä»€ä¹ˆåˆ›å»ºPFGä¹Ÿä¼šä¾èµ–æŒ‡å‘ä¿¡æ¯å‘¢ï¼Ÿ</p><p><img src="5.png" width="50%" height="50%" alt=""></p><p>å› ä¸ºåœ¨å¤„ç†<code>instance fields</code>çš„æŒ‡å‘å…³ç³»çš„æ—¶å€™ï¼Œå‰ææ˜¯éœ€è¦çŸ¥é“è¿™äº›<code>field</code>çš„<code>object</code>çš„æŒ‡å‘ä¿¡æ¯â€”â€”ç”±<code>allocation sites</code>æ›´æ–°å¾—åˆ°ã€‚<strong>å› æ­¤<code>PFG</code>æœ¬èº«ä¹Ÿæ˜¯éšç€æŒ‡é’ˆåˆ†æçš„è¿‡ç¨‹åŠ¨æ€æ›´æ–°çš„ã€‚</strong></p><h4 id="algorithm">Algorithm</h4><p>æœ¬èŠ‚å…·ä½“å®ç°æ•°æ®æµåˆ†æç®—æ³•ï¼Œé¦–å…ˆæ˜¯ä½¿ç”¨åˆ°çš„æ•°æ®ç»“æ„ï¼š</p><ul><li><code>S</code>: è¾“å…¥ç¨‹åºçš„è¯­å¥é›†åˆ</li><li><code>WL</code>: work listå­˜å‚¨äº†éœ€è¦å¤„ç†çš„æŒ‡å‘å…³ç³»pairï¼Œ<strong>å…¶ä¸­æ¯ä¸€é¡¹<code>&lt;n,ğ“Ÿ(O)&gt;*</code>æ„å‘³ç€åœ¨<code>ğ“Ÿ(O)</code>ä¸­çš„ä¿¡æ¯éœ€è¦ä¼ é€’ç»™<code>n</code>çš„æŒ‡å‘å…³ç³»é›†åˆ<code>pt(n)</code>ä¸­</strong>ï¼Œç”¨</li><li><code>PFG</code>: æœ‰å‘å›¾ï¼Œè¡¨ç¤ºæˆä¸ºè¾¹çš„é›†åˆï¼Œå…¶ä¸­<code>sâŸ¶t</code>è¡¨ç¤º<code>s</code>çš„æŒ‡å‘å…³ç³»æµå‘<code>t</code>çš„æŒ‡å‘å…³ç³»</li><li><code>Hybrid-Set</code>: ç”¨æ¥å­˜åœ¨<code>pt(s)</code>ï¼Œå³å½“å…ƒç´ å°äº16æ—¶ç”¨<code>HashSet</code>å¤§äº16æ—¶ç”¨<code>BitVector</code></li></ul><h5 id="main-algorithm">Main Algorithm</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Solve(S) &#123;</span><br><span class="line">  WL = [], PFG = &#123;&#125;</span><br><span class="line">  foreach i: x=new T() âˆŠ S do          //å¤„ç†Newè¯­å¥</span><br><span class="line">    add &lt;x, &#123;O_i&#125;&gt; to WL              </span><br><span class="line"></span><br><span class="line">  foreach x=y âˆŠ S do       //å¤„ç†Assignè¯­å¥</span><br><span class="line">    AddEdge(y, x)</span><br><span class="line"></span><br><span class="line">   while WL is not empty do</span><br><span class="line">     remove &lt;n, pts&gt; from WL</span><br><span class="line">     ğš« = pts - pt(n)</span><br><span class="line">     Propagate(n, ğš«)     </span><br><span class="line">     if n represents a variable x then</span><br><span class="line">       foreach o_i âˆŠ ğš« do </span><br><span class="line">         foreach x.f=y âˆŠ S do</span><br><span class="line">           AddEdge(y, o_i.f)     //å¤„ç†Storeè¯­å¥ </span><br><span class="line">         foreach y=x.f âˆŠ S do    </span><br><span class="line">           AddEdge(o_i.f, y)    //å¤„ç†Loadè¯­å¥</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AddEdge(s, t) &#123;   //æ„å»ºPFG</span><br><span class="line">  if sâŸ¶t âˆ‰ PFG then      </span><br><span class="line">    add sâŸ¶t to PFG</span><br><span class="line">    if pt(s) is not empty then</span><br><span class="line">      add &lt;t, pt(s)&gt; to WL</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Propagate(n, pts) &#123;    //æ›´æ–°pt(x)</span><br><span class="line">  if pts is not empty then</span><br><span class="line">    pt(n) â‹ƒ= pts //æ ¸å¿ƒï¼š ä¼ é€’æ•°æ®æµ</span><br><span class="line">    foreach nâŸ¶s âˆŠ PFG do </span><br><span class="line">      add &lt;s, pts&gt; to WL</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="addedge">AddEdge</h5><p>é¦–å…ˆæ¯ä¸€æ¡<code>New</code>è¯­å¥ç”Ÿæˆä¸€æ¡æŒ‡å‘å…³ç³»å®Œæˆå¯¹<code>WL</code>çš„åˆå§‹åŒ–ã€‚è¿™å¥—ç®—æ³•çš„è¾“å…¥è¯­å¥<code>S</code>æ˜¯æµä¸æ•æ„Ÿ<code>insensitive</code>çš„ï¼Œå³å¤„ç†è¿‡ç¨‹ä¸ä¼šå…³æ³¨è¯­å¥é¡ºåºã€‚</p><p><code>AddEdge</code>å‡½æ•°ä¸»è¦æ˜¯é€šè¿‡å¤„ç†<code>Assign</code>è¯­å¥æ„å»º<code>PFG</code>ã€‚æ¯ä¸€æ¡<code>sâŸ¶t</code>éƒ½å¯¹åº”ç€å›¾ä¸Šä¸€æ¡è¾¹ï¼Œæ ¹æ®æŒ‡é’ˆåˆ†æçš„<code>inclusion constraints</code>åŸç†å°†<code>&lt;t, pt(s)&gt;</code>åŠ å…¥<code>WL</code>ä¸­å®ç°æŠŠæŒ‡é’ˆ<code>s</code>çš„æŒ‡å‘é›†åˆåŠ åˆ°æŒ‡é’ˆ<code>t</code>ä¸­ã€‚</p><h5 id="propagate">Propagate</h5><p>åœ¨æ„å»ºå®Œæœ€åŸºç¡€çš„çš„<code>PFG</code>ä¹‹åï¼Œç®—æ³•è¿›å…¥<code>While</code>å¾ªç¯å¼€å§‹è¿­ä»£å¤„ç†<code>WL</code>ä¸­çš„æŒ‡å‘å…³ç³»ã€‚å–å‡ºä¸€é¡¹<code>&lt;n, pts&gt;</code>ï¼Œ<strong>è¿‡æ»¤æ‰æŒ‡é’ˆ<code>s</code>æŒ‡å‘å…³ç³»ä¸­æŒ‡é’ˆ<code>n</code>å·²ç»å­˜åœ¨çš„æŠ½è±¡å¯¹è±¡å³ğš«=pts-pt(n)â€”â€”ä¸»è¦æ˜¯ä¸ºäº†é¿å…æ›´å¤šçš„å†—ä½™æ“ä½œå·²è¾¾åˆ°<code>Differential Propagation</code></strong></p><p>ç„¶åå¼€å§‹<code>Propagate</code>å‡½æ•°ï¼Œ<font color="red">è¿™ä¸ªå‡½æ•°æ˜¯çœŸæ­£ä¿®æ”¹äº†æŒ‡é’ˆçš„æŒ‡å‘å…³ç³»å³å®Œæˆæ•°æ®æµçš„ä¼ é€’ï¼Œæ¢å¥è¯è®²æŒ‡é’ˆåˆ†æçš„è¿‡ç¨‹å°±æ˜¯åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ä¸æ–­å‘<code>pts</code>ä¸­åŠ å…¥æ–°çš„æ•°æ®æµ</font>ã€‚è€Œè¿›å…¥åˆ°å‡½æ•°å†…çš„ğš«æ˜¯çœŸæ­£éœ€è¦ä¼ é€’ç»™<code>n</code>çš„æŒ‡å‘é›†åˆï¼Œæ¥ç€åˆæ ¹æ®<code>inclusion constraints</code>éœ€è¦æŠŠæŒ‡é’ˆ<code>n</code>åˆšæ›´æ–°è¿‡çš„æŒ‡å‘é›†åˆåŠ åˆ°å…¶åœ¨<code>PFG</code>ä¸Šçš„åç»§ä¸­ï¼Œæ•…éå†æ•´ä¸ªå›¾æ‰¾åˆ°æ‰€æœ‰çš„åç»§èŠ‚ç‚¹<code>s</code>å¹¶æŠŠ<code>&lt;s, pts&gt;</code>åŠ åˆ°<code>WL</code>ä¸­ç­‰å¾…ä¸‹ä¸€è½®æ›´æ–°ã€‚</p><h5 id="differential-propagation">Differential Propagation</h5><p><strong>æŸ¥åˆ†ä¼ æ’­</strong>æ˜¯ä¸ºäº†é¿å…å¤„ç†å†—ä½™çš„æŒ‡é’ˆä¿¡æ¯ã€‚è¿™æ˜¯å› ä¸ºåœ¨<code>PFG</code>ä¸Šä»»æ„ç‚¹çš„æŒ‡å‘é›†åˆä¿¡æ¯<code>pt(n)</code>ä¸€å®šå·²ç»ä¼ æ’­åˆ°äº†å…¶åç»§å…ƒç´ ï¼Œæ²¡æœ‰å¿…è¦åœ¨ä¼ æ’­ä¸€æ¬¡ã€‚åœ¨æ•´ä¸ªç®—æ³•ä¸­ä¸€å…±æœ‰ä¸¤å¤„æŸ¥åˆ†ä¼ æ’­ï¼Œåˆ†åˆ«æ˜¯åœ¨<code>ğš«=pts-pt(n)</code>è¯­å¥ä»¥åŠå¤„ç†<code>Store/Load</code>è¯­å¥çš„ä»£ç ç‰‡æ®µ<code>foreach O_i âˆŠ ğš« do</code>ã€‚</p><p>é¦–å…ˆ<code>Store/Load</code>è¯­å¥æ˜ å°„åˆ°<code>PFG</code>ä¸Šçš„æ“ä½œæ­£å¥½ç›¸åï¼š</p><ul><li><code>Storeï¼šx.f=y</code> o<sub>i</sub>.f âŸµ y</li><li><code>Load: y=x.f</code> yâŸµ o<sub>i</sub>.f</li></ul><p>å…³é”®æ˜¯éœ€è¦çŸ¥é“æŒ‡é’ˆ<code>x</code>æŒ‡å‘çš„æŠ½è±¡å¯¹è±¡<code>o_i</code>ç„¶åç»§ç»­æ“ä½œã€‚è€Œ<code>foreach o_iâˆŠğš« do</code>æ­£å¥½æ¸…é™¤æ‰æŒ‡é’ˆ<code>x</code>ä»¥å‰çš„æŒ‡å‘ä¿¡æ¯è€Œä¿ç•™äº†è¿™æ¬¡è¿­ä»£ä¸­<strong>æ–°åŠ å…¥</strong>çš„æŠ½è±¡å¯¹è±¡ã€‚</p><p><img src="6.png" width="50%" height="50%" alt=""></p><p>å°±<code>Store/Load</code>è¯­å¥æœ¬èº«è€Œè¨€ä¹Ÿæ˜¯é€šè¿‡<code>AddEdge</code>çš„æ–¹å¼æ¥æ›´æ–°<code>PFG</code>çš„ï¼Œä½†è¿™é‡Œè¦æ³¨æ„çš„æ˜¯<strong>å› ä¸ºæœ‰å¯èƒ½ä¸¤ä¸ªå˜é‡ä¼šæŒ‡å‘ç›¸åŒçš„æŠ½è±¡å¯¹è±¡o<sub>i</sub>ï¼Œå³è™½ç„¶o<sub>i</sub>å¯¹äºxæ¥è¯´æ˜¯æ–°åŠ å…¥çš„æŒ‡å‘ä¿¡æ¯ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨å‰å‡ æ¬¡è¿­ä»£ä¸­æœ‰<code>z.f=y</code>ä¸­çš„æŒ‡é’ˆ<code>z</code>ä¹ŸæŒ‡å‘æŠ½è±¡å¯¹è±¡o<sub>i</sub>ï¼Œ<font color="red">å³å› ä¸ºæŒ‡é’ˆo<sub>i</sub>.fä¸­o<sub>i</sub>æ˜¯ä¸€ä¸ªå¯¹è±¡â€”â€”æœ‰å¯èƒ½ä¼šè¢«å¤šä¸ªæŒ‡é’ˆæŒ‡å‘ï¼Œå› æ­¤è¿™é‡Œçš„<code>AddEdge</code>æ“ä½œä¸èƒ½ä¿è¯ä¸€å®šä¼šå¼•å…¥æ–°çš„<code>PFG</code>è¾¹</font></strong>ã€‚</p><h5 id="fixed-point">Fixed Point</h5><p>ç®—æ³•ç¬¦åˆä¸åŠ¨ç‚¹åŸç†â€”â€”<code>WL</code>çš„åŠŸèƒ½å°±æ˜¯å‘<code>pt</code>ä¸­æ·»åŠ ä¿¡æ¯ï¼Œè€Œæ ¸å¿ƒ<code>pt(n) â‹ƒ =pts</code>ä¹‹åå¦‚æœç›´æ¥æ£€æŸ¥åˆå¹¶å‰å<code>pt</code>é›†åˆæ˜¯å¦æœ‰å˜åŒ–ä¹Ÿä»¥åˆ¤æ–­è¾¾åˆ°ä¸åŠ¨ç‚¹ã€‚</p><h4 id="how-to-deal-with-method-calls">How To Deal With Method Calls</h4><p>å…¨ç¨‹åºçš„æŒ‡é’ˆåˆ†æç®—æ³•è¿˜éœ€è¦å¤„ç†æ–¹æ³•è°ƒç”¨ã€‚å’Œæ‰€æœ‰è¿‡ç¨‹é—´åˆ†æä¸€æ ·ï¼Œ<code>Inter-procedural pointer analysis</code>ä¹Ÿéœ€è¦å»ºç«‹<code>call graph</code>ã€‚ä¸è¿‡ç›¸æ¯”äº<code>CHA analysis</code>ä»…ä»…é€šè¿‡<code>receiver object</code>çš„å£°æ˜ç±»å‹æ¥æ„å»ºè°ƒç”¨å›¾ä¸åŒï¼ŒæŒ‡é’ˆåˆ†æè¿˜ä½¿ç”¨æŒ‡å‘ä¿¡æ¯<code>points-to relations</code>æ¥ä½¿å¾—<code>call graph</code>çš„æ„å»ºæ›´åŠ ç²¾ç¡®ã€‚æ¯”å¦‚<code>void foo(A a) {... b = a.bar();...}</code>ä¸­<strong><code>points-to relations</code>å’Œ<code>Call Graph</code>éƒ½æ˜¯åœ¨æŒ‡é’ˆåˆ†æçš„è¿‡ç¨‹ä¸­åŠ¨æ€æ›´æ–°çš„ï¼Œæ¯”å¦‚æƒ³è¦å»ºç«‹<code>pt(a)</code>éœ€è¦çŸ¥é“å‡½æ•°<code>foo</code>çš„è°ƒç”¨è¾¹ï¼Œè€Œå¦‚æœæƒ³è¦ç»™<code>a.bar()</code>å»ºç«‹è°ƒç”¨è¾¹åˆ™ä¹Ÿéœ€è¦<code>pt(a)</code>ï¼Œè¿™ç§æ–¹æ³•è¢«ç§°ä¸º<code>on-the-fly call graph construction</code></strong>ã€‚</p><ul><li><code>CHA</code>: åŸºäº<code>a</code>å£°æ˜ç±»å‹è§£æ<code>call targets</code></li><li><code>pointer analysis</code>: åŸºäº<code>pt(a)</code>è§£æ<code>call targets</code></li></ul><h5 id="rule-call">Rule: Call</h5><p>é¦–å…ˆå¼•å…¥æŒ‡é’ˆåˆ†æå¤„ç†æ–¹æ³•è°ƒç”¨Rulesçš„å½¢å¼åŒ–æè¿°ï¼š</p><p><img src="7.png" width="50%" height="50%" alt=""></p><p>æŒ‡é’ˆåˆ†æå™¨åœ¨é‡åˆ°äº†<code>r = x.k(a1, ...)</code>è°ƒç”¨è¯­å¥çš„æ—¶å€™ï¼Œè‚¯å®šä¼šæ¨¡æ‹Ÿç¼–è¯‘å™¨çš„è¿è¡Œæ—¶è¡Œä¸ºå¹¶è§£æï¼š</p><ul><li>o<sub>i</sub>âˆŠpt(<font color="blue">x</font>),m=Dispatch(o<sub>i</sub>,k) âŸ¶ o<sub>i</sub>âˆŠpt(<font color="blue">m<sub>this</sub></font>)ï¼Œå…¶ä¸­xæ˜¯<code>caller</code>å˜é‡</li><li>o<sub>u</sub>âˆŠpt(<font color="blue">a<sub>j</sub></font>) âŸ¶ o<sub>u</sub>âˆŠpt(<font color="blue">m<sub>pj</sub></font>)ï¼Œå…¶ä¸­a<sub>j</sub>æ˜¯å½¢å‚</li><li>o<sub>v</sub>âˆŠpt(<font color="blue">m<sub>ret</sub></font>)âŸ¶o<sub>v</sub>âˆŠpt(<font color="blue">m<sub>r</sub></font>)ï¼Œå…¶ä¸­m<sub>ret</sub>æ˜¯è¿”å›å€¼</li></ul><p>ä¸ºäº†è§£é‡Šçš„æ›´æ¸…æ¥šï¼Œä¸‹é¢å¯¹è§„åˆ™è¿›è¡Œäº†è¿›ä¸€æ­¥çš„è§£é‡Šï¼š</p><ul><li>æ ¹æ®<code>pt(x)</code>å¾—åˆ°è¢«è°ƒç”¨æ–¹æ³•<code>k</code>çš„<code>receiver object</code>å³o<sub>i</sub>ï¼Œç„¶åè°ƒç”¨<code>Dispatch(O_i, k)</code>è§£æå‡º<code>target method</code>å³<code>m</code><br></li><li>å°†ç›®æ ‡å‡½æ•°<code>m</code>çš„<code>this</code>æŒ‡é’ˆæŒ‡å‘å˜é‡<code>x</code>å®é™…æŒ‡å‘çš„å¯¹è±¡å³o<sub>i</sub></li><li>å°†å½¢å‚<code>m_pj</code>çš„æŒ‡é’ˆæŒ‡å‘å®å‚å˜é‡æŒ‡å‘çš„å¯¹è±¡é›†åˆ<code>pt(aj)</code>ï¼Œ<font color="red">å¹¶å°†å½¢å‚å˜é‡å’Œå¯¹åº”å®å‚å˜é‡ä¹‹é—´åŠ ä¸Š<code>PFG</code>è¾¹(a1âŸ¶m_p<sub>j</sub>)</font></li><li>å°†è°ƒç”¨è¯­å¥çš„<code>LHS</code>æŒ‡å‘ç›®æ ‡å‡½æ•°<code>m</code>çš„è¿”å›å€¼å˜é‡æŒ‡å‘çš„å¯¹è±¡ç»“å©š<code>m_ret</code>ï¼Œ<font color="red">å¹¶å°†è¿™ä¸¤ä¸ªå˜é‡ä¹‹é—´åŠ ä¸Š<code>PFG</code>çš„è¾¹(râŸµm<sub>ret</sub>)</font></li></ul><p>ä¸»è¦éœ€è¦å…³æ³¨çš„æ˜¯<code>receiver object</code>ï¼Œ<code>target method</code>ï¼Œ<code>arguments</code>å’Œ<code>return value</code>ã€‚</p><p><img src="8.png" width="50%" height="50%" alt=""></p><p>è€Œè¿™é‡Œå¯¹å½¢å‚å’Œå®å‚ä¹‹é—´ï¼Œè¿”å›å€¼å’Œå·¦å€¼ä¹‹é—´è¿ä¸Š<code>PFG</code>çš„è¾¹è€Œæ²¡æœ‰ç»™ç›®æ ‡æ–¹æ³•å’Œè°ƒç”¨è€…ä¹‹é—´åŠ è¾¹çš„åŸå› æ˜¯<strong>å› ä¸º<code>caller</code>å˜é‡<code>x</code>æœ‰å¯èƒ½æœ‰å¤šä¸ªæŒ‡å‘å¯¹è±¡<code>pt(x)</code>ï¼Œè€Œå¯¹äº<code>Dispatch</code>å‡½æ•°æ¥è¯´ï¼Œåªè¦<code>receiver object</code>ç¡®å®šé‚£<code>target method</code>ä¹Ÿæ˜¯ç¡®å®šçš„ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä¿è¯OOPè¯­è¨€ä¸­æ‰€æœ‰å‡½æ•°çš„<code>this</code>æŒ‡é’ˆéƒ½æŒ‡å‘å”¯ä¸€æ­£ç¡®çš„<code>receiver object</code>å³o<sub>i</sub>ï¼Œå‰æå°±æ˜¯ä¿è¯ä¸èƒ½è®©å…¶ä»–è™šå‡çš„<code>pt(x)</code>ä¿¡æ¯ç›´æ¥æµå…¥<code>this</code>æŒ‡é’ˆâ€”â€”</strong>å¦‚æœè´¸ç„¶ç»™<code>x</code>å’Œç›®æ ‡æ–¹æ³•çš„<code>this</code>æŒ‡é’ˆä¹‹é—´åŠ ä¸Š<code>PFG</code>åªä¼šå¯¼è‡´å¼•å…¥è™šå‡<code>spurious</code>ä¿¡æ¯ã€‚</p><h5 id="algorithm-1">Algorithm</h5><p>åœ¨è¿‡ç¨‹é—´æŒ‡é’ˆåˆ†æä¸­ï¼Œè°ƒç”¨å›¾çš„æ„å»ºå’ŒæŒ‡å‘å…³ç³»çš„æ„å»ºéƒ½æ˜¯åŒæ­¥åŠ¨æ€æ›´æ–°çš„ï¼Œå¼•å…¥<code>reachable</code>å¯è¾¾çš„æ¦‚å¿µï¼šå³ä»<code>main</code>å‡½æ•°å¼€å§‹ï¼Œå°†çœŸæ­£è°ƒç”¨åˆ°çš„å‡½æ•°ä¾æ¬¡çº³å…¥å¯è¾¾æ–¹æ³•é›†åˆä¸­ï¼Œæ‰€æœ‰çš„åˆ†æåªä»è¿™äº›é›†åˆä¸­å®Œæˆã€‚é¦–å…ˆä»‹ç»ç®—æ³•ä¸­ä½¿ç”¨åˆ°çš„æ•°æ®ç»“æ„ï¼š</p><ul><li><code>S</code>: å¯è¾¾è¯­å¥<code>reachable statements</code>çš„é›†åˆ</li><li><code>S_m</code>: å‡½æ•°<code>m</code>ä¸­çš„è¯­å¥é›†åˆ</li><li><code>RM</code>: å¯è¾¾å‡½æ•°é›†åˆ</li><li><code>CG</code>: è°ƒç”¨è¾¹<code>Call Graph</code>é›†åˆ</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Solve(m_entry) &#123;</span><br><span class="line">WL = &#123;&#125;, PFG = &#123;&#125;, RM = &#123;&#125;, CG = &#123;&#125;</span><br><span class="line">AddReachable(m_entry)</span><br><span class="line">while(WL is not empty) &#123;</span><br><span class="line">remove &lt;n, pts&gt; from WL</span><br><span class="line">ğš« = pts - pt(n)</span><br><span class="line">Propagate(n, ğš«)</span><br><span class="line">if n represents a variable x &#123;</span><br><span class="line">foreach o_iâˆŠğš« do</span><br><span class="line">foreach x.f=yâˆŠS do</span><br><span class="line">        AddEdge(y, o_i.f)</span><br><span class="line">        foreach y=x.fâˆŠS do</span><br><span class="line">        AddEdge(o_i.f, y)</span><br><span class="line">        ProcessCall(x, o_i)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AddReachable(m) &#123;</span><br><span class="line">if mâˆ‰RM then</span><br><span class="line">add m to RM</span><br><span class="line">S â‹ƒ= S_m</span><br><span class="line">foreach i:x=new T()âˆŠS_m do</span><br><span class="line">add &lt;x, &#123;o_i&#125;&gt; toWL</span><br><span class="line">foreach x=yâˆŠS_m do</span><br><span class="line">AddEdge(y, x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ProcessCall(x, o_i) &#123;</span><br><span class="line">foreach l:r=x.k(a1,...an)âˆŠS do</span><br><span class="line">m = Dispatch(o_i,k)</span><br><span class="line">add &lt;m_this,&#123;o_i&#125;&gt; to WL</span><br><span class="line">if lâŸ¶mâˆ‰CG then</span><br><span class="line">add lâŸ¶m to CG</span><br><span class="line">AddReachable(m)</span><br><span class="line">foreach parameter p_i of m do</span><br><span class="line">AddEdge(a_i, p_i)</span><br><span class="line">AddEdge(m_ret, r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="addreachable">AddReachable</h6><p>è¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½å°±æ˜¯å°†è¢«è°ƒç”¨çš„æ–¹æ³•åŠ å…¥<code>RM</code>ï¼Œå¹¶å°†å¯¹åº”çš„è¯­å¥åŠ å…¥åˆ°<code>S</code>ä¸­ã€‚<code>AddReachable</code>å‡½æ•°åœ¨æ•´ä¸ªç®—æ³•ä¸€å…±ä¸¤ä¸ªåœ°æ–¹è¢«è°ƒç”¨â€”â€”ä¸€ä¸ªæ˜¯åˆå§‹åŒ–å°†<code>main</code>å‡½æ•°é¦–å…ˆåŠ å…¥ï¼Œå…¶æ¬¡å°±æ˜¯åœ¨æ¯ä¸€æ¬¡æœ‰æ–°çš„<code>Call Graph edge</code>è¢«åˆ›å»ºçš„æ—¶å€™ã€‚å‡½æ•°æœ¬èº«è¿˜éœ€è¦å¤„ç†å½“å‰<code>Reachable Method</code>ä¸­çš„<code>New/Assign</code>è¯­å¥ã€‚<strong>è¿™æ˜¯å› ä¸º<code>Load/Store/Call</code>è¯­å¥çš„åˆ†æéƒ½æ˜¯æ ¹æ®æŒ‡å‘ä¿¡æ¯çš„å˜åŒ–ï¼ˆæ¯”å¦‚<code>x.f=y</code>å¦‚æœ<code>x</code>åˆæŒ‡å‘äº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼‰æ¥æ›´æ–°å¤„ç†çš„ï¼Œä½†æ˜¯<code>New/Assign</code>ä¸éœ€è¦ä»»ä½•ä¿¡æ¯å°±å¯ä»¥ç‹¬ç«‹å®Œæˆåˆ†æã€‚</strong>è¿™ä¹Ÿæ˜¯<code>Differential</code>çš„ç›®çš„ã€‚</p><h6 id="processcall">ProcessCall</h6><p>è¯¥å‡½æ•°å¤„ç†æ–¹æ³•è°ƒç”¨çš„<code>Rules</code>ã€‚<strong>æ•´ä¸ªå‡½æ•°æ‰§è¡Œçš„å‰æå°±æ˜¯è¯¥å‡½æ•°çš„<code>receiver object</code>å³<code>x</code>æœ‰æ–°çš„æŒ‡å‘å…³ç³»o<sub>i,j,k...</sub>è¢«åŠ å…¥åˆ°ğš«æ—¶ï¼Œ</strong>è¿™ä¸¤ä¸ªå‚æ•°è¢«ä¼ å…¥åˆ°å‡½æ•°ä¸­å¼€å§‹æ‰§è¡Œã€‚</p><p>é¦–å…ˆä½¿ç”¨<code>Dispatch</code>å‡½æ•°è§£æå‡ºæ¥<code>target method</code>å³<code>m</code>å˜é‡ã€‚é€šè¿‡æŠŠ&lt;m<sub>this</sub>,{o<sub>i</sub>}&gt;åŠ å…¥åˆ°<code>WL</code>ä¸­æ¥å®Œæˆå°†ç›®æ ‡å‡½æ•°<code>m</code>çš„<code>this</code>æŒ‡é’ˆæŒ‡å‘å˜é‡<code>x</code>å®é™…æŒ‡å‘å¯¹è±¡å³o<sub>i</sub>ã€‚</p><p>æ¥ä¸‹æ¥æ·»åŠ <code>Call Graph</code>ï¼Œè¿™é‡Œä¹‹æ‰€ä»¥è¦æœ‰<code>if</code>è¯­å¥åˆ¤æ–­è¯¥æ¡è°ƒç”¨è¾¹å­˜åœ¨æ€§å³<code>Differential</code>ï¼Œæ˜¯å› ä¸º<strong>æœ‰å¯èƒ½ä¹‹å‰æœ‰å’Œo<sub>i</sub>ç›¸åŒç±»å‹çš„å¯¹è±¡o<sub>j</sub>å·²ç»è§¦å‘äº†<code>ProcessCall</code>å‡½æ•°æ‰§è¡Œå¹¶åŠ ä¸Šè°ƒç”¨è¾¹â€”â€”å› ä¸ºæ•´ä¸ª<code>While</code>å¾ªç¯ç»§ç»­æ‰§è¡Œçš„å‰æå°±æ˜¯<code>pt(x)</code>è¢«æ›´æ–°ï¼Œé‚£æ›´æ–°å‰åçš„o<sub>i,j,k...</sub>å®Œå…¨æœ‰å¯èƒ½æ˜¯åŒä¸€ä¸ªç±»å‹ã€‚</strong></p><p>æ·»åŠ å®Œè°ƒç”¨è¾¹ä¹‹åï¼Œæœ€åæ·»åŠ å‚æ•°å’Œè¿”å›å€¼ã€‚æ•´ä¸ªç®—æ³•çš„è¾“å‡ºæ˜¯<code>Points-to relations</code>å’Œ<code>Call Graph</code>ã€‚è‡³æ­¤ä¸Šä¸‹æ–‡ä¸æ•æ„Ÿçš„å…¨ç¨‹åºæŒ‡é’ˆåˆ†æç®—æ³•å°±ä»‹ç»å®Œäº†ã€‚</p><h3 id="context-sensitivity-1">Context Sensitivity</h3><p>ä¸Šä¸‹æ–‡æ•æ„Ÿæ˜¯æå‡æŒ‡é’ˆåˆ†æç²¾åº¦ï¼ˆå°¤å…¶æ˜¯é’ˆå¯¹<code>Java</code>è¯­è¨€çš„æŒ‡é’ˆåˆ†æï¼‰æœ€æœ‰æ•ˆçš„æŠ€æœ¯ï¼Œä¹Ÿæ˜¯æŒ‡é’ˆåˆ†æé¢†åŸŸè¿‘å¹´æ¥ç ”ç©¶çš„çƒ­ç‚¹ã€‚</p><h4 id="introduction-1">Introduction</h4><p>åœ¨ç¨‹åºåŠ¨æ€è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ª<code>method</code>å¯èƒ½ä¼šåœ¨ä¸åŒçš„<code>context</code>ä¸‹è¢«è°ƒç”¨å¤šæ¬¡ã€‚è€Œåœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­<code>method</code>çš„æŒ‡é’ˆå¯èƒ½ä¼šæŒ‡å‘ä¸åŒçš„<code>object</code>ã€‚<strong><code>Context Insensitivity .aka. C.I.</code>å¯¼è‡´è¿™äº›ä¸åŒä¸Šä¸‹æ–‡çš„<code>objects</code>é€šè¿‡è¿”å›å€¼éƒ½è¢«ä¼ é€’åˆ°ç¨‹åºçš„å…¶ä»–åˆ†æ”¯ä¸­è¿›è€Œäº§ç”Ÿè™šå‡æ•°æ®æµä¿¡æ¯ã€‚</strong>æ¯”å¦‚ç¨‹åºä¸­ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x = id(n1);</span><br><span class="line">y = id(n2);</span><br><span class="line">int i = x.get();</span><br><span class="line">Number id(Number n) &#123;</span><br><span class="line">return n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºå‡½æ•°<code>id</code>è¢«è°ƒç”¨ä¸¤æ¬¡ï¼Œæ•…å½¢å¼å‚æ•°<code>n</code>è¢«ä¼ å…¥ä¸¤æ¡<code>PFG</code>è¾¹â€”â€”åˆ†åˆ«æ˜¯å®å‚<code>n1</code>å’Œ<code>n2</code>ï¼Œè€Œè¿™ä¸¤ä¸ªæŒ‡é’ˆå¯¹è±¡åˆåˆ†åˆ«æŒ‡å‘ä¸åŒçš„o<sub>i</sub>å’Œo<sub>j</sub>ï¼Œ<strong>å¯¼è‡´è¿”å›å€¼<code>n</code>çš„æŒ‡å‘å…³ç³»é›†åˆ<code>pt(n)</code>é‡Œå¢åŠ äº†o<sub>i</sub>å’Œo<sub>j</sub>ã€‚</strong>è€Œ<code>n</code>å’Œ<code>x</code>,<code>y</code>åˆå„è‡ªè¿ç€<code>PFG</code>æ•…å¯¼è‡´<code>pt(x)/pt(y)</code>çš„æŒ‡å‘å…³ç³»ä¹Ÿæ˜¯o<sub>i</sub>å’Œo<sub>j</sub>â€”â€”å¦‚æœæ˜¯è¿‡ç¨‹é—´çš„å¸¸é‡ä¼ æ’­åˆ™æœ€ç»ˆåˆ†æçš„ç»“æœå°±æ˜¯<code>x/y = NAC</code>ï¼Œå¾ˆæ˜æ˜¾ä¸§å¤±äº†ç²¾åº¦ã€‚</p><p>Context sensitivity models calling contextx by <font color="red">distinguishing </font>different data flows of different contextx to improve precision.</p><p>ä¸‹é¢è®¨è®ºå¼€å±•ä¸Šä¸‹æ–‡æ•æ„Ÿçš„æŒ‡é’ˆåˆ†æç®—æ³•æ‰€éœ€è¦è€ƒè™‘çš„å‡ ä¸ªæ–¹é¢ï¼š</p><h5 id="call-site-sensitivity">Call-site sensitivity</h5><p><code>Context sensitivity .aka. C.S.</code>ç”¨æ¥åŒºåˆ«ä¸åŒä¸Šä¸‹æ–‡çš„æ–¹å¼ä¸­æœ€å¸¸è§çš„æ˜¯<code>call-site sensitivity</code>â€”â€”æ¯ä¸€ä¸ªä¸Šä¸‹æ–‡éƒ½æŠ½è±¡æˆæœ¬æ¬¡æ–¹æ³•è°ƒç”¨çš„<strong>åŠ¨æ€è¿è¡Œæ—¶è°ƒç”¨æ ˆ</strong>å³ä¸€ç³»åˆ—<code>call-sites</code>ç»„æˆçš„åˆ—è¡¨(éšç€è°ƒç”¨å±‚æ¬¡æ·±å…¥<code>c</code>çš„é•¿åº¦ä¼šå¢åŠ ï¼ŒåŒºåˆ«äºç”¨<code>l</code>è¡Œå·ä»£è¡¨å½“å‰è°ƒç”¨ç‚¹)ï¼Œæ¯”å¦‚ä¸Šé¢ä¸€æ®µä»£ç ä¸­çš„<code>id</code>æ–¹æ³•å…±æœ‰ä¸¤ä¸ª<code>context</code>åˆ†åˆ«æ˜¯<code>[1]</code>å’Œ<code>[2]</code>ã€‚ä»å®ç°çš„è§’åº¦æ¥çœ‹ï¼Œ<code>Cloning-Based Context Sensitivity</code>æ˜¯å®ç°<code>C.S.</code>æœ€ç›´æ¥çš„æ–¹å¼â€”â€”åŒä¸€ä¸ª<code>method</code>çš„å¤šæ¬¡è°ƒç”¨éƒ½æ ¹æ®å„è‡ªçš„<code>context</code>åŒºåˆ†æˆä¸åŒçš„<code>Cloning-Based</code>ç‰ˆæœ¬ï¼Œ<code>method</code>ä¸­çš„è°ƒç”¨ä¹Ÿéšç€å„è‡ªçš„<code>Cloning-Based</code>åŒºåˆ†å‡ºæ¥â€”â€”<code>one clone per context</code>ã€‚</p><p><img src="9.png" width="50%" height="50%" alt=""></p><h5 id="context-sensitive-heap">Context-Sensitive Heap</h5><p>ä»æ›´ç»†ç²’åº¦çš„è§’åº¦çœ‹ï¼ŒOOPæ˜¯<code>heap-intensive</code>çš„è¯­è¨€â€”â€”æ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯å»ºç«‹åœ¨å †åŒº<code>by new</code>ã€‚åœ¨å®é™…è®¾è®¡ä¸­ï¼Œä¸Šä¸‹æ–‡æ•æ„Ÿçš„æŒ‡é’ˆåˆ†æç®—æ³•è¿˜éœ€è¦è€ƒè™‘åˆ°å †æ•æ„Ÿçš„é—®é¢˜â€”â€”è¿™æ˜¯å› ä¸ºæ‰€æœ‰çš„è¯­å¥å…¶å®éƒ½æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼ŒOOPçš„ä½œç”¨åŸŸå°±æ˜¯å‡½æ•°ã€‚<strong>åˆ›å»ºæ–°å¯¹è±¡çš„<code>new</code>è¯­å¥å°±æ˜¯ä¸€ä¸ª<code>allocation site</code>ï¼Œè€Œå½“<code>new</code>è¯­å¥å‡ºç°åœ¨ä¸€ä¸ªå‡½æ•°ä¸­æ°å·§è¯¥å‡½æ•°åˆè¢«å¤šæ¬¡è°ƒç”¨çš„æ—¶å€™ï¼ŒåŒä¸€ä¸ª<code>allocation site</code>ä¼šåœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡èƒŒæ™¯ä¸‹å»ºç«‹å„è‡ªçš„å¯¹è±¡</strong>ï¼Œæ‰€ä»¥åŒä¸€ä¸ªæ–¹æ³•ä¸­çš„å †å¯¹è±¡ä¹Ÿéœ€è¦æ ¹æ®ä¸åŒçš„<code>heap context</code>æ¥è¿›è¡ŒåŒºåˆ†ã€‚æœ€ç›´æ¥çš„æ–¹å¼å°±æ˜¯ç›´æ¥ç»§æ‰¿å…¶æ‰€åœ¨<code>method</code>çš„ä¸Šä¸‹æ–‡å¹¶ä»æ›´åŠ ç»†ç²’åº¦çš„è§’åº¦å¤„ç†æŒ‡é’ˆåˆ†æç®—æ³•ï¼š</p><p><img src="10.png" width="50%" height="50%" alt=""></p><h4 id="rules-1">Rules</h4><p>ä¸‹é¢å¼•å…¥ä¸Šä¸‹æ–‡æ•æ„ŸæŒ‡é’ˆåˆ†æçš„<code>Rules</code>ï¼š</p><h5 id="domains-and-notations-1">Domains and Notations</h5><p>åœ¨ä¸Šä¸‹æ–‡æ•æ„Ÿåˆ†æä¸­ï¼Œç¨‹åºä¸­çš„æ‰€æœ‰å…ƒç´ ï¼ˆå˜é‡ï¼Œæ–¹æ³•ï¼Œå¯¹è±¡ï¼‰éƒ½åŠ ä¸Šäº†ä¸Šä¸‹æ–‡ã€‚é¦–å…ˆå¼•å…¥ä¸Šä¸‹æ–‡çš„é›†åˆ<code>C</code>,</p><ul><li>c,c',c'' âˆŠ C</li></ul><p>è€Œç¨‹åºä¸­çš„æ–¹æ³•ï¼Œå˜é‡å’Œå¯¹è±¡éƒ½å’Œ<code>context</code>åšäº†<code>product</code>ï¼š</p><ul><li><font color="red">Context-sensitive methods</font>: <font color="red">c:</font>m âˆŠ <font color="red">C</font> x M</li><li><font color="red">Context-sensitive variables</font>: <font color="red">c:</font>x, <font color="red">c':</font>y âˆŠ <font color="red">C</font> x V</li><li><font color="red">Context-sensitive objects</font>: <font color="red">c:</font>o<sub>i</sub>, <font color="red">c':</font>o<sub>j</sub> âˆŠ <font color="red">C</font> x O</li><li>Fields: f, g âˆŠ F</li><li>Instance fields: <font color="red">c:</font>o<sub>i</sub>.f, <font color="red">c':</font>o<sub>j</sub>.g âˆŠ <font color="red">C</font> x O x F</li></ul><p>æœ€åï¼Œå¼•å…¥è¿™äº›ç¨‹åºä¸­çš„ä¸¤ç§ä¸Šä¸‹æ–‡æ•æ„Ÿçš„æŒ‡é’ˆç±»å‹ï¼š</p><ul><li><font color="red">Context-sensitive pointers</font>: CSPointer = (<font color="red">C</font> x V) â‹ƒ (<font color="red">C</font> x O x F)</li></ul><p>ä»¥åŠæŒ‡å‘å…³ç³»é›†åˆï¼š</p><ul><li>Points-to relations: pt: CSPointer âŸ¶ ğ“Ÿ(<font color="red">C</font> x O)</li></ul><h5 id="regular-rules">Regular Rules</h5><p>è¿™äº›è§„åˆ™å’Œä¹‹å‰é’ˆå¯¹<code>Java</code>è¯­è¨€çš„æ•°æ®æµåˆ†ææ¡†æ¶è§„åˆ™åŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯å…ƒç´ éƒ½åŠ ä¸Šäº†ä¸åŒçš„ä¸Šä¸‹æ–‡ä»¥åŒºåˆ†ï¼Œé‡ç‚¹éœ€è¦å…³æ³¨è¿™äº›è¯­å¥ä¸­çš„<font color="green">æŒ‡é’ˆå˜é‡</font>å’Œ<font color="blue">å †å¯¹è±¡</font>æ˜¯å¦éƒ½åœ¨åŒä¸€ä¸ª<code>context</code>ä¸­ï¼š</p><p><img src="11.png" width="50%" height="50%" alt=""></p><p><code>new</code>è¯­å¥ä¸­<code>x</code>å’Œåˆ†é…çš„å †å¯¹è±¡o<sub>i</sub>åŒå±äºä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œé‚£æ˜¯å› ä¸ºæŒ‡é’ˆå˜é‡çš„åˆå§‹åŒ–å †å†…å­˜ä¸€å®šæ˜¯åœ¨ä¸€ä¸ªä½œç”¨åŸŸä¸­ã€‚<code>assign</code>è¯­å¥ä¸­ä¼šå‘ç°åªæœ‰<code>x = y</code>æ˜¯åœ¨ä¸€ä¸ª<code>context</code>ä¸­ï¼Œè€Œå…¶ä¸¤ä¸ªæŒ‡é’ˆå˜é‡å…±åŒæŒ‡å‘çš„å †å†…å­˜éƒ¨åˆ†<code>pt(y)</code>å´<strong>å…±åŒ</strong>åœ¨å¦ä¸€ä¸ª<code>context</code>ä¸­è¿™æ˜¯å› ä¸ºæœ‰å‚æ•°ä¼ é€’çš„å¯èƒ½ã€‚<code>Store/Load</code>è¯­å¥ä¸­<code>x</code>å’Œ<code>y</code>åœ¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­ä½†æ˜¯å®ƒä»¬çš„æŒ‡å‘å¯¹è±¡å´<strong>åˆ†åˆ«</strong>åœ¨ä¸åŒçš„<code>context</code>ä¸‹ã€‚</p><h5 id="call-rule">Call Rule</h5><p>ä¸Šä¸‹æ–‡æ•æ„Ÿçš„è§„åˆ™ä¸­æœ€é‡è¦çš„å°±æ˜¯<code>Call</code>è§„åˆ™ï¼Œå®ƒä¸»å¯¼å¹¶ä¼ é€’äº†ä¸åŒçš„æ•°æ®æµä½¿å¾—ç²¾åº¦æå‡æˆä¸ºå¯èƒ½ã€‚</p><p><img src="12.png" width="50%" height="50%" alt=""></p><p>å‡è®¾ç”¨<code>c</code>ä»£è¡¨å½“å‰æ‰€åœ¨æ–¹æ³•ä¹Ÿå°±æ˜¯è°ƒç”¨è€…<code>Caller</code>çš„ä¸Šä¸‹æ–‡ï¼Œè€Œç”¨c<sup>t</sup>ä»£è¡¨è¢«è°ƒç”¨è€…<code>Callee</code>çš„ä¸Šä¸‹æ–‡ã€‚é¦–å…ˆå¾—åˆ°æŒ‡é’ˆå˜é‡<code>x</code>çš„<code>receiver object</code>å³o<sub>i</sub>ï¼Œè¯¥å †å¯¹è±¡æœ‰å¯èƒ½æ˜¯åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­å› æ­¤å’Œå…¶æŒ‡é’ˆçš„ä¸Šä¸‹æ–‡ä¸åŒã€‚å…¶æ¬¡ä½¿ç”¨o<sub>iÂ </sub>å’Œæ–¹æ³•ç­¾å<code>k</code>ä½œä¸ºå‚æ•°ï¼Œ<code>Dispatch</code>å‡ºçœŸæ­£çš„<code>target method</code>ã€‚æœ€åä½¿ç”¨å’Œ<code>call-site</code>ç›¸å…³çš„ä¿¡æ¯ï¼š<code>call-site</code>ï¼Œå½“å‰ä¸Šä¸‹æ–‡<code>c</code>ä»¥åŠæ‰€æŒ‡å‘çš„å †å¯¹è±¡<code>c':o_i</code>ä½œä¸ºå‚æ•°ä½¿ç”¨å‡½æ•°<code>Select</code>æ¥å–å¾—è¯¥<code>target method</code>çš„ä¸Šä¸‹æ–‡c<sup>t</sup>ã€‚<strong>éœ€è¦æ³¨æ„çš„å°±æ˜¯<font color="red">o<sub>i,j,k...</sub> = pt(x)&lt;</font>ä¸­çš„o<sub>i,j,k...</sub>å’Œ<code>x</code>ä¸¤è€…ä¹‹é—´çš„ä¸Šä¸‹æ–‡æ˜¯æ²¡æœ‰ç›´æ¥å…³ç³»çš„ï¼Œæ‰€ä»¥ä¸¥æ ¼è®²è¿™ä¸¤ä¸ªçš„<code>c</code>éƒ½åº”è¯¥æ˜¯ä¸åŒçš„ã€‚</strong></p><p><img src="13.png" width="50%" height="50%" alt=""></p><p>è¿™æ—¶å€™åŸºæœ¬ä¸Šæ‰€æœ‰<code>Cloning-Based</code>çš„ç¨‹åºå…ƒç´ éƒ½å–å¾—äº†ï¼Œå°±å’Œä¸Šä¸‹æ–‡ä¸æ•æ„ŸæŒ‡é’ˆåˆ†æå¤„ç†<code>Call</code>çš„è§„åˆ™åŸºæœ¬ä¸€è‡´ã€‚</p><h4 id="algorithm-2">Algorithm</h4><p>ä¸Šä¸‹æ–‡æ•æ„Ÿçš„ç®—æ³•å’Œä¸Šä¸‹æ–‡ä¸æ•æ„Ÿçš„æŒ‡é’ˆåˆ†æç®—æ³•æ•´ä½“ä¸Šæ¡†æ¶æ˜¯ä¸€æ ·çš„ã€‚<strong>æ„å»ºä¸Šä¸‹æ–‡æ•æ„Ÿçš„æŒ‡é’ˆæµå›¾å¹¶é€šè¿‡PFG with C.S.ä¼ é€’æŒ‡å‘ä¿¡æ¯ã€‚</strong>åªæ˜¯è¿™äº›PFGçš„èŠ‚ç‚¹å’Œè¾¹ä¸ºäº†æ›´é«˜çš„ç²¾åº¦è¢«åŠ ä¸Šäº†æ–°çš„çº¦æŸâ€”â€”ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»è€Œå˜æˆäº†<code>context-sensitive variable/abstract object</code>çš„æŒ‡é’ˆç±»å‹ã€‚</p><ul><li><code>Node: CSPointer = (C x V) â‹ƒ (C x O x F)</code></li><li><code>Edges:CSPointer x CSPointer</code></li></ul><p>PFGä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½è¢«ä¸Šä¸‹æ–‡<code>c</code>åŒºåˆ†å¼€ï¼Œæ¯ä¸€æ¡è¾¹éƒ½æœ‰äº†æ›´ç»†ç²’åº¦çš„è§£é‡Šï¼š</p><ul><li><code>x = y</code>: c:x âŸµ c:y</li><li><code>x.f = y</code>: c':o<sub>i</sub>.f âŸµ c:y</li><li><code>y = x.f</code>: c:y âŸµ c':o<sub>i</sub>.f</li></ul><p>ä¸‹é¢å°±æ˜¯ä¸Šä¸‹æ–‡æ•æ„Ÿçš„ç®—æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Solve(m_entry) &#123;</span><br><span class="line">  WL=&#123;&#125;, PFG=&#123;&#125;, S=&#123;&#125;, RM=&#123;&#125;, CG=&#123;&#125;</span><br><span class="line">  AddReachable([]:m_entry)     //ä¸Šä¸‹æ–‡æ•æ„Ÿå‡½æ•°</span><br><span class="line">  while WL is not empty do</span><br><span class="line">    remove &lt;n, pts&gt; from WL</span><br><span class="line">    ğš« = pts - pt(n)</span><br><span class="line">    Propagate(n, ğš«)</span><br><span class="line">    if n represents a variable c:x then   //ä¸Šä¸‹æ–‡æ•æ„Ÿçš„æŒ‡é’ˆå˜é‡</span><br><span class="line">        foreach c&apos;:o_i âˆŠ ğš« do     //ä¸Šä¸‹æ–‡æ•æ„Ÿçš„å †å¯¹è±¡</span><br><span class="line">        foreach x.f = y âˆŠ S do</span><br><span class="line">              AddEdge(c:y, c&apos;:o_i.f)  //å¯¹ä¸Šä¸‹æ–‡æ•æ„Ÿçš„æŒ‡é’ˆå’Œå †å¯¹è±¡åŠ PFGè¾¹</span><br><span class="line">            foreach y = x.f âˆŠ S do</span><br><span class="line">              AddEdge(c&apos;:o_i.f, c:y)</span><br><span class="line">            ProcessCall(c:x, c&apos;:o_i)    //å¤„ç†ä¸Šä¸‹æ–‡æ•æ„Ÿçš„æ–¹æ³•è°ƒç”¨</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AddReachable(c:m) &#123;</span><br><span class="line">  if c:m âˆ‰ RM then</span><br><span class="line">    add c:m to RM</span><br><span class="line">    S â‹ƒ= S_m</span><br><span class="line">    foreach i:x = new T() âˆŠ S_m do</span><br><span class="line">      add&lt;c:x, &#123;c:o_i&#125;&gt; to WL   //ä¿®æ”¹PFG</span><br><span class="line">    foreach x = y âˆŠ S_m do</span><br><span class="line">      AddEdge(c:y, c:x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ProcessCall(c:x, c&apos;:o_i)&#123;</span><br><span class="line">     foreach l: r = x.k(a1, ..., an)âˆŠS do</span><br><span class="line">        m = Dispatch(o_i, k)</span><br><span class="line">        ct = Select(c, l, c&apos;:o_i)   // æ ¸å¿ƒï¼š é€‰æ‹©target methodçš„ä¸Šä¸‹æ–‡ct</span><br><span class="line">        add &lt;ct:m_this, &#123;c&apos;:o_i&#125;&gt; to WL   //thisæŒ‡é’ˆå’Œå †å¯¹è±¡åŠ PFG</span><br><span class="line">          if c:l âŸ¶ ct:m to CG      //æ·»åŠ è°ƒç”¨è¾¹</span><br><span class="line">            add c:l âŸ¶ ct:m to CG</span><br><span class="line">              AddReachable(ct:m)   </span><br><span class="line">              foreach parameter p_i of m do //å¤„ç†å‚æ•°</span><br><span class="line">              AddEdge(c:a_i, ct:p_i)</span><br><span class="line">             AddEdge(ct:m_ret, c:r)   //å¤„ç†è¿”å›å€¼</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="variants">Variants</h4><p>ä¸Šè¿°ç®—æ³•ä¸­å¼•å…¥äº†ä¸€ä¸ªæ–°çš„<strong>å‡½æ•°<code>Select(c, l, c':o_i)</code>â€”â€”åœ¨<code>caller</code>å‡½æ•°ä¸­åˆ©ç”¨ç›¸å…³ä¿¡æ¯è·å–å½“å‰<code>callee</code>çš„ä¸Šä¸‹æ–‡ã€‚</strong>è¯¥ä¿¡æ¯åŒ…æ‹¬è°ƒç”¨è€…ä¸Šä¸‹æ–‡<code>caller context</code>ï¼Œè°ƒç”¨ç‚¹<code>call-ste</code>ï¼Œå †ä¸Šä¸‹æ–‡æ•æ„Ÿçš„å¯¹è±¡<code>receiver object with heap context</code>ã€‚</p><p><img src="14.png" width="50%" height="50%" alt=""></p><p>ä»‹ç»ä¸‰ä¸ªç‰ˆæœ¬çš„<code>Select</code>å‡½æ•°ã€‚</p><h5 id="call-site-sensitivity-1">Call-site sensitivity</h5><p>è¯¥ç‰ˆæœ¬çš„<code>context</code>ç”±ä¸€ç³»åˆ—<code>call-site</code>ï¼ˆåœ¨ä»£ç ä¸­ç”±è¡Œå·æ¥è¡¨ç¤ºï¼‰ç»„æˆçš„åˆ—è¡¨ã€‚<strong><code>callee-context</code>æ˜¯åœ¨æ¯æ¬¡è°ƒç”¨ç‚¹å°†å½“å‰çš„è¡Œå·appendåˆ°<code>caller-context</code>ä¸Š</strong>â€”â€”æœ¬è´¨ä¸Šæ˜¯åœ¨æ¨¡æ‹Ÿè°ƒç”¨æ ˆï¼š</p><ul><li>Select(c, l, ...) = [<font color="red">l', ..., l''</font>, l], where c = [<font color="red">l', ..., l''</font>]</li></ul><p>è¿™ä¸ªåˆ—è¡¨çš„é•¿åº¦å¯ä»¥è§„å®šï¼Œæ•…åˆç§°ä¸º<code>k-CFA</code>ã€‚è€Œè¿™ç§æŠ½è±¡åœ¨é€’å½’ç¨‹åºä¸­ä¼šå¯¼è‡´å‡ºç°æ— æ•°ä¸ª<code>callee-context</code>,åˆæ¯”å¦‚åœ¨å®é™…å·¥ç¨‹é¡¹ç›®ä¸­è°ƒç”¨æ ˆå¾ˆæ·±çš„æƒ…å†µä¸‹ä¸Šä¸‹æ–‡è¿‡äºå†—é•¿ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">void main() &#123;   //context:[]</span><br><span class="line">...</span><br><span class="line">a.foo();</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void foo() &#123;   //context:[3]</span><br><span class="line">...</span><br><span class="line">b.bar();</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void bar()&#123;   //Context:[3,9], [3,9,15], [3,9,15,15...]  æ— æ•°ä¸ª</span><br><span class="line">...</span><br><span class="line">bar();</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>k-Limiting Context</code>é€šè¿‡å¯¹ä¸Šä¸‹æ–‡çš„é•¿åº¦è¿›è¡Œäº†é™åˆ¶ä¿è¯äº†ä¸ä¼šè¿‡åº¦å¢é•¿ã€‚ä¸€èˆ¬æƒ…å†µä¸‹é•¿åº¦â‰¤3ã€‚è€Œä¸”<code>method context</code>å’Œ<code>heap context</code>ä½¿ç”¨ä¸åŒçš„é•¿åº¦ä¿è¯ä¸ä¼šäº’ç›¸æœ‰å½±å“ã€‚</p><h5 id="object-sensitivity">Object sensitivity</h5><p>è¯¥ç‰ˆæœ¬çš„<code>context</code>æ˜¯ç”±ä¸€ç³»åˆ—æŠ½è±¡å¯¹è±¡<code>abstract objects</code>ï¼ˆç”±å…¶<code>allocations site</code>è¡¨ç¤ºï¼‰ç»„æˆçš„ã€‚</p><ul><li>Select(,,c':o<sub>i</sub>) = [<font color="red">o<sub>j</sub>,...,o<sub>k</sub></font>,o<sub>i</sub>] where c'=[<font color="red">o<sub>j</sub>,...,o<sub>k</sub></font>]</li></ul><p>è¿™é‡Œä¸€ä¸ªæœ‰æ„æ€çš„ç‚¹å°±æ˜¯ä¸ç®¡æ˜¯<code>Object</code>è¿˜æ˜¯<code>Call-site</code>éƒ½æœ‰è‡ªå·±çš„å±€é™æ€§ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class A&#123;</span><br><span class="line">B f;</span><br><span class="line">void set(B b)&#123;</span><br><span class="line">this.doSet(b);</span><br><span class="line">&#125;</span><br><span class="line">void doSet(B p)&#123;</span><br><span class="line">this.f = p;</span><br><span class="line">&#125;</span><br><span class="line">B get()&#123;</span><br><span class="line">return this.f;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">a1 = new A();</span><br><span class="line">a2 = new A();</span><br><span class="line">b1 = new B();</span><br><span class="line">b2 = new B();</span><br><span class="line">a1.set(b1);</span><br><span class="line">a2.set(b2);</span><br><span class="line">x = a1.get();</span><br></pre></td></tr></table></figure><p>åˆ™ä½¿ç”¨<code>1-call-site</code>æ•æ„Ÿæ¥å®Œæˆæ—¶ï¼Œä¼šå‘ç°å› ä¸º<code>set</code>ä¸­å¥—ç”¨äº†<code>doSet</code>å‡½æ•°è€Œå¯¼è‡´<code>c:b1</code>å’Œ<code>c':b2</code>éƒ½æŒ‡å‘äº†<code>c'':doSet_this</code>å‡½æ•°ï¼Œä»è€Œå¼•å…¥è™šå‡ä¿¡æ¯ã€‚è€Œä½¿ç”¨<code>1-object</code>åˆ™å› ä¸º<code>doSet</code>å‡½æ•°åˆ†åˆ«åœ¨ä¸¤ä¸ªå †å¯¹è±¡ä¸‹æ‰€ä»¥æ›´ç²¾ç¡®ã€‚</p><p>ä¸‹é¢çš„ä»£ç ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class C&#123;</span><br><span class="line">static void main() &#123;</span><br><span class="line">C c = new C();</span><br><span class="line">c.m()</span><br><span class="line">&#125;</span><br><span class="line">Number id(Number n) &#123;</span><br><span class="line">return n;</span><br><span class="line">&#125;</span><br><span class="line">void m() &#123;</span><br><span class="line">Number n1, n2, x, y;</span><br><span class="line">n1 = new One();</span><br><span class="line">n2 = new Two();</span><br><span class="line">x = this.id(n1);</span><br><span class="line">y = this.id(n2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>1-object</code>çš„æ—¶å€™å› ä¸ºè¿™é‡Œä¸¤æ¬¡è°ƒç”¨<code>id</code>å‡½æ•°éƒ½æ˜¯åœ¨<code>c</code>å¯¹è±¡ä¸‹çš„å› æ­¤å¯¼è‡´<code>c:n1</code>å’Œ<code>c':n2</code>éƒ½æŒ‡å‘<code>c_this</code>å‡½æ•°ä»è€Œå¼•å…¥è™šå‡ä¿¡æ¯ï¼Œè€Œ<code>1-call-site</code>åˆ™å› ä¸ºæ˜¯ä¸¤ä¸ª<code>call-site</code>å› æ­¤æ›´åŠ ç²¾ç¡®ã€‚</p><p>æ•…æœ¬è´¨ä¸Šå¾ˆå¤šæ—¶å€™æŒ‡é’ˆåˆ†ææœ¬è´¨å’Œè¯­è¨€çš„æ€§è´¨æœ‰éå¸¸å¯†åˆ‡çš„å…³ç³»ã€‚</p><h5 id="type-sensitivity">Type sensitivity</h5><p>è¯¥ç‰ˆæœ¬çš„<code>context</code>ä½¿ç”¨ä¸€ç³»åˆ—<code>InType</code>ç»„æˆï¼Œä¸æ·±å…¥äº†ã€‚</p><p>è‡³æ­¤æŒ‡é’ˆåˆ†æçš„å­¦ä¹ ç»“æŸã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;abstract&quot;&gt;Abstract&lt;/h3&gt;
&lt;p&gt;è¿‡ç¨‹é—´åˆ†æéœ€è¦åŸºäºç¨‹åºçš„&lt;code&gt;Call Graph&lt;/code&gt;æ¥å®Œæˆã€‚ç”±äº&lt;code&gt;CHA Analysis&lt;/code&gt;è¿‡åº¦è¿½æ±‚é€Ÿåº¦é€ æˆè¯¯æŠ¥â€”â€”è€Œ&lt;code&gt;false positive&lt;/code&gt;å¯¹äºå¸¸é‡ä¼ æ’­è¿™æ ·çš„&lt;code&gt;must&lt;/code&gt;åˆ†ææ¥è¯´æ˜¯ä¸å¯æ¥å—çš„ã€‚å› æ­¤æŒ‡é’ˆåˆ†æåœ¨&lt;code&gt;POPL&#39;1980&lt;/code&gt;è¢«ç¬¬ä¸€æ¬¡æå‡º&lt;a href=&quot;https://static.aminer.org/pdf/PDF/000/546/844/interprocedural_data_flow_analysis_in_the_presence_of_pointers_procedure.pdf&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Interprocedural Data Flow Analysis in the Presence of Pointers, Procedure Variables, and Label Variables&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;Pointer Analysis computes an over-approximation of the set of which memory-locations(objects) a pointer can point to.&lt;/p&gt;
&lt;p&gt;æŒ‡é’ˆåˆ†æé™¤äº†å¯ä»¥æ„å»º&lt;code&gt;Call Graph&lt;/code&gt;ç­‰ç¨‹åºåŸºæœ¬ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç”¨äºç¼–è¯‘ä¼˜åŒ–ï¼Œç¨‹åºé²æ£’æ€§å’Œå®‰å…¨ç­‰å„ä¸ªé¢†åŸŸï¼Œæ˜¯æœ€åŸºç¡€çš„é™æ€åˆ†æç®—æ³•ä¹‹ä¸€â€”â€”æ¯”å¦‚æµè¡Œçš„åˆ«ååˆ†æ&lt;code&gt;Alias Analysis&lt;/code&gt;å°±æ˜¯ä»æŒ‡é’ˆåˆ†æä¸­æ´¾ç”Ÿå‡ºæ¥çš„:Alias information can be derived from points-to relations.åœ¨æŒ‡é’ˆåˆ†æçš„è¾“å‡ºæŒ‡å‘å…³ç³»ä¸­æ˜¯å¦æœ‰ä¸¤ä¸ªæŒ‡é’ˆå¯ä»¥æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://haotianmcihael.github.io/categories/Java/"/>
    
    
      <category term="PL" scheme="http://haotianmcihael.github.io/tags/PL/"/>
    
      <category term="Software-Analysis" scheme="http://haotianmcihael.github.io/tags/Software-Analysis/"/>
    
  </entry>
  
  <entry>
    <title>NJUé™æ€ç¨‹åºåˆ†æ(2-CHA-Analysis)</title>
    <link href="http://haotianmcihael.github.io/2021/05/10/NJU%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90-2-CHA-Analysis/"/>
    <id>http://haotianmcihael.github.io/2021/05/10/NJUé™æ€ç¨‹åºåˆ†æ-2-CHA-Analysis/</id>
    <published>2021-05-10T10:23:58.000Z</published>
    <updated>2022-03-16T10:12:10.822Z</updated>
    
    <content type="html"><![CDATA[<h3 id="abstract">Abstract</h3><p>æ ¹æ®<code>safe-approximation</code>ï¼Œè¿‡ç¨‹å†…æ•°æ®æµåˆ†æ<code>Intraprocedural</code>å¯¹æ‰€æœ‰çš„å‡½æ•°è°ƒç”¨<code>method call</code>åšå‡ºè¿‡åº¦ä¿å®ˆçš„å‡è®¾â€”â€”å³æ‰€æœ‰åˆ†æç»“æœå¿…é¡»<code>safe</code>ï¼Œè€Œæ ¹æ®<code>Lattice</code>ç†è®ºè¿™ç§å¤„ç†ä¼šä½¿<code>must</code>å’Œ<code>may</code>åˆ†æéƒ½å˜çš„<code>less precise</code>ã€‚æ‰€ä»¥å¼•å…¥<strong>è¿‡ç¨‹é—´æ•°æ®æµåˆ†æ</strong><code>Interprocedural Analysis</code>ï¼Œé€šè¿‡<code>Call Graph</code>æ¥å®ç°è¿‡ç¨‹é—´çš„æ•°æ®æµä¼ é€’ï¼Œä»è€Œè¿›ä¸€æ­¥æé«˜åˆ†æçš„ç²¾åº¦ã€‚<strong>å› æ­¤å¦‚ä½•æ„é€ è¿™äº›<code>call-graph</code>å°±æ˜¯è¿‡ç¨‹é—´åˆ†æçš„å…³é”®ç¯èŠ‚ã€‚</strong></p><p>For Better precision, we need Interprocedural Analysisï¼špropagate data-flow information along <strong>interprocedural control-flow edges</strong> i.e., call and return edges</p><p><code>Class hierarchy analysis</code>æ˜¯ç”¨æ¥æ„é€ <code>Call Graph</code>çš„ä¸€ç§ç»å…¸æ–¹æ³•â€”â€”ä¹Ÿæ˜¯è¿‡ç¨‹é—´åˆ†æçš„åŸºç¡€ã€‚</p><a id="more"></a><h3 id="cha">CHA</h3><p>ä»ä¸‹é¢å¼€å§‹æˆ‘ä»¬å¼€å§‹ç ”ç©¶åŒ…å«å‡½æ•°è°ƒç”¨çš„ç¨‹åºâ€”â€”è°ƒç”¨å›¾åæ˜ äº†ç¨‹åºä¸­çš„è°ƒç”¨å…³ç³»<code>calling relationships</code>ï¼Œç¡®åˆ‡çš„è¯´å°±æ˜¯<strong>ä¸€ç³»åˆ—ä»è°ƒç”¨ç‚¹<code>call-sites</code>æŒ‡å‘ç›®æ ‡æ–¹æ³•<code>callees</code>çš„è¾¹çš„é›†åˆ</strong>ï¼Œå¯ä»¥çœ‹å‡º<code>Call Graph</code>æ˜¯æå…¶é‡è¦çš„ç¨‹åºä¿¡æ¯ã€‚</p><p>å¦‚ä½•æ„é€ <code>Call Graph</code>ï¼Ÿé‰´äº<code>OOPLs</code>è¯­è¨€æ˜¯ç›®å‰è½¯ä»¶é¢†åŸŸç»å¯¹çš„é¢†å¯¼è€…ï¼Œå› æ­¤æœ¬èŠ‚è¯¾ä¹Ÿä¸»è¦é’ˆå¯¹<code>Java</code>æ¥æ„é€ è°ƒç”¨å›¾ã€‚ä¸€å…±æœ‰å››ç§æ„é€ ç®—æ³•:</p><ul><li>Class hierarchy analysis(CHA)</li><li>Rapid type analysis(RTA)</li><li>Variable type analysis(VTA)</li><li>Pointer analysis(k-CFA)</li></ul><p>å®ƒä»¬çš„åˆ†æç²¾åº¦ä»ä¸Šåˆ°ä¸‹è¶Šæ¥è¶Šå‡†ç¡®ï¼Œè€Œåˆ†ææ—¶é—´ä¹Ÿç›¸åº”çš„è¶Šæ¥è¶Šé•¿ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»ç¬¬ä¸€ç§CHAã€‚</p><h4 id="methods-callsinvocations-in-java">Methods Calls(invocations) in Java</h4><table><colgroup><col style="width: 12%"><col style="width: 10%"><col style="width: 46%"><col style="width: 30%"></colgroup><thead><tr class="header"><th></th><th>Static call</th><th>Special call</th><th>Virtual call</th></tr></thead><tbody><tr class="odd"><td>Instruction</td><td>Invokestatic</td><td>Invokespecial</td><td>Invokeinterface/invokevirtual</td></tr><tr class="even"><td>Receiver objects</td><td>â¨‰</td><td>âœ“</td><td>âœ“</td></tr><tr class="odd"><td>Target methods</td><td>Static methods</td><td>constructors/private instance methods/superclass instance methods</td><td>Other instance methods</td></tr><tr class="even"><td>#Target methods</td><td>1</td><td>1</td><td>â‰¥1(<font color="red">polymorphism</font>)</td></tr><tr class="odd"><td>Determinacy</td><td>Compile-time</td><td>Compile-time</td><td>Run-time</td></tr></tbody></table><p>Javaçš„å‡½æ•°è°ƒç”¨ä¸»è¦åˆ†ä¸ºä¸‰ç§ç±»å‹ã€‚å…¶ä¸­<code>static call</code>è°ƒç”¨é™æ€æ–¹æ³•å› æ­¤æ²¡æœ‰<code>instance</code>å®ä¾‹ï¼Œè€Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸå°±å¯ä»¥è§£æå‡ºå‡½æ•°åœ°å€ã€‚<code>special call</code>æœ‰ä¸‰ä¸ªç›®æ ‡å‡½æ•°â€”â€”æ„é€ å‡½æ•°ï¼Œç§æœ‰æˆå‘˜å‡½æ•°ä»¥åŠçˆ¶ç±»å‡½æ•°ï¼Œå› ä¸ºè¯¥è°ƒç”¨çš„<code>receiver object</code>ç±»å‹ç¡®å®šæ‰€ä»¥ä¹Ÿå¯ä»¥å†ç¼–è¯‘æœŸç¡®å®šã€‚éš¾ç‚¹åœ¨äºè™šå‡½æ•°è°ƒç”¨ï¼Œ<strong>æ‰€è°“è¿è¡Œæ—¶ç»‘å®šæŒ‡çš„æ˜¯åªæœ‰åœ¨è¿è¡Œæ—¶æ‰å¯ä»¥ç¡®å®šå…¶ç›®æ ‡å‡½æ•°ï¼ˆå¤šæ€ï¼‰ï¼Œ</strong>å› æ­¤æ„é€ è°ƒç”¨å›¾çš„å…³é”®å°±åœ¨äºå¯¹è™šå‡½æ•°è°ƒç”¨å®Œæˆæ„å»ºã€‚</p><h4 id="method-dispatch">Method Dispatch</h4><p>ä¸€ä¸ªè™šå‡½æ•°è°ƒç”¨<font color="blue">o<sup>1</sup>.foo(...)<sup>2</sup></font>åœ¨è¿è¡Œæ—¶æ ¹æ®ä¸¤ç‚¹è¢«è§£æï¼š</p><ul><li><code>Receiver object</code>çš„ç±»å‹ï¼Œå³å˜é‡oæŒ‡å‘çš„å¯¹è±¡ç±»å‹</li><li>åœ¨<code>call site</code>çš„å‡½æ•°ç­¾åï¼Œå³foo(...)</li></ul><p>å…³äºå¯¹è±¡ç±»å‹ï¼Œæ˜¯å˜é‡æŒ‡å‘çš„å®é™…ç±»å‹â€”â€”æ¯”å¦‚<code>A x = new B()</code>å’Œ<code>B x = new B()</code>çš„<code>receiver objecte</code>ç±»å‹éƒ½æ˜¯<code>B</code>ã€‚å…³äºå‡½æ•°ç­¾å<code>signatrue</code>çš„åŠŸèƒ½å°±æ˜¯èƒ½å”¯ä¸€ä»£è¡¨ä¸€ä¸ªå‡½æ•°ï¼š</p><ul><li>Signatrue = <font color="red">class type</font> + <font color="blue">method name</font> + <font color="green">descriptor</font></li><li><font color="green">Descriptor</font> = <font color="green">return type</font> + <font color="green">parameter types</font></li></ul><p>æ¯”å¦‚<code>class C{T foo(P p, Q q, R r){...}}</code> ä¸­å‡½æ•°fooçš„å‡½æ•°ç­¾åå¯ä»¥å†™æˆ<code>C.foo(P, Q, R)</code>ã€‚</p><p>æ¥ç€å¼•å…¥å‡½æ•°<font color="red">Dispatch</font>(c, m)æ¥æ¨¡æ‹Ÿè¿è¡Œæ—¶å‡½æ•°è‡ªåŠ¨ç»‘å®šçš„è¿‡ç¨‹ï¼š</p><p><img src="1.png" width="50%" height="50%" alt=""></p><p>å…¶ä¸­<code>c</code>æ˜¯<code>receiver object</code>çš„ç±»å‹ï¼Œè€Œ<code>m</code>å°±æ˜¯<code>call sites</code>çš„å‡½æ•°ç­¾åã€‚<code>Dispatch</code>å‡½æ•°åœ¨<code>c</code>ä¸­å¯»æ‰¾å’Œå‡½æ•°ç­¾å<code>m</code>ç›¸ç¬¦åˆçš„<strong>éæŠ½è±¡å‡½æ•°<code>non-abstract method</code></strong>ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™å»<code>c</code>çš„çˆ¶ç±»ä¸­ç»§ç»­æ‰¾ç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ï¼Œè¯¥å‡½æ•°æ˜¯CHAåˆ†æçš„æ ¸å¿ƒã€‚</p><h4 id="cha-1">CHA</h4><p><code>CHA</code>æ˜¯Jeffrey Deanåœ¨ECOOPä¸Šæå‡ºæ¥çš„ä¸€ç§ä¼˜åŒ–ç®—æ³•<a href="https://www.researchgate.net/profile/David-Grove/publication/2509356_Optimization_of_Object-Oriented_Programs_Using_Static_Class_Hierarchy_Analysis/links/0912f50b6c1a600bb9000000/Optimization-of-Object-Oriented-Programs-Using-Static-Class-Hierarchy-Analysis.pdf?origin=publication_detail" target="_blank" rel="noopener">Optimization of Object-Oriented Programs Using Static Class Hierarchy Analysis</a>ã€‚</p><p><strong>è¯¥ç®—æ³•å¯ä»¥æ ¹æ®<code>receiver object</code>çš„å£°æ˜ç±»å‹ï¼ˆåŒºåˆ«äºå®é™…ç±»å‹ï¼‰æ¥è§£æè™šå‡½æ•°è°ƒç”¨ã€‚</strong>å®ƒéœ€è¦æ•´ä¸ªç¨‹åºçš„ç»§æ‰¿é“¾ä½œä¸ºä¿¡æ¯åŸºç¡€ï¼Œæ¯”å¦‚<code>A a = ...;  a.foo()</code>ä¸­è¯¥ç®—æ³•å‡è®¾å˜é‡<code>a</code>å¯ä»¥æŒ‡å‘<code>class  A</code>åŠå…¶æ‰€æœ‰å­ç±»ï¼Œæ®æ­¤è§£æå‡ºå¤šä¸ªå¯èƒ½çš„ç›®æ ‡æ–¹æ³•ã€‚ä¸‹é¢æ˜¯CHAçš„ç®—æ³•:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Resolve(cs) &#123;</span><br><span class="line">T = &#123;&#125;</span><br><span class="line">m = method signature at cs</span><br><span class="line">if cs is a static call then</span><br><span class="line">T = &#123;m&#125;</span><br><span class="line">if cs is special call then</span><br><span class="line">c_m = class type of m</span><br><span class="line">T = &#123;Dispatch(c_m, m)&#125;</span><br><span class="line">if cs is a virtual call then</span><br><span class="line">c = declared type of receiver variable at cs</span><br><span class="line">foreach c&apos; that is a subclass of c or c itself do</span><br><span class="line">add Dispatch(c&apos;, m) to T</span><br><span class="line">return T</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯¹<code>Java</code>çš„ä¸‰ç§è°ƒç”¨ç±»å‹éƒ½åšäº†è§£æï¼Œå‚æ•°<code>cs</code>æ˜¯ç¨‹åºä¸­çš„è°ƒç”¨ç‚¹â€”â€”å³æ¯ä¸€ç§è°ƒç”¨å®é™…å‘ç”Ÿçš„åœ°æ–¹ã€‚<code>static call</code>å¯ä»¥ç›´æ¥æ ¹æ®å‡½æ•°ç­¾åå¾—åˆ°ç›®æ ‡å‡½æ•°ï¼›å¯¹äº<code>special call</code>ç”±äºè¿›è¡Œ<code>super-call</code>è°ƒç”¨çš„æ—¶å€™éœ€è¦è¿›ä¸€æ­¥è§£æçˆ¶ç±»ä¸­çš„å‡½æ•°ï¼ˆè¿˜ä¸èƒ½ä¿è¯çˆ¶ç±»ä¸€å®šå­˜åœ¨å‡½æ•°éœ€è¦è¿›ä¸€æ­¥ä¸Šå‡ï¼‰æ‰€ä»¥ä½¿ç”¨äº†<code>Dispatch</code>å‡½æ•°ã€‚</p><p><strong>è™šå‡½æ•°è°ƒç”¨åªéœ€è¦æ‹¿åˆ°åœ¨<code>call-site</code>å¤„<code>receiver variable</code>çš„å£°æ˜ç±»å‹ï¼Œç„¶åå¯¹è¯¥ç±»å‹ä»¥åŠè¯¥ç±»å‹çš„æ‰€æœ‰å­ç±»å¯¹è±¡åšDispatchè§£æå³å¯ã€‚</strong></p><p>è¯¥ç®—æ³•åªè€ƒè™‘è°ƒç”¨ç‚¹å¤„<code>reveriver variable</code>çš„ç±»å‹å’Œå®ƒçš„ç»§æ‰¿é“¾è€Œå¿½ç•¥äº†å…¶ä»–æ•°æ®æµå’Œæ§åˆ¶æµä¿¡æ¯ï¼Œå› æ­¤é€Ÿåº¦ä¸Šéå¸¸å¿«ï¼Œä½†æ˜¯ç²¾åº¦ä¸€èˆ¬ã€‚æ•…å…¶ä¸»è¦åº”ç”¨å°±æ˜¯IDEçš„è¡¥å…¨ä¸Šï¼Œæ»¡è¶³é€Ÿåº¦å¿«è´´åˆéœ€æ±‚ä½†æ˜¯ç²¾åº¦ä¹Ÿä¿æŒåœ¨ä¸€ä¸ªå¾ˆå¥½çš„æ¥å—èŒƒå›´å†…ã€‚</p><h4 id="call-graph-construction">Call Graph Construction</h4><p>åœ¨CHAåˆ†æçš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡å‡ºæ„é€ è°ƒç”¨å›¾<code>Call Graph</code>çš„å®Œæ•´ç®—æ³•ï¼Œè¯¥ç®—æ³•åº”ç”¨<code>BFS</code>çš„æ€è·¯ä»<code>entry</code>å‡ºå‘å¯¹æ¯ä¸€ä¸ª<code>method</code>ï¼Œè§£æè¯¥å‡½æ•°åœ¨æ‰€æœ‰è°ƒç”¨ç‚¹<code>cs</code>çš„ç›®æ ‡æ–¹æ³•<code>Resolve(cs)</code>ç›´åˆ°æ‰€æœ‰çš„<code>method</code>éƒ½å®Œæˆè§£æã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">BuildCallGraph(m_entry) &#123;</span><br><span class="line">WL = [m_entry], CG = &#123;&#125;, RM = &#123;&#125;</span><br><span class="line">while WL is not empty do</span><br><span class="line">remove m from WL</span><br><span class="line">if m âˆ‰ RM then</span><br><span class="line">add m to RM</span><br><span class="line">foreach call-site cs in th m do     // Resolve target methods via CHA</span><br><span class="line">T = Resolve(cs)</span><br><span class="line">foreach traget method m&apos; in T do</span><br><span class="line">add cs âŸ¶ m&apos; to CG    // Add call edges to call graph</span><br><span class="line">add m&apos; to WL</span><br><span class="line">return CG</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š</p><ul><li>WLåŒ…å«å³å°†è¢«è§£æçš„<code>method</code></li><li>CGåŒ…å«æ„å»ºå‡ºæ¥çš„è°ƒç”¨è¾¹<code>call-edges</code>é›†åˆ</li><li>RMåŒ…å«å·²ç»è§£æå®Œæˆçš„<code>method</code></li></ul><h3 id="inter-procedural-control-flow-graph">Inter-procedural Control-Flow Graph</h3><p>æ„å»º<code>Call Graph</code>çš„ç›®çš„å°±æ˜¯ä¸ºäº†è¿›ä¸€æ­¥æ„å»º<code>ICFG</code>ï¼Œå¦‚æœè¯´<code>CFG</code>è¡¨ç¤ºå•ä¸ªå‡½æ•°çš„ç»“æ„ï¼Œé‚£<code>ICFG</code>è¡¨ç¤ºçš„å°±æ˜¯æ•´ä¸ªç¨‹åºçš„ç»“æ„ã€‚æœ‰äº†<code>ICFG</code>æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œè¿‡ç¨‹é—´åˆ†æäº†ï¼Œ<code>ICFG</code>ä¸»è¦ç”±ä¸¤éƒ¨åˆ†æ„æˆ:</p><ul><li>ç¨‹åºä¸­æ‰€æœ‰å‡½æ•°çš„CFG</li><li>ä¸¤ç§æ–°åŠ çš„edges<ul><li>Call edges: ä»<code>call-site</code>æŒ‡å‘<code>callees</code>çš„<code>entry</code></li><li>Return edges: ä»<code>callees</code>çš„è¿”å›è¯­å¥æŒ‡å‘<code>return-site</code>(ç´§è·Ÿç€<code>call-site</code>çš„è¯­å¥)</li></ul></li></ul><p><img src="2.png" width="50%" height="50%" alt=""></p><p>è€Œè¿™ä¸¤ç§æ–°åŠ çš„è¾¹ä¿¡æ¯å°±æ¥è‡ªäº<code>Call Graph</code>ã€‚å¯¹äºæ•´ä¸ªç¨‹åºçš„<code>ICFG</code>ï¼Œåªéœ€è¦å°†å‡½æ•°è°ƒç”¨è¯­å¥å•ç‹¬ä½œä¸ºä¸€ä¸ª<code>Basic Block</code>å³å¯ï¼Œå…¶ä»–çš„ä¸å˜ã€‚</p><p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®æµä»<code>call-site</code>æ²¿ç€<code>call edges</code>æµå‘<code>callees</code>ï¼Œæ¥ç€ä»<code>callees</code>çš„è¿”å›è¯­å¥æµå‘<code>return-site</code>ã€‚<strong>è€Œ<code>call-site</code>å’Œ<code>return-site</code>ä¹‹é—´è¿˜æœ‰ä¸€æ¡è¾¹<code>call-to-return edge</code>æ˜¯ä¸ºäº†ä¼ é€’æœ¬åœ°å‡½æ•°çš„æ•°æ®æµï¼Œ</strong>ä»¥å…è¿™äº›ä¿¡æ¯è·Ÿç€<code>call graph</code>ç»•è¿œè·¯ã€‚</p><h3 id="inter-procedural-data-flow-analysis">Inter-procedural Data-Flow Analysis</h3><p>åœ¨æ„å»ºå¥½<code>ICFG</code>ä¹‹åï¼Œå°±å¯ä»¥è¿›è¡Œè¿‡ç¨‹é—´æ•°æ®æµåˆ†æäº†ã€‚</p><p>è¿™é‡Œå¯¹æ¯”è¿‡ç¨‹å†…<code>Intraprocedural</code>å’Œ<code>Interprocedural</code>ä¸¤ç§åˆ†æï¼š</p><table><thead><tr class="header"><th></th><th><font color="red">Intra</font>procedural</th><th><font color="red">Inter</font>procedural</th></tr></thead><tbody><tr class="odd"><td>Program representation</td><td>CFG</td><td>ICFG = CFGs + <font color="red">call &amp; return edges</font></td></tr><tr class="even"><td>Transfer functions</td><td>Node transfer</td><td>Node transfer + <font color="red">edge transfer</font></td></tr></tbody></table><p>å¯ä»¥çœ‹åˆ°è¿‡ç¨‹é—´åˆ†ææ¯”è¿‡ç¨‹å†…åˆ†æå¤šäº†ä¸€äº›<code>edge analysis</code>ã€‚ä»ç†è®ºä¸Šçœ‹è¿™äº›<code>edge analysis</code>å®Œæˆäº†å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­çš„è·¨å‡½æ•°æ•°æ®æµæ¯”å¦‚å‚æ•°ï¼Œè¿”å›å€¼çš„ä¼ é€’ã€‚</p><ul><li>Call edge transfer: ä¼ é€’å‚æ•°ï¼ˆä»call-siteåˆ°entry of calleeï¼‰</li><li>Return edge transfer: ä¼ é€’è¿”å›å€¼(ä»return ofcalleeåˆ°return-site)</li></ul><p>è€Œè¿‡ç¨‹é—´åˆ†æå’Œè¿‡ç¨‹å†…åˆ†æçš„<code>Transfer Function</code>ç›¸æ¯”ï¼Œå¤šäº†ä¸€æ¡è§„åˆ™ï¼š</p><p>For each call node(call-site), kill data-flow value for the LHS variable. Its value will flow to return site along the return edges.</p><p>å³è¦<code>kill</code>æ‰è°ƒç”¨ç‚¹è¯­å¥çš„<strong>å·¦å€¼å˜é‡</strong>ã€‚</p><p><img src="3.png"" width="50%" height="50%" alt=""></p><p>å› ä¸ºå·¦å€¼çš„æ•°æ®æµä¼šåœ¨<code>callee</code>ä¸­å¾—åˆ°æ›´æ–°æœ€ç»ˆæ²¿ç€<code>return edge</code>ä¼ é€’ï¼Œè€Œå¦‚æœè¯¥å€¼åœ¨<code>call-to-return edge</code>ä¸­ç»§ç»­ä¼ é€’ä¸‹å»ï¼Œåœ¨<code>merge</code>çš„æ—¶å€™å›æŸå¤±ç²¾åº¦æ¯”å¦‚å¸¸é‡ä¼ æ’­ä¸­c<sub>1</sub> âŠ“ c<sub>2</sub> = NACã€‚æ•…æ‹¿å¸¸é‡ä¼ æ’­æ¥è¯´çš„è¯ï¼Œ<code>Interprocedural constant propagation</code>è¦æ¯”<code>Intraprocedural constant propagation</code>æ›´åŠ ç²¾ç¡®ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;abstract&quot;&gt;Abstract&lt;/h3&gt;
&lt;p&gt;æ ¹æ®&lt;code&gt;safe-approximation&lt;/code&gt;ï¼Œè¿‡ç¨‹å†…æ•°æ®æµåˆ†æ&lt;code&gt;Intraprocedural&lt;/code&gt;å¯¹æ‰€æœ‰çš„å‡½æ•°è°ƒç”¨&lt;code&gt;method call&lt;/code&gt;åšå‡ºè¿‡åº¦ä¿å®ˆçš„å‡è®¾â€”â€”å³æ‰€æœ‰åˆ†æç»“æœå¿…é¡»&lt;code&gt;safe&lt;/code&gt;ï¼Œè€Œæ ¹æ®&lt;code&gt;Lattice&lt;/code&gt;ç†è®ºè¿™ç§å¤„ç†ä¼šä½¿&lt;code&gt;must&lt;/code&gt;å’Œ&lt;code&gt;may&lt;/code&gt;åˆ†æéƒ½å˜çš„&lt;code&gt;less precise&lt;/code&gt;ã€‚æ‰€ä»¥å¼•å…¥&lt;strong&gt;è¿‡ç¨‹é—´æ•°æ®æµåˆ†æ&lt;/strong&gt;&lt;code&gt;Interprocedural Analysis&lt;/code&gt;ï¼Œé€šè¿‡&lt;code&gt;Call Graph&lt;/code&gt;æ¥å®ç°è¿‡ç¨‹é—´çš„æ•°æ®æµä¼ é€’ï¼Œä»è€Œè¿›ä¸€æ­¥æé«˜åˆ†æçš„ç²¾åº¦ã€‚&lt;strong&gt;å› æ­¤å¦‚ä½•æ„é€ è¿™äº›&lt;code&gt;call-graph&lt;/code&gt;å°±æ˜¯è¿‡ç¨‹é—´åˆ†æçš„å…³é”®ç¯èŠ‚ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;For Better precision, we need Interprocedural Analysisï¼špropagate data-flow information along &lt;strong&gt;interprocedural control-flow edges&lt;/strong&gt; i.e., call and return edges&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Class hierarchy analysis&lt;/code&gt;æ˜¯ç”¨æ¥æ„é€ &lt;code&gt;Call Graph&lt;/code&gt;çš„ä¸€ç§ç»å…¸æ–¹æ³•â€”â€”ä¹Ÿæ˜¯è¿‡ç¨‹é—´åˆ†æçš„åŸºç¡€ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://haotianmcihael.github.io/categories/Java/"/>
    
    
      <category term="PL" scheme="http://haotianmcihael.github.io/tags/PL/"/>
    
      <category term="Software-Analysis" scheme="http://haotianmcihael.github.io/tags/Software-Analysis/"/>
    
  </entry>
  
  <entry>
    <title>NJUé™æ€ç¨‹åºåˆ†æ(1-Data Flow Analysis)</title>
    <link href="http://haotianmcihael.github.io/2021/05/04/NJU%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90-1-Data-Flow-Analysis/"/>
    <id>http://haotianmcihael.github.io/2021/05/04/NJUé™æ€ç¨‹åºåˆ†æ-1-Data-Flow-Analysis/</id>
    <published>2021-05-03T16:12:53.000Z</published>
    <updated>2022-03-16T10:20:48.443Z</updated>
    
    <content type="html"><![CDATA[<h3 id="abstract">Abstract</h3><p>ç¼–è¯‘å™¨ä¸­å¤§éƒ¨åˆ†æœºå™¨æ— å…³çš„å…¨å±€ä¼˜åŒ–æ˜¯åŸºäº<code>Data-flow Analysis</code>å®ç°çš„ã€‚æ•°æ®æµåˆ†ææŠ€æœ¯ä»ä»£ç ä¸­æ”¶é›†ç¨‹åºè¯­ä¹‰ç›¸å…³çš„ä¿¡æ¯ï¼Œæ˜¯ç¨‹åºåˆ†æçš„åŸºç¡€ã€‚</p><p><strong>In each data-flow analysis application, we associate with every program point a data-flow value that represents an abstraction of the set of all possible program states that can be observed for that point.</strong></p><p>åœ¨å·¥ä¸šç•Œçš„<a href="https://www.zhihu.com/question/41959902" target="_blank" rel="noopener">ä¸»æµç¼–è¯‘å™¨</a>ä¸­ï¼Œ<code>C</code>ç³»çš„<code>LLVM</code>ï¼Œ<code>Java</code>ç³»çš„<code>HotSpot</code>éƒ½æ˜¯åŸºäº<code>SSA</code>åšæ•°æ®æµåˆ†æè€Œä¸æ˜¯ä¼ ç»Ÿçš„<code>lattice</code>ã€‚å—å¤§è¿™èŠ‚è¯¾ä¸­æ˜¯åŸºäº<code>Lattice</code>æ¥è®²è§£è¿‡ç¨‹å†…<code>Intra-procedural</code>ï¼Œæ— åˆ«å<code>no aliases</code>çš„ç»å…¸æ•°æ®æµåˆ†ææ¡†æ¶ã€‚</p><a id="more"></a><h3 id="applications">Applications</h3><h4 id="overview">Overview</h4><h5 id="cfg">CFG</h5><p>åˆ†ææ¡†æ¶éƒ½æ˜¯å»ºç«‹åœ¨<code>control-flow-graph</code>ä¸Šçš„ï¼Œè¿™æ˜¯ä¸€ç§<code>IR</code>â€”â€”ç”±<code>basic-blocks</code>é€šè¿‡<code>control-flows</code>è¿æ¥è€Œæˆï¼Œå¯ä»¥åˆ†åˆ«çœ‹æˆæ˜¯<code>CFG</code>çš„<code>nodes</code>å’Œ<code>edges</code>ã€‚ å¦‚ä½•é€šè¿‡æºç ï¼ˆå•ä¸ªå‡½æ•°ï¼‰ç”Ÿæˆ<code>CFG</code>è§è¯¾ä»¶ã€‚</p><p><img src="1.png" width="50%" height="50%" alt=""></p><h5 id="abstract-1">Abstract</h5><p>æ•°æ®æµåˆ†æç”¨æ¥æè¿°æ‰€è°“<strong>æ•°æ®</strong>å¦‚ä½•åœ¨<strong>CFG</strong>ä¸­æµåŠ¨ã€‚è¿™é‡Œçš„<code>data</code>æŒ‡çš„æ˜¯ç¨‹åºè¯­ä¹‰ä¿¡æ¯çš„ä¸€ç§<code>abstraction</code>ï¼Œ<code>CFG</code>ä¸­çš„<code>nodes</code>å’Œ<code>edges</code>åˆ†åˆ«æ˜ å°„<code>transfer-function</code>å’Œ<code>control-flow handling</code>ã€‚æ‰€ä»¥æ•´ä¸ªåˆ†ææ˜¯å»ºç«‹åœ¨ä¸€å¥—æˆç†Ÿçš„ç†è®ºæ¡†æ¶ä¹‹ä¸Šçš„ã€‚</p><ul><li><code>data(application-specific)</code>: ä¸åŒçš„æ•°æ®æµåˆ†æåº”ç”¨ä¼šæœ‰ä¸åŒçš„æŠ½è±¡å€¼<code>value</code>ï¼Œæ¯”å¦‚åˆ†æå˜é‡æ•°å€¼æ—¶ï¼š<code>+;-;0;UND;UNKNOW;</code><ul><li><code>domain</code>: æŠ½è±¡æ•°æ®æµçš„å€¼åŸŸå³æ‰€æœ‰<code>value</code>å®šä¹‰çš„é›†åˆ</li></ul></li><li><code>transfer-functions</code>:ä¸åŒçš„ç¨‹åºä¼šæœ‰ä¸åŒçš„<code>CFG</code>è¡¨ç¤ºï¼Œè¿›ä¸€æ­¥éœ€è¦æ·±åˆ»<code>CFG</code>ä¸­<code>statements</code>ï¼Œ<code>basic-blocks</code>åœ¨è¢«æ˜ å°„æˆ<code>transfer-functions</code>æ—¶çš„åŒºåˆ«å’Œè”ç³»</li><li><code>control-flows</code>:æ§åˆ¶æµåŸºæœ¬ä¸Šåªæœ‰ä¸‰ä¸ªâ€”â€”é¡ºåºï¼Œæ±‡èšä»¥åŠåˆ†æµ</li></ul><h5 id="safety-analysis">safety analysis</h5><p>å¤§éƒ¨åˆ†çš„åˆ†ææ¡†æ¶è¦æ±‚åˆ†æç»“æœæ˜¯<code>Sound</code>çš„å³<code>over-approximation</code>ã€‚è€Œå®é™…ä¸Šå¹¶éæ‰€æœ‰å¦‚æ­¤â€”â€”è¿™é‡Œæ­£å¼å°†æ‰€æœ‰åˆ†æåˆ†æˆä¸¤ç±»ï¼š<code>may analysis</code>å’Œ<code>must analysis</code>ã€‚</p><ul><li><code>may analysis</code>: è¦æ±‚åˆ†æç»“æœä¸­å¿…é¡»å…¨éƒ¨åŒ…å«æ‰€æœ‰æ­£ç¡®ç­”æ¡ˆï¼Œæ¢ä¸ªè§’åº¦ç†è§£å°±æ˜¯<strong>ä¸æ”¾è¿‡ä»»ä½•ä¸€ä¸ªåŠ¨æ€è¿è¡Œæ—¶çš„å¯èƒ½å‡ºé”™çš„è¡Œä¸º</strong>â€”â€”ä¸€æ—¦å‘ç°å°±è¦æŠ¥é”™ï¼Œå³<code>over</code>çš„æ¦‚å¿µ</li><li><code>must analysis</code>: è¦æ±‚åˆ†æç»“æœä¸€å®šæ˜¯æ­£ç¡®çš„ï¼Œå³ä¸èƒ½æœ‰è¯¯æŠ¥ï¼Œå³<code>under</code>çš„æ¦‚å¿µ</li></ul><p>è€Œ<code>over</code>å’Œ<code>under</code>åœ¨ä¸åŒçš„åº”ç”¨ä¸­éƒ½ä»£è¡¨äº†å„è‡ªæœ€<code>safe</code>çš„ç»“æœï¼Œå› æ­¤æ‰€æœ‰çš„é™æ€ç¨‹åºåˆ†æå¯ä»¥æ€»ç»“æˆï¼š<code>abstraction</code>å’Œ<code>safe-approximation</code>ä¸¤ä¸ªé˜¶æ®µï¼Œä¸åŒçš„æ•°æ®æµåˆ†ææœ‰ä¸åŒçš„<code>abstraction</code>å’Œ<code>safe-approximation strategies</code>å³ä¸åŒçš„<code>transfer-functions</code>å’Œ<code>control-flow handlings</code>ã€‚</p><h4 id="preliminaries">Preliminaries</h4><h5 id="input-and-output-states">Input and Output States</h5><p>æ‰€æœ‰çš„æ“ä½œå¯¹è±¡éƒ½æ˜¯åœ¨ä¸€ä¸ª<code>CFG</code>ä¸­ã€‚</p><p><code>statements</code> æ˜¯<code>CFG</code>ä¸­çš„æ‰§è¡Œçš„æœ€å°å•ä½â€”â€”æ¯ä¸€æ¡<code>statements</code>çš„æ‰§è¡Œéƒ½ä¼šæ”¹å˜ç¨‹åºçš„çŠ¶æ€ã€‚</p><p><strong>æ¯ä¸€ä¸ª<code>statements</code>å‰åéƒ½æœ‰è‡ªå·±çš„<code>program point</code>åˆ†åˆ«ä»£è¡¨<code>input/output state</code>ï¼Œè®°ä½œ<code>IN[S_i]/OUT[S_i]</code>ã€‚åˆå› ä¸ºä¸€ä¸ª<code>basic-blocks</code>ä¸­çš„æ‰€æœ‰<code>statements</code>å¯ä»¥ç»“åˆåœ¨ä¸€èµ·ï¼ˆå› ä¸ºBBå†…éƒ¨åªèƒ½é¡ºåºæ‰§è¡Œï¼‰æ•…æ¯ä¸ª<code>basic-blocks</code>å¼€å§‹å’Œç»“æŸä¹Ÿæœ‰è‡ªå·±çš„<code>program point</code>ï¼Œè®°ä½œ<code>IN[B_i]/OUT[B_i]</code>ã€‚</strong></p><p><code>control flow</code>è¡¨ç¤ºäº†å„ä¸ª<code>basic-blocks</code>çš„æ‰§è¡Œé¡ºåºå…³ç³»ã€‚åˆ†ä¸ºä¸‰ç§ï¼šé¡ºåºï¼Œæ±‡èšå’Œåˆ†æµ</p><p><img src="2.png" width="50%" height="50%" alt=""></p><ul><li>é¡ºåºï¼š<code>IN[s2] = OUT[s1]</code></li><li>æ±‡èš: <code>IN[s2] = OUT[s1] ^ OUT[s3]</code><ul><li>æ“ä½œç¬¦<code>^</code>æŒ‡çš„æ˜¯<code>meet operator</code>ï¼Œä¸åŒçš„ç®—æ³•æœ‰ä¸åŒæ“ä½œæ¯”å¦‚å¹¶é›†ï¼Œäº¤é›†ç­‰</li></ul></li><li>åˆ†æµ: <code>IN[s2] = IN[s3] = OUT[s1]</code></li></ul><p><strong>éœ€è¦å…³æ³¨çš„æ˜¯æ¯ä¸ªBBæˆ–è€…Statementçš„<code>program point</code>ï¼Œæ•°æ®æµåˆ†æä¼šç»™æ¯ä¸ª<code>program point</code>ä¸€ä¸ª<code>data-flow value</code>æ¥æŠ½è±¡å‡ºå½“å‰ä½ç½®ç¨‹åºçš„éƒ¨åˆ†è¯­ä¹‰ä¿¡æ¯ï¼Œå†è¿›ä¸€æ­¥åˆ©ç”¨å„ç§<code>safe-approximation-directed constraints</code>ä»¥è¾¾åˆ°åˆ†æç›®çš„ï¼Œè¿™é‡Œçš„<code>constraints</code>å…·ä½“æŒ‡çš„æ˜¯ä¸åŒçš„<code>transfer functions</code>å’Œ<code>control flow handlings</code>ã€‚</strong></p><h5 id="notations-for-transfer-functions-constraints">Notations for Transfer Functions' Constraints</h5><ul><li>Forward Analysisï¼š OUT[s] = F_s(IN[s]),å…¶ä¸­F_så°±æ˜¯é’ˆå¯¹å…·ä½“è¾“å…¥çš„<code>Transfer Function</code>ï¼Œå‰å‘åˆ†ææ˜¯ä»è¾“å…¥æ¨å¯¼è¾“å‡º</li></ul><p><img src="3.png" width="50%" height="50%" alt=""></p><ul><li>Backward Analysisï¼šIN[s] = F_s(OUT[s]),åå‘åˆ†ææ˜¯ä»è¾“å‡ºæ¨å¯¼è¾“å…¥</li></ul><p><img src="4.png" width="50%" height="50%" alt=""></p><h5 id="notations-for-control-flows-constraints">Notations for Control Flows' Constraints</h5><h6 id="control-flow-within-a-bb">control flow within a BB</h6><p>åœ¨ä¸€ä¸ªBBå†…éƒ¨ï¼Œ<code>IN[S_(i+1)] = OUT[S_(i)], for all i = 1, 2,...n-1</code>â€”â€”è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œä¸€ä¸ªBBä¸­çš„<code>statements</code>åªèƒ½é¡ºåºæ‰§è¡Œæ•…åªä¼šæœ‰ä¸€ä¸ªè¾“å…¥è¾“å‡ºã€‚</p><h6 id="control-flow-among-bbs">control flow among BBs</h6><p>å¯¹äºä¸€ä¸ª<code>basic block</code>æ¥è¯´ï¼š<code>IN[B] = IN[S_1];   OUT[B] = OUT[S_n]</code>ã€‚ è€ŒBBä¹‹é—´çš„æ‰§è¡Œä¸ä»…ä»…æ˜¯é¡ºåºå…³ç³»ã€‚è¿˜æœ‰æ±‡èšå’Œåˆ†æµçš„æ‰§è¡Œé¡ºåºã€‚</p><p>é¦–å…ˆæ˜¯æ±‡èšï¼š<code>OUT[B] = F_b(IN[B])</code>ï¼Œå…¶ä¸­<code>F_b = F_sn * ...* F_s2 * F_s1</code>ä¹Ÿå°±æ˜¯ä¸€ä¸ªBBçš„çš„<code>Transfer Function</code>ç”±å†…éƒ¨<code>statements</code>å„è‡ªçš„<code>transfer function</code>ç»„æˆï¼Œ<code>IN[B] = ^ OUT[P]</code>ï¼Œè¡¨ç¤ºæ‰€æœ‰æ±‡èšçš„è¾“å‡ºçš„å¹¶é›†éƒ½æˆä¸ºä¸‹ä¸€ä¸ªçš„è¾“å…¥ï¼Œè¿™é‡Œçš„<code>^</code>å°±æ˜¯è¡¨ç¤ºå¹¶é›†çš„<code>meet operator</code>è€Œ<code>P</code>è¡¨ç¤º<code>B</code>çš„æ‰€æœ‰å‰é©±<code>basic blocks</code>ã€‚</p><p><img src="5.png" width="50%" height="50%" alt=""></p><p>å…¶æ¬¡æ˜¯åˆ†æµï¼š<code>IN[B] = F_b(OUT[B])</code>;<code>OUT[B] = ^IN[S]</code>è¿™é‡Œè¡¨ç¤º<code>B</code>çš„è¾“å‡ºéƒ½æˆä¸ºæ‰€æœ‰<code>S</code>çš„è¾“å…¥ï¼Œ<code>S</code>æ˜¯<code>B</code>çš„æ‰€æœ‰åç»§ã€‚</p><p><img src="6.png" width="50%" height="50%" alt=""></p><p>æœ‰äº†å‰é¢çš„åŸºç¡€ï¼Œä¸‹é¢å…ˆä»‹ç»ä¸‰ç§ç»å…¸çš„æ•°æ®æµåˆ†æç®—æ³•ï¼š</p><h4 id="reaching-definitions-analysis">Reaching Definitions Analysis</h4><h5 id="å®šä¹‰">å®šä¹‰</h5><p>A definition d at <strong>program point</strong> p reaches a point q if <strong>there is</strong> a path from p to q such that d is not &quot;killed&quot; along that path.(A definition of a variable is a statement that assigns a value to v).</p><p><img src="7.png" width="50%" height="50%" alt=""></p><p>é¦–å…ˆ<strong><code>definition</code>-å®šä¹‰</strong>æŒ‡çš„æ˜¯å¯¹å˜é‡<code>v</code>è¿›è¡Œèµ‹å€¼çš„è¯­å¥ã€‚ä¸€èˆ¬æ¥è®²<strong>å®šä¹‰</strong>éƒ½æ˜¯ä»ä¸€ä¸ª<code>program point</code>ä¸Šå®Œæˆçš„ã€‚</p><p>åœ¨pç‚¹ä¸Šçš„ï¼Œä¸€ä¸ªå¯¹å˜é‡<code>v</code>çš„<code>definition</code>èƒ½<code>reach</code>åˆ°æŸä¸€ä¸ªæ–°çš„ç‚¹qï¼Œå–å†³äºåœ¨æ§åˆ¶æµä¸Šæ˜¯å¦<strong>å­˜åœ¨</strong>ä¸€æ¡ä»påˆ°qçš„è·¯å¾„ï¼ŒåŒæ—¶åœ¨è¿™æ¡è·¯å¾„ä¸Šè¯¥å˜é‡<code>v</code>ä¸ä¼šè¢«é‡æ–°å®šä¹‰ï¼Œå°±è¯´æ˜¯è¿™ä¸ª<code>definition</code>å¯ä»¥reachåˆ°qç‚¹ã€‚</p><h5 id="åˆ†æç±»å‹">åˆ†æç±»å‹</h5><p>ä»å®šä¹‰çš„<code>there is</code>å¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ª<code>may analysis</code>â€”â€”å³æ§åˆ¶æµä¸Šä»påˆ°qçš„æ‰€æœ‰è·¯å¾„è€Œè¨€ï¼Œåªéœ€è¦æœ‰ä¸€æ¡è·¯å¾„æ²¡æœ‰è¢«é‡æ–°å®šä¹‰ï¼Œé‚£è¿™ä¸¤ä¸ª<code>program point</code>ä¹‹é—´å°±æ˜¯<code>Reached</code>çš„ã€‚å¹¶ä¸”è¿˜çŸ¥é“è¿™æ˜¯ä¸€ä¸ª<code>forward analysis</code>â€”â€”å› ä¸ºæ˜¯å‰é¢çš„<code>program point</code>ä¸Šçš„<code>definition</code>å¯ä»¥<code>reach</code>åˆ°åé¢çš„<code>program point</code>ã€‚</p><h5 id="åº”ç”¨">åº”ç”¨</h5><p>è¯¥åˆ†æå¯ä»¥ç”¨æ¥<strong>æ£€æŸ¥æœªå®šä¹‰çš„å˜é‡</strong>ã€‚å¯¹äºæ‰€æœ‰éœ€è¦æ£€æµ‹çš„å˜é‡ï¼Œåœ¨<code>CFG</code>çš„<code>entry</code>å…¥å£å¤„éƒ½èµ‹å€¼ä¸º<code>dummy definition</code>â€”â€”å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ª<code>undefined</code>çš„æ ‡ç­¾ï¼Œå¦‚æœå˜é‡<code>v</code>çš„å¯ä»¥<strong>åˆ°è¾¾</strong>æŸä¸€ä¸ªä½¿ç”¨ç‚¹ï¼Œé‚£è¿™ä¸ªå˜é‡å°±æœ‰å¯èƒ½æ˜¯æœªå®šä¹‰å‰ä½¿ç”¨ã€‚</p><h5 id="ç»†èŠ‚">ç»†èŠ‚</h5><h6 id="data-flow-valuesfact">Data Flow Values/Fact</h6><p>é¦–å…ˆæ•°æ®æµåˆ†æéœ€è¦å¯¹åˆ†æçš„å¯¹è±¡è¿›è¡ŒæŠ½è±¡ï¼Œ<strong>è¿™é‡Œä½¿ç”¨<code>BitVector</code>æ¥è¡¨ç¤ºä¸€ä¸ª<code>CFG</code>ï¼ˆå³ä¸€æ®µè¿‡ç¨‹å†…ç¨‹åºä¸­ï¼‰ä¸Šæ‰€æœ‰å˜é‡çš„<code>definition</code>ã€‚</strong>ï¼ˆæ³¨æ„å…³æ³¨å¯¹è±¡<code>definition</code>ä¸æ˜¯å˜é‡æœ¬èº«ï¼Œè€Œæ˜¯å®šä¹‰è¿™ä¸ªå˜é‡çš„æ‰€æœ‰<code>program point</code>ã€‚ï¼‰</p><h6 id="transfer-function">Transfer Function</h6><p>æ ¹æ®<code>IN</code>æ±‚å‡ºæ¯ä¸€ä¸ª<code>statemetns/basic blocks</code>çš„<code>OUT</code>çš„ã€‚ç”±è¯¥åˆ†æçš„ç›®çš„å¯ä»¥å¾—å‡ºï¼š<code>OUT[B] = gen_B âˆª (IN[B] - kill_B)</code>ï¼Œå³å¯¹äºæ¯ä¸€ä¸ª<code>program point</code>æ¥è¯´ï¼Œå…¶<code>OUT</code>å°±æ˜¯åœ¨è¯¥ç‚¹å¤„æ–°å¢åŠ çš„å¯¹å˜é‡çš„<code>definitions</code>é™¤æ‰åˆ«å¤„è¿™äº›å˜é‡çš„<code>definitions</code>ã€‚</p><h6 id="control-flow">Control Flow</h6><p>æ ¹æ®ä¸Šä¸€ä¸ª<code>statements/basic blocks</code>çš„<code>OUT</code>æ±‚å‡ºä¸‹ä¸€ä¸ªçš„<code>IN</code>ã€‚å› ä¸ºä½œä¸º<code>may</code>åˆ†æï¼Œå…¶ä¸æ”¾è¿‡ä»»ä½•ä¸€ä¸ªè¿è¡Œæ—¶çš„è¡Œä¸ºï¼Œæ‰€ä»¥é’ˆå¯¹æ‰€æœ‰ç•™åˆ°è¯¥<code>IN</code>çš„<code>OUT</code>éƒ½è¦æ¥æ”¶ã€‚å³<code>IN[B] = âˆª_p(pæ˜¯Bæ‰€æœ‰çš„å‰é©±ç»“ç‚¹)OUT[P]</code>ã€‚</p><h5 id="ç®—æ³•">ç®—æ³•</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">INPUT: CFG(kill_B and gen_B computed for each basic blocks B)</span></span><br><span class="line"><span class="comment">OUTOUT: IN[B] and OUT[B] for each basic block B</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">OUT[entry] = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">for</span> (each basic block B\entry)</span><br><span class="line">OUT[B] = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(changes to ant OUT occur) </span><br><span class="line"><span class="keyword">for</span>(each basic blocks B\entry) &#123;</span><br><span class="line">   IN[B] = âˆª_OUT[P];</span><br><span class="line">   OUT[B] = gen_B âˆª (IN[B] - kill_B);      </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯éå¸¸å…¸å‹çš„<strong>ä¸åŠ¨ç‚¹ç®—æ³•</strong>ï¼Œå¦‚æœæˆ‘ä»¬ç®€åŒ–æ¨¡å‹ä»…ä»…åªæ˜¯å…³æ³¨æ¯ä¸€ä¸ª<code>basic blocks</code>çš„<code>IN</code>å’Œ<code>OUT</code>,ä¼šå‘ç°å¯¹äºæœ‰é™çš„<code>definition</code>é›†åˆï¼Œåœ¨ç»è¿‡å¤šæ¬¡è¿­ä»£ä¹‹åï¼Œæ­£å‘çš„å¢åŠ <code>gen/survivors</code>ä¸€å®šä¼šå¯¼è‡´<code>OUT</code>è¾¾åˆ°ä¸€ä¸ªå®šå€¼ã€‚</p><h4 id="live-variables-analysis">Live Variables Analysis</h4><h5 id="å®šä¹‰-1">å®šä¹‰</h5><p>Live variables analysis tells whether the value of variable v at program point p <strong>could be used </strong>along some path in CFG starting at p. If so, v is live at p; otherwise, v is dead at p.</p><p><img src="8.png" width="50%" height="50%" alt=""></p><p>åˆ†æ<strong>å˜é‡<code>v</code>åœ¨ä¸€ä¸ª<code>program point</code>-pä¸Šæ˜¯å¦æ˜¯æ´»è·ƒçš„</strong>ï¼Œå–å†³äºæ˜¯å¦å­˜åœ¨ä¸€æ¡ä»pç‚¹å¼€å§‹ä¸€ç›´åˆ°ç¨‹åºæ‰§è¡Œç»“æŸçš„è·¯å¾„ï¼Œè¯¥è·¯å¾„ä¸­æœ‰ä½¿ç”¨è¿‡<code>v</code>çš„åœ°æ–¹ï¼Œ<strong>å¹¶ä¸”ä»pç‚¹åˆ°ä½¿ç”¨ç‚¹æœŸé—´<code>v</code>ä¸å¯ä»¥è¢«é‡æ–°å®šä¹‰</strong>â€”â€”åˆ™è¯´æ˜è¯¥å˜é‡<code>v</code>åœ¨pç‚¹æ˜¯æ´»è·ƒçš„ã€‚</p><h5 id="åˆ†æç±»å‹-1">åˆ†æç±»å‹</h5><p>æ ¹æ®å®šä¹‰å¯ä»¥çŸ¥é“è¿™æ˜¯ä¸€ä¸ª<code>may</code>åˆ†æï¼Œè¯¥å˜é‡åªè¦æœ‰ä½¿ç”¨ç‚¹åˆ™åˆ†æç»“æœå°±æ˜¯æ´»è·ƒçš„ã€‚åˆå› ä¸ºåˆ†æçš„è¿‡ç¨‹æ˜¯ä»åå¾€å‰çš„æ•…è¯¥åˆ†æä¹Ÿæ˜¯ä¸€ä¸ª<code>backward analysis</code>ã€‚</p><h5 id="åº”ç”¨-1">åº”ç”¨</h5><p>è¯¥åˆ†æå¯ä»¥ç”¨æ¥å®Œæˆ<strong>å¯„å­˜å™¨åˆ†é…</strong>ã€‚æ¯”å¦‚åœ¨æ‰§è¡Œåˆ°ç¨‹åºçš„æŸä¸€ç‚¹éœ€è¦å°†æ“ä½œæ•°åŠ è½½åˆ°å…¶ä¸­ä¸€ä¸ªå¯„å­˜å™¨ä¸­â€”â€”è€Œè¿™æ—¶å€™æ‰€æœ‰çš„<code>registers</code>éƒ½æ»¡äº†ã€‚å¦‚ä½•é€‰æ‹©åˆé€‚çš„å¯„å­˜å™¨å‘¢ï¼Ÿå¦‚æœé€‰æ‹©çš„æ˜¯ä¸€ä¸ª<code>dead</code>ä¸æ´»è·ƒçš„å¯„å­˜å™¨å€¼ï¼ˆæœªæ¥ä¸ä¼šè¢«ç”¨åˆ°ï¼‰ï¼Œé‚£å°±å¯ä»¥ç›´æ¥æ›¿æ¢æ‰ã€‚è€Œå¦‚æœè¿™ä¸ªå¯„å­˜å™¨ä¸­çš„å˜é‡å€¼æ˜¯æ´»è·ƒçš„ï¼Œé‚£åé¢å†æ¬¡ä½¿ç”¨åˆ°çš„æ—¶å€™å°±éœ€è¦æŠŠå®ƒå†æ¬¡ä»å†…å­˜è¯»åˆ°å¯„å­˜å™¨ï¼Œæµªè´¹äº†èµ„æºã€‚</p><h5 id="ç»†èŠ‚-1">ç»†èŠ‚</h5><h6 id="data-flow-valuefact">Data Flow Value/Fact</h6><p>è¯¥åˆ†æå…³æ³¨çš„å¯¹è±¡ï¼Œ<strong>å°±æ˜¯å˜é‡æœ¬èº«</strong>ï¼Œä½¿ç”¨<code>BitVector</code>è¡¨ç¤ºã€‚</p><h6 id="transfer-function-1">Transfer Function</h6><p><code>IN[B] = use_B âˆª (OUT[B] - def_B)</code>ã€‚è¿™é‡Œçš„<code>use_B</code>æŒ‡çš„æ˜¯<strong>æ‰€æœ‰åœ¨é‡æ–°å®šä¹‰ä¹‹å‰å˜é‡çš„ä½¿ç”¨ç‚¹ï¼Œ</strong>é€šè¿‡<code>backward</code>çš„æ€è·¯æ¥åˆ†æï¼Œå¯¹äºä¸€ä¸ª<code>basic block</code>ï¼Œç»™å‡ºå…¶<code>OUT</code>æ¥å¾—åˆ°å…¶<code>IN</code>éœ€è¦å…³æ³¨åœ¨BBä¸­å˜é‡æ˜¯å¦æ˜¯æ»¡è¶³æ´»è·ƒçš„å‰æè¦æ±‚çš„ã€‚</p><p><img src="9.png" width="50%" height="50%" alt=""></p><h6 id="control-flow-1">Control Flow</h6><p>å› ä¸ºä½œä¸º<code>may</code>åˆ†æï¼Œå…¶ä¸æ”¾è¿‡ä»»ä½•ä¸€ä¸ªè¿è¡Œæ—¶çš„è¡Œä¸ºï¼Œæ‰€ä»¥é’ˆå¯¹æ‰€æœ‰ç•™åˆ°è¯¥<code>IN</code>çš„<code>OUT</code>éƒ½è¦æ¥æ”¶ã€‚å³<code>IN[B] = âˆª_s(sæ˜¯Bæ‰€æœ‰çš„å‰é©±ç»“ç‚¹)OUT[s]</code>ã€‚</p><h5 id="ç®—æ³•-1">ç®—æ³•</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">INPUT: CFG(def_B and use_B computed for each basic blocks B)</span></span><br><span class="line"><span class="comment">OUTOUT: IN[B] and OUT[B] for each basic block B</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">IN[<span class="built_in">exit</span>] = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">for</span> (each basic block B\<span class="built_in">exit</span>)</span><br><span class="line">IN[B] = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(changes to ant IN occur) </span><br><span class="line"><span class="keyword">for</span>(each basic blocks B\<span class="built_in">exit</span>) &#123;</span><br><span class="line">OUT[B] = âˆª_IN[S];</span><br><span class="line">OUT[B] = use_B âˆª (OUT[B] - def_B);      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°†ä¸¤ä¸ªç®—æ³•çš„<code>Transfer Func</code>æ”¾åˆ°ä¸€èµ·å¯¹æ¯”ï¼š</p><ul><li>RDA: <code>OUT[B] = gen_B âˆª (IN[B] - kill_B)</code></li><li>LVA: <code>IN[B] = use_B âˆª (OUT[B] - def_B)</code></li></ul><p>ä¼šå‘ç°å¾ˆå¤šçš„æ•°æ®æµåˆ†æç®—æ³•éƒ½æ˜¯<code>GEN/KILL Problem</code>ï¼Œç»Ÿè®¡ä¸€ä¸‹å…¬å¼å°±æ˜¯<code>OUT = gen âˆª (IN - kill)</code>ã€‚</p><h4 id="available-expressions-analysis">Available Expressions Analysis</h4><h5 id="å®šä¹‰-2">å®šä¹‰</h5><p>An expression x op y is available at program point p if (1) <strong>all paths </strong>from the entry to p must pass through the evaluation of x op y, and (2) <strong>after the last evaluation of x op y, there is no redefinition of x or y</strong>.</p><p><img src="10.png" width="50%" height="50%" alt=""></p><p>åœ¨<code>CFG</code>ä¸Šçš„æ‰€æœ‰çš„å¤åˆå‹è¡¨è¾¾å¼éƒ½ä¼šè¢«æ‹†æˆä¸‰åœ°å€ç ã€‚<strong>åˆ¤æ–­ä¸€ä¸ª<code>expression</code>-<code>x op y</code>åœ¨pç‚¹æ˜¯<code>available</code>çš„</strong>ï¼Œå–å†³äºä»<code>entry</code>åˆ°<code>p</code>ç‚¹æ‰€æœ‰çš„è·¯å¾„éƒ½å¿…é¡»æœ‰è¯¥è¡¨è¾¾å¼çš„<code>evaluation</code>æ±‚å€¼ï¼Œå¹¶ä¸”åœ¨æœ€åä¸€ä¸ªæ±‚å€¼ä¹‹åä¸èƒ½å¯¹<code>x/y</code>é‡æ–°èµ‹å€¼ï¼Œå³å°±è¯´è¿™ä¸ªè¡¨è¾¾å¼åœ¨pç‚¹äº‹<code>available</code>çš„ã€‚</p><h5 id="åˆ†æç±»å‹-2">åˆ†æç±»å‹</h5><p>å¿…é¡»ä¿è¯æ‰€æœ‰çš„<code>path</code>éƒ½æœ‰<code>evaluation of expression</code>åˆ†æç»“æœæ‰æ˜¯<code>available</code>ã€‚å› æ­¤è¿™æ˜¯ä¸€ä¸ª<code>must</code>åˆ†æï¼Œå³ä¸èƒ½æœ‰è¯¯æŠ¥ä½†å¯ä»¥æœ‰æ¼æŠ¥ï¼Œæ¯”å¦‚ä¸‹å›¾ä¸­çš„æƒ…å†µï¼Œå‡è®¾<code>x = 3</code>å‰åéƒ½æˆç«‹é‚£ä¹ˆå®é™…ä¸Šè¿™ä¸ªè¡¨è¾¾å¼ä¹Ÿæ˜¯å¯ä»¥è¢«ä¼˜åŒ–çš„ï¼Œä½†æ˜¯æ ¹æ®è¯¥<code>must</code>åˆ†æçš„å®šä¹‰è¿™ä¸ªåˆ†æç»“æœæ˜¯<code>not avaliable</code>çš„ã€‚</p><p><img src="11.png" width="50%" height="50%" alt=""></p><h5 id="åº”ç”¨-2">åº”ç”¨</h5><p>è¯¥åˆ†æå¯ä»¥ç”¨æ¥è¿›è¡Œ<strong>å…¬å…±å­è¡¨è¾¾å¼åˆ é™¤</strong>ï¼Œå³ç”¨<code>the last evaluation of available expression</code>ç›´æ¥æ›¿æ¢è¯¥è¡¨è¾¾å¼ï¼Œä»è€Œä¼˜åŒ–ä»£ç ã€‚</p><h5 id="ç»†èŠ‚-2">ç»†èŠ‚</h5><h6 id="data-flow-valuefact-1">Data Flow Value/Fact</h6><p>é¡¾åæ€ä¹‰å°±æ˜¯ç¨‹åºä¸­æ‰€æœ‰çš„<code>expression</code>ã€‚</p><h6 id="transfer-function-2">Transfer Function</h6><p>æ ¹æ®å®šä¹‰<code>OUT[B] = gen_B âˆª (IN[B] - kill_B)</code>ï¼Œå¯¹äºæ‰€æœ‰çš„è¾“å…¥çš„è¡¨è¾¾å¼ï¼Œäº§ç”Ÿçš„æ–°è¡¨è¾¾å¼å¹¶ä¸”åˆ é™¤æ‰åœ¨å…¶å˜é‡è¢«é‡æ–°èµ‹å€¼çš„è¡¨è¾¾å¼ã€‚</p><h6 id="control-flow-2">Control Flow</h6><p>å› ä¸ºæ˜¯<code>must</code>åˆ†æå¯¹äºæ‰€æœ‰çš„æƒ…å†µéƒ½è¦è€ƒè™‘ï¼Œæ‰€ä»¥<code>IN[B] = âˆ©(p:predecessors of B)OUT[p]</code>ã€‚</p><h5 id="ç®—æ³•-2">ç®—æ³•</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">INPUT: CFG(kill_B and gen_B computed for each basic blocks B)</span></span><br><span class="line"><span class="comment">OUTOUT: IN[B] and OUT[B] for each basic block B</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">out[entry] = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">for</span> (each basic block B\entry)</span><br><span class="line">OUT[B] = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(changes to ant OUT occur) </span><br><span class="line"><span class="keyword">for</span>(each basic blocks B\entry) &#123;</span><br><span class="line">IN[B] = âˆª_IN[P];</span><br><span class="line">OUT[B] = gen_B âˆª (OUT[B] - kill_B);      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¯¹äºè¿™ä¸‰ç§åˆ†ææ¥è¯´ï¼Œå¦‚ä½•ç†è§£<code>may/must</code>ï¼Œ<code>false positive/false negative</code>å’Œåœ¨æ‰€æœ‰<code>CFG</code>ä¸Šç¨‹åºçš„è¿è¡Œæ—¶è¡Œä¸ºä¹‹é—´çš„å…³ç³»æ˜¯å¾ˆå…³é”®çš„é—®é¢˜ã€‚</strong></p><h3 id="foundations">Foundations</h3><h4 id="mathematics-prerequisite">Mathematics Prerequisite</h4><h5 id="partial-order">Partial Order</h5><p>å®šä¹‰<code>poset</code>ååºé›†<code>(P, â‰¼)</code>è¡¨ç¤ºä¸€ä¸ªé›†åˆ<code>p</code>ï¼Œç¬¦å·<code>â‰¼</code>å®šä¹‰åœ¨è¯¥é›†åˆçš„<code>partial ordering</code>æœ‰å¦‚ä¸‹æ€§è´¨ï¼š</p><ul><li><em>Reflexivity</em>. âˆ€ xâˆŠP, xâ‰¼x<br></li><li><em>Antisymmetry.</em> âˆ€ x,yâˆŠP, xâ‰¼y âˆ§ yâ‰¼x âŸ¹ x=y.</li><li><em>Transitivity</em>. âˆ€ x,y,zâˆŠP, xâ‰¼y âˆ§ yâ‰¼z âŸ¹ xâ‰¼z.</li></ul><p>å¦‚ä½•ç†è§£ååº-<code>partial ordering</code>ï¼Ÿ<strong>åœ¨é›†åˆ<code>p</code>ä¸­å®šä¹‰äº†ä¸€ç§<code>order</code>ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰ä¸¤ä¸ªå…ƒç´ ä¹‹é—´éƒ½å¿…é¡»æ»¡è¶³è¿™ç§<code>order</code>â€”â€”å³é›†åˆä¸­ä¸¤ä¸ªå…ƒç´ ä¹‹é—´å¯ä»¥æ˜¯<code>incomparable</code>çš„</strong>ã€‚æ¯”å¦‚<code>power set</code>æ˜¯éå¸¸å…¸å‹çš„<code>poset</code>ã€‚</p><p><img src="12.png" width="50%" height="50%" alt=""></p><h5 id="upper-and-lower-bounds">Upper and Lower Bounds</h5><p>ç»™å®šååºé›†<code>(P, â‰¼)</code>ä»¥åŠè¯¥é›†åˆçš„ä¸€ä¸ªå­é›†<code>S âŠ† P</code>ã€‚æˆ‘ä»¬ä½¿ç”¨é›†åˆ<code>P</code>ä¸­çš„<strong>ä¸€ä¸ªå…ƒç´ <code>u âˆŠ P</code></strong>æ¥å®šä¹‰<strong>é›†åˆ<code>S</code>çš„<code>upper bound</code>å’Œ<code>lower bound</code>:</strong></p><ul><li>âˆ€xâˆŠS, xâ‰¼u âŸ¹ uâˆŠP is an <em>upper bounds</em> of S</li><li>âˆ€xâˆŠS, lâ‰¼x âŸ¹ lâˆŠP is an <em>lower bound</em> of S</li></ul><p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥å®šä¹‰<strong>é›†åˆ<code>S</code>çš„<code>least upper bound(lub or join)</code>ç®€å†™ä¸º<code>âŠ”S</code>ï¼Œä»¥åŠ<code>greatest lower bound(glb or meet)</code>ç®€å†™ä¸º<code>âŠ“S</code>:</strong></p><ul><li>for every <em>upper bound</em> of S, say u: <code>âŠ”S â‰¼ u</code></li><li>for every <em>lower bound</em> of S, say l:<code>l â‰¼ âŠ“S</code></li></ul><p>æ ¹æ®<code>âŠ”S/âŠ“S</code>çš„å®šä¹‰ï¼Œå¦‚æœé›†åˆ<code>S</code>ä¸­åªæœ‰ä¸¤ä¸ªå…ƒç´ <code>a and b</code>ã€‚é‚£ä¹ˆï¼š</p><ul><li><code>âŠ”S</code> â‰¡ <code>a âŠ” b</code>(aå’Œbçš„å¹¶é›†)</li><li><code>âŠ“S</code> â‰¡ <code>a âŠ“ b</code>ï¼ˆaå’Œbçš„äº¤é›†ï¼‰</li></ul><p><strong>ä¸æ˜¯æ‰€æœ‰çš„ååºé›†éƒ½æœ‰<code>âŠ“S/âŠ”S</code>ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªååºé›†åŒæ—¶æœ‰<code>âŠ”S/âŠ“S</code>çš„è¯ï¼Œé‚£è¯¥ååºé›†å°±æ˜¯å”¯ä¸€çš„ã€‚</strong></p><h5 id="lattic">Lattic</h5><p>å¯¹äºä¸€ä¸ªååºé›†<code>P</code>ï¼Œå¦‚æœé›†åˆä¸­<strong>ä»»æ„ä¸¤ä¸ªå…ƒç´ ï¼ˆæ„æˆçš„å­é›†Sï¼‰</strong><code>a</code>å’Œ<code>b</code>ï¼Œå®ƒä»¬çš„<code>aâŠ”b</code>å’Œ<code>aâŠ“b</code>éƒ½å­˜åœ¨ï¼Œåˆ™è¿™ä¸ªååºé›†å°±æ˜¯ä¸€ä¸ª<code>lattice</code>ã€‚</p><ul><li>Given poset (P, â‰¼), âˆ€a,bâˆŠP, if âˆƒ aâŠ”b, âˆƒ aâŠ“b âˆƒ then P is calles a lattice</li></ul><p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¦‚æœè¿™ä¸ªååºé›†Pä¸­çš„ä»»æ„ä¸¤ä¸ªå…ƒç´ åªæœ‰<code>aâŠ”b</code>æˆ–è€…<code>aâŠ“b</code>ä¸­çš„ä¸€ä¸ªï¼Œåˆ™è¿™ä¸ªååºé›†åˆ†åˆ«ç§°ä¸º<code>join semilattice</code>å’Œ<code>meet semilattice</code>ã€‚</p><h5 id="complete-lattice">Complete Lattice</h5><p>å¯¹äºä¸€ä¸ªååºé›†<code>P</code>ï¼Œå¦‚æœé›†åˆä¸­<strong>ä»»æ„ä¸€ä¸ªå­é›†S</strong>éƒ½å­˜åœ¨<code>âŠ”S</code>å’Œ<code>âŠ“S</code>ï¼Œåˆ™è¿™ä¸ªååºé›†ä¾¿ç§°ä¸º<code>complete lattice</code>ã€‚<strong>å…¨æ ¼å’Œæ ¼çš„åŒºåˆ«ä¸»è¦åœ¨äºï¼Œæ ¼å¯¹å…¶å­é›†çš„è¦æ±‚æ˜¯åªéœ€è¦æœ‰ä¸¤ä¸ªå…ƒç´ è€Œå…¨æ ¼å¯¹å­é›†å…ƒç´ çš„æ•°é‡æ²¡æœ‰é™åˆ¶ã€‚</strong></p><p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¯¹äºä¸€ä¸ª<code>complete lattice</code>ï¼Œéƒ½æœ‰å­˜åœ¨ï¼š</p><ul><li>a greatest element âŠ¤ = âŠ”P called <font color="red">top</font></li><li>a least element âŠ¥ = âŠ“P called <font color="blue">bottom</font></li></ul><p><strong>æ¯ä¸€ä¸ª<code>finite lattice</code>éƒ½æ˜¯ä¸€ä¸ª<code>complete lattice</code>ã€‚ä½†æ˜¯ä¸€ä¸ª<code>complete lattice</code>å´ä¸ä¸€å®šæ˜¯<code>finite lattice</code></strong>ã€‚</p><h5 id="product-lattice">Product Lattice</h5><p>ç»™å®šå¤šä¸ª<code>lattice</code>-<code>Li = (Pi, â‰¼i)</code>çš„ç¬›å¡å°”ç§¯æ„æˆçš„ä¸€ä¸ªæ–°çš„<code>latticeï¼Œ</code>å¦‚æœè¿™äº›<code>lattice</code>æ¯ä¸€ä¸ªéƒ½æœ‰<code>lub</code>å’Œ<code>glb</code>çš„è¯<strong>(è¿™é‡Œæ²¡æœ‰è¯´æ˜å­é›†Sçš„ä¸ªæ•°ä¸»è¦æ˜¯å› ä¸ºå®ƒå¯ä»¥æ˜¯åªæœ‰ä¸¤ä¸ªå…ƒç´ çš„æ™®é€š<code>lattice</code>ä¹Ÿå¯ä»¥æ˜¯åŒ…æ‹¬ä»»æ„å…ƒç´ çš„<code>complete lattice</code>ï¼Œæ¢å¥è¯è¯´å¦‚æœä¸€ä¸ª<code>product lattice</code>æ˜¯<code>complete lattice</code>çš„ç¬›å¡å°”ç§¯ï¼Œé‚£ä¹ˆå®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ª<code>complete lattice</code>)</strong>åˆ™ç§°å…¶ç§¯ä¸º<code>product lattice</code>å¹¶æ»¡è¶³ä¸‹é¢æ€§è´¨:</p><ul><li>P = P1 x P2...x Pn</li><li>(x1, ..., xn) â‰¼ (y1, ..., yn) â‰¡ (x1 â‰¼ y1)âˆ§...âˆ§(xnâ‰¼yn)</li><li>(x1, ..., xn) âŠ” (y1, ..., yn) â‰¡ (x1 âŠ” y1)âˆ§...âˆ§(xn âŠ” yn)</li><li>(X1, ..., xn) âŠ“ (y1, ..., yn) â‰¡ (x1 âŠ“ y1)âˆ§...âˆ§(xn âŠ“ yn)</li></ul><p>å³ä¸€ä¸ª<code>product lattice</code>ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ <code>lattice</code>æ»¡è¶³çš„æ€§è´¨å®ƒéƒ½æ»¡è¶³ã€‚</p><h4 id="data-flow-analysis-framework-via-lattice">Data Flow Analysis Framework via Lattice</h4><h5 id="iterative-algorithm">Iterative Algorithm</h5><p>å›é¡¾å‰é¢ä¸‰ä¸ªå…·ä½“çš„æ•°æ®æµåˆ†æç®—æ³•ï¼Œå³ç›¸åº”çš„<code>may/must</code>åˆ†æä»å„è‡ªçš„åˆå§‹çŠ¶æ€å‡ºå‘ï¼Œ<strong>ç»è¿‡ä¸æ–­è¿­ä»£ï¼ˆTransfer Function/Control Flowï¼‰</strong>æœ€ç»ˆåˆ°è¾¾<strong>ä¸åŠ¨ç‚¹</strong>â€”â€”æ•´ä¸ªç¨‹åºçš„æ•°æ®æµä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œç®—æ³•åœæ­¢ã€‚</p><p>è¿™é‡Œä»æ›´å…·ä½“çš„è§’åº¦æ¥ç†è§£è¿™ä¸ªç®—æ³•ï¼š</p><p>ç»™å®šä¸€ä¸ª<code>CFG</code>ï¼Œå…¶ä¸­æœ‰<code>k</code>ä¸ªèŠ‚ç‚¹(è¿™é‡Œç®€åŒ–æˆä¸ºåªå¸¦ä¸€ä¸ª<code>statement</code>çš„<code>basic block</code>)ã€‚<strong>è€Œè¿­ä»£ç®—æ³•åœ¨æ¯æ¬¡è¿­ä»£ä¸­æ›´æ–°è¿™kä¸ªèŠ‚ç‚¹çš„è¾“å‡º<code>OUT</code></strong>ï¼Œå¼•å…¥ä¸€ä¸ª<code>k-tuple</code>:</p><ul><li>(OUT[n<sub>1</sub>], OUT[n<sub>2</sub>], ..., OUT[n<sub>k</sub>]) â‰¡ <font color="red">(V<sub>1</sub> x V<sub>2</sub> ... x V<sub>k</sub>)</font></li></ul><p><strong><code>k-tuple</code>å°±æ˜¯æ¯ä¸€æ¬¡è¿­ä»£åæ‰€æœ‰èŠ‚ç‚¹è¾“å‡ºå€¼çš„<code>product</code>è®°ä¸ºV<sup>k</sup>ã€‚</strong>è€Œæ›´å…·ä½“çš„è§£é‡Šå°±æ˜¯<strong>ä¸åŒçš„æ•°æ®æµåˆ†æç®—æ³•åœ¨æ¯æ¬¡è¿­ä»£ä¸­é€šè¿‡åº”ç”¨å„ç§<code>Transfer Function/Control Flow</code>æ¥æ›´æ–°<code>k-tuple</code>çš„å€¼â€”â€”å¯ä»¥å°†æ¯ä¸€æ¬¡è¿­ä»£æŠ½è±¡å‡ºæˆä¸ºä¸€ä¸ªå‡½æ•°:F: V<sup>k</sup> âŸ¶ V<sup>k</sup></strong>ã€‚è€Œå½“æœ€åä¸€æ¬¡è¿­ä»£çš„è¾“å‡ºæ²¡æœ‰å‘ç”Ÿå˜åŒ–ä¾¿åˆ°è¾¾äº†ä¸åŠ¨ç‚¹ã€‚</p><p><img src="13.png" width="50%" height="50%" alt=""></p><p>This general <em>iterative algorithm</em> produces a solution to data flow analysisï¼Œæ ¹æ®<strong>å‡½æ•°Fçš„ä¸€ä¸ªä¸åŠ¨ç‚¹</strong>çš„å®šä¹‰ï¼š</p><ul><li>X is a <font color="yellow">fix point</font> of Function F if <font color="yellow">X = F(X)</font>&gt;</li></ul><p>å¯ä»¥å¾—åˆ°<font color="red">å½“æŠŠæ¯ä¸€ä¸ªè¿­ä»£æŠ½è±¡æˆä¸ºä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œ<code>IterativeÂ Algorithm</code>æœ€ç»ˆä¼šåˆ°è¾¾ä¸€ä¸ª<strong>ä¸åŠ¨ç‚¹</strong>ï¼Œè€Œè¿™ä¸ª<strong>ä¸åŠ¨ç‚¹</strong>å°±æ˜¯æ•°æ®æµåˆ†æçš„ä¸€ä¸ªç»“æœ</font>ã€‚</p><h5 id="data-flow-analysis-framework-via-lattice-1">Data Flow Analysis Framework via Lattice</h5><p>å®šä¹‰ä¸€ä¸ªæ•°æ®æµåˆ†ææ¡†æ¶ä¸»è¦æœ‰ä¸‰ä¸ªéƒ¨åˆ†(<font color="red">D</font>, <font color="green">L</font>, <font color="blue">F</font>):</p><ul><li><font color="red">D</font>: æŒ‡çš„æ˜¯åˆ†æçš„æ–¹å‘æ˜¯<code>backwwards/forwards</code></li><li><font color="green">L</font>: æ ¸å¿ƒéƒ¨åˆ†æ˜¯<code>lattice</code>ï¼Œä»£è¡¨æ‰€åˆ†æçš„<strong>æ•°æ®æµå€¼åŸŸ</strong>ï¼Œå’Œ<strong>ä¸€ä¸ª<code>meetâŠ“</code>æˆ–è€…<code>joinâŠ”</code>è¿ç®—ç¬¦</strong>ï¼ˆä¸€èˆ¬ä¸€ä¸ªæ•°æ®æµåˆ†æç®—æ³•åªä¼šç”¨åˆ°å…¶ä¸­ä¸€ä¸ªè¿ç®—ç¬¦â€”â€”æ•…å…¶å®æ˜¯<code>semilattice</code>ï¼‰</li><li><font color="blue">F</font>: æŒ‡çš„æ˜¯åˆ†æä¸­çš„<code>Transfer Functions</code></li></ul><p><strong>åˆ†ææ¡†æ¶å°±å¯ä»¥çœ‹æˆæ˜¯åœ¨ä¸€ä¸ª<code>lattice</code>çš„å€¼ä¸Šä¸åœçš„è¿­ä»£<code>transfer functions</code>å’Œ<code>join/meet operations</code></strong>ã€‚</p><h5 id="fixed-point-theorem">Fixed Point Theorem</h5><p>åœ¨å­¦å®Œ<strong><code>Iterative Algorithm</code></strong>ä»¥åŠ<strong><code>Data FLow Analysis Framework</code></strong>ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥ç†è§£è¿™ä¸¤è€…ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶æ›´æ·±å±‚æ¬¡çš„ç†è§£<strong>åœ¨<code>lattice</code>ä¸Šå®šä¹‰çš„å‡½æ•°çš„ä¸åŠ¨ç‚¹åŸç†-<code>Fixed Point Theorem</code></strong>ï¼Œé¦–å…ˆå¯¹<code>Iterative Algorithm</code>æå‡ºä¸€äº›æ ¸å¿ƒçš„é—®é¢˜:</p><ul><li>è¿­ä»£ç®—æ³•èƒ½ä¿è¯<strong>ä¸€å®šä¼šåˆ°è¾¾ä¸å®šç‚¹ä¹ˆï¼Ÿ</strong></li><li>å‡è®¾å¯ä»¥åˆ°è¾¾ä¸åŠ¨ç‚¹ï¼Œé‚£è¿™ä¸ª<strong>ä¸åŠ¨ç‚¹æ˜¯å”¯ä¸€çš„ä¹ˆ</strong>ï¼Œæˆ–è€…<strong>é€šè¿‡è¿­ä»£ç®—æ³•åˆ°è¾¾çš„ä¸åŠ¨ç‚¹æ˜¯æœ€ç²¾ç¡®çš„ä¹ˆï¼Ÿ</strong></li><li>å‡è®¾å¯ä»¥åˆ°è¾¾ä¸åŠ¨ç‚¹ï¼Œé‚£<strong>ä»€ä¹ˆæ—¶å€™å¯ä»¥åˆ°è¾¾ï¼Ÿ</strong></li></ul><p>å‰ä¸¤ä¸ªé—®é¢˜å¼•å‡ºäº†<strong>ä¸åŠ¨ç‚¹ç†è®ºåŠå…¶å­˜åœ¨æ€§ä»¥åŠç²¾ç¡®æ€§</strong>ã€‚ç”±äºå‰é¢ä»‹ç»çš„<code>Iterative Algorithm</code>ä¹Ÿæ˜¯å»ºç«‹åœ¨<code>Lattice</code>ä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥ä¸ºäº†<strong>å›ç­”è¿™ä¸‰ä¸ª<code>Iterative Algorithm</code>æœ‰å…³çš„é—®é¢˜ï¼Œé¦–å…ˆåº”è¯¥å¼•å…¥å»ºç«‹åœ¨<code>Lattice</code>ä¸Šçš„å‡½æ•°å¹¶ç ”ç©¶è¯¥å‡½æ•°ä¸åŠ¨ç‚¹çš„æ€§è´¨ï¼Œæœ€åå°†è¿™ä¸ªå‡½æ•°ä¸<code>Iterative Algorithm</code>è”ç³»èµ·æ¥ã€‚</strong></p><h6 id="monotonicity">Monotonicity</h6><p>å¼•å…¥<strong>åœ¨<code>Lattice</code>å®šä¹‰ä¸Šçš„å‡½æ•°f</strong>å¹¶å®šä¹‰å…¶å•è°ƒæ€§:</p><ul><li><code>f: L âŸ¶ L (L is a Lattice)</code> is monotonic if âˆ€x,yâˆŠL, xâ‰¼ y âŸ¹ f(x) â‰¼ f(y)</li></ul><p>åœ¨æ­¤åŸºç¡€ä¸Šå¼•å…¥<code>Fixed-Point Theorem</code>:</p><p><font color="red">å¯¹äºä¸€ä¸ª<code>complete lattice(L, â‰¼)</code>ï¼Œå¦‚æœâ‘ åœ¨å…¶ä¸Šçš„å‡½æ•°<code>f:LâŸ¶L</code>æ˜¯å•è°ƒçš„ï¼Œâ‘¡Læ˜¯<code>finiteÂ lattice</code>ï¼š é‚£ä¹ˆé€šè¿‡è¿­ä»£f(âŠ¥), f(f(âŠ¥)), ..., f^k(âŠ¥)å¯ä»¥å¾—åˆ°<code>leastÂ fixedÂ point</code>ï¼› Â é€šè¿‡è¿­ä»£f(âŠ¤), f(f(âŠ¤)), ..., f^k(âŠ¤)å¯ä»¥å¾—åˆ°<code>greatestÂ fixedÂ point</code>ã€‚</font></p><p>å¯ä»¥é€šè¿‡è¯æ˜è¯¥ç†è®ºæ¥å›ç­”å‰ä¸¤ä¸ªé—®é¢˜ã€‚è¯æ˜åˆ†ä¸ºä¸¤æ­¥:</p><ul><li>ä¸åŠ¨ç‚¹çš„å­˜åœ¨</li><li>è¿­ä»£åˆ°è¾¾æœ€å°/å¤§ä¸åŠ¨ç‚¹</li></ul><h6 id="proof">Proof</h6><blockquote><p><em>Proof-Existence of Fixed Point:</em></p><p>â€‹ <em>âˆµ <code>âŠ¥</code>æ˜¯<code>Lattice</code>æœ€å°å…ƒç´ ï¼Œç”±<code>f:LâŸ¶L</code>çš„å®šä¹‰å¯çŸ¥<code>f(âŠ¥)</code>ä¹Ÿæ˜¯<code>Lattice</code>ä¸Šçš„å…ƒç´ âŸ¹ âŠ¥ â‰¼ f(âŠ¥)</em></p><p>â€‹ <em>âˆµ <code>f</code>æ˜¯å•è°ƒçš„ âŸ¹ f(âŠ¥) â‰¼ f(f(âŠ¥))=f<sup>2</sup>(âŠ¥) ç›¸ä¼¼çš„ âŸ¹ âŠ¥â‰¼ f(âŠ¥) â‰¼ f<sup>2</sup>(âŠ¥) ... â‰¼ f<sup>i</sup>(âŠ¥)</em></p><p>â€‹ <em>âˆµ<code>L</code>æ˜¯<code>finite</code>çš„ âŸ¹ f<sup>k</sup>(âŠ¥) = f<sup>(k+1)</sup>(âŠ¥)</em></p><p>â€‹ <em>âˆ´ ä¸åŠ¨ç‚¹å­˜åœ¨</em></p><p><em>Proof-Least Fixed Point:</em></p><p>â€‹ <em>å‡è®¾æœ‰å¦ä¸€ä¸ªä¸åŠ¨ç‚¹<code>x</code>ï¼ŒâŸ¹ <code>x = f(x)</code>, <code>âŠ¥ â‰¼ x</code></em></p><p><code>Induction:</code></p><p>â€‹ <em>âˆµ f æ˜¯å•è°ƒçš„ âŸ¹ f(âŠ¥) â‰¼ f(x)</em></p><p>â€‹ <em>å‡è®¾f^i(âŠ¥) â‰¼ f<sup>i</sup>(x), âˆµ få•è°ƒ âŸ¹ f<sup>(i+1)</sup>(âŠ¥) â‰¼ f<sup>(i+1)</sup>(x)</em></p><p>â€‹ <em>âˆ´æ ¹æ®å½’çº³æ³• âŸ¹ f<sup>i</sup>(âŠ¥) âŸ¹ f<sup>i</sup>(x)</em></p><p>â€‹ <em>âˆµ<code>x</code>æ˜¯ä¸åŠ¨ç‚¹ï¼Œf<sup>i</sup>(âŠ¥) â‰¼ f<sup>i</sup>(x) = xï¼Œ åˆâˆµf<sup>fix</sup>=f<sup>k</sup>(âŠ¥)æ˜¯ä»âŠ¥å¼€å§‹è¿­ä»£åœæ­¢çš„ä¸åŠ¨ç‚¹ âŸ¹ f<sup>k</sup>(âŠ¥) â‰¼ x</em></p><p>â€‹ <em>âˆ´f<sup>k</sup>(âŠ¥)æ˜¯å”¯ä¸€çš„æœ€å°ä¸åŠ¨ç‚¹(æœ€å¤§ä¸åŠ¨ç‚¹è¯æ˜ç±»ä¼¼)</em></p></blockquote><h6 id="iterative-and-fixed-point">Iterative and Fixed-Point</h6><p>ç†è§£æ•°æ®æµåˆ†æçš„æœ€åä¸€æ­¥ï¼Œå°±æ˜¯å°†åˆ†æçš„<code>Iterative Algorithm</code>ä¸å‰é¢å»ºç«‹åœ¨<code>Lattice</code>ä¸Š<code>Fixed-Point Theorem</code>è”ç³»èµ·æ¥ï¼Œè€Œå…³äºä¸åŠ¨ç‚¹åŸç†çš„å‰æ:</p><ul><li>a complete lattice(L, â‰¼)ï¼Œ L is finite</li><li><code>f: L âŸ¶ L</code> is monotonic</li></ul><p>å¯ä»¥çœ‹å‡º<strong>åªéœ€è¦å°†è¿­ä»£ç®—æ³•æŠ½è±¡æˆä¸€ä¸ªä¸ªå®šä¹‰åœ¨<code>Lattice</code>ä¸Šçš„å•è°ƒå‡½æ•°å³å¯(æ ¹æ®ä¸åŠ¨ç‚¹åŸç†è¯¥å‡½æ•°ä¸€å®šä¼šè¾¾åˆ°æœ€å¤§/å°ä¸åŠ¨ç‚¹)</strong>â€”â€”ä¸‹é¢å…·ä½“å¯¹<code>Iterative Algorithm</code>è¿›è¡ŒæŠ½è±¡:</p><p>è¿­ä»£ç®—æ³•ä¸­çš„<code>CFG</code>æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„è¾“å‡ºV<sub>i</sub>éƒ½å¯ä»¥æŠ½è±¡æˆä¸€ä¸ª<code>Lattice</code>ï¼Œ<strong>æ•…å…¨éƒ¨<code>CFG</code>çš„è¾“å‡ºV<sup>k</sup>å°±æ˜¯ä¸€ä¸ª<code>product lattice</code></strong>ã€‚åˆå› ä¸ºèŠ‚ç‚¹æ˜¯æœ‰é™çš„ï¼Œæ•…è¿™ä¸ª<code>product lattice</code>æ˜¯<code>complete lattice</code>ã€‚</p><p><img src="15.png" width="50%" height="50%" alt=""></p><p>åˆå› ä¸ºè¿­ä»£ç®—æ³•çš„æ ¸å¿ƒå°±æ˜¯V<sup>k</sup>åº”ç”¨<code>Transfer Function</code>å’Œ<code>meet/join Function</code>å®Œæˆä¸€æ¬¡åˆä¸€æ¬¡çš„è¿­ä»£ï¼Œ<strong>è¿™é‡Œçš„<code>Transfer /meet.join Function</code>å¯ä»¥æŠ½è±¡æˆå®šä¹‰åœ¨<code>Lattice</code>ä¸Šçš„å‡½æ•°ã€‚</strong></p><p><img src="16.png" width="50%" height="50%" alt=""></p><p>åªè¦ä¿è¯<code>Transfer Function</code>å’Œ<code>meet/join Function</code>æ˜¯å•è°ƒçš„ï¼Œå°±å¯ä»¥å®Œæˆè¿­ä»£ç®—æ³•åˆ°ä¸åŠ¨ç‚¹ç†è®ºçš„æ˜ å°„ã€‚</p><p>å…¶å®æ‰€æœ‰çš„<code>Transfer Function</code>æœ¬è´¨ä¸Šéƒ½æ˜¯<code>gen/kill problems</code>ï¼Œå› æ­¤ç®€åŒ–ä¸ºå‡½æ•°f<sub>i</sub>: L âŸ¶ Lã€‚å…¶åŸºæœ¬å…¬å¼å¯ä»¥ç®€åŒ–æˆä¸º<font color="red">OUT[S] = gen<sub>S</sub> â‹ƒ (IN[S] - kill<sub>S</sub>)</font> ã€‚ä»åŸºæœ¬å…¬å¼ä¸­å¯å¾—:</p><ul><li>gen<sub>S</sub>å’Œkill<sub>S</sub>æ˜¯æ ¹æ®æ•°æ®æµåˆ†æç®—æ³•çš„å®šä¹‰å†³å®šçš„ï¼Œæ‰€ä»¥<strong>ä¿æŒä¸å˜</strong></li><li>gen<sub>S</sub>æ˜¯å•è°ƒçš„(OUT[S]åªä¼šå¢åŠ )ï¼ŒIN[S]è¦ä¹ˆè¢«killæ‰ï¼Œè¦ä¹ˆä¹ŸåŠ å…¥åˆ°OUT[S]ä¸­</li><li><strong>å› æ­¤<code>OUT[S] never shrinks</code></strong></li></ul><p>ç”±äºè¾“å…¥ä¸€å®šæ˜¯æœ‰é™çš„(è¾“å…¥å°±æ˜¯æ•°æ®æµæ¯”å¦‚<code>all definitions/all variables/all expressions</code>)å› æ­¤è¯¥å‡½æ•°ä¸€å®šä¹Ÿæ˜¯å•è°ƒæœ‰ç•Œçš„ã€‚</p><p>ç›¸å¯¹æ¥è¯´<code>meet/join Function</code>å‡½æ•°âŠ”/âŠ“:L x L âŸ¶ Lï¼Œåªè¯æ˜âŠ”æ˜¯å•è°ƒçš„ï¼ŒâŠ“ç±»ä¼¼:</p><blockquote><p><em>Poof.</em></p><p><em>âˆ€x, y, z âˆŠ L, x â‰¼ y, æˆ‘ä»¬è¦è¯æ˜ xâŠ”z â‰¼ yâŠ”z</em></p><p><em>âˆµ xâ‰¼y, y â‰¼ yâŠ”z âŸ¹ x â‰¼ yâŠ”z</em></p><p><em>âˆµ xâŠ”zæ˜¯least upper bound of x and z</em></p><p><em>âˆ´xâŠ”z â‰¼ yâŠ”z</em></p></blockquote><p>å¾—è¯è¯¥å‡½æ•°ä¹Ÿæ˜¯å•è°ƒçš„ã€‚</p><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å®Œç¾çš„å°†<code>data-flow analysis</code>çš„<code>iterative algorithm</code>è½¬åŒ–æˆä¸º<code>fixed-point theorem</code>çš„å·²çŸ¥æ¡ä»¶ï¼Œæ•…<code>fixed-point theorem</code>çš„ç»“è®ºå½“ç„¶ä¹Ÿé€‚ç”¨äº<code>iterative algorithm</code>ã€‚æˆ‘ä»¬ä¹Ÿå›ç­”äº†è¿™ä¸€èŠ‚æœ€å¼€å§‹å…³äºè¿­ä»£ç®—æ³•ä¸åŠ¨ç‚¹å­˜åœ¨æ€§å’Œç²¾åº¦çš„é—®é¢˜ã€‚</p><h6 id="complexity">Complexity</h6><p>å…³äºè¿­ä»£ç®—æ³•çš„ä¸åŠ¨ç‚¹ç†è®ºè¿˜æœ‰æœ€åä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ç®—æ³•ä¼šåœ¨ä»€ä¹ˆæ—¶å€™åˆ°è¾¾ä¸åŠ¨ç‚¹å³<code>when can we get the solution</code>?<strong>è¿™å°±æ¶‰åŠåˆ°äº†åœ¨<code>Lattice</code>å»ºç«‹çš„å‡½æ•°çš„å¤æ‚åº¦ï¼š</strong></p><p>é¦–å…ˆå¼•å…¥<code>Lattice</code>çš„é«˜åº¦<code>height</code>ï¼Œå³ä»<code>lattice</code>çš„<code>top</code>åˆ°<code>bottom</code>æœ€é•¿çš„ä¸€æ¡è·¯å¾„<code>h</code>ï¼Œå‡è®¾è¯¥<code>CFG</code>ä¸­èŠ‚ç‚¹çš„æ•°ç›®æ˜¯<code>k</code>ï¼Œ<strong>é‚£æœ€åæƒ…å†µéœ€è¦<code>i = h* k</code>æ¬¡è¿­ä»£æ‰èƒ½åˆ°è¾¾ä¸åŠ¨ç‚¹ã€‚</strong></p><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæ‰€æœ‰çš„ç†è®ºéƒ¨åˆ†éƒ½ä»‹ç»ç»“æŸäº†ï¼</p><h4 id="maymust-analysis-on-lattice">May/Must Analysis On Lattice</h4><p>å‰é¢ä¸€éƒ¨åˆ†ä¸»è¦ä»æ•°å­¦è§’åº¦å¼•å…¥<strong>åœ¨<code>lattice</code>ä¸Šå®šä¹‰çš„å‡½æ•°çš„ä¸åŠ¨ç‚¹å®šç†ï¼Œç„¶åè¯æ˜äº†æ•°æ®æµåˆ†æçš„ç®—æ³•æœ¬è´¨ä¸Šå°±æ˜¯é€šè¿‡è¿­ä»£æ¥è¾¾åˆ°ä¸åŠ¨ç‚¹ã€‚</strong>ä½†æ˜¯å®é™…ä¸Šä¸åŒçš„æ•°æ®æµåˆ†æç®—æ³•æœ‰ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œå„è‡ªå¯¹ç²¾åº¦å’ŒSoundnessçš„è¦æ±‚ä¹Ÿä¸ç›¸åŒâ€”â€”å› æ­¤å¦‚ä½•ç†è§£<code>may</code>å’Œ<code>must</code>åˆ†æçš„<strong>åˆå§‹åŒ–æ¡ä»¶</strong>ä»¥åŠ<strong>æœ€å¤§/å°ä¸åŠ¨ç‚¹</strong>ï¼Ÿ æœ¬èŠ‚è§£å†³ â‘ <code>may/must data-flow analysis</code>å¦‚æœç”¨<code>lattice</code>è¡¨è¿°ä¼šæ˜¯ä»€ä¹ˆæ ·å­?â‘¡è¿™äº›åˆ†æå’Œæ±‚è§£<code>lattice</code>ä¸Šçš„ä¸åŠ¨ç‚¹æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿå³<code>may</code>æ±‚è§£æœ€å°ä¸åŠ¨ç‚¹è€Œ<code>must</code>æ±‚è§£æœ€å¤§ä¸åŠ¨ç‚¹ï¼Ÿâ‘¢æ±‚è§£ä¸åŠ¨ç‚¹å’Œåˆ†æçš„<code>Soundness</code>å’Œåˆ†æç²¾åº¦æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿè¿™éƒ¨åˆ†è®²è§£ååˆ†ç²¾å½©ï¼Œå›¾è§è¯¾ä»¶ï¼Œè¿™é‡Œåªæ˜¯è®°å½•æˆ‘è®¤ä¸ºæœ€æ ¸å¿ƒçš„éœ€è¦ç†è§£çš„éƒ¨åˆ†ã€‚</p><h5 id="may-analysis">may analysis</h5><p><code>may</code>åˆ†æä»âŠ¥åˆ°âŠ¤ã€‚</p><p>æ‹¿<code>Reaching Definition</code>åº”ç”¨äº<font color="red">æ£€æµ‹æœªå®šä¹‰å˜é‡</font>ä¸ºä¾‹ï¼š</p><h6 id="bottom">bottom</h6><p>åˆ†æçš„<code>âŠ¥</code>æ˜¯no definitions can reachï¼Œ<strong>âŠ¥å°±æ„å‘³ç€æ‰€æœ‰å˜é‡éƒ½ä¸æ˜¯æœªå®šä¹‰</strong>ï¼Œè¿™ä¸ªåˆ†æç»“æœä¸€å®šæ˜¯<code>unsafe</code>çš„ï¼ˆå› ä¸ºå®é™…ä¸Šå“ªæ€•åªæœ‰ä¸€ä¸ªæœªå®šä¹‰å˜é‡æ²¡æœ‰è¢«æ£€æµ‹å‡ºæ¥ï¼Œ<strong>è¿è¡Œæ—¶ä¹Ÿä¸€å®šä¼šæŠ¥é”™</strong>ï¼‰ã€‚</p><h6 id="top">top</h6><p>åˆ†æçš„<code>âŠ¤</code>æ˜¯all definitions may reachï¼Œå°±æ„å‘³ç€æ‰€æœ‰çš„å˜é‡éƒ½æ˜¯æœªå®šä¹‰ï¼Œæ•…åˆ†æç»“æœä¸€å®šæ˜¯<code>safe</code>çš„ï¼ˆå› ä¸ºå°±ç®—æœ‰ä¸€ä¸ªå®šä¹‰è¿‡çš„å˜é‡è¢«æ£€æµ‹æˆæœªå®šä¹‰ï¼Œ<strong>è¿è¡Œæ—¶ä¹Ÿä¸ä¼šæŠ¥é”™</strong>ï¼‰ã€‚</p><h6 id="safe-precision">safe &amp; precision</h6><p>åˆ†æç®—æ³•ç»§ç»­è¿­ä»£ï¼Œæ²¿ç€æ›´åŠ <code>safe</code>çš„æ–¹å‘èµ°ï¼Œç›´åˆ°åˆ°è¾¾æœ€å°ä¸åŠ¨ç‚¹â€”â€”è¿™éƒ¨åˆ†æ˜¯å·²ç»è¯æ˜è¿‡çš„äº†ï¼Œé—®é¢˜æ˜¯å¦‚ä½•ç†è§£åˆ†æçš„ç²¾åº¦å’Œå®‰å…¨ã€‚</p><p>å›é¡¾<code>may</code>åˆ†æç»“æœ<strong>å¯ä»¥æœ‰è¯¯æŠ¥ä½†ä¸å¯ä»¥æœ‰æ¼æŠ¥</strong>å³<code>false-positive</code>æˆ–è€…<code>sound</code>ã€‚æˆ‘ç†è§£æ˜¯<font color="red">è¿™é‡Œçš„<code>safe</code>å’Œ<code>precision</code>éƒ½æ˜¯é’ˆå¯¹è¿è¡Œæ—¶æ¥è¯´çš„</font>ï¼Œ<strong>âŠ¥ä¸€å®šä¼šåœ¨è¿è¡Œæ—¶æŠ¥é”™ï¼ŒâŠ¤ç¨‹åºä¸ä¼šè¿è¡Œ</strong>ï¼Œè€Œå¦‚ä½•ä¿è¯<code>safe</code>æ˜¯ç”±è®¾è®¡è€…è‡ªå·±è®¾è®¡çš„<code>Transfer Function</code>å†³å®šçš„ã€‚<strong>å¦ä¸€æ–¹é¢ç²¾åº¦é—®é¢˜é’ˆå¯¹åœ¨<code>safe</code>çš„å‰æä¸‹æ˜¯å¦å¯ä»¥å°½é‡å°‘è¯¯æŠ¥</strong>ï¼Œå› ä¸ºä¸åŠ¨ç‚¹æœ‰å¾ˆå¤šè€Œæœ€ç»ˆæˆ‘ä»¬éœ€è¦çš„åªæ˜¯æœ€å°çš„é‚£ä¸ªã€‚</p><h5 id="must-analysis">must analysis</h5><p><code>must</code>åˆ†æä»âŠ¤åˆ°âŠ¥ã€‚</p><p>æ‹¿<code>available expression</code>åº”ç”¨äº<font color="red">ä¼˜åŒ–å…¬å…±å­è¡¨è¾¾å¼åˆ é™¤</font>ä¸ºä¾‹ï¼š</p><h6 id="top-1">top</h6><p>åˆ†æçš„âŠ¤æ˜¯all expressions must be availableï¼Œ<strong>å°±æ„å‘³ç€æ‰€æœ‰çš„è¡¨è¾¾å¼éƒ½æ˜¯å¯ä»¥è¢«ä¼˜åŒ–çš„</strong>ï¼Œè¿™ä¸ªåˆ†æç»“æœä¸€å®šæ˜¯<code>unsafe</code>çš„ï¼ˆå› ä¸ºå“ªæ€•æœ‰ä¸€ä¸ªè¡¨è¾¾å¼ä¸æ˜¯å…¬å…±çš„ï¼Œé‚£ä¼˜åŒ–ç»“æœä¸€å®šæ˜¯é”™çš„ï¼‰ã€‚</p><h6 id="bottom-1">bottom</h6><p>åˆ†æçš„âŠ¥æ˜¯no expressions are availableçš„ï¼Œå°±æ„å‘³ç€æ‰€æœ‰çš„è¡¨è¾¾å¼éƒ½ä¸å¯è¢«ä¼˜åŒ–ï¼Œæ•…åˆ†æç»“æœä¸€å®šæ˜¯<code>safe</code>çš„ï¼ˆå› ä¸ºå“ªæ€•æœ‰ä¸€ä¸ªå…¬å…±è¡¨è¾¾å¼ä¸ºè¢«æ£€æµ‹å‡ºæ¥ï¼Œé‚£ä¹Ÿä»…ä»…åªæ˜¯å°‘å‡ ä¸ªä¼˜åŒ–ï¼‰ã€‚</p><h6 id="safe-precision-1">safe &amp; precision</h6><p>å›é¡¾<code>must</code>åˆ†æç»“æœ<strong>å¯ä»¥æœ‰æ¼æŠ¥ä½†æ˜¯ä¸å¯ä»¥æœ‰è¯¯æŠ¥</strong>å³<code>false-negative</code>æˆ–è€…<code>complete</code>ã€‚æˆ‘ç†è§£æ˜¯<font color="red">è¿™é‡Œçš„<code>safe</code>å’Œ<code>precision</code>ä¹Ÿæ˜¯é’ˆå¯¹ç¨‹åºè¿è¡Œç»“æœè€Œè¨€çš„</font>ï¼Œ<strong>âŠ¥å°‘å‡ ä¸ªä¼˜åŒ–ï¼ŒâŠ¤çš„ç¨‹åºä¸€å®šå‡ºç°é—®é¢˜ã€‚</strong>å¦‚ä½•ä¿è¯<code>safe</code>æ˜¯ç”±è®¾è®¡è€…è‡ªå·±è®¾è®¡çš„<code>Transfer Function</code>å†³å®šçš„ã€‚<strong>å¦ä¸€æ–¹é¢ç²¾åº¦é—®é¢˜é’ˆå¯¹åœ¨<code>safe</code>çš„å‰æä¸‹æ˜¯å¦å¯ä»¥å°½é‡å°‘æ¼æŠ¥ï¼Œ</strong>å› ä¸ºä¸åŠ¨ç‚¹æœ‰å¾ˆå¤šè€Œæœ€ç»ˆæˆ‘ä»¬éœ€è¦çš„åªæ˜¯æœ€å¤§çš„é‚£ä¸ªã€‚</p><p><font color="red">ç”±æ­¤å¯ä»¥çœ‹å‡º<code>may/must</code>åˆ†æå®Œå…¨é’ˆå¯¹çš„æ˜¯ä¸åŒçš„åœºæ™¯ï¼Œä½†æ˜¯å…¶åˆ†æç»“æœçš„<code>safe</code>å’Œ<code>precision</code>å´éƒ½æ˜¯é’ˆå¯¹ç¨‹åºè¿è¡Œæ—¶å’Œæœ€ç»ˆçš„ç»“æœã€‚</font></p><h5 id="another-view">another view</h5><p>è€å¸ˆåœ¨è¿™é‡Œæä¾›äº†å¦ä¸€ä¸ªè§’åº¦ï¼Œå°±æ˜¯åœ¨<code>lattice</code>ä¸Šè¿­ä»£å‡½æ•°ï¼Œå…¶ä¸­<code>Transfer Function</code>æœ¬èº«æ˜¯å›ºå®šçš„ï¼Œ<strong>è€Œä¸¤ç§åˆ†æçš„<code>join/meet Function</code>æ ¹æ®<code>lattice</code>çš„æ€§è´¨å…¶å°±æ˜¯ä¸¤ä¸ªå…ƒç´ çš„<code>least/greatest upper/lower bound</code>ï¼ŒåŠ ä¸Šåˆ†åˆ«ä»<code>âŠ¥</code>å’Œ<code>âŠ¤</code>å¼€å§‹ï¼Œ</strong>æ•…æ¯æ¬¡è¿­ä»£å‡½æ•°èµ°çš„éƒ½æ˜¯æœ€å°/å¤§çš„è·¯å¾„ï¼Œæ•…åˆ°è¾¾çš„ä¹Ÿæ˜¯æœ€å°/æœ€å¤§ä¸åŠ¨ç‚¹ã€‚</p><h4 id="mop-and-distributivity">MOP and Distributivity</h4><p>å‰é¢è®¨è®ºäº†æ•°æ®æµåˆ†æ<code>Iterative Algorithm</code>æœ€ååˆ°è¾¾çš„ä¸åŠ¨ç‚¹æ˜¯æœ€ç²¾ç¡®çš„ã€‚ä½†æ˜¯å¦‚ä½•è¡¡é‡è¿™ä¸ªç²¾åº¦ï¼Ÿè¿™ä¸€å°èŠ‚å¼•å…¥ä¸€ä¸ªå¾ˆç»å…¸çš„<strong>æ¦‚å¿µ</strong><code>Meet-Over-All-Paths Solution</code>å³<code>MOP</code>ã€‚</p><p><code>MOP</code>æ¦‚å¿µå¼•å…¥<code>CFG</code>çš„æ¯ä¸€æ¡è·¯å¾„éƒ½æ˜¯ä»<code>entry</code>ä¸€ç›´åˆ°å…¶æ‰§è¡Œç»“æŸã€‚</p><ul><li>P = Entry âŸ¶ S<sub>1</sub> âŸ¶ S<sub>2</sub> âŸ¶... âŸ¶ S<sub>i</sub></li></ul><p><code>MOP</code>æ¯ä¸€æ¡<code>path</code>çš„<code>Transfer Function</code>æ˜¯è¯¥æ¡è·¯å¾„ä¸Šæ‰€æœ‰<code>statements</code>çš„<code>Transfer Function</code>çš„åˆåŠ›ï¼Œæœ€ååº”ç”¨<code>meet operator</code>æ¥è®¡ç®—æ•°æ®æµå€¼: MOP[S<sub>i</sub>] = âŠ”/âŠ“ F<sub>P</sub>(OUT[Entry])ã€‚<code>MOP</code>ä»…ä»…ä½œä¸ºä¸€ä¸ªç†è®ºä¸Šçš„æ¦‚å¿µå­˜åœ¨æ˜¯å› ä¸ºåº”ç”¨ä¸­å¾ˆå¤šè·¯å¾„æ˜¯<code>not executable</code>çš„ï¼Œ<code>Unbounded</code>çš„ä»¥åŠ<code>not enumerable</code>çš„ï¼Œæ•…å¯¹äºé‚£ç§æŒ‡æ•°çˆ†ç‚¸çš„ç¨‹åº<code>MOP</code>æ˜¯<code>impractical</code>çš„ã€‚<strong>è¿™é‡Œä¸»è¦é€šè¿‡<code>MOP</code>æ¦‚å¿µå¯¹æ¯”<code>Iterative Algorithm</code>ã€‚</strong>å¯¹äºåŒä¸€ä¸ª<code>CFG</code>:</p><p><img src="17.png" width="50%" height="50%" alt=""></p><p>è¿­ä»£ç®—æ³•æ˜¯åœ¨æ¯ä¸€ä¸ª<code>control flow</code>åº”ç”¨å‡½æ•°:<em>IN[S<sub>4</sub>] = f<sub>S<sub>3</sub></sub>(f<sub>S<sub>1</sub></sub>(OUT[Entry]) âŠ” f<sub>S<sub>2</sub></sub>(OUT[Entry]))</em></p><p>è€Œ<code>MOP</code>åªä¼šåœ¨è·¯å¾„ç»“æŸä¹‹ååº”ç”¨å‡½æ•°:<em>MOP[S<sub>4</sub>] = f<sub>S<sub>3</sub></sub>(f<sub>S<sub>1</sub></sub>(OUT[Entry])) âŠ” f<sub>S<sub>3</sub></sub>(f<sub>S<sub>2</sub></sub>(OUT[Entry]))</em></p><p>ç®€åŒ–ä¸€ä¸‹å°±æ˜¯:</p><ul><li>Ours = F(x âŠ” y)</li><li>MOP = F(x) âŠ” F(y)</li></ul><p>å¯ä»¥è¯æ˜<strong>è¿­ä»£ç®—æ³•çš„ç²¾åº¦è¦æ¯”<code>MOP</code>æ›´ä¸å‡†ã€‚</strong>åªæœ‰å½“Få‡½æ•°æ˜¯<code>distributive</code>çš„æ—¶å€™æ‰èƒ½ä¿è¯<code>F(xâŠ”y) = F(x) âŠ” F(y)</code>å³ä¸¤ç§ç®—æ³•çš„ç²¾ç¡®åº¦æ˜¯ä¸€æ ·çš„ã€‚å‰é¢çš„æ‰€æœ‰<code>Bit-vector/Gen/Kill</code>é—®é¢˜çš„æ•°æ®æµåˆ†æç®—æ³•å®ƒä»¬çš„<code>meet/join</code>å‡½æ•°éƒ½æ˜¯<code>distributive</code>çš„ã€‚</p><h4 id="constant-propagation">Constant Propagation</h4><p>å¸¸é‡ä¼ æ’­æ˜¯ä¸€ä¸ª<code>non-distributive</code>çš„æ•°æ®æµåˆ†æç®—æ³•ã€‚</p><p>Given a variable x at program point p, determine whether x is guaranteed to hold a constant value at p.</p><p>æŒ‰ç…§æ•°æ®æµåˆ†ææ¡†æ¶(<font color="red">D</font>, <font color="green">L</font>, <font color="blue">F</font>)æ¥è§£é‡Šçš„è¯ï¼Œè¯¥åˆ†æä¸€å®šæ˜¯å‰å‘åˆ†æ<code>forward-analysis</code>ï¼Œç”±äºä½œä¸ºä¼˜åŒ–ç®—æ³•å…¶å¿…é¡»ä¿è¯è¿è¡Œæ—¶ä¸å¯ä»¥å‡ºé”™æ•…æ˜¯<code>must</code>åˆ†æã€‚å…¶<code>lattice</code>çš„domainæ˜¯ä¸€ä¸ªpair<code>(x, v)</code>å…¶ä¸­<code>x</code>æ˜¯å˜é‡è€Œ<code>v</code>è¡¨ç¤ºå˜é‡çš„å€¼ï¼ˆæœ‰<code>constant</code>, <code>undefined</code>ï¼Œ<code>notAconstant</code>ä¸‰ç§é€‰é¡¹ï¼‰ï¼Œåˆ†æçš„<code>meet operator</code>å’Œä¹‹å‰çš„ç®—æ³•ä¸åŒâ€”â€”ä¸æ˜¯å•ä¸€çš„âŠ”/âŠ“ï¼š</p><ul><li>NAC âŠ“ v = NAC</li><li>UNDEF âŠ“ v = v</li><li>c âŠ“ v = ?<ul><li>c âŠ“ c = c</li><li>c<sub>1</sub> âŠ“ c<sub>2</sub> = NAC</li></ul></li></ul><p>ç»™å®š<code>s: x = ...</code>æ˜¯ä¸€ä¸ªèµ‹å€¼è¯­å¥ï¼Œå› æ­¤è¯¥è¯­å¥OUTåˆ™æ˜¯INçš„æ‰€æœ‰å˜é‡å‡æ‰<code>x</code>(å› ä¸ºxè¢«é‡æ–°èµ‹å€¼äº†)å†åŠ ä¸Šè¯¥è¯­å¥ä¸­æ–°genå‡ºæ¥çš„å˜é‡ã€‚æ•…å®šä¹‰å¸¸é‡ä¼ æ’­çš„<code>Transfer Function</code>F: OUT[s] = gen â‹ƒ (IN[s] - {(x, _)})ã€‚å…¶ä¸­genå‡½æ•°:</p><ul><li>s: x = c; //c is a constant âŸ¹ gen = {(x, c)}</li><li>s: x = y; âŸ¹ gen = {(x, val(y))}</li><li>x: x = y op z; âŸ¹ gen = {(x, f(y, z))}<ul><li>val(y) op val(z) // if val(y) and val(z) are constants</li><li>NAC // if val(y) or val(z) is NAC</li><li>UNDEF //UNDEF op UNDEF or UNDEF op NAC</li></ul></li></ul><p>ä¸‹é¢çš„è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><p><img src="18.png" width="50%" height="50%" alt=""></p><p>ç”¨æ•°æ®æµåˆ†æè¿­ä»£ç®—æ³•ä»¥åŠ<code>MOP</code>ç®—æ³•æ¥å®Œæˆå¸¸é‡ä¼ æ’­æ±‚å€¼ä¹‹åè¿›è¡Œä¸€æ¬¡å¯¹æ¯”:</p><ul><li>Ours: F(X âŠ“ Y) = {(a, NAC), (c, NAC), <font color="green">(c, NAC)</font>}</li><li>MOP: F(X) âŠ“ F(Y) = {(a, NAC), (b, NAC), <font color="green">(c, 10)</font>}</li></ul><p>æŒ‰ç…§<code>must</code>åˆ†æçš„ä¸åŠ¨ç‚¹ç†è®ºï¼Œåˆ†ææ˜¯ä»âŠ¤åˆ°âŠ¥ï¼ˆâŠ¤å°±æ˜¯UNDEFï¼ŒâŠ¥æ˜¯NACï¼‰è¿›è¡Œçš„ã€‚è€Œ<code>Ours</code>çš„å€¼è¦æ¯”<code>MOP</code>çš„å€¼æ›´é è¿‘âŠ¥æ•…å…¶åˆ†æåˆ™<code>less precise</code>ã€‚å› æ­¤<code>F(XâŠ“Y)â‰  F(X)âŠ“ F(Y)</code>è¿›è€Œ<code>F(XâŠ“Y) â‹ F(X)âŠ“ F(Y)</code>ã€‚æ‰€ä»¥è¯¥åˆ†ææ˜¯<code>Nondistributive</code>çš„ã€‚</p><h4 id="worklist-algorithm">Worklist Algorithm</h4><p>åœ¨å®é™…çš„æ•°æ®æµåˆ†æä¸­ä¼šä½¿ç”¨è¿­ä»£ç®—æ³•çš„ä¼˜åŒ–ç‰ˆæœ¬å³<code>Worklist Algorithm</code>ã€‚</p><p>è¿­ä»£ç®—æ³•çš„ä¸»è¦å¤æ‚åº¦åœ¨<code>CFG</code>ä¸­ä¸€ä¸ªèŠ‚ç‚¹è¾“å‡ºæœ‰å˜åŒ–éƒ½éœ€è¦ä½¿å¾—æ•´ä¸ª<code>CFG</code>è¿­ä»£ï¼Œè€Œ<code>Worklist Algorithm</code>åˆ™æ˜¯è¿­ä»£ç®—æ³•çš„ä¸€ç§å‰ªæä¼˜åŒ–ã€‚</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">OUT</span>[entry] = nullptr;</span><br><span class="line"><span class="title">for</span>(each basic block\entry)</span><br><span class="line"><span class="type">OUT</span>[<span class="type">B</span>] = nullptr;</span><br><span class="line"><span class="type">Worklist</span> âŸµ all basic blocks</span><br><span class="line"><span class="title">while</span>(<span class="type">Worklist</span> is not empty) </span><br><span class="line"><span class="type">Pick</span> a basic block <span class="type">B</span> from <span class="type">Worklist</span></span><br><span class="line">old_OUT = <span class="type">OUT</span>[<span class="type">B</span>]</span><br><span class="line"><span class="type">IN</span>[<span class="type">B</span>] = âŠ”<span class="type">OUT</span>[<span class="type">P</span>]</span><br><span class="line"><span class="type">OUT</span>[<span class="type">B</span>] = gen_B â‹ƒ (<span class="type">IN</span>[<span class="type">B</span>] - kill_B)</span><br><span class="line"><span class="keyword">if</span>(old_OUT â‰  <span class="type">OUT</span>[<span class="type">B</span>]) </span><br><span class="line">add all successors <span class="keyword">of</span> <span class="type">B</span> to <span class="type">Worklist</span></span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæ•°æ®æµåˆ†æçš„å­¦ä¹ å‘Šä¸€æ®µè½ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;abstract&quot;&gt;Abstract&lt;/h3&gt;
&lt;p&gt;ç¼–è¯‘å™¨ä¸­å¤§éƒ¨åˆ†æœºå™¨æ— å…³çš„å…¨å±€ä¼˜åŒ–æ˜¯åŸºäº&lt;code&gt;Data-flow Analysis&lt;/code&gt;å®ç°çš„ã€‚æ•°æ®æµåˆ†ææŠ€æœ¯ä»ä»£ç ä¸­æ”¶é›†ç¨‹åºè¯­ä¹‰ç›¸å…³çš„ä¿¡æ¯ï¼Œæ˜¯ç¨‹åºåˆ†æçš„åŸºç¡€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;In each data-flow analysis application, we associate with every program point a data-flow value that represents an abstraction of the set of all possible program states that can be observed for that point.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨å·¥ä¸šç•Œçš„&lt;a href=&quot;https://www.zhihu.com/question/41959902&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ä¸»æµç¼–è¯‘å™¨&lt;/a&gt;ä¸­ï¼Œ&lt;code&gt;C&lt;/code&gt;ç³»çš„&lt;code&gt;LLVM&lt;/code&gt;ï¼Œ&lt;code&gt;Java&lt;/code&gt;ç³»çš„&lt;code&gt;HotSpot&lt;/code&gt;éƒ½æ˜¯åŸºäº&lt;code&gt;SSA&lt;/code&gt;åšæ•°æ®æµåˆ†æè€Œä¸æ˜¯ä¼ ç»Ÿçš„&lt;code&gt;lattice&lt;/code&gt;ã€‚å—å¤§è¿™èŠ‚è¯¾ä¸­æ˜¯åŸºäº&lt;code&gt;Lattice&lt;/code&gt;æ¥è®²è§£è¿‡ç¨‹å†…&lt;code&gt;Intra-procedural&lt;/code&gt;ï¼Œæ— åˆ«å&lt;code&gt;no aliases&lt;/code&gt;çš„ç»å…¸æ•°æ®æµåˆ†ææ¡†æ¶ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://haotianmcihael.github.io/categories/Java/"/>
    
    
      <category term="PL" scheme="http://haotianmcihael.github.io/tags/PL/"/>
    
      <category term="Software-Analysis" scheme="http://haotianmcihael.github.io/tags/Software-Analysis/"/>
    
  </entry>
  
  <entry>
    <title>NJUé™æ€ç¨‹åºåˆ†æ(0-Introduction)</title>
    <link href="http://haotianmcihael.github.io/2021/05/02/NJU%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90-0-Introduction/"/>
    <id>http://haotianmcihael.github.io/2021/05/02/NJUé™æ€ç¨‹åºåˆ†æ-0-Introduction/</id>
    <published>2021-05-01T19:00:36.000Z</published>
    <updated>2022-03-16T10:22:34.756Z</updated>
    
    <content type="html"><![CDATA[<h3 id="abstract">Abstract</h3><p>ç¼–è¯‘å™¨ä½œä¸ºå·¥ä¸šç•Œå¯¹PLç†è®ºçš„éƒ¨åˆ†å®ç°â€”â€”å’Œç¼–ç¨‹è¯­è¨€ï¼Œè¿è¡Œæ—¶ç¯å¢ƒä¸€æ ·åªæ˜¯æœºå™¨è§£é‡Šä¸–ç•Œçš„ä¸€ä¸ªè§’åº¦ã€‚è€Œå½“æˆ‘è§£é”äº†ä»æ›´åŠ PLçš„æ–¹å¼çœ‹å¾…<code>è®¡ç®—</code>è¿™ä»¶äº‹æƒ…ä¹‹åï¼Œåˆæ‰“å¼€äº†ä¸€æ‰‡é€šå¾€æ–°ä¸–ç•Œçš„å¤§é—¨ã€‚è¿‡å»çš„å‡ åå¹´é‡Œ<code>Programming Language</code>çš„å†…æ ¸å¹¶æ²¡æœ‰å˜åŒ–å¤šå°‘â€”â€”ä½†æ˜¯ç¨‹åºæœ¬èº«å´éšç€åº”ç”¨éœ€æ±‚å˜çš„æ›´åŠ åºå¤§å’Œå¤æ‚ã€‚è€Œé™æ€ç¨‹åºåˆ†æä½œä¸ºPLçš„é‡è¦åº”ç”¨ï¼Œå…¶ç›®çš„å°±åœ¨äºåœ¨ç¼–è¯‘æœŸç¡®ä¿ç¨‹åºçš„å¯é æ€§ï¼Œå®‰å…¨æ€§ç­‰å„ç§æ€§è´¨ã€‚</p><p>â€‹ <strong>Static Analysis analyzes a program P to reasono about its behaviors and determines whether it satisfies some properties before running P.</strong></p><p>â€‹ ä¸»è¦çš„å­¦ä¹ èµ„æºæ˜¯<a href="https://pascal-group.bitbucket.io/teaching.html" target="_blank" rel="noopener">NJU-PASCALå›¢é˜Ÿçš„é™æ€åˆ†æè¯¾ç¨‹</a>ä»¥åŠ<a href="https://book.douban.com/subject/3774682/" target="_blank" rel="noopener">é¾™ä¹¦</a>å’Œ<a href="https://book.douban.com/subject/1400374/" target="_blank" rel="noopener">é²¸ä¹¦</a>ä¸­çš„éƒ¨åˆ†ç« èŠ‚ã€‚</p><a id="more"></a><h3 id="static-analysis">Static-Analysis</h3><p>â€‹ PLçš„å¤§æ¡†æ¶å¤§ä½“ä¸Šå¯ä»¥åˆ†æˆä¸‰ä¸ªéƒ¨åˆ†:</p><ul><li>Theory</li></ul><p>åŒ…æ‹¬å¦‚ä½•è®¾è®¡ä¸€ä¸ªè¯­è¨€å†…æ ¸ï¼Œä¸€ä¸ªç±»å‹ç³»ç»Ÿï¼Œå¦‚ä½•å®Œæˆè¯­ä¹‰åˆ†æï¼Œå¦‚ä½•å½¢å¼åŒ–ç­‰ç­‰ä¸åŒçš„ç†è®ºï¼Œæ›´å¤šæ˜¯ä½œä¸ºå­¦æœ¯ç ”ç©¶çš„è¯¾é¢˜</p><ul><li>Environment</li></ul><p>é’ˆå¯¹ç‰¹å®šåœºæ™¯è®¾è®¡çš„ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶ç¯å¢ƒç­‰</p><ul><li>Application</li></ul><p>ç¨‹åºåˆ†æï¼Œç¨‹åºåˆæˆï¼Œç¨‹åºéªŒè¯</p><p>è€Œé™æ€ç¨‹åºåˆ†æä¸»è¦å…³æ³¨åœ¨ç¨‹åºçš„<strong>Reliability</strong>æ¯”å¦‚åœ¨ç¨‹åºè¿è¡Œå‰æ£€æµ‹åˆ°ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå†…å­˜æ³„æ¼ç­‰é—®é¢˜é˜²æ­¢ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­æŠ¥è¿è¡Œæ—¶é”™è¯¯ï¼›<strong>Security</strong>æ¯”å¦‚éšç§æ•°æ®æ³„éœ²ï¼Œæ³¨å…¥æ”»å‡»<code>injection attack</code>ç­‰ï¼›<strong>Optimization</strong>ç¼–è¯‘ä¼˜åŒ–ç­‰æ–¹é¢ã€‚</p><h3 id="rices-theorem">Riceâ€˜s Theorem</h3><p>Any non-trivial property of the behavior of programs in a <strong>recursively enumerable</strong> language is undecidable.</p><p>è¿™ä¸ªå®šç†æœ‰ç‚¹å“¥å¾·å°”ä¸å®Œå¤‡å®šç†çš„æ„Ÿè§‰â€”â€”ä¸å­˜åœ¨ä¸€ä¸ªå®Œç¾çš„åˆ†æç®—èƒ½å‡†ç¡®é¢„æµ‹å‡ºç¨‹åºçš„å„ç§å…³é”®è¡Œä¸ºï¼Œå³No Silver Bulletã€‚è¿™ä¹Ÿå¼•å‡ºäº†åœ¨å®è·µä¸­æœ€é‡è¦çš„ä¸€ä¸ªè¯„åˆ¤æ ‡å‡†Soundå’ŒCompleteã€‚</p><p>è¿™é‡Œçš„<code>recursively enumerable</code>é€’å½’å¯æšä¸¾æ˜¯<strong>å›¾çµå®Œå¤‡</strong>çš„å¦ä¸€ç§è¯´æ³•ï¼Œç®€å†™ä¸º<code>r.e.</code>ã€‚</p><h3 id="sound-and-complete">Sound and Complete</h3><p>å‡è®¾ä¸€ä¸ªç¨‹åºä¸­å­˜åœ¨10ä¸ª<code>unknown error</code>ï¼Œä¸€å¥—åˆ†ææ¡†æ¶ä¸å¯èƒ½ç²¾ç¡®å®šä½åˆ°è¿™åä¸ªã€‚è€Œæ˜¯åœ¨å…¶å€¼åŸŸèŒƒå›´å†…æ³¢åŠ¨â€”â€”ä¸ä»…ä»…åŒ…å«è¿™10çš„é›†åˆå°±æ˜¯<code>Sound</code>ï¼ŒåªåŒ…å«è¿™10ä¸ªçš„å­é›†å°±æ˜¯<code>Complete</code>ã€‚</p><p><img src="1.png" width="50%" height="50%" alt=""></p><p>ä¼´éšç€è¿™ä¸€å¯¹æ¦‚å¿µè¿˜æœ‰ä¸€å¯¹â€”â€”<code>false negatives</code>å’Œ<code>false positives</code>ã€‚</p><ul><li>False negatives</li></ul><p>å°±æ˜¯<code>Compromise soundness</code>ä¹Ÿå°±æ˜¯ç¼©å°åŸæ¥åˆ†æçš„é‡ï¼Œè¿™æ ·ä¼šæ›´åŠ çš„<code>complete</code>â€”â€”ä¾¿ä¼šäº§ç”Ÿ<strong>æ¼æŠ¥</strong></p><ul><li>False positives</li></ul><p>å°±æ˜¯<code>Compromise completeness</code>ä¹Ÿå°±æ˜¯å¢å¤§åŸæ¥åˆ†æçš„é‡ï¼Œè¿™æ ·ä¼šæ›´åŠ çš„<code>sound</code>â€”â€”ä¾¿ä¼šäº§ç”Ÿ<strong>è¯¯æŠ¥</strong></p><p>å…¶å®è¿™é‡Œä¸ºä»€ä¹ˆè¦å¼•å…¥è¿™ä¸€å¯¹æ¦‚å¿µæˆ‘æ²¡æœ‰å¤ªç†è§£â€¦â€¦æœ‰ç‚¹å¾€å›ç»•çš„æ„æ€ã€‚ è¿™ä¸ªå›¾å¾—å¥½å¥½ç†è§£ä¸€ä¸‹ã€‚</p><p><img src="2.png" width="50%" height="50%" alt=""></p><p>åœ¨å®è·µä¸­ï¼Œç”¨çš„æ›´å¤šçš„æ ‡å‡†æ˜¯<code>compromising completeness</code>ä¹Ÿå°±æ˜¯è¦è®©ç»“æœæ›´åŠ çš„<code>sound</code>ä½†æ˜¯æŸå¤±äº†ç²¾ç¡®åº¦ã€‚<strong>æ¢å¥è¯è®²ï¼Œåˆ†æçš„ç»“æœä¸€å®šè¦å…¨é¢ï¼Œä½†ä¸ä¸€å®šç²¾ç¡®ã€‚ä¹Ÿå°±æ˜¯è¯´å®å¯è¯¯æŠ¥ä¸€äº›åˆ†æè¡Œä¸ºï¼Œä¹Ÿä¸å…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶æŠ¥å¼‚å¸¸â€”â€”è¿™æ ·æ•´ä¸ªç³»ç»Ÿä»˜å‡ºä»£ä»·ä¼šæ›´é«˜ã€‚</strong></p><h4 id="ä¾‹å­">ä¾‹å­</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class A&#123;&#125;;</span><br><span class="line">class Base&#123;</span><br><span class="line">  A fld;</span><br><span class="line">&#125;;</span><br><span class="line">class B : A&#123;&#125;;</span><br><span class="line">class C : A&#123;&#125;;</span><br><span class="line"></span><br><span class="line">Base a = new Base();</span><br><span class="line">if(condition) &#123;</span><br><span class="line">  B b = new B();</span><br><span class="line">a.fld = b;</span><br><span class="line">&#125;else &#123;</span><br><span class="line">  C c = new D();</span><br><span class="line">a.fld = c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// case</span><br><span class="line">B bTmp = (B)a.fld;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä¸Šä¾‹ä¸­çš„caseä¸­è¿›è¡Œäº†ä¸€æ¬¡å¼ºåˆ¶è½¬æ¢ï¼Œå¦‚æœæ§åˆ¶æµèµ°çš„æ˜¯<code>!condition</code>é‚£ä¹ˆå°±ä¼šæŠ¥é”™ã€‚å¦‚æœåˆ†æå™¨æ˜¯<code>sound</code>çš„è¿™é‡Œå°±åº”è¯¥æ£€æµ‹å‡ºè¯¥ç¨‹åºçš„æ§åˆ¶æµé”™è¯¯â€”â€”ä»è€Œå‡å°‘äº†BUGã€‚</p><h4 id="tradeoff">tradeoff</h4><p>å› ä¸º<code>sound</code>ä¼šåˆ†æå‡ºæ¯”ç†è®ºæ›´å¤šçš„ç»“æœï¼Œæ‰€ä»¥å¯¼è‡´åˆ†æçš„é€Ÿåº¦ä¼šå˜æ…¢ã€‚</p><p>Static Analysis ensure soundness, while making good trade-offs between analysis precision and analysis speedâ€”â€”åˆ†æè¿‡ç¨‹çš„æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§é€Ÿåº¦å’Œç²¾åº¦ä¹‹é—´çš„æƒè¡¡ã€‚</p><h3 id="to-conclude">To Conclude</h3><p>â€‹ å¤§éƒ¨åˆ†åˆ†ææ–¹å¼å¯ä»¥æ€»ç»“ä¸ºä¸‹é¢çš„ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>Abstraction</li></ul><p>å°±æ˜¯å°†å…·ä½“çš„ç¨‹åºç‰¹å¾å’Œè¡Œä¸ºè¿›ä¸€æ­¥æŠ½è±¡æˆåˆ†æå™¨çš„å…ƒç¬¦å·ï¼Œå®Œæˆä¸€å®šæ„ä¹‰çš„æ‰€è°“<strong>å½¢å¼åŒ–</strong></p><ul><li><p>Over-approximation</p></li><li><p>transfer functions</p></li></ul><p>In static analysis, transfer functions define how to evaluate different program statements on abstract values. Its defined according to &quot;analysis problem&quot; and the &quot;semantics&quot; of different program statements.</p><ul><li>control flows</li></ul><p>ç¨‹åºçš„æœ¬è´¨å…¶å®å°±æ˜¯è¯­å¥åŠè¯­å¥ä¹‹é—´çš„å…³è”ï¼Œæ˜ å°„åˆ°static analysisä¸­å°±æ˜¯ï¼ˆè¯­å¥ï¼‰<code>transfer functions</code>å’Œï¼ˆå…³è”ï¼‰<code>control flows</code>ã€‚åœ¨æŠ½è±¡çš„åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥é¢—ç²’åŒ–ç¨‹åºè¿è¡Œè¡Œä¸ºã€‚æ¯”å¦‚<code>transfer functions</code>å®šä¹‰ä¸ºç¨‹åºä¸­<code>statements</code>å’Œç¨‹åºå¼‚å¸¸è¡Œä¸ºçš„è¯­ä¹‰æ¯”å¦‚å£°æ˜è¯­å¥ï¼Œé™¤é›¶å¼‚å¸¸ç­‰ã€‚è€Œ<code>control flows</code>å®šä¹‰äº†ç¨‹åºçš„æ§åˆ¶æµæ¯”å¦‚ä¸€äº›if-elseåˆ†æ”¯ã€‚<strong>è¿™æ ·å°±èƒ½æ›´åŠ ç»†ç²’åº¦çš„å®Œæˆç¨‹åºè¡Œä¸ºçš„å»ºæ¨¡ï¼Œç„¶ååœ¨æ¨¡å‹åŸºç¡€ä¸Šå®Œæˆåˆ†æå™¨é¢„å®šçš„soundçš„åˆ†æç»“æœã€‚</strong></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;abstract&quot;&gt;Abstract&lt;/h3&gt;
&lt;p&gt;ç¼–è¯‘å™¨ä½œä¸ºå·¥ä¸šç•Œå¯¹PLç†è®ºçš„éƒ¨åˆ†å®ç°â€”â€”å’Œç¼–ç¨‹è¯­è¨€ï¼Œè¿è¡Œæ—¶ç¯å¢ƒä¸€æ ·åªæ˜¯æœºå™¨è§£é‡Šä¸–ç•Œçš„ä¸€ä¸ªè§’åº¦ã€‚è€Œå½“æˆ‘è§£é”äº†ä»æ›´åŠ PLçš„æ–¹å¼çœ‹å¾…&lt;code&gt;è®¡ç®—&lt;/code&gt;è¿™ä»¶äº‹æƒ…ä¹‹åï¼Œåˆæ‰“å¼€äº†ä¸€æ‰‡é€šå¾€æ–°ä¸–ç•Œçš„å¤§é—¨ã€‚è¿‡å»çš„å‡ åå¹´é‡Œ&lt;code&gt;Programming Language&lt;/code&gt;çš„å†…æ ¸å¹¶æ²¡æœ‰å˜åŒ–å¤šå°‘â€”â€”ä½†æ˜¯ç¨‹åºæœ¬èº«å´éšç€åº”ç”¨éœ€æ±‚å˜çš„æ›´åŠ åºå¤§å’Œå¤æ‚ã€‚è€Œé™æ€ç¨‹åºåˆ†æä½œä¸ºPLçš„é‡è¦åº”ç”¨ï¼Œå…¶ç›®çš„å°±åœ¨äºåœ¨ç¼–è¯‘æœŸç¡®ä¿ç¨‹åºçš„å¯é æ€§ï¼Œå®‰å…¨æ€§ç­‰å„ç§æ€§è´¨ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ &lt;strong&gt;Static Analysis analyzes a program P to reasono about its behaviors and determines whether it satisfies some properties before running P.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;â€‹ ä¸»è¦çš„å­¦ä¹ èµ„æºæ˜¯&lt;a href=&quot;https://pascal-group.bitbucket.io/teaching.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;NJU-PASCALå›¢é˜Ÿçš„é™æ€åˆ†æè¯¾ç¨‹&lt;/a&gt;ä»¥åŠ&lt;a href=&quot;https://book.douban.com/subject/3774682/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é¾™ä¹¦&lt;/a&gt;å’Œ&lt;a href=&quot;https://book.douban.com/subject/1400374/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é²¸ä¹¦&lt;/a&gt;ä¸­çš„éƒ¨åˆ†ç« èŠ‚ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://haotianmcihael.github.io/categories/Java/"/>
    
    
      <category term="PL" scheme="http://haotianmcihael.github.io/tags/PL/"/>
    
      <category term="Software-Analysis" scheme="http://haotianmcihael.github.io/tags/Software-Analysis/"/>
    
  </entry>
  
  <entry>
    <title>å‡½æ•°å¼ç¼–ç¨‹ï¼ˆOcamlï¼‰</title>
    <link href="http://haotianmcihael.github.io/2021/04/18/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%EF%BC%88Ocaml%EF%BC%89/"/>
    <id>http://haotianmcihael.github.io/2021/04/18/å‡½æ•°å¼ç¼–ç¨‹ï¼ˆOcamlï¼‰/</id>
    <published>2021-04-18T09:48:24.000Z</published>
    <updated>2022-03-16T09:52:27.160Z</updated>
    
    <content type="html"><![CDATA[<h3 id="abstract">Abstract</h3><p>æœ€è¿‘åœ¨å®éªŒå®¤å®ä¹ çš„è¿‡ç¨‹ä¸­å­¦åˆ°äº†å¾ˆå¤šæœ‰æ„æ€çš„ä¸œè¥¿ï¼Œå¯¹<code>Programming Languages</code>ä¹Ÿæœ‰äº†æ›´æ·±çš„äº†è§£ï¼Œ<code>Ocaml</code>æ˜¯ä¸€é—¨æ”¯æŒå¤šèŒƒå¼çš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ã€‚<strong>ç¨‹åºæè¿°è®¡ç®—ï¼Œä½†æ˜¯åˆä¸ä»…ä»…æ˜¯è®¡ç®—</strong>ã€‚<code>Ocaml</code>çš„å­¦ä¹ å¸¦ç»™æˆ‘çš„ä¸ä»…ä»…æ˜¯è¯­è¨€æœ¬èº«ï¼Œè¿™ä¸ªç³»åˆ—è®°å½•äº†å…¶ä¸­çš„éƒ¨åˆ†å¿ƒå¾—:</p><ul><li>å…³äº<code>scripting/imperative/object-oriented/functional PL</code>çš„åŸºæœ¬æ¦‚å¿µ<ul><li><code>Higher-order Functions</code></li><li><code>State-Full vs State-Free Computation</code></li><li><code>Modelling Objects and Closures</code></li><li><code>Exceptions/Continuations to Defer Control</code></li><li><code>Polymorphism</code></li><li><code>Partial Evaluation/Lazy Programming/Modules</code></li></ul></li><li>å…³äº<code>reason about programs</code>çš„æ–¹æ³•<ul><li><code>Type Checking</code></li><li><code>Induction</code></li><li><code>Operational Semantics</code></li><li><code>QuickCheck</code></li></ul></li><li>å…³äºè®¾è®¡ä¸€é—¨è¯­è¨€çš„åŸºæœ¬è§„åˆ™</li></ul><a id="more"></a><h3 id="fps-basic-concepts">FP's Basic Concepts</h3><p><code>Ocaml is a statically typed functional programminng language</code>ã€‚å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œ<code>function</code>æ°¸è¿œæ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œç¨‹åºä¸­åªæœ‰<code>expression</code>çš„æ¦‚å¿µï¼Œé€šè¿‡<code>functions</code>é€’å½’å¤„ç†<code>values</code>æ¥å®Œæˆ<code>computations</code>ã€‚<code>Ocaml</code>é€šè¿‡<code>pattern matching</code>æ¨¡å¼åŒ¹é…çš„æ–¹å¼æ¥å®šä¹‰é€’å½’æ•°æ®ç»“æ„å’Œå‡½æ•°ï¼Œè¿›è€Œå†™å‡ºæ›´ç®€æ´çš„ç¨‹åºã€‚</p><p>åœ¨å‡½æ•°å¼ä¸­è¿˜æœ‰ä¸€ä¸ªå’Œ<code>imperative PL.</code>ä¸­ä¸åŒçš„æ¦‚å¿µç§°ä¸º<code>effect-free programming</code>ã€‚åœ¨å‘½ä»¤å¼è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç»™<code>variables/fields</code>èµ‹å€¼æ¥ä¿®æ”¹ç¨‹åºçŠ¶æ€å¹¶å°†èµ‹å€¼è¡Œä¸ºçš„ç»“æœçœ‹æˆæ˜¯<code>effects</code>ã€‚ä½†æ˜¯æ¯”å¦‚å‡½æ•°å¼å°±ä¸ä¼š<code>explicitly</code>çš„åˆ†é…å†…å­˜ï¼Œç”šè‡³æ²¡æœ‰<code>exception handling</code>æ¥æ”¹å˜æ§åˆ¶æµçŠ¶æ€â€”â€”<strong>ä¸æ”¯æŒ<code>effect</code>è¢«ç§°ä¸º<code>pure functiional</code>æ¯”å¦‚<code>Haskell</code></strong>ã€‚<code>Ocaml</code>ä¸æ˜¯çº¯å‡½æ•°å¼è¯­è¨€ã€‚æ‰€ä»¥æ”¯æŒ<code>effectful/state-full programming</code>å’Œ<code>pure FP</code>ã€‚</p><p>æœ€åä¸€ä¸ªå…³é”®å­—å°±æ˜¯<code>statically typed</code>é™æ€ç±»å‹ã€‚<code>Types statically approximate the runtime behaviour of an expression.</code>æ„æ€å°±æ˜¯<code>static type checking</code>æœ¬èº«æ˜¯åœ¨ç¨‹åºè¿è¡Œä¹‹å‰è¿›è¡Œç±»å‹æ£€æŸ¥â€”â€”é€šè¿‡<code>syntatic structure of expressions</code>ã€‚å®ƒå¯ä»¥ä¿è¯é€šè¿‡é™æ€ç±»å‹æ£€æŸ¥çš„ç¨‹åºåœ¨è¿è¡Œæ—¶ä¸€å®šä¸ä¼š<code>core dump</code>ã€‚è¿™æ ·çš„<code>statically typed PL.</code>æ¯”å¦‚<code>Ocaml/Java/ML/Haskell/Scalaç­‰</code>ä¹Ÿè¢«ç§°ä¸ºæ˜¯<code>type-safe</code>çš„ã€‚</p><h4 id="expressions-names-values-and-types">Expressions, Names, Values and Types</h4><p>åœ¨å‡½æ•°å¼ä¸­æ²¡æœ‰è¯­å¥<code>statements</code>ï¼Œæœ€åŸºæœ¬çš„<code>expression</code>å°±æ˜¯<code>numbers/strings/booleans</code>ã€‚</p><figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">2</span> + <span class="number">3</span>;;</span><br><span class="line">- : <span class="built_in">int</span> = <span class="number">5</span></span><br><span class="line"># <span class="number">4.0</span> /. <span class="number">2.0</span>;;</span><br><span class="line">- : <span class="built_in">float</span> = <span class="number">2.0</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç ä¸­çš„æ ¼å¼ä¸º<code>&lt;name&gt; : &lt;type&gt; = &lt;value&gt;</code> ã€‚æˆ‘ä»¬å°†<code>;;</code>ä¹‹å‰çš„å¼å­ç§°ä¸º<code>expressions</code>ï¼Œå°†æ•´ä¸ªè®¡ç®—è¿‡ç¨‹ç§°ä¸º<code>evaluation</code>ï¼Œè€Œå°†è®¡ç®—çš„ç»“æœç§°ä¸º<code>values</code>ã€‚</p><p>æ³¨æ„åœ¨<code>Ocaml</code>ä¸­åŸºç¡€è¿ç®—ç¬¦å¹¶æ²¡æœ‰è¢«é‡è½½ï¼Œæ•…æµ®ç‚¹è¿ç®—éƒ½æ˜¯åœ¨åé¢æœ‰ä¸€ä¸ª<code>,</code>ã€‚è¿™ä¸»è¦æ˜¯å› ä¸º<code>Ocaml</code>æ˜¯é™æ€ç±»å‹çš„ï¼Œä¸ä¼šåœ¨è¿è¡Œæ—¶å»æ ¹æ®è¿ç®—ç¬¦å‚æ•°æ¥æ¨å¯¼é‡è½½çš„<code>operators</code>ã€‚</p><p>é€šè¿‡ç±»å‹æ£€æŸ¥çš„ç¨‹åºï¼Œå…¶<code>evaluation</code>è¦ä¹ˆæ›´æ–°åˆ°ä¸€ä¸ªæ–°çš„<code>state</code>è¦ä¹ˆæŠ¥ä¸€ä¸ª<code>built-in runtime error</code>ã€‚æ¯”å¦‚:</p><figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">3</span> / <span class="number">0</span>;;</span><br><span class="line"><span class="type">Exception</span>: <span class="type">Division_by_zero</span></span><br></pre></td></tr></table></figure><h4 id="variables-bindings-and-functions">Variables, Bindings and Functions</h4><p><code>Ocaml</code>æ˜¯ä¸€ä¸ª<code>call-by-value</code>çš„è¯­è¨€â€”â€”<code>it binds values to variable names not expressions</code>ã€‚è¿™é‡Œæœ‰ä¸€ä¸ª<code>binding</code>çš„æ¦‚å¿µï¼ŒåŒºåˆ†äº<code>assignment</code>ã€‚æˆ‘ä»¬åªæ˜¯åœ¨<code>values</code>å’Œ<code>name</code>ä¹‹é—´å»ºç«‹äº†â€œé“¾æ¥â€â€”â€”å¹¶æ²¡æœ‰æ–°çš„<code>state</code>è¢«åˆ›å»ºâ€”â€”æˆ‘ç†è§£å’Œ<code>imperative PL.</code>ä¸åŒçš„åº”è¯¥æ˜¯å†…å­˜æ¨¡å‹æ¯”å¦‚<code>C</code>ä¸­å¯¹å±€éƒ¨å˜é‡æ˜¯æ”¾åœ¨æ ˆä¸Šçš„ä½†æ˜¯ç¡®å®åˆ›å»ºäº†å†…å­˜ã€‚å½“ç„¶è¿™ç§â€œé“¾æ¥â€ä¹Ÿæ˜¯å¯ä»¥æ›´æ–°çš„ã€‚åœ¨<code>Ocaml</code>ä¸­ç”¨<code>let</code>è¡¨è¾¾å¼æ¥å»ºç«‹ä¸€ä¸ªç»‘å®šã€‚</p><figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">let</span> x = <span class="number">3</span> * <span class="number">3</span>;;</span><br><span class="line"><span class="keyword">val</span> x : <span class="built_in">int</span> = <span class="number">9</span></span><br><span class="line"># <span class="keyword">let</span> x = <span class="number">42</span>;;</span><br><span class="line"><span class="keyword">val</span> x : <span class="built_in">int</span> = <span class="number">42</span></span><br></pre></td></tr></table></figure><p>å˜é‡çš„ä½œç”¨åŸŸæ˜¯æ ¹æ®<code>binding stack</code>æ¥ç¡®å®šçš„ã€‚å±€éƒ¨æˆ–è€…ä¸´æ—¶åˆ›å»ºçš„<code>binding</code>éƒ½ä¼šè¢«<code>push</code>è¿›<code>binding stack</code>ä¸­ï¼Œåœ¨ä¸éœ€è¦çš„æ—¶å€™ä¼šè¢«<code>GC</code>æ¸…é™¤ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># let k = 4;;</span><br><span class="line">val k : int = 4</span><br><span class="line"># let k = 3 in k * k ;;</span><br><span class="line">- : int = 9</span><br><span class="line"># k;;</span><br><span class="line">- : int = 4</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸€ä¸ªæ–°çš„<code>let &lt;name&gt; = &lt;expression 1&gt; in &lt;expression 2&gt;</code>ç»“æ„â€”â€”å°†<code>expression1</code>çš„<code>value</code>ç»‘å®šåˆ°<code>name</code>ä¸Šï¼Œç„¶åç»§ç»­ä½¿ç”¨è¿™ä¸ªæ–°çš„ç»‘å®šå¯¹<code>expression 2</code>è¿›è¡Œ<code>evalutions</code>ã€‚</p><p>åœ¨å‡½æ•°å¼ä¸­<code>let</code>ä¸ä»…å¯ä»¥ç»‘å®šåŸºæœ¬ç±»å‹ï¼Œè¿˜å¯ä»¥ç»‘å®šå‡½æ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let area : float -&gt; float = function r -&gt; pi *. r *. r;;</span><br><span class="line">let area : float -&gt; float = fun r -&gt; 3.14 *. r *. r;;</span><br><span class="line">let area (r:float) = pi *. r *. r;;</span><br><span class="line">let a1 = area(2.0);;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¸‰ç§å†™æ³•æ˜¯ç­‰ä»·çš„ï¼Œéƒ½å¾—åˆ°å‡½æ•°ç±»å‹<code>val area : float -&gt; float = &lt;fun&gt;</code>ã€‚<strong>æœ‰æ„æ€çš„æ˜¯å‡½æ•°ä½œä¸ºä¸€ç§ç»‘å®šï¼Œä¹Ÿæ˜¯åœ¨<code>binding stack</code>ä¸­çš„ï¼Œæ‰€ä»¥å®ƒåªèƒ½çœ‹åˆ°è¿‡å»çš„ç»‘å®šï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># let (pi*float) = 3.0</span><br><span class="line">val pi : float = 3.14</span><br><span class="line"># let area (r:float) = pi *. r *.r;;</span><br><span class="line">val area : float -&gt; float = &lt;fun&gt;</span><br><span class="line"># let a1 = area(2.0);;</span><br><span class="line">val a1 : float = 12.0</span><br><span class="line"># let (pi*float) = 4.0</span><br><span class="line">val pi : float = 4.0</span><br><span class="line"># let a2 = area(2.0);;</span><br><span class="line">val a2 : float = 12.0</span><br></pre></td></tr></table></figure><p>æœ€åä»‹ç»ä¸€ä¸‹é€’å½’å‡½æ•°ã€‚åœ¨<code>Ocaml</code>ä¸­é€’å½’å‡½æ•°ä½¿ç”¨<code>let rec</code>æ¥å£°æ˜ã€‚æ¯”å¦‚å®šä¹‰<code>factorial</code>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># exception Domain;;</span><br><span class="line"># let rec fact n = </span><br><span class="line">if n &lt; 0 then raise Domain</span><br><span class="line">else if n = 0 then 1</span><br><span class="line">else n * fact(n - 1);;</span><br></pre></td></tr></table></figure><p>åœ¨å‡½æ•°å¼ä¸­æ‰€æœ‰çš„å‡½æ•°éƒ½å¯ä»¥è¢«å†™æˆå°¾é€’å½’çš„å½¢å¼ç„¶åè¿›ä¸€æ­¥ä¼˜åŒ–â€”â€”è¿™æ˜¯å› ä¸ºå°¾é€’å½’å‡½æ•°çš„æ ˆå¸§å¯ä»¥è¢«ä¼˜åŒ–æ‰ã€‚æ¯”å¦‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># let fact_tr n = </span><br><span class="line">let rec f n acc = </span><br><span class="line">if n = 0 then acc else f (n - 1) (n * acc)</span><br><span class="line">in</span><br><span class="line">f n 1</span><br></pre></td></tr></table></figure><h4 id="data-types-and-pattern-matching">Data Types and Pattern Matching</h4><p>è¿™ä¸€èŠ‚å¯ä»¥åœ¨<code>Ocaml</code>ä¸­å®šä¹‰è‡ªå·±çš„é€’å½’/éé€’å½’çš„æ•°æ®ç±»å‹ã€‚</p><p><code>Ocaml</code>ä½¿ç”¨<code>type</code>æ¥å®šä¹‰<strong>æœ‰é™æ— åºçš„éé€’å½’é›†åˆ</strong>ï¼Œè¿™é‡Œä¸¾ä¸€ä¸ªæ‰‘å…‹ç‰Œçš„ä¾‹å­:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># type suit = Clubs | Spades | Hearts | Diamonds;;</span><br><span class="line">type suit = Clubs | Spades | Hearts | Diamonds</span><br><span class="line"># type rank = Two | Three | Four | Five | Six | Seven | Eight | Nine | Ten | Jack | Queen | King | Ace;;</span><br><span class="line"># type card = rank * suit;;</span><br><span class="line">type card = rank * suit</span><br><span class="line"># type hand = Empty | Hand of card * hand;;</span><br><span class="line">type hand = Empty | Hand of card * hand</span><br><span class="line"># let rec dom (s1, s2) = match (s1, s2) with </span><br><span class="line">| (Spades, _) -&gt; true</span><br><span class="line">| (Hearts, Diamonds)  -&gt; true</span><br><span class="line">| (s1, s2) -&gt; s1 = s2</span><br></pre></td></tr></table></figure><p><code>Ocaml</code>ä½¿ç”¨<code>pattern matching</code>æ¨¡å¼åŒ¹é…æ¥æ“ä½œè¿™äº›æ•°æ®ç»“æ„ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªæ¦‚å¿µâ€”â€”<code>patterns</code>å’Œ<code>constructors</code>ã€‚æ¯ä¸€ä¸ª<code>pattern</code>ç”±ä¸åŒçš„<code>constructors</code>å¡«å……â€”â€”è¿™é‡Œçš„æ„é€ å™¨æŒ‡çš„æ˜¯æ¯ä¸€ä¸ªå’Œç±»å‹å…ƒç´ åŒåçš„æ„é€ å™¨æ¯”å¦‚<code>Clubs</code>ã€‚<code>Ocaml</code>è§„å®šæ„é€ å™¨é¦–å­—æ¯å¿…é¡»å¤§å†™ï¼Œä¸”åŒ¹é…æ˜¯ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºã€‚</p><p>è¿›ä¸€æ­¥çš„ï¼Œä¸ºäº†ç®€åŒ–ä»£ç è€Œæ”¯æŒ<code>inductively</code>çš„<code>deep pattern</code>æ„é€ å½¢å¼å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># let rec add c1 c2 = match c1 c2 with</span><br><span class="line">| (Hearts, v1), (Hearts, v2) -&gt; v1 + v2</span><br><span class="line">| _, _ -&gt; 0;;</span><br><span class="line">val add : (&apos;a -&gt; (suit * int) * (suit * int)) -&gt; &apos;a -&gt; int = &lt;fun&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼šå‘ç°æ„é€ äº†ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ç±»å‹<code>('a -&gt; (suit*int)*(suit*int)) -&gt; 'a -&gt; int</code>ã€‚å…¶ä¸­<code>type1 * type2</code>ä¸ºä¸€ä¸ª<code>pair</code>ï¼Œè€Œ`<code>a</code>ä¸ºä»»æ„ç±»å‹ã€‚</p><p>ä¸Šè¿°å‡½æ•°çš„åŸºæœ¬ç±»å‹æ¨å¯¼è¿‡ç¨‹ä¸ºä¸¤ä¸ªä»»æ„ç±»å‹ä¸ºè¾“å…¥å‚æ•°ï¼Œ<code>int</code>ä¸ºè¾“å‡ºã€‚å…¶ä¸­ä»»æ„ç±»å‹ä¸º<code>(suit*int)*(suit*int)</code>çš„ã€‚</p><p>ä¸Šé¢æ‰‘å…‹ç‰Œçš„ä¾‹å­ä¸­<code>hand</code>å®šä¹‰ä¸€ç»„<strong>æ— é™é€’å½’é›†åˆ</strong>ã€‚åœ¨<code>hand</code>ç±»å‹ä¸­ï¼Œ<code>Empty</code>å’Œ<code>Hand</code>åˆ†åˆ«ä¸ºä¸¤ä¸ª<code>constructors</code>ã€‚<code>Empty</code>æ²¡æœ‰è¾“å…¥å‚æ•°ï¼Œè€Œ<code>Hand</code>ä»¥<code>a tuple of a card and another hand</code>çš„ä¸€ä¸ª<code>tuple</code>ä¸ºè¾“å…¥å‚æ•°ã€‚çœ‹ä¸‹é¢çš„å®ä¾‹åŒ–ä¾‹å­:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># let hand0: hand = Empty</span><br><span class="line">let hand1: hand = Hand((Ace, Hearts), Empty)</span><br><span class="line">let hand2: hand = Hand((Queen, Diamonds), hand1)</span><br><span class="line">let hand3:hand = </span><br><span class="line">Hand((Ace, Spades),</span><br><span class="line">Hand((Ten, Diamonds), </span><br><span class="line">Hand((Seven, Clubs),</span><br><span class="line">Hand((Queen, Spades),</span><br><span class="line">Hand((Eight, Clubs), Empty)))));;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª<code>hand</code>ç±»å‹å®é™…ä¸Šå°±æ˜¯ä¸€æ£µé€€åŒ–çš„äºŒå‰æ ‘ï¼ˆåªèƒ½é å³ç”Ÿé•¿ï¼‰â€”â€”å¶å­æ˜¯<code>Empty</code>ï¼Œ è€Œ<code>Hand</code>æ„é€ å™¨ä½¿ç”¨ä¸¤ä¸ªå‚æ•°æ¥å»ºæ ‘ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¿™é‡Œå‡½æ•°çš„ç±»å‹æ˜¯<code>suit -&gt; hand -&gt; hand</code>ï¼ŒåŠŸèƒ½æ˜¯ç»™å®šä¸€ä¸ª<code>suit -&gt; hand</code>çš„è¾“å…¥ï¼Œç„¶åä»<code>hand</code>ä¸­æ‰¾æœ‰åŒ¹é…åˆ°<code>suit</code>ç±»å‹çš„<code>hand</code>ç„¶åè¿”å›ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># let rec extract (s:suit) (h:hand) = match h with </span><br><span class="line">| Empty -&gt; Empty</span><br><span class="line">| Hand ((_, s&apos;) as c, h&apos;) -&gt;</span><br><span class="line">if s = s&apos; then Hand(c, extract s h&apos;)</span><br><span class="line">else extract s h&apos;</span><br></pre></td></tr></table></figure><p>ä¸Šä¸€ä¸ªå‡½æ•°ä¸­çš„<code>Empty</code>å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªç»ˆç»“ç¬¦ï¼Œæ„å‘³ç€å¦‚æœ<code>hand</code>ç±»å‹éƒ½ä¸åŒ¹é…çš„è¯å°±ç›´æ¥è¿”å›<code>Empty</code>ã€‚ä½†æ˜¯å¦‚æœæˆ‘è¦åŒ¹é…ä¸€ä¸ª<code>card</code>çš„è¯ï¼Œæ²¡æœ‰åŒ¹é…ä¸Šè¯¥æ€ä¹ˆè¿”å›å‘¢ï¼Ÿ<code>Ocaml</code>å¼•å…¥ä¸€ä¸ª<code>optional data type</code>ã€‚æ¯”å¦‚ä¸‹é¢çš„å‡½æ•°:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># type &apos;a option = None | Some of &apos;a</span><br><span class="line">type &apos;a option = None | Some of &apos;a</span><br><span class="line"># let rec find (r, h) = match h with</span><br><span class="line">| Empty  -&gt; None</span><br><span class="line">| Hand((r&apos;, s&apos;), h&apos;) -&gt; if r = r&apos; then Some s&apos;</span><br><span class="line">else find(r, h&apos;)</span><br><span class="line">val find: rank * hand -&gt; suit option = &lt;fun&gt;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>option type</code>è¡¨ç¤ºç”±<code>Some</code>æ„é€ å™¨å®ç°çš„ç±»å‹ä¸º`<code>a</code>çš„å…ƒç´ é›†åˆï¼Œæ˜¯ç¬¦åˆå¤šæ€çš„ä»»æ„ç±»å‹ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;abstract&quot;&gt;Abstract&lt;/h3&gt;
&lt;p&gt;æœ€è¿‘åœ¨å®éªŒå®¤å®ä¹ çš„è¿‡ç¨‹ä¸­å­¦åˆ°äº†å¾ˆå¤šæœ‰æ„æ€çš„ä¸œè¥¿ï¼Œå¯¹&lt;code&gt;Programming Languages&lt;/code&gt;ä¹Ÿæœ‰äº†æ›´æ·±çš„äº†è§£ï¼Œ&lt;code&gt;Ocaml&lt;/code&gt;æ˜¯ä¸€é—¨æ”¯æŒå¤šèŒƒå¼çš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ã€‚&lt;strong&gt;ç¨‹åºæè¿°è®¡ç®—ï¼Œä½†æ˜¯åˆä¸ä»…ä»…æ˜¯è®¡ç®—&lt;/strong&gt;ã€‚&lt;code&gt;Ocaml&lt;/code&gt;çš„å­¦ä¹ å¸¦ç»™æˆ‘çš„ä¸ä»…ä»…æ˜¯è¯­è¨€æœ¬èº«ï¼Œè¿™ä¸ªç³»åˆ—è®°å½•äº†å…¶ä¸­çš„éƒ¨åˆ†å¿ƒå¾—:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å…³äº&lt;code&gt;scripting/imperative/object-oriented/functional PL&lt;/code&gt;çš„åŸºæœ¬æ¦‚å¿µ
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Higher-order Functions&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;State-Full vs State-Free Computation&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Modelling Objects and Closures&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Exceptions/Continuations to Defer Control&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Polymorphism&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Partial Evaluation/Lazy Programming/Modules&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;å…³äº&lt;code&gt;reason about programs&lt;/code&gt;çš„æ–¹æ³•
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Type Checking&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Induction&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Operational Semantics&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;QuickCheck&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;å…³äºè®¾è®¡ä¸€é—¨è¯­è¨€çš„åŸºæœ¬è§„åˆ™&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Ocaml" scheme="http://haotianmcihael.github.io/categories/Ocaml/"/>
    
    
      <category term="PL" scheme="http://haotianmcihael.github.io/tags/PL/"/>
    
      <category term="FP" scheme="http://haotianmcihael.github.io/tags/FP/"/>
    
  </entry>
  
  <entry>
    <title>Lispè¯­è¨€å’ŒEmacs</title>
    <link href="http://haotianmcihael.github.io/2021/02/16/Lisp%E8%AF%AD%E8%A8%80%E5%92%8CEmacs/"/>
    <id>http://haotianmcihael.github.io/2021/02/16/Lispè¯­è¨€å’ŒEmacs/</id>
    <published>2021-02-16T13:58:30.000Z</published>
    <updated>2022-03-16T10:25:10.893Z</updated>
    
    <content type="html"><![CDATA[<h3 id="abstract">Abstract</h3><p>â€‹ ç¬¬ä¸€æ¬¡æ¥è§¦<code>EMACS</code>æ˜¯å¤§äºŒçš„æ—¶å€™ï¼Œå½“æ—¶åªé¡¾ç€æ–°å¥‡çš„ç•Œé¢å’Œå¼ºå¤§çš„åŠŸèƒ½å´å¿½è§†äº†å…¶èƒŒåçœŸæ­£çš„ç†è®ºã€‚åæ¥æˆ‘å†™ä»£ç ä¹Ÿä¸€ç›´ä¸å–œæ¬¢IDEè¿™ç§ä¸œè¥¿ï¼Œä½†ç°åœ¨å›è¿‡å¤´æ¥çœ‹ï¼Œè¿™è²Œä¼¼ä¹Ÿåªæ˜¯ä¸€ç§æµ®äºè¡¨é¢è€Œæ— å…³åŸç†çš„æ‰§æ‹—ã€‚</p><p>â€‹ è¿™æ¬¡é‡æ–°å›å½’åˆ°<code>Spacemacs</code>ï¼Œæˆ‘å¸Œæœ›ä»”ç»†ä»<code>Lisp</code>çš„è§’åº¦ç†è§£è¿™æ¬¾ç¼–è¾‘å™¨ï¼Œä¸ç®¡æ˜¯å…¶æ’ä»¶ç‰¹æ€§è¿˜æ˜¯è¯­è¨€æœ¬èº«ã€‚</p><a id="more"></a>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;abstract&quot;&gt;Abstract&lt;/h3&gt;
&lt;p&gt;â€‹ ç¬¬ä¸€æ¬¡æ¥è§¦&lt;code&gt;EMACS&lt;/code&gt;æ˜¯å¤§äºŒçš„æ—¶å€™ï¼Œå½“æ—¶åªé¡¾ç€æ–°å¥‡çš„ç•Œé¢å’Œå¼ºå¤§çš„åŠŸèƒ½å´å¿½è§†äº†å…¶èƒŒåçœŸæ­£çš„ç†è®ºã€‚åæ¥æˆ‘å†™ä»£ç ä¹Ÿä¸€ç›´ä¸å–œæ¬¢IDEè¿™ç§ä¸œè¥¿ï¼Œä½†ç°åœ¨å›è¿‡å¤´æ¥çœ‹ï¼Œè¿™è²Œä¼¼ä¹Ÿåªæ˜¯ä¸€ç§æµ®äºè¡¨é¢è€Œæ— å…³åŸç†çš„æ‰§æ‹—ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ è¿™æ¬¡é‡æ–°å›å½’åˆ°&lt;code&gt;Spacemacs&lt;/code&gt;ï¼Œæˆ‘å¸Œæœ›ä»”ç»†ä»&lt;code&gt;Lisp&lt;/code&gt;çš„è§’åº¦ç†è§£è¿™æ¬¾ç¼–è¾‘å™¨ï¼Œä¸ç®¡æ˜¯å…¶æ’ä»¶ç‰¹æ€§è¿˜æ˜¯è¯­è¨€æœ¬èº«ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Lisp" scheme="http://haotianmcihael.github.io/categories/Lisp/"/>
    
    
      <category term="EMACS" scheme="http://haotianmcihael.github.io/tags/EMACS/"/>
    
      <category term="PL" scheme="http://haotianmcihael.github.io/tags/PL/"/>
    
  </entry>
  
  <entry>
    <title>WebAssemblyå’ŒWabt</title>
    <link href="http://haotianmcihael.github.io/2020/11/12/WebAssembly%E5%92%8CWabt/"/>
    <id>http://haotianmcihael.github.io/2020/11/12/WebAssemblyå’ŒWabt/</id>
    <published>2020-11-12T09:01:21.000Z</published>
    <updated>2022-03-16T09:54:07.429Z</updated>
    
    <content type="html"><![CDATA[<h3 id="abstract">Abstract</h3><p>æœ€è¿‘å‚åŠ <a href="https://github.com/deeplang-org" target="_blank" rel="noopener"><code>deeplang</code></a>çš„çš„è¿‡ç¨‹ä¸­ï¼Œæ¥è§¦åˆ°äº†ä¸€äº›ç¼–è¯‘é¢†åŸŸçš„æ–°æŠ€æœ¯ï¼Œæ€»ç»“ä¸€ä¸‹å¸Œæœ›æœ‰æ—¶é—´äº†å¯ä»¥è¿›ä¸€æ­¥çš„æ·±å…¥äº†è§£ã€‚å‚è€ƒèµ„æ–™æ˜¯<a href="https://book.douban.com/subject/30396640/" target="_blank" rel="noopener">WebAssemblyæ ‡å‡†å…¥é—¨</a>ã€‚</p><a id="more"></a><h3 id="points">Points</h3><p>è¿‡å»å¾ˆå¤šæŠ€æœ¯å°è¯•å°†<code>C/C++</code>ç¨‹åºç›´æ¥è¿è¡Œåœ¨æµè§ˆå™¨ä¸­ï¼Œæ¯”å¦‚<code>TypeScript</code> å°†<code>C/C++</code>ä»£ç è½¬æ¢ä¸º<code>JS</code>ã€‚</p><ul><li><code>Emscripten</code></li></ul><p>è€Œè¿™ä¸ªé¡¹ç›®åˆ©ç”¨<code>LLVM</code>ç¼–è¯‘å™¨å‰ç«¯ç¼–è¯‘<code>C/C++</code>ä»£ç ï¼Œç”Ÿæˆ<code>LLVM</code>å¹³å°ç‰¹æœ‰çš„è·¨å¹³å°ä¸­é—´è¯­è¨€ä»£ç ï¼Œæœ€ç»ˆå†å°†<code>IR</code>è½¬æ¢ä¸º<code>JavaScript</code>çš„<strong><code>asm.js</code>å­é›†</strong>â€”â€”è¿™æ˜¯<code>WebAssembly</code>çš„åŸºç¡€ã€‚</p><ul><li><code>AOTç¼–è¯‘</code></li><li><code>JITç¼–è¯‘</code></li></ul><p><code>JIT</code>çš„ä¼˜ç‚¹åœ¨äº<code>Profile-Based Optimization</code>ï¼Œæ ¹æ®è¿è¡Œæ—¶ä¿¡æ¯ç„¶åéšç€æ—¶é—´çš„æ¨ç§»å°½å¯èƒ½çš„å¾—åˆ°æœ€ä¼˜çš„ä»£ç ã€‚</p><p>è€Œ<code>AOT</code>çš„ä¼˜ç‚¹åœ¨äºæ— éœ€<code>runtime</code>è¿è¡Œï¼Œç›´æ¥é™æ€é“¾æ¥è‡³æœ€ç»ˆçš„ç¨‹åºä¸­ã€‚</p><ul><li><code>WebAssembly</code></li></ul><p><code>JavaScript</code>è¿è¡Œåœ¨å…¶è™šæ‹Ÿæœºä¸Šï¼Œè€Œ<code>WebAssembly</code>ä¹Ÿè¿è¡Œåœ¨å…¶è™šæ‹Ÿæœºä¸Šã€‚è€Œç°åœ¨<code>Node.js 8.0</code>ä¹‹åçš„ç‰ˆæœ¬ä¹Ÿå¯ä»¥è¿è¡Œ<code>WebAssembly</code>â€”â€”ä¹Ÿå°±æ˜¯è¯´<code>WebAssembly</code>è™šæ‹Ÿæœºå¯ä»¥è„±ç¦»<code>JS</code>çš„ç¯å¢ƒæ”¯æŒï¼Œä¸ä»…ä»…è¿è¡Œåœ¨æµè§ˆå™¨ä¸­ã€‚</p><h3 id="webassemblyæ¦‚è¿°">WebAssemblyæ¦‚è¿°</h3><p>å’Œ<code>LLVM IR</code>å¾ˆåƒï¼Œæœ‰ä¸¤ç§æ±‡ç¼–è¡¨ç¤ºâ€”â€”<code>.wat</code>æ–‡æœ¬è¡¨ç¤ºå’Œ<code>.wasm</code>æœºå™¨è¡¨ç¤ºã€‚</p><h4 id="å…³é”®æ¦‚å¿µ">å…³é”®æ¦‚å¿µ</h4><ul><li>æ¨¡å—</li></ul><p>ç”±<code>.wasm</code>ç¼–è¯‘è€Œæ¥çš„å¯æ‰§è¡Œæœºå™¨ç çš„äºŒè¿›åˆ¶å¯¹è±¡ã€‚</p><ul><li>å†…å­˜</li></ul><p>ç½‘é¡µç¯å¢ƒä¸‹ï¼Œ<code>wasm</code>çš„å†…å­˜ç”±<code>JavaScript</code>ä¸­çš„<code>ArrayBuffer</code>å¯¹è±¡å®ç°çš„ã€‚</p><ul><li>è¡¨æ ¼</li></ul><p>å¼•å…¥è¡¨æ ¼å¯¹è±¡ç”¨äºå­˜å‚¨å‡½æ•°å¼•ç”¨æ¥æ¨¡æ‹Ÿ<code>C/C++</code>æŒ‡é’ˆã€‚</p><ul><li>å®ä¾‹<ul><li>å¯¼å…¥å¯¹è±¡ è°ƒç”¨JSå‡½æ•°</li><li>å¯¼å‡ºå¯¹è±¡ æä¾›æ¥å£</li></ul></li></ul><p>æŒ‡ä¸€ä¸ªæ¨¡å—åŠå…¶è¿è¡Œæ—¶çš„æ‰€æœ‰çŠ¶æ€ï¼ŒåŒ…æ‹¬å†…å­˜ï¼Œè¡¨æ ¼ä»¥åŠå¯¼å…¥å¯¹è±¡ç­‰ã€‚æ¨¡å—åªæœ‰è¢«å®ä¾‹åŒ–ä¹‹åæ‰å¯ä»¥è°ƒç”¨ã€‚</p><h4 id="ç¨‹åºç”Ÿå‘½å‘¨æœŸ">ç¨‹åºç”Ÿå‘½å‘¨æœŸ</h4><ul><li>å°†<code>wat</code>æˆ–è€…å…¶ä»–è¯­è¨€ç¼–è¯‘æˆ<code>.wasm</code>æ–‡ä»¶</li><li>ç½‘é¡µä¸­ä½¿ç”¨<code>fetch</code>ç­‰è·å–<code>.wasm</code>æ–‡ä»¶<ul><li><code>emrun --no_browser --port 8080 .</code> å°†æ–‡ä»¶è¿è¡Œåœ¨<code>http</code>åè®®ä¸Š</li><li>ç„¶åæ‰“å¼€<code>http://localhost:8080/xxx.html</code></li></ul></li><li>å°†<code>.wasm</code>ç¼–è¯‘ä¸ºæ¨¡å—ï¼Œç¼–è¯‘è¿‡ç¨‹ä¸­è¿›è¡Œåˆæ³•æ€§æ£€æŸ¥</li><li>å®ä¾‹åŒ–ï¼Œåˆå§‹åŒ–å¯¼å…¥å¯¹è±¡ï¼Œåˆ›å»ºæ¨¡å—å®ä¾‹</li><li>æ‰§è¡Œå®ä¾‹çš„å¯¼å‡ºå‡½æ•°ï¼Œå®Œæˆæ“ä½œ</li></ul><h4 id="è™šæ‹Ÿæœºä½“ç³»ç»“æ„">è™šæ‹Ÿæœºä½“ç³»ç»“æ„</h4><ul><li>ä¸€ä¸ªå…¨å±€ç±»å‹æ•°ç»„(å‡½æ•°ç­¾å)</li><li>ä¸€ä¸ªå…¨å±€å‡½æ•°æ•°ç»„</li><li>ä¸€ä¸ªå…¨å±€å˜é‡æ•°ç»„</li><li>ä¸€ä¸ªå…¨å±€è¡¨æ ¼å¯¹è±¡(å…ƒç´ å¼•ç”¨)</li><li>ä¸€ä¸ªå…¨å±€å†…å­˜å¯¹è±¡</li><li>ä¸€ä¸ªè¿è¡Œæ—¶æ ˆ</li></ul><h4 id="hello-world">Hello World</h4><p>JavaScriptéƒ¨åˆ†<code>hello.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Show me the answer<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">            var wasmMem = new WebAssembly.Memory(&#123;initial:1&#125;);</span></span><br><span class="line"><span class="undefined">            function printStr(offset, length)&#123;</span></span><br><span class="line"><span class="undefined">                var bytes = new Uint8Array(wasmMem.buffer, offset, length);</span></span><br><span class="line"><span class="undefined">                var string = new TextDecoder('utf-8').decode(bytes);</span></span><br><span class="line"><span class="undefined">                console.log(string);</span></span><br><span class="line"><span class="undefined">                &#125;;</span></span><br><span class="line"><span class="undefined">            var importObj = &#123;js : &#123;print: printStr, mem: wasmMem&#125;&#125;; </span></span><br><span class="line"><span class="undefined">            fetch('hello.wasm').then(response=&gt;</span></span><br><span class="line"><span class="undefined">                        response.arrayBuffer()</span></span><br><span class="line"><span class="undefined">                        ).then(bytes=&gt;</span></span><br><span class="line"><span class="undefined">                          WebAssembly.instantiate(bytes, importObj)</span></span><br><span class="line"><span class="undefined">                        ).then(result =&gt; result.instance.exports.hello()</span></span><br><span class="line"><span class="undefined">                        );</span></span><br><span class="line"><span class="undefined">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>watéƒ¨åˆ†<code>hello.wat</code></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> ;; hello.wat</span><br><span class="line"></span><br><span class="line">(<span class="keyword">module</span></span><br><span class="line">      ;; import js::print as js_print(); </span><br><span class="line">      (import "js" "print" (func $js_print (param i32 i32)))</span><br><span class="line">      (import "js" "mem" (memory 1))  ;;import js::mem as memory</span><br><span class="line">      (data (i32.const 0) "ä½ å¥½ï¼Œwasm")</span><br><span class="line">      (func (export "hello")</span><br><span class="line">           i32.const 0    ;; pass offset 0 to js_print</span><br><span class="line">           i32.const 13   ;; pass offset 13 to js_print</span><br><span class="line">           call $js_print </span><br><span class="line">            )</span><br><span class="line">       )</span><br></pre></td></tr></table></figure><p>é¦–å…ˆå°†<code>.wat</code>ç¼–è¯‘æˆä¸º<code>.wasm</code>,éœ€è¦ç”¨åˆ°<a href="https://github.com/WebAssembly/wabt" target="_blank" rel="noopener">wabtå·¥å…·é›†</a>ã€‚è¿˜éœ€è¦ä¸‹è½½<a href="https://github.com/juj/emsdk.git" target="_blank" rel="noopener">Emscriptenå·¥å…·é›†</a>ã€‚ç¼–è¯‘å¥½ä¹‹åé…ç½®ç¯å¢ƒå˜é‡ã€‚å°±å¯ä»¥æ‰§è¡Œäº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> wat2wasm hello.wat -o hello.wasm</span><br><span class="line"><span class="meta">$</span> emrun --no_browser --port 8080 .</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰“å¼€<code>http://localhost:8080/xxx.html</code>ï¼Œå¯åŠ¨<code>Chrome</code>ä¸‹çš„å¼€å‘è€…æ¨¡å¼ï¼Œçœ‹åˆ°æ‰§è¡ŒæˆåŠŸã€‚</p><h3 id="webassemblyæ ¸å¿ƒ">WebAssemblyæ ¸å¿ƒ</h3><h4 id="åœ¨jsç¯å¢ƒä¸­">åœ¨JSç¯å¢ƒä¸­</h4><p>æµè§ˆå™¨ä¸­çš„<code>wasm</code>è¿è¡Œåœ¨<code>JS</code>è™šæ‹Ÿæœºä¸Šï¼Œé¡µé¢å¯ä»¥é€šè¿‡ä¸€ç»„<code>JS</code>å¯¹è±¡è¿›è¡Œ<code>wasm</code>æ¨¡å—çš„ç¼–è¯‘ï¼Œè½½å…¥ï¼Œé…ç½®ï¼Œè°ƒç”¨ç­‰æ“ä½œã€‚</p><p>åœ¨<code>wasm</code>ä¸­çš„å‡ ä¸ªå…³é”®æ¦‚å¿µéƒ½æœ‰ä¸ä¹‹å¯¹åº”çš„å¯¹è±¡ï¼š</p><ul><li>æ¨¡å—â€”â€”<code>WebAssembly.Module</code></li><li>å†…å­˜â€”â€”<code>WebAssembly.Memory</code></li><li>è¡¨æ ¼â€”â€”<code>WebAssembly.Table</code></li><li>å®ä¾‹â€”â€”<code>WebAssembly.Instance</code></li></ul><h4 id="webassemblyæ±‡ç¼–è¯­è¨€">WebAssemblyæ±‡ç¼–è¯­è¨€</h4>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;abstract&quot;&gt;Abstract&lt;/h3&gt;
&lt;p&gt;æœ€è¿‘å‚åŠ &lt;a href=&quot;https://github.com/deeplang-org&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;code&gt;deeplang&lt;/code&gt;&lt;/a&gt;çš„çš„è¿‡ç¨‹ä¸­ï¼Œæ¥è§¦åˆ°äº†ä¸€äº›ç¼–è¯‘é¢†åŸŸçš„æ–°æŠ€æœ¯ï¼Œæ€»ç»“ä¸€ä¸‹å¸Œæœ›æœ‰æ—¶é—´äº†å¯ä»¥è¿›ä¸€æ­¥çš„æ·±å…¥äº†è§£ã€‚å‚è€ƒèµ„æ–™æ˜¯&lt;a href=&quot;https://book.douban.com/subject/30396640/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;WebAssemblyæ ‡å‡†å…¥é—¨&lt;/a&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="JavaScript" scheme="http://haotianmcihael.github.io/categories/JavaScript/"/>
    
    
      <category term="Compiler" scheme="http://haotianmcihael.github.io/tags/Compiler/"/>
    
      <category term="PL" scheme="http://haotianmcihael.github.io/tags/PL/"/>
    
      <category term="WebAssembly" scheme="http://haotianmcihael.github.io/tags/WebAssembly/"/>
    
  </entry>
  
  <entry>
    <title>LLVMæ¼«è°ˆï¼ˆ2-Implementing a Languageï¼‰</title>
    <link href="http://haotianmcihael.github.io/2020/07/07/LLVM%E6%BC%AB%E8%B0%88%EF%BC%882-Implementing-a-Language%EF%BC%89/"/>
    <id>http://haotianmcihael.github.io/2020/07/07/LLVMæ¼«è°ˆï¼ˆ2-Implementing-a-Languageï¼‰/</id>
    <published>2020-07-06T23:05:29.000Z</published>
    <updated>2022-03-16T10:29:57.096Z</updated>
    
    <content type="html"><![CDATA[<h1 id="abstract">Abstract</h1><p>åŸºäº<code>LLVM</code>å®ç°ç®€å•çš„ç¼–ç¨‹è¯­è¨€<code>kaleidoscope</code>ï¼Œæ¥æºäº<a href="https://releases.llvm.org/9.0.0/docs/tutorial/LangImpl01.html" target="_blank" rel="noopener">LLVM9.0.0 tutorial</a>ã€‚</p><p><code>LLVM</code>çš„å®˜æ–¹æ–‡æ¡£è¿˜æ˜¯å¾ˆä¸é”™çš„ï¼Œé˜…è¯»å®Œå…¶ä¸­çš„<strong>tutorials</strong>å°±èƒ½å¤§è‡´ä¸Šæ‰‹<code>LLVM</code>äº†ã€‚å®ç°çš„ä»£ç å¯¹<code>C++11</code>è¦æ±‚æ¯”è¾ƒé«˜ï¼Œæˆ‘æ”¾åœ¨äº†<a href="https://github.com/haotianmichael/LLVMSet/tree/master/Kaleidoscope" target="_blank" rel="noopener">Github</a>ä¸Šã€‚</p><p>å®ç°å…±åˆ†ä¸º10éƒ¨åˆ†ï¼š</p><ul><li>å®ç°<strong>è¯æ³•åˆ†æå™¨Lexer</strong></li><li>ä½¿ç”¨<strong>é€’å½’ä¸‹é™</strong>å’Œ<strong>è¿ç®—ç¬¦ä¼˜å…ˆçº§è§£æ</strong>å®ç°<strong>è¯­æ³•åˆ†æå™¨Parser</strong></li><li>å°†<strong><code>AST</code></strong>è½¬åŒ–æˆ<strong><code>LLVM-IR</code></strong></li><li>æ·»åŠ <strong><code>JIT</code>å³æ—¶ç¼–è¯‘</strong>å’Œ<strong>ä¼˜åŒ–å™¨</strong>çš„æ”¯æŒ</li><li>æ‰©å±•â€”â€”<strong>æ§åˆ¶æµ</strong>ï¼Œè¿™ä¸€ç« ä¼šå¼•å…¥<strong><code>SSA</code></strong>æ¦‚å¿µ</li><li>æ‰©å±•â€”â€”<strong>ç”¨æˆ·å®šä¹‰è¿ç®—ç¬¦</strong></li><li>æ‰©å±•â€”â€”<strong>è‡ªåŠ¨å˜é‡</strong>ï¼Œæ·±å…¥<strong><code>SSA</code></strong></li><li>ç›®æ ‡ä»£ç ç”Ÿæˆ</li><li>æ‰©å±•â€”â€”<strong>æ·»åŠ è°ƒè¯•å™¨</strong></li><li>æ·±å…¥â€”â€”<strong>GCï¼Œå¼‚å¸¸ç­‰</strong></li></ul><a id="more"></a><h1 id="parser">Parser</h1><h2 id="ç¼–è¯‘åŸç†">ç¼–è¯‘åŸç†</h2><h2 id="cåŸç†">C++åŸç†</h2><h1 id="llvm-ir">LLVM-IR</h1>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;abstract&quot;&gt;Abstract&lt;/h1&gt;
&lt;p&gt;åŸºäº&lt;code&gt;LLVM&lt;/code&gt;å®ç°ç®€å•çš„ç¼–ç¨‹è¯­è¨€&lt;code&gt;kaleidoscope&lt;/code&gt;ï¼Œæ¥æºäº&lt;a href=&quot;https://releases.llvm.org/9.0.0/docs/tutorial/LangImpl01.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;LLVM9.0.0 tutorial&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;LLVM&lt;/code&gt;çš„å®˜æ–¹æ–‡æ¡£è¿˜æ˜¯å¾ˆä¸é”™çš„ï¼Œé˜…è¯»å®Œå…¶ä¸­çš„&lt;strong&gt;tutorials&lt;/strong&gt;å°±èƒ½å¤§è‡´ä¸Šæ‰‹&lt;code&gt;LLVM&lt;/code&gt;äº†ã€‚å®ç°çš„ä»£ç å¯¹&lt;code&gt;C++11&lt;/code&gt;è¦æ±‚æ¯”è¾ƒé«˜ï¼Œæˆ‘æ”¾åœ¨äº†&lt;a href=&quot;https://github.com/haotianmichael/LLVMSet/tree/master/Kaleidoscope&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Github&lt;/a&gt;ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;å®ç°å…±åˆ†ä¸º10éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å®ç°&lt;strong&gt;è¯æ³•åˆ†æå™¨Lexer&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨&lt;strong&gt;é€’å½’ä¸‹é™&lt;/strong&gt;å’Œ&lt;strong&gt;è¿ç®—ç¬¦ä¼˜å…ˆçº§è§£æ&lt;/strong&gt;å®ç°&lt;strong&gt;è¯­æ³•åˆ†æå™¨Parser&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å°†&lt;strong&gt;&lt;code&gt;AST&lt;/code&gt;&lt;/strong&gt;è½¬åŒ–æˆ&lt;strong&gt;&lt;code&gt;LLVM-IR&lt;/code&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;æ·»åŠ &lt;strong&gt;&lt;code&gt;JIT&lt;/code&gt;å³æ—¶ç¼–è¯‘&lt;/strong&gt;å’Œ&lt;strong&gt;ä¼˜åŒ–å™¨&lt;/strong&gt;çš„æ”¯æŒ&lt;/li&gt;
&lt;li&gt;æ‰©å±•â€”â€”&lt;strong&gt;æ§åˆ¶æµ&lt;/strong&gt;ï¼Œè¿™ä¸€ç« ä¼šå¼•å…¥&lt;strong&gt;&lt;code&gt;SSA&lt;/code&gt;&lt;/strong&gt;æ¦‚å¿µ&lt;/li&gt;
&lt;li&gt;æ‰©å±•â€”â€”&lt;strong&gt;ç”¨æˆ·å®šä¹‰è¿ç®—ç¬¦&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;æ‰©å±•â€”â€”&lt;strong&gt;è‡ªåŠ¨å˜é‡&lt;/strong&gt;ï¼Œæ·±å…¥&lt;strong&gt;&lt;code&gt;SSA&lt;/code&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;ç›®æ ‡ä»£ç ç”Ÿæˆ&lt;/li&gt;
&lt;li&gt;æ‰©å±•â€”â€”&lt;strong&gt;æ·»åŠ è°ƒè¯•å™¨&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;æ·±å…¥â€”â€”&lt;strong&gt;GCï¼Œå¼‚å¸¸ç­‰&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="C++" scheme="http://haotianmcihael.github.io/categories/C/"/>
    
    
      <category term="Compiler" scheme="http://haotianmcihael.github.io/tags/Compiler/"/>
    
      <category term="LLVM" scheme="http://haotianmcihael.github.io/tags/LLVM/"/>
    
  </entry>
  
  <entry>
    <title>LLVMæ¼«è°ˆï¼ˆ1-LLVMç¼–è¯‘æ¡†æ¶ï¼‰</title>
    <link href="http://haotianmcihael.github.io/2020/06/25/LLVM%E6%BC%AB%E8%B0%88%EF%BC%881-LLVM%E7%BC%96%E8%AF%91%E6%A1%86%E6%9E%B6%EF%BC%89/"/>
    <id>http://haotianmcihael.github.io/2020/06/25/LLVMæ¼«è°ˆï¼ˆ1-LLVMç¼–è¯‘æ¡†æ¶ï¼‰/</id>
    <published>2020-06-25T04:53:37.000Z</published>
    <updated>2022-03-16T10:29:30.699Z</updated>
    
    <content type="html"><![CDATA[<h1 id="abstract">Abstract</h1><p><strong>LLVM</strong>ï¼Œè¿™ä¸ªæ˜Ÿçƒæœ€ç‰›é€¼çš„ç¼–è¯‘å™¨ã€‚</p><p>å…¶æ ¸å¿ƒè®¾è®¡ç†å¿µå°±æ˜¯<strong>ç»Ÿä¸€çš„åº•å±‚ä¸­é—´è¡¨è¾¾ä»¥åŠæ¨¡å—åŒ–çš„è½¯ä»¶å·¥ç¨‹åŒ–æ–¹æ³•ã€‚</strong>LLVMé‡‡ç”¨äº†<code>å‰ç«¯-ä¼˜åŒ–å™¨-åç«¯</code>çš„ç»„ç»‡å½¢å¼ï¼Œ<strong>åªæ˜¯ä¸åŒçš„å‰ç«¯å’Œåç«¯éƒ½é‡‡ç”¨ç»Ÿä¸€çš„åº•å±‚ä¸­é—´è¡¨ç¤ºæ ¼å¼ï¼ˆLLVM IRï¼‰æ¥æœ€å¤§å¯èƒ½å¤ç”¨ä¼˜åŒ–å™¨çš„ä»£ç ã€‚</strong></p><p>åœ¨<a href="http://nondot.org/sabre/" target="_blank" rel="noopener">Chris Lattner</a>å°†å…¶å¼€æºåï¼Œ<a href="http://llvm.org/" target="_blank" rel="noopener">LLVM</a>é€æ¸å‘å±•æˆä¸ºäº†æˆç†Ÿçš„ç¼–è¯‘æ¡†æ¶ï¼Œå…·æœ‰å¤§é‡åº“å’Œç¼–è¯‘é“¾å·¥å…·ã€‚</p><p>æˆ‘ä½¿ç”¨çš„å¹³å°æ˜¯<code>macOS Mojave 10.14</code>ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™è¦æ³¨æ„ç‰ˆæœ¬æ˜¯å¦å…¼å®¹ã€‚</p><p><strong>ä¸€èˆ¬ç³»ç»Ÿä¼šé€šè¿‡æ‰“å°äºŒè¿›åˆ¶æ–‡ä»¶åç§°å’Œæ— æ³•åŠ è½½çš„åŠ¨æ€åº“çš„åç§°æ¥å‘ç°é“¾æ¥é”™è¯¯ã€‚å½“å±å¹•ä¸Šæ‰“å°åŠ¨æ€åº“åç§°æ—¶è¦äºˆä»¥æ³¨æ„ï¼Œè¿™è¯´æ˜ç³»ç»ŸåŠ¨æ€é“¾æ¥å™¨å’ŒåŠ è½½å™¨æ— æ³•åŠ è½½è¯¥åº“ï¼Œå› ä¸ºè¯¥ç¨‹åºä¸å½“å‰ç³»ç»Ÿä¸å…¼å®¹ã€‚</strong></p><p>æˆ‘ç¼–è¯‘<code>LLVM 10.0.0</code>çš„æ—¶å€™å‡ºé”™å¦‚ä¸‹ï¼š</p><p><img src="1.png" width="50%" height="50%" alt=""></p><p>åæ¥å‘ç°è¿™ä¸ªç‰ˆæœ¬çš„<code>Xcode</code>å·¥å…·é“¾æœ€é«˜åªæ”¯æŒ<code>LLVM 9.0.0</code>ç‰ˆæœ¬ï¼Œç„¶åæ¢äº†ç‰ˆæœ¬æœ€åç¼–è¯‘æˆåŠŸã€‚</p><a id="more"></a><h1 id="build">BUILD</h1><table><colgroup><col style="width: 34%"><col style="width: 65%"></colgroup><thead><tr class="header"><th>Subproject Deployed On My System</th><th>Note</th></tr></thead><tbody><tr class="odd"><td><strong>llvm-core</strong></td><td><strong>modern source- and target-independent <a href="http://llvm.org/docs/Passes.html" target="_blank" rel="noopener">optimizer</a>, along with <a href="http://llvm.org/docs/CodeGenerator.html" target="_blank" rel="noopener">code generation support</a> for many popular CPUs</strong></td></tr><tr class="even"><td><strong>Clang</strong></td><td><strong>&quot;LLVM native&quot; C/C++/Objective-C compiler front-end</strong></td></tr><tr class="odd"><td><strong>LLDB</strong></td><td><strong>native debugger</strong></td></tr><tr class="even"><td><strong>LLD</strong></td><td><strong>native linker</strong></td></tr><tr class="odd"><td><strong>libcxx/libcxxabi</strong></td><td><strong>standard conformant and high-performance implementation of the C++ Standard Library,</strong></td></tr><tr class="even"><td><strong>compiler-rt</strong></td><td><strong>highly tuned implementations of the low-level code generator support routines and implementations of run-time libraries</strong></td></tr></tbody></table><h2 id="llvm">llvm</h2><p>ä»¥ä¸Šçš„<code>subproject</code>é€šè¿‡ä»¥ä¸‹ç¼–è¯‘æ–¹å¼å®Œæˆéƒ¨ç½²ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//ought to download source of subprojects to local, besides </span><br><span class="line"><span class="meta">$</span> git clone https://github.com/llvm/llvm-project.git  </span><br><span class="line"><span class="meta">$</span> mkdir /LLVM/llvm-build  &amp;&amp; cd //LLVM/llvm-build</span><br><span class="line"><span class="meta">$</span> cmake -G Ninja -DLLVM_ENABLE_PROJECTS='lldb;clang;compiler-rt;lld;' \    </span><br><span class="line">        -DCMAKE_INSTALL_PREFIX='/LLVM/llvm-install'  \</span><br><span class="line">        ~/where you put llvm-src</span><br><span class="line"><span class="meta">$</span> ninja &amp;&amp; ninja install</span><br><span class="line"><span class="meta">$</span> echo $?   //check</span><br></pre></td></tr></table></figure><h2 id="libcxxlibcxxabi">libcxx/libcxxabi</h2><p>è¿™é‡Œç†æ¸…æ¥šä¸€ä¸ªæ¦‚å¿µï¼š</p><ul><li><code>glic</code>æ˜¯<code>linux</code>æœ€é‡è¦çš„è¿è¡Œåº“ï¼Œå…¶å®ç°æœ€åº•å±‚çš„<code>API</code>ä¾›å…¶ä»–åº“ä½¿ç”¨æ¯”å¦‚<code>malloc/printf</code>ç­‰ã€‚</li><li><code>libstdc++</code>æ˜¯ä¸€ä¸ª<code>C++</code>æ ‡å‡†åº“ï¼Œå¦‚æœè·‘åœ¨<code>linux</code>åˆ™ä¾èµ–<code>Glibc</code></li><li><code>libcxx</code>æ˜¯<code>LLVM</code>ä¸“é—¨å¼€å‘çš„ä¸€ä¸ªä»£æ›¿<code>libstdc++</code>çš„<code>c++</code>æ ‡å‡†åº“</li><li><code>compiler-rt</code>æ˜¯<code>LLVM</code>å¼€å‘æ¥æ›¿ä»£<code>libgcc</code>,ä¸»è¦ç”¨äºä¸ºç¡¬ä»¶ä¸æ”¯æŒçš„ä½çº§åŠŸèƒ½æä¾›ç‰¹å®šäºç›®æ ‡çš„æ”¯æŒ</li></ul><p><code>clang++</code>æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™ä½¿ç”¨<code>libcxx</code>æˆ–è€…<code>libclc</code>(OpenCLè¿è¡Œæ—¶åº“)ã€‚å…¶ä¸­<code>libcxx</code>å®ç°ç”±<strong>åº“æœ¬èº«å’Œä¸€ä¸ªä½çº§å‡½æ•°å±‚<code>libcxxabi</code>ç»„æˆï¼Œè¿™ä¸ªå‡½æ•°å±‚ç”¨æ¥å¤„ç†å¼‚å¸¸å’Œè¿è¡Œæ—¶ç±»å‹ä¿¡æ¯(RTTI)ç­‰åŠŸèƒ½ï¼Œè¿™ç§åˆ†ç¦»å¼è®¾è®¡ä½¿å¾—<code>libcxxabi</code>æ›´å®¹æ˜“ç§»æ¤ã€‚</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> git clone https://github.com/llvm/llvm-project.git</span><br><span class="line"><span class="meta">$</span> cd llvm-project</span><br><span class="line"><span class="meta">$</span> mkdir /LLVM/libcxx-build &amp;&amp; cd /LLVM/libcxx-build</span><br><span class="line"><span class="meta">$</span> cmake -G Ninja -DCMAKE_C_COMPILER=clang \</span><br><span class="line">        -DCMAKE_CXX_COMPILER=clang++ \</span><br><span class="line">        -DLLVM_ENABLE_PROJECTS="libcxx;libcxxabi" \</span><br><span class="line">        -DCMAKE_INSTALL_PREFIX='/LLVM/llvm-install'   \</span><br><span class="line">        ~/where you put libcxx-src</span><br><span class="line"><span class="meta">$</span> make # Build</span><br><span class="line"><span class="meta">$</span> make check-cxx # Test</span><br><span class="line"><span class="meta">$</span> make install-cxx install-cxxabi # Install</span><br></pre></td></tr></table></figure><h2 id="warning">warning</h2><p>å…¶ä¸­<code>llvm</code>å’Œ<code>libcxx</code>æˆ‘æ˜¯åˆ†å¼€ç¼–è¯‘çš„ï¼Œè€Œä¸”<strong>ç¼–è¯‘ç›®å½•å’Œå®‰è£…ç›®å½•éƒ½æ˜¯æŒ‡å®šçš„ç›®å½•ï¼Œé»˜è®¤å¾ˆå¯èƒ½ä¼šå®‰è£…åˆ°ç³»ç»Ÿè·¯å¾„ä¸‹ï¼Œä»è€Œå¸¦æ¥é”™è¯¯ã€‚</strong></p><ul><li><code>~/Document/LLVM9.0.0/</code><ul><li><code>llvm</code> //llvmæºä»£ç </li><li><code>libcxx</code> //libcxxæºä»£ç </li></ul></li><li><code>/LLVM/</code><ul><li><code>llvm-build</code> //llvmç¼–è¯‘è·¯å¾„</li><li><code>llvm-install</code> //llvmå®‰è£…è·¯å¾„</li></ul></li><li><code>/LLVM/</code><ul><li><code>libcxx-build</code> //libcxxç¼–è¯‘è·¯å¾„</li><li><code>libcxx-install</code> //libcxxå®‰è£…è·¯å¾„</li></ul></li></ul><h1 id="features">Features</h1><h2 id="æ ¸å¿ƒè®¾è®¡">æ ¸å¿ƒè®¾è®¡</h2><p><code>LLVM</code>ä¸­æœ€æ ¸å¿ƒçš„å°±æ˜¯<code>LLVM-IR</code> ï¼š</p><ul><li><strong><code>SSA</code>è¡¨ç¤ºå’Œå…è®¸å¿«é€Ÿä¼˜åŒ–çš„æ— é™å¯„å­˜å™¨</strong></li><li><strong>é€šè¿‡å°†æ•´ä¸ªç¨‹åºå­˜å‚¨åœ¨ç£ç›˜IRè¡¨ç¤ºä¸­ï¼Œå®ç°ä¾¿æ·çš„é“¾æ¥æ—¶ä¼˜åŒ–</strong></li></ul><p>å½“ç„¶<code>LLVM</code>ä¸ä»…ä»…åªæœ‰ä¸€ç§ä¸­é—´è¡¨ç¤ºå½¢å¼ï¼š</p><ul><li>å°†<code>C</code>æˆ–<code>C++</code>è½¬æ¢ä¸º<code>LLVM-IR</code>çš„æ—¶å€™ï¼Œ<code>Clang</code>å°†ä½¿ç”¨<strong>æŠ½è±¡è¯­æ³•æ ‘<code>AST</code>ç»“æ„</strong>åœ¨å†…å­˜ä¸­è¡¨ç¤ºç¨‹åº</li><li>å°†<code>LLVM-IR</code>è½¬æ¢ä¸ºç‰¹å®šäºæœºå™¨çš„æ±‡ç¼–è¯­è¨€çš„æ—¶å€™ï¼Œ<code>LLVM</code>é¦–å…ˆå°†ç¨‹åºè½¬æ¢ä¸º<strong>æœ‰å‘æ— ç¯å›¾<code>DAG</code></strong>æ ¼å¼ä»¥ä¾¿è¿›è¡Œ<strong>æŒ‡ä»¤é€‰æ‹©</strong>ï¼Œç„¶åå°†å…¶è½¬æ¢å›<strong>ä¸‰åœ°å€è¡¨ç¤º</strong>ä»¥è¿›è¡Œ<strong>æŒ‡ä»¤è°ƒåº¦</strong></li><li>ä¸ºäº†å®ç°æ±‡ç¼–å™¨å’Œé“¾æ¥å™¨ï¼Œ<code>LLVM</code>ä½¿ç”¨ç¬¬å››ç§ä¸­é—´æ•°æ®ç»“æ„<code>MCModule</code>åœ¨å¯¹è±¡æ–‡ä»¶çš„ä¸Šä¸‹æ–‡ä¸­ä¿å­˜æˆç¨‹åºè¡¨ç¤º</li></ul><p>åœ¨æ•´ä¸ªæ¡†æ¶ä¸­ï¼Œ&quot;åº“&quot;æ˜¯ä¸€ä¸ªå¾ˆæ ¸å¿ƒçš„æ¦‚å¿µã€‚å¾ˆå¤šäºŒè¿›åˆ¶å·¥å…·éƒ½å¯ä»¥ç›´æ¥è°ƒç”¨åº“æ¥å®ç°ã€‚è€Œ<strong>Clangä½œä¸ºç¼–è¯‘é©±åŠ¨ç¨‹åºåˆ™å¯ä»¥é€šè¿‡é“¾æ¥å°å·¥å…·çš„åº“æ¥å®ç°å…¶åŠŸèƒ½â€”â€”ä»£ç é‡ç”¨ã€‚</strong>æ•…<code>clang</code>åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ˜¯æœ€å¤§çš„ï¼Œå› ä¸ºå®ƒé“¾æ¥å¹¶åˆ©ç”¨äº†æ•´ä¸ª<code>LLVM</code>ç”Ÿæ€ç³»ç»Ÿã€‚<strong>è€Œå¼€å‘è€…ä¸€èˆ¬éƒ½æ˜¯å°†LLVMå„ä¸ªç»„ä»¶çœ‹å‡ºæ˜¯åº“ã€‚</strong></p><p><img src="2.png" width="50%" height="50%" alt=""></p><h2 id="ç¼–è¯‘æµç¨‹">ç¼–è¯‘æµç¨‹</h2><h3 id="clang">clang</h3><p><code>clang</code>ä½œä¸ºç¼–è¯‘å™¨é©±åŠ¨ç¨‹åºéšå¼çš„è°ƒç”¨ä»å‰ç«¯åˆ°é“¾æ¥å™¨çš„æ‰€æœ‰å·¥å…·ã€‚<strong>æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯åœ¨å†…å­˜ä¸­å®Œæˆçš„ï¼Œå¹¶ä¸ä¼šå°†ä¸­é—´æ–‡ä»¶è¾“å‡ºåˆ°ç£ç›˜ä¸­ã€‚</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> clang hello.c -o hello</span><br><span class="line"><span class="meta">$</span> clang -### hello.c -o hello          //å¯ä»¥æŸ¥çœ‹é©±åŠ¨ç¨‹åºè°ƒç”¨çš„æ‰€æœ‰å·¥å…·</span><br></pre></td></tr></table></figure><h3 id="ç‹¬ç«‹å·¥å…·">ç‹¬ç«‹å·¥å…·</h3><p><code>LLVM</code>ç‹¬ç«‹å·¥å…·ä¼šå°†ä¸­é—´æ–‡ä»¶è¾“å‡ºåˆ°ç£ç›˜ä¸Šã€‚</p><table><colgroup><col style="width: 15%"><col style="width: 84%"></colgroup><thead><tr class="header"><th>Tools</th><th>Notes</th></tr></thead><tbody><tr class="odd"><td><code>opt</code></td><td><strong>åœ¨IRçº§åˆ«å¯¹ç¨‹åºè¿›è¡Œä¼˜åŒ–çš„å·¥å…·ï¼Œè¾“å…¥å¿…é¡»æ˜¯LLVMä½ç æ–‡ä»¶(ç¼–ç çš„LLVM-IR)ï¼Œå¹¶ä¸”ç”Ÿæˆçš„è¾“å‡ºæ–‡ä»¶å¿…é¡»å…·æœ‰ç›¸åŒçš„ç±»å‹</strong></td></tr><tr class="even"><td><code>llc</code></td><td><strong>é€šè¿‡ç‰¹å®šåç«¯å°†LLVMä½ç è½¬æ¢ä¸ºç›®æ ‡æœºå™¨æ±‡ç¼–è¯­è¨€æ–‡ä»¶æˆ–ç›®æ ‡æ–‡ä»¶çš„å·¥å…·ï¼Œå¯ä»¥é€šè¿‡ä¼ é€’å‚æ•°æ¥é€‰æ‹©ä¼˜åŒ–çº§åˆ«ï¼Œæ‰“å¼€è°ƒè¯•é€‰é¡¹ä»¥åŠå¯ç”¨æˆ–ç¦ç”¨ç‰¹å®šä¸ç›®æ ‡çš„ä¼˜åŒ–</strong></td></tr><tr class="odd"><td><code>llvm-mc</code></td><td><strong>èƒ½å¤Ÿæ±‡ç¼–æŒ‡ä»¤å¹¶ç”Ÿæˆè¯¸å¦‚<code>ELF</code>,<code>Mach-O</code>,<code>PE</code>ç­‰å¯¹é¦™æ ¼å¼çš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åæ±‡ç¼–ç›¸åŒçš„å¯¹è±¡ï¼Œä»è€Œè½¬å‚¨è¿™äº›æŒ‡ä»¤çš„æ±‡ç¼–ä¿¡æ¯å’Œå†…éƒ¨<code>LLVM</code>æœºå™¨æŒ‡ä»¤æ•°æ®ç»“æ„</strong></td></tr><tr class="even"><td><code>lli</code></td><td><strong>æ˜¯<code>LLVM IP</code>çš„è§£é‡Šå™¨å’Œ<code>JIT</code>ç¼–è¯‘å™¨</strong></td></tr><tr class="odd"><td><code>llvm-link</code></td><td><strong>å°†å‡ ä¸ª<code>LLVM</code>ä½ç é“¾æ¥åœ¨ä¸€èµ·ï¼Œä»¥äº§ç”Ÿä¸€ä¸ªåŒ…å«æ‰€æœ‰è¾“å…¥çš„<code>LLVM</code>ä½ç </strong></td></tr><tr class="even"><td><code>llvm-as</code></td><td><strong>å°†äººå·¥å¯è¯»çš„<code>LLVM-IR</code>æ–‡ä»¶(ç§°ä¸º<code>LLVM</code>æ±‡ç¼–ç )è½¬æ¢ä¸º<code>LLVM</code>ä½ç </strong></td></tr><tr class="odd"><td><code>llvm-dis</code></td><td><strong>å°†<code>LLVM</code>ä½ç è§£ç æˆä¸º<code>LLVM</code>æ±‡ç¼–ç </strong></td></tr></tbody></table><h4 id="emit-llvm"><code>-emit-llvm</code></h4><ul><li><strong>LLVMä½ç </strong>ï¼š ç¼–ç çš„<code>LLVM-IR</code></li><li><strong>LLVMæ±‡ç¼–ç </strong>ï¼š äººå·¥å¯è¯»çš„<code>LLVM-IR</code></li></ul><p>å‡è®¾<code>main.c</code>å’Œ<code>sum.c</code>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ vim main.c</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line">  </span><br><span class="line"><span class="keyword">int</span> </span><br><span class="line">main(<span class="keyword">void</span>) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">int</span> r = sum(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"r = %d\n"</span>, r);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ vim sum.c</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (x + y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœç›´æ¥ä½¿ç”¨<strong>ç¼–è¯‘å™¨é©±åŠ¨ç¨‹åº<code>Clang</code></strong>çš„è¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> clang main.c sum.c -o sum</span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨ç‹¬ç«‹å·¥å…·çš„è¯:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> clang -emit-llvm -c main.c -o main.bc</span><br><span class="line"><span class="meta">$</span> clang -emit-llvm -c sum.c -o sum.bc</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>-emit-llvm</code>ç¼–è¯‘é€‰é¡¹å¯ä»¥è®©<code>clang</code>æ ¹æ®<code>-c</code>æˆ–è€…<code>-S</code>å‚æ•°æ¥ç”Ÿæˆ<strong><code>LLVM</code>ä½ç </strong>è¿˜æ˜¯<strong><code>LLVM</code>æ±‡ç¼–ç </strong>ã€‚</p><ul><li><code>-c</code> ç”ŸæˆLLVMä½ç </li><li><code>-c -S</code>ç”ŸæˆLLVMæ±‡ç¼–ç </li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> clang -emit-llvm -c -S main.c -o main.ll</span><br><span class="line"><span class="meta">$</span> clang -emit-llvm -c -S sum.c -o sum.ll</span><br></pre></td></tr></table></figure><h4 id="llc">llc</h4><p>è¯¥å·¥å…·ä»æ¯ä¸ªLLVMä½ç æ–‡ä»¶å†…ç”Ÿæˆç‰¹å®šäºç›®æ ‡çš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ï¼Œå¹¶é€šè¿‡å°†å…¶é“¾æ¥åˆ°ç³»ç»Ÿé“¾æ¥å™¨æ¥æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> llc -filetype=obj main.bc -o main.o</span><br><span class="line"><span class="meta">$</span> llc -filetype= obj sum.bc -o sum.o</span><br><span class="line"><span class="meta">$</span> clang main.o sum.o -o sum</span><br></pre></td></tr></table></figure><h4 id="llvm-link">llvm-link</h4><p>è¯¥å·¥å…·å°†å¤šä¸ªLLVMä½ç æ–‡ä»¶è¿æ¥æˆä¸ºæœ€ç»ˆçš„LLVMä½ç æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> llvm-link main.bc sum.bc -o sum.linked.bc</span><br><span class="line"><span class="meta">$</span> llc -filetype=obj sum.linked.bc -o sum.linked.o</span><br><span class="line"><span class="meta">$</span> clang sum.linked.o -o sum</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„äºŒè¿›åˆ¶å·¥å…·éƒ½å›´ç»•å‡ ä¸ªä¸­é—´å½¢å¼çš„è¡¨ç¤ºå±•å¼€ï¼Œè¿™äº›ä¸­é—´è¡¨ç¤ºåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å å¾ˆé‡è¦çš„ä½œç”¨ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;abstract&quot;&gt;Abstract&lt;/h1&gt;
&lt;p&gt;&lt;strong&gt;LLVM&lt;/strong&gt;ï¼Œè¿™ä¸ªæ˜Ÿçƒæœ€ç‰›é€¼çš„ç¼–è¯‘å™¨ã€‚&lt;/p&gt;
&lt;p&gt;å…¶æ ¸å¿ƒè®¾è®¡ç†å¿µå°±æ˜¯&lt;strong&gt;ç»Ÿä¸€çš„åº•å±‚ä¸­é—´è¡¨è¾¾ä»¥åŠæ¨¡å—åŒ–çš„è½¯ä»¶å·¥ç¨‹åŒ–æ–¹æ³•ã€‚&lt;/strong&gt;LLVMé‡‡ç”¨äº†&lt;code&gt;å‰ç«¯-ä¼˜åŒ–å™¨-åç«¯&lt;/code&gt;çš„ç»„ç»‡å½¢å¼ï¼Œ&lt;strong&gt;åªæ˜¯ä¸åŒçš„å‰ç«¯å’Œåç«¯éƒ½é‡‡ç”¨ç»Ÿä¸€çš„åº•å±‚ä¸­é—´è¡¨ç¤ºæ ¼å¼ï¼ˆLLVM IRï¼‰æ¥æœ€å¤§å¯èƒ½å¤ç”¨ä¼˜åŒ–å™¨çš„ä»£ç ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;åœ¨&lt;a href=&quot;http://nondot.org/sabre/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Chris Lattner&lt;/a&gt;å°†å…¶å¼€æºåï¼Œ&lt;a href=&quot;http://llvm.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;LLVM&lt;/a&gt;é€æ¸å‘å±•æˆä¸ºäº†æˆç†Ÿçš„ç¼–è¯‘æ¡†æ¶ï¼Œå…·æœ‰å¤§é‡åº“å’Œç¼–è¯‘é“¾å·¥å…·ã€‚&lt;/p&gt;
&lt;p&gt;æˆ‘ä½¿ç”¨çš„å¹³å°æ˜¯&lt;code&gt;macOS Mojave 10.14&lt;/code&gt;ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™è¦æ³¨æ„ç‰ˆæœ¬æ˜¯å¦å…¼å®¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ä¸€èˆ¬ç³»ç»Ÿä¼šé€šè¿‡æ‰“å°äºŒè¿›åˆ¶æ–‡ä»¶åç§°å’Œæ— æ³•åŠ è½½çš„åŠ¨æ€åº“çš„åç§°æ¥å‘ç°é“¾æ¥é”™è¯¯ã€‚å½“å±å¹•ä¸Šæ‰“å°åŠ¨æ€åº“åç§°æ—¶è¦äºˆä»¥æ³¨æ„ï¼Œè¿™è¯´æ˜ç³»ç»ŸåŠ¨æ€é“¾æ¥å™¨å’ŒåŠ è½½å™¨æ— æ³•åŠ è½½è¯¥åº“ï¼Œå› ä¸ºè¯¥ç¨‹åºä¸å½“å‰ç³»ç»Ÿä¸å…¼å®¹ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æˆ‘ç¼–è¯‘&lt;code&gt;LLVM 10.0.0&lt;/code&gt;çš„æ—¶å€™å‡ºé”™å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;1.png&quot; width=&quot;50%&quot; height=&quot;50%&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;åæ¥å‘ç°è¿™ä¸ªç‰ˆæœ¬çš„&lt;code&gt;Xcode&lt;/code&gt;å·¥å…·é“¾æœ€é«˜åªæ”¯æŒ&lt;code&gt;LLVM 9.0.0&lt;/code&gt;ç‰ˆæœ¬ï¼Œç„¶åæ¢äº†ç‰ˆæœ¬æœ€åç¼–è¯‘æˆåŠŸã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="C++" scheme="http://haotianmcihael.github.io/categories/C/"/>
    
    
      <category term="Compiler" scheme="http://haotianmcihael.github.io/tags/Compiler/"/>
    
      <category term="LLVM" scheme="http://haotianmcihael.github.io/tags/LLVM/"/>
    
  </entry>
  
  <entry>
    <title>LLVMæ¼«è°ˆï¼ˆ0-ç¼–è¯‘ç³»ç»Ÿæ¦‚è¿°ï¼‰</title>
    <link href="http://haotianmcihael.github.io/2020/06/02/LLVM%E6%BC%AB%E8%B0%88%EF%BC%880-%E7%BC%96%E8%AF%91%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%EF%BC%89/"/>
    <id>http://haotianmcihael.github.io/2020/06/02/LLVMæ¼«è°ˆï¼ˆ0-ç¼–è¯‘ç³»ç»Ÿæ¦‚è¿°ï¼‰/</id>
    <published>2020-06-01T20:36:42.000Z</published>
    <updated>2022-03-16T10:28:29.613Z</updated>
    
    <content type="html"><![CDATA[<h1 id="abstract">Abstract</h1><p>ä»å¼€å§‹æ¥è§¦ç¼–è¯‘ç³»ç»Ÿçš„å­¦ä¹ å·²ç»å¿«åŠå¹´äº†ï¼Œæœ‰äº›å¿ƒå¾—æ€»ç»“ä¸€ä¸‹ã€‚</p><p>ä»€ä¹ˆæ˜¯ç¼–è¯‘ç³»ç»Ÿï¼Ÿæˆ‘æƒ³ä»ä¸¤ä¸ªè§’åº¦è°ˆä¸€ä¸‹ï¼š</p><p>é¦–å…ˆä»æŠ€æœ¯è§’åº¦æ¥è®²ï¼Œå¹¿ä¹‰çš„ç¼–è¯‘ç³»ç»Ÿè´Ÿè´£å°†é«˜çº§è¯­è¨€è½¬æ¢æˆä¸ºCPUå¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æœºå™¨ä»£ç ã€‚ç¼–è¯‘ç³»ç»ŸåŒ…æ‹¬<strong>ç¼–è¯‘å™¨</strong>ï¼Œ <strong>æ±‡ç¼–å™¨</strong>ï¼Œ<strong>é™æ€/åŠ¨æ€é“¾æ¥å™¨</strong>ï¼Œ<strong>æ“ä½œç³»ç»Ÿè£…è½½å™¨</strong>ä»¥åŠ<strong>è¿è¡Œåº“</strong>ã€‚</p><ul><li>ç¼–è¯‘å™¨ï¼š æ˜¯ç³»ç»Ÿå‰åŠéƒ¨åˆ†çš„æ ¸å¿ƒï¼Œè´Ÿè´£å°†æºæ–‡ä»¶<strong>.c</strong>è½¬æ¢æˆä¸ºæ±‡ç¼–æ–‡ä»¶<strong>.s</strong>ã€‚</li><li>æ±‡ç¼–/é“¾æ¥/è£…è½½å™¨ï¼šæ˜¯ç³»ç»ŸååŠéƒ¨åˆ†çš„æ ¸å¿ƒï¼Œä¸»è¦æ˜¯å°†<strong>.s</strong>è½¬æ¢ä¸º<strong>äºŒè¿›åˆ¶ELFæ–‡ä»¶</strong>å¹¶è¿›ä¸€æ­¥å›´ç»•<strong>ELF</strong>å¤„ç†ã€‚</li><li>è¿è¡Œåº“ï¼šæ˜¯æ“ä½œç³»ç»Ÿå±‚é¢ç”¨æ¥æ”¯æŒ<strong>é«˜çº§è¯­è¨€è¿è¡Œç¯å¢ƒ</strong>æ¯”å¦‚å†…å­˜æ± ï¼Œæ ‡å‡†APIç­‰çš„åº“æ–‡ä»¶ã€‚</li></ul><p>ç„¶åä»ä¸“ä¸šçš„è§’åº¦æ¥è®²ï¼Œæˆ‘è§‰å¾—å¯ä»¥åˆ†ä¸º<strong>ç³»ç»Ÿå±‚é¢</strong>å’Œ<strong>ç®—æ³•ä¼˜åŒ–å±‚é¢</strong>ï¼Œç³»ç»Ÿå±‚é¢ä¸»è¦æ˜¯æ•´ä¸ªç¼–è¯‘æ¡†æ¶æ¯”å¦‚LLVMï¼Œæ ¸å¿ƒæ˜¯å’Œæ“ä½œç³»ç»Ÿäº¤äº’çš„éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†å†…å®¹æ˜¯ç¼–è¯‘å™¨å·¥ç¨‹å¸ˆçš„åŸºæœ¬åŠŸï¼Œéœ€è¦æŒæ¡ç»†èŠ‚ã€‚è€Œç®—æ³•ä¼˜åŒ–å±‚é¢æŒ‡çš„æ˜¯<strong>ç¼–è¯‘ä¼˜åŒ–</strong>â€”â€”ç¼–è¯‘å™¨å·¥ç¨‹å¸ˆçš„æœ€ç†æƒ³çš„æ–¹å‘å°±æ˜¯åšä¼˜åŒ–ï¼Œè¿™ä¸€éƒ¨åˆ†éœ€è¦ç²¾é€šï¼Œä»é™æ€å•èµ‹å€¼SSAç­‰ä¼ ç»Ÿçš„é™æ€åˆ†æä¼˜åŒ–åˆ°ç°åœ¨ä¸»æµçš„æ·±åº¦å­¦ä¹ æ¨ç†å¼•æ“æ¯”å¦‚TVMç­‰ã€‚</p><p>æœ¬æ–‡ä¸»è¦æ˜¯å¯¹ç³»ç»Ÿå±‚é¢çš„å­¦ä¹ ï¼Œå¯¹ç³»ç»Ÿå±‚é¢çš„å­¦ä¹ æ­¢æ­¥äºå¯¹LLVMç¼–è¯‘æ¡†æ¶çš„ä½¿ç”¨å’Œæºä»£ç é˜…è¯»ã€‚</p><a id="more"></a><h1 id="æ€è·¯">æ€è·¯</h1><p>æœ¬æ–‡ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œç¼–è¯‘ï¼ŒELFä»¥åŠåº“æ–‡ä»¶ã€‚</p><p>é¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ç¼–è¯‘å™¨çš„æ•´ä½“æ¡†æ¶å’Œç¼–è¯‘æµç¨‹ã€‚</p><p>**æ ¸å¿ƒéƒ¨åˆ†æ˜¯å­¦ä¹ *nixæ“ä½œç³»ç»Ÿä¸‹çš„ELFæ–‡ä»¶çš„æ ¼å¼â€”â€”æ™®é€šc/c++é«˜çº§ç¨‹åºåœ¨ç›®æ ‡æ–‡ä»¶ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼›ç›®æ ‡æ–‡ä»¶æ˜¯å¦‚ä½•è¢«é“¾æ¥å™¨é“¾æ¥åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å½¢æˆå¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ã€‚ç›®æ ‡æ–‡ä»¶åœ¨é“¾æ¥æ—¶ç¬¦å·å¤„ç†ï¼Œé‡å®šä½å’Œåœ°å€åˆ†é…å¦‚ä½•è¿›è¡Œã€‚å¯æ‰§è¡Œæ–‡ä»¶å¦‚ä½•è¢«è£…è½½å¹¶ä¸”æ‰§è¡Œï¼Œå¯æ‰§è¡Œæ–‡ä»¶ä¸è¿›ç¨‹çš„è™šæ‹Ÿç©ºé—´ä¹‹é—´å¦‚ä½•æ˜ å°„ã€‚è®²è§£åŠ¨æ€é“¾æ¥ã€‚ **</p><p>æœ€åè®²è§£ä¸€ä¸‹è¿è¡Œåº“çš„åŸç†å’Œæ“ä½œç³»ç»Ÿä¸ç¼–è¯‘ç³»ç»Ÿäº¤äº’çš„éƒ¨åˆ†ã€‚</p><h1 id="ç¼–è¯‘å™¨">ç¼–è¯‘å™¨</h1><p>ç¼–è¯‘å™¨åˆ†ä¸ºå‰ç«¯å’Œåç«¯ï¼Œç›´è§‚ä¸Šè®²<strong>å°±æ˜¯å°†æºè¯­è¨€å½¢å¼åŒ–çš„è¡¨ç¤ºå¹¶ç¿»è¯‘æˆä¸ºæ±‡ç¼–ç›®æ ‡è¯­è¨€</strong>ã€‚å‰ç«¯ä¸»è¦æœ‰ï¼š</p><ul><li><p><strong>è¯æ³•åˆ†æå™¨</strong></p></li><li><strong>è¯­æ³•åˆ†æå™¨</strong>ï¼Œ</li><li><p><strong>è¯­ä¹‰åˆ†æå™¨</strong></p></li></ul><p>ç­‰å®Œæˆæºè¯­è¨€çš„è¯­æ³•æ¨å¯¼ï¼Œè¯­ä¹‰å¤„ç†ï¼Œç„¶åå°†ç‰¹å®šä¿¡æ¯æ”¶é›†åˆ°ç¬¦å·è¡¨ä¸­ï¼Œä¸åŒçš„ç¼–è¯‘å™¨å‰ç«¯ä¼šç”Ÿæˆä¸åŒçš„<strong>ä¸­é—´è¡¨ç¤º</strong>â€”â€”æ¯”å¦‚<strong>LLVM IR</strong>å°±æ˜¯ä¸€ç§éå¸¸é‡è¦çš„ä¸­é—´ä»£ç ã€‚</p><p>åç«¯ä¸»è¦æ˜¯ï¼š</p><ul><li><p><strong>å¯„å­˜å™¨åˆ†é…</strong></p></li><li><p><strong>æŒ‡ä»¤é€‰æ‹©</strong></p></li><li><p><strong>æŒ‡ä»¤è°ƒåº¦</strong></p></li></ul><p><strong>åç«¯å’Œç›®æ ‡æœºçš„å…³ç³»æ¯”è¾ƒç´§å¯†ï¼Œä¹Ÿæ˜¯ä¼˜åŒ–çš„é‡ç‚¹å¹³å°ã€‚ </strong></p><h1 id="æ±‡ç¼–å™¨">æ±‡ç¼–å™¨</h1><p>å½“ç¼–è¯‘å™¨å°†æºæ–‡ä»¶ç¿»è¯‘æˆä¸ºæ±‡ç¼–è¯­è¨€ä¹‹åï¼Œ<strong>.s</strong>æ–‡ä»¶éœ€è¦è¿›ä¸€æ­¥çš„è¢«<strong>æ±‡ç¼–å™¨</strong>è¿›è¡Œè½¬æ¢æˆä¸º<strong>å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ï¼ˆRelocatable Fileï¼‰</strong>ã€‚</p><p>å› ä¸ºæ±‡ç¼–è¯­è¨€æœ¬è´¨ä¸Šå°±æ˜¯åŠ©è®°ç¬¦ï¼Œ<strong>æ±‡ç¼–å™¨å°±æ˜¯å°†æ±‡ç¼–æ–‡ä»¶ç¿»è¯‘æˆä¸ºæœºå™¨å¯æ‰§è¡Œçš„åˆæ­¥çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™é‡Œçš„åˆæ­¥æ˜¯æ±‡ç¼–å™¨æ±‡ç¼–ä¹‹åç”Ÿæˆçš„.oæ–‡ä»¶è¿˜ä¸èƒ½ç›´æ¥åœ¨æ“ä½œç³»ç»Ÿä¸­è¿è¡Œï¼Œè¿™æ˜¯å› ä¸º.oæ–‡ä»¶ä¸­å¾ˆå¤šç¬¦å·å’Œå˜é‡çš„åœ°å€éƒ½æ²¡æœ‰ç¡®å®šâ€”â€”å±äºç›¸å¯¹åœ°å€ï¼Œæ‰€ä»¥æ— æ³•åŠ è½½åˆ°è¿›ç¨‹åœ°å€ç©ºé—´ä¸­ï¼Œè€Œä¸”å…¶è¿è¡Œè¿˜éœ€è¦æ“ä½œç³»ç»Ÿæä¾›çš„è¿è¡Œåº“æä¾›æ”¯æŒï¼Œè¿™ä¸€åˆ‡éƒ½éœ€è¦é“¾æ¥å™¨æ¥å®Œæˆã€‚æ‰€ä»¥.oæ–‡ä»¶åˆç§°ä¸ºå¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ã€‚</strong></p><p>ä»<strong>.s</strong>æ–‡ä»¶ç¿»è¯‘æˆä¸º<strong>.o</strong>æ–‡ä»¶ï¼Œå¿…é¡»æŒ‰ç…§ç‰¹å®šæŒ‡ä»¤é›†çš„æœºå™¨ç ï¼Œè¿˜æœ‰ELFæ–‡ä»¶çš„æ ¼å¼æ¥è½¬æ¢ï¼Œå®ç°èµ·æ¥ä¸æ˜¯å¾ˆéš¾â€”â€”<strong>éœ€è¦ç²¾é€šç›®æ ‡æœºå™¨çš„ä½“ç³»ç»“æ„ï¼Œä»¥åŠç›®æ ‡æœºå™¨çš„ELFæ–‡ä»¶æ ¼å¼</strong>ã€‚è¿™é‡Œä¸æ¶‰åŠä½“ç³»ç»“æ„çš„çŸ¥è¯†ã€‚</p><h1 id="elf">ELF</h1><h2 id="elfç®€ä»‹">ELFç®€ä»‹</h2><p>å…¶å®ä»æ±‡ç¼–å™¨çš„å®ç°ä¸­å°±å·²ç»ç”¨åˆ°äº†ELFçš„çŸ¥è¯†ã€‚</p><p>ELFå¯ä»¥è¯´æ˜¯ç¼–è¯‘ç³»ç»Ÿå·¥å…·é“¾ä¸­çš„æœ€é‡è¦çš„æ–‡ä»¶æ ¼å¼äº†ï¼Œç¦»å¼€ç¼–è¯‘å™¨ä¹‹åçš„æ‰€æœ‰ç¼–è¯‘æ­¥éª¤å‡ ä¹éƒ½å’ŒELFç›¸å…³æˆ–è€…å›´ç»•ELFå±•å¼€ï¼Œæ‰€ä»¥å¯¹å®ƒçš„ç ”ç©¶éå¸¸æœ‰æ„ä¹‰ã€‚</p><p>æœ€æ—©æ˜¯ç”±Unix System V Release3æå‡ºäº†COFFçš„æ¦‚å¿µä»¥åŠä½¿ç”¨è§„èŒƒã€‚åæ¥WindowsåŸºäºCOFFæŒ‡å®šäº†PEæ ¼å¼æ ‡å‡†ï¼Œè€ŒLinuxä¹Ÿä»¥ELFä½œä¸ºåŸºæœ¬æ ¼å¼ã€‚COFFçš„ä¸»è¦è´¡çŒ®å°±æ˜¯æä¾›äº†â€œæ®µsegmentâ€çš„æ¦‚å¿µã€‚</p><h2 id="elfç±»å‹">ELFç±»å‹</h2><p>æ ¹æ®ELFæ–‡ä»¶æ ‡å‡†ï¼Œå¯ä»¥åˆ†ä¸ºä¸‹é¢4ç±»ï¼š</p><table><colgroup><col style="width: 24%"><col style="width: 37%"><col style="width: 37%"></colgroup><thead><tr class="header"><th>ELFæ–‡ä»¶ç±»å‹</th><th>è¯´æ˜</th><th>å®ä¾‹</th></tr></thead><tbody><tr class="odd"><td><strong>å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶(Relocatable File)</strong></td><td>ç”±æ±‡ç¼–å™¨ç”Ÿæˆçš„.oæ–‡ä»¶ï¼Œåˆè¢«ç§°ä¸º<strong>ç›®æ ‡æ–‡ä»¶</strong>ï¼Œå› ä¸ºéœ€è¦è¿æ¥é‡å®šä½å…¶æ–‡ä»¶ä¸­çš„ç¬¦å·åœ°å€æ‰€ä»¥å«Relocatableï¼›å¦å¤–ï¼Œ<strong>é™æ€é“¾æ¥åº“.aå…¶å®ä¹Ÿæ˜¯ä½¿ç”¨arç¨‹åºå°†å¾ˆå¤š.oæ–‡ä»¶å‹ç¼©å¹¶å¯¹å…¶è¿›è¡Œç´¢å¼•å’Œç¼–å·ã€‚æ‰€ä»¥ä¹Ÿç®—æ­¤ç±»å‹ã€‚</strong></td><td>Linuxä¸‹çš„.oæ–‡ä»¶ï¼Œ.aé™æ€åº“æ–‡ä»¶ï¼›Windowsä¸‹çš„.objï¼Œ.libé™æ€åº“æ–‡ä»¶</td></tr><tr class="even"><td><strong>å¯æ‰§è¡Œæ–‡ä»¶(Executable File)</strong></td><td>æ˜¯å¯ä»¥ç›´æ¥æ‰§è¡Œçš„ç¨‹åºï¼Œåˆè¢«ç§°ä¸º<strong>å¯æ‰§è¡Œæ–‡ä»¶</strong>ã€‚</td><td>/usr/bashæ–‡ä»¶ï¼›Windowsä¸‹çš„.exe</td></tr><tr class="odd"><td><strong>å…±äº«ç›®æ ‡æ–‡ä»¶(Shared Object File)</strong></td><td><strong>å…±äº«</strong>å°±æ˜¯åŠ¨æ€é“¾æ¥çš„æœ¬è´¨ã€‚å…¶å¯ä»¥è¢«é“¾æ¥å™¨ç»§ç»­é“¾æ¥ç”Ÿæˆæ–°çš„ç›®æ ‡æ–‡ä»¶ï¼›ä¹Ÿå¯ä»¥å’Œå¯æ‰§è¡Œæ–‡ä»¶ç»“åˆï¼Œä½œä¸ºè¿›ç¨‹æ˜ åƒçš„ä¸€éƒ¨åˆ†æ¥è¿è¡Œã€‚</td><td>Linuxä¸‹çš„.soï¼›Windowsä¸‹çš„DLL</td></tr><tr class="even"><td><strong>æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶(Core Dump File)</strong></td><td>å½“è¿›ç¨‹æ„å¤–ç»ˆæ­¢çš„æ—¶å€™ï¼Œç³»ç»Ÿå¯ä»¥å°†è¯¥è¿›ç¨‹çš„åœ°å€ç©ºé—´åŠç»ˆæ­¢æ—¶çš„ä¸€äº›å…¶ä»–ä¿¡æ¯è½¬å‚¨åˆ°æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ä¸­ã€‚</td><td>Linuxä¸‹çš„core dump</td></tr></tbody></table><h2 id="elfæ ¼å¼">ELFæ ¼å¼</h2><h3 id="åˆ†æ®µ">åˆ†æ®µ</h3><p>ä»¥ç›®æ ‡æ–‡ä»¶<strong>.o</strong>ä¸ºä¾‹ä»‹ç»ï¼Œç›®æ ‡æ–‡ä»¶ä¸­çš„å†…å®¹è‡³å°‘å«æœ‰ç¼–è¯‘åçš„æœºå™¨æŒ‡ä»¤<strong>ä»£ç å’Œæ•°æ®</strong>ã€‚æŒ‰ç…§COFFçš„å†å²è§„å®šï¼ŒELFæ ¼å¼ä¹Ÿæ˜¯æŒ‰ç…§<strong>æ®µ-segment</strong>æ¥ç®¡ç†çš„ã€‚ä¸‹é¢æ˜¯ELFæ–‡ä»¶çš„åŸºæœ¬æ ¼å¼ï¼š</p><p><img src="1.png" width="50%" height="50%" alt=""></p><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒELFçš„å¼€å¤´æ˜¯<strong>ELF Header</strong>ï¼Œæè¿°äº†æ•´ä¸ªæ–‡ä»¶çš„æ–‡ä»¶å±æ€§ï¼ŒåŒ…æ‹¬æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œï¼Œæ˜¯é™æ€é“¾æ¥è¿˜æ˜¯åŠ¨æ€é“¾æ¥åŠå…¥å£åœ°å€ï¼ˆå¦‚æœæ˜¯å¯æ‰§è¡Œæ–‡ä»¶çš„è¯ï¼‰ï¼Œç›®æ ‡ç¡¬ä»¶ï¼Œæ“ä½œç³»ç»Ÿç­‰ä¿¡æ¯ã€‚ELFä¸­ç¬¬äºŒé‡è¦çš„æ•°æ®ç»“æ„æ˜¯<strong>Section Header table</strong>â€”â€”æè¿°æ–‡ä»¶ä¸­å„ä¸ªæ®µçš„æ•°ç»„ã€‚æ®µè¡¨æè¿°äº†æ–‡ä»¶ä¸­å„ä¸ªæ®µåœ¨æ–‡ä»¶ä¸­çš„åç§»é‡ä»¥åŠæ®µçš„å±æ€§ç­‰ï¼Œä»å…¶ä¸­å¯ä»¥å¾—åˆ°æ¯ä¸ªæ®µçš„æ‰€æœ‰ä¿¡æ¯ã€‚<strong>ELF Header</strong>åé¢å°±æ˜¯å„ä¸ªæ®µçš„å†…å®¹ã€‚åˆ†æ®µçš„ç›®çš„å¦‚ä¸‹ï¼š</p><ul><li>å½“æŒ‡ä»¤å’Œæ•°æ®åˆ†ç¦»çš„æ—¶å€™ï¼Œ<strong>æ“ä½œç³»ç»Ÿå¯ä»¥åˆ†é…ä¸åŒçš„è¯»å†™æƒé™ä¾¿äºç®¡ç†</strong></li><li>å½“æŒ‡ä»¤å’Œæ•°æ®åˆ†ç¦»çš„æ—¶å€™ï¼Œ<strong>CPUç¼“å­˜çš„å‘½ä¸­ç‡ä¼šæ›´é«˜</strong></li><li>å½“æŒ‡ä»¤å’Œæ•°æ®åˆ†ç¦»çš„æ—¶å€™ï¼Œ<strong>å¤šä¸ªè¿›ç¨‹å¯ä»¥å…±äº«åŒä¸€ä»½æŒ‡ä»¤ï¼ŒèŠ‚çœå¼€é”€</strong></li></ul><h3 id="elf-header">ELF Header</h3><p>æ˜¯ELFæ–‡ä»¶æœ€å¼€å¤´çš„ä¸€ä¸ªç»“æ„ä½“ã€‚å®ƒåŒ…å«äº†æè¿°æ•´ä¸ªæ–‡ä»¶çš„åŸºæœ¬å±æ€§ã€‚å› ä¸ºELFæ–‡ä»¶åœ¨å„ä¸ªå¹³å°ä¸‹éƒ½é€šç”¨ï¼Œä¸ºäº†å¯¹æ¯ä¸ªæˆå‘˜çš„å¤§å°åšå‡ºæ˜ç¡®çš„è§„å®šä»¥ä¾¿ä¿æŒå…¼å®¹æ€§ã€‚ELFä½¿ç”¨typedefå®šä¹‰äº†ä¸€å¥—è‡ªå·±çš„å˜é‡ä½“ç³»ç±»ä¼¼<code>Elf32_Addr</code>è¿™ç§ã€‚ä¸‹é¢ç®€å•åˆ—å‡ºæ–‡ä»¶å¤´ä¸­çš„å…³é”®ä¿¡æ¯ï¼š</p><ul><li>ELFé­”æ•°ï¼Œæ–‡ä»¶æœºå™¨å­—èŠ‚é•¿åº¦ï¼Œæ•°æ®å­˜å‚¨æ–¹å¼ï¼Œç‰ˆæœ¬ï¼Œè¿è¡Œå¹³å°ï¼Œ</li><li>ABIç‰ˆæœ¬ï¼ŒELFé‡å®šä½ç±»å‹ï¼Œç¡¬ä»¶å¹³å°ï¼Œ<strong>å…¥å£åœ°å€ï¼ˆOSåŠ è½½çš„è™šæ‹Ÿåœ°å€ï¼Œå¯é‡å®šä½ç›®æ ‡æ–‡ä»¶è¯¥å€¼ä¸º0ï¼‰</strong>ï¼Œç¨‹åºå¤´å…¥å£å’Œé•¿åº¦ï¼Œ</li><li><strong>Section Header tableçš„ä½ç½®ï¼ˆä»¥åç§»é‡çš„æ–¹å¼ï¼‰</strong>å’Œé•¿åº¦åŠæ®µçš„æ•°é‡</li></ul><p>é­”æ•°ï¼šå½“å¹´çš„UNIXæ˜¯åœ¨PDPå°å‹æœºå™¨ä¸Šå¼€å‘çš„ï¼Œè€Œå½“æ—¶çš„ç³»ç»ŸåŠ è½½å¯æ‰§è¡Œæ–‡ä»¶ç›´æ¥ä»ç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹è¿è¡Œï¼Œäººä»¬ä¸€èˆ¬å°†ç¬¬ä¸€æ¡æŒ‡ä»¤è®¾ç½®ä¸ºè·³è½¬æŒ‡ä»¤ï¼Œè¿™ä¸ªé­”æ•°å°±æ˜¯å½“æ—¶çš„JMPæŒ‡ä»¤ï¼Œä¸ºäº†å…¼å®¹æ€§è¢«ä¿ç•™ä¸‹æ¥ã€‚</p><h3 id="section-header-table">Section Header table</h3><p>æ®µè¡¨æè¿°äº†ELFçš„å„ä¸ªæ®µsegmentçš„ä¿¡æ¯æ¯”å¦‚æ®µåï¼Œæ®µé•¿åº¦ï¼Œæ®µåç§»ä»¥åŠæ®µçš„è¯»å†™æƒé™ç­‰ã€‚ å®ç°ä¸Šï¼Œä¸€èˆ¬ä¼šé‡‡å–ä¸€ä¸ªç»“æ„ä½“æ•°ç»„æ¥è¡¨ç¤ºæ®µè¡¨ã€‚</p><ul><li>æ®µç±»å‹ï¼š å¾ˆå¤šç±»å‹æ¯”å¦‚<code>.data</code>,<code>.text</code>æˆ–è€…<code>.rel</code>,<code>.string</code>ç­‰</li><li>æ®µæ ‡å¿—ä½ï¼šè¡¨ç¤ºè¯¥æ®µåœ¨è¿›ç¨‹å†…è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„å±æ€§</li></ul><h3 id="relocation-table">Relocation Table</h3><p>ç›®æ ‡æ–‡ä»¶ä¸­ä»£ç æ®µå’Œæ•°æ®æ®µé‚£äº›å¯¹ç»å¯¹åœ°å€çš„å¼•ç”¨ï¼Œéœ€è¦åœ¨é“¾æ¥çš„æ—¶å€™é‡å®šä½ã€‚æ¯ä¸€ä¸ªéœ€è¦é‡å®šä½çš„ä½ç½®ï¼Œæœ€åéƒ½ä¼šæœ‰ä¸€ä¸ª<strong>ç›¸åº”çš„é‡å®šä½è¡¨</strong>æ¯”å¦‚<code>.rel.txt</code>,<code>.rel.data</code>ç­‰ã€‚</p><h3 id="sections">Sections</h3><ul><li><code>.data</code>: ä¿å­˜åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡</li><li><code>.bss</code>: ä¿å­˜æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡</li><li><code>.data</code>: ä¿å­˜ä»£ç æ®µï¼Œç­‰ç­‰</li></ul><p>æ•´ä¸ªELFæ–‡ä»¶æœ‰å¾ˆå¤šæ®µæ¯”å¦‚å­—ç¬¦ä¸²æ®µï¼Œè°ƒè¯•ä¿¡æ¯æ®µstripç­‰ã€‚åŒ…æ‹¬åœ¨ä¸åŒçš„å¹³å°æ ‡å‡†ä¸ŠELFæ ¼å¼éƒ½ä¸åŒï¼Œè¿™é‡Œä¸å±•å¼€è¯´äº†ã€‚</p><h1 id="é“¾æ¥å™¨">é“¾æ¥å™¨</h1><p>é“¾æ¥çš„æœ¬è´¨å°±æ˜¯è¦æŠŠå¤šä¸ªä¸åŒçš„ç›®æ ‡æ–‡ä»¶ä¹‹é—´ç›¸äº’â€œç²˜â€åœ¨ä¸€èµ·â€”â€”<strong>å®é™…ä¸Šå°±æ˜¯ç›®æ ‡æ–‡ä»¶ä¹‹é—´åœ°å€çš„å¼•ç”¨ï¼ŒåŠå¯¹å‡½æ•°å’Œå˜é‡çš„åœ°å€çš„å¼•ç”¨ã€‚</strong></p><h2 id="ç¬¦å·">ç¬¦å·</h2><p><strong>åœ¨é“¾æ¥è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€ä¸ªELFç›®æ ‡æ–‡ä»¶éƒ½ä¼šæœ‰ä¸€ä¸ªç›¸åº”çš„ç¬¦å·è¡¨ï¼Œè¿™ä¸ªç¬¦å·è¡¨å¯¹åº”ELFä¸­çš„ä¸€ä¸ªæ®µ<code>.symtab</code>ï¼Œè¿™ä¸ªè¡¨é‡Œè®°å½•äº†ç›®æ ‡æ–‡ä»¶æ‰€ç”¨åˆ°çš„æ‰€æœ‰ç¬¦å·ï¼Œæ¯ä¸ªå®šä¹‰çš„ç¬¦å·æœ‰ä¸€ä¸ªç¬¦å·å€¼ï¼Œå¯¹äºå˜é‡å’Œå‡½æ•°æ¥è¯´è¯¥å€¼å°±æ˜¯å…¶åœ°å€ã€‚</strong></p><p>ELFçš„ç¬¦å·å¯ä»¥å¤§è‡´åˆ†ä¸ºï¼š</p><ul><li><strong>å®šä¹‰</strong>åœ¨ç›®æ ‡æ–‡ä»¶ä¸­çš„<strong>å…¨å±€ç¬¦å·</strong></li><li>åœ¨ç›®æ ‡æ–‡ä»¶å†…ä¸­<strong>å¼•ç”¨</strong>çš„<strong>å…¨å±€ç¬¦å·ï¼Œåˆç§°ä¸ºå¤–éƒ¨ç¬¦å·</strong></li><li>æ®µå</li><li>å±€éƒ¨ç¬¦å·</li><li>é“¾æ¥å™¨åœ¨ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™ï¼Œè‡ªè¡Œå®šä¹‰çš„ç‰¹æ®Šç¬¦å·æ¯”å¦‚ç¨‹åºèµ·å§‹åœ°å€<code>__executable_start</code></li></ul><p>å…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯<strong>å…¨å±€ç¬¦å·</strong>ï¼Œå› ä¸ºå…¶ä»–çš„ç¬¦å·åªæ˜¯åœ¨ç›®æ ‡æ–‡ä»¶ä¸­å¯è§ï¼Œè€Œå…¨å±€ç¬¦å·çš„ä½œç”¨åŸŸæ˜¯è·¨æ–‡ä»¶çš„ã€‚</p><p>UNIXç³»ç»Ÿé€šè¿‡<strong>ç¬¦å·ä¿®é¥°</strong>å’Œ<strong>å‡½æ•°ç­¾å</strong>æœºåˆ¶é˜²æ­¢ä¸åŒç›®æ ‡æ–‡ä»¶ä¸­çš„ç¬¦å·åç§°å†²çªã€‚</p><h3 id="å¼ºå¼±ç¬¦å·å®šä¹‰å¼•ç”¨">(å¼º/å¼±ç¬¦å·)(å®šä¹‰/å¼•ç”¨)</h3><p>ç¼–è¯‘å™¨é»˜è®¤å‡½æ•°å’Œåˆå§‹åŒ–äº†çš„å…¨å±€å˜é‡ä¸ºå¼ºç¬¦å·ï¼Œæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ä¸ºå¼±ç¬¦å·ã€‚<strong>å¼ºç¬¦å·å’Œå¼±ç¬¦å·éƒ½æ˜¯é’ˆå¯¹å®šä¹‰æ¥è¯´çš„ï¼Œä¸æ˜¯é’ˆå¯¹ç¬¦å·çš„å¼•ç”¨ã€‚</strong></p><ul><li>ä¸åŒçš„ç›®æ ‡æ–‡ä»¶ä¸­ä¸å…è®¸æœ‰åŒåçš„å¼ºç¬¦å·</li><li>å¼ºç¬¦å·å¯ä»¥å±è”½å¼±ç¬¦å·</li></ul><p>è€Œå½“å¤–éƒ¨å˜é‡çš„ç¬¦å·å¼•ç”¨åœ¨ç›®æ ‡æ–‡ä»¶è¢«é“¾æ¥æˆä¸ºå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œå¦‚æœæ˜¯å¼ºå¼•ç”¨ï¼Œå¦‚æœå®šä¹‰ä¸å­˜åœ¨åˆ™æŠ¥é”™ï¼Œè€Œå¼±å¼•ç”¨ä¸ä¼šæŠ¥é”™ã€‚<strong>å¼º/å¼±å¼•ç”¨ä¸€èˆ¬ç”¨äºåº“æ–‡ä»¶çš„é“¾æ¥è¿‡ç¨‹ã€‚</strong></p><h2 id="é™æ€é“¾æ¥">é™æ€é“¾æ¥</h2><p>é“¾æ¥å™¨ä¸€èˆ¬éƒ½é‡‡ç”¨<strong>Two-pass Linking</strong>çš„æ–¹å¼ï¼š</p><ul><li><strong>ç©ºé—´ä¸åœ°å€åˆ†é…ï¼š</strong> æ‰«ææ‰€æœ‰çš„è¾“å…¥æ–‡ä»¶ï¼Œè·å¾—å®ƒä»¬å„ä¸ªæ®µçš„é•¿åº¦ï¼Œå±æ€§å’Œä½ç½®ï¼Œ<strong>å¹¶å°†è¾“å…¥ç›®æ ‡æ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨ä¸­çš„æ‰€æœ‰ç¬¦å·å®šä¹‰å’Œç¬¦å·å¼•ç”¨æ”¶é›†èµ·æ¥ï¼Œç»Ÿä¸€æ”¾åˆ°ä¸€ä¸ªå…¨å±€ç¬¦å·è¡¨ã€‚</strong></li><li><strong>ç¬¦å·è§£æä¸é‡å®šä½ï¼š</strong> è¯»å–è¾“å…¥æ–‡ä»¶ä¸­æ®µçš„æ•°æ®ï¼Œé‡å®šä½ä¿¡æ¯ï¼›è¿›è¡Œ<strong>ç¬¦å·è§£æä¸é‡å®šä½ï¼Œè°ƒæ•´ä»£ç ä¸­çš„åœ°å€ã€‚</strong><ul><li>å„ä¸ªæ®µä¸­çš„ç¬¦å·åœ°å€</li><li>ä»£ç ä¸­çš„åœ°å€å¼•ç”¨</li></ul></li></ul><h3 id="ç©ºé—´ä¸åœ°å€åˆ†é…">ç©ºé—´ä¸åœ°å€åˆ†é…</h3><p>é“¾æ¥å™¨èƒ½å¤Ÿè·å¾—æ‰€æœ‰è¾“å…¥ç›®æ ‡æ–‡ä»¶çš„æ®µé•¿åº¦ï¼Œå¹¶ä¸”å°†å®ƒä»¬åˆå¹¶ï¼Œè®¡ç®—å‡ºè¾“å‡ºæ–‡ä»¶ä¸­å„ä¸ªæ®µåˆå¹¶åçš„é•¿åº¦å’Œä½ç½®ï¼Œå¹¶å»ºç«‹æ˜ å°„å…³ç³»ã€‚</p><p><img src="2.png" width="50%" height="50%" alt=""></p><h3 id="ç¬¦å·è§£æä¸é‡å®šä½">ç¬¦å·è§£æä¸é‡å®šä½</h3><p>è¿™é‡Œæœ‰ä¸¤éƒ¨åˆ†ï¼Œç¬¦å·çš„åœ°å€å’Œä»£ç ä¸­çš„åœ°å€ã€‚å…¶ä¸­é“¾æ¥å™¨åœ¨å®Œæˆåœ°å€å’Œç©ºé—´åˆ†é…ä¹‹åå°±å¯ä»¥ç¡®å®šæ‰€æœ‰<strong>ç¬¦å·</strong>çš„è™šæ‹Ÿåœ°å€äº†ï¼Œè€Œé“¾æ¥å™¨å°±å¯ä»¥æ ¹æ®ç¬¦å·çš„åœ°å€(<strong>é€šè¿‡æŸ¥æ‰¾ç”±æ‰€æœ‰è¾“å…¥ç›®æ ‡æ–‡ä»¶çš„ç¬¦å·è¡¨ç»„æˆçš„å…¨å±€ç¬¦å·è¡¨</strong>)å¯¹æ¯ä¸ªéœ€è¦<strong>é‡å®šä½çš„æŒ‡ä»¤â€”â€”å³ä¼šç”¨åˆ°å¤–éƒ¨ç¬¦å·çš„æŒ‡ä»¤</strong>è¿›è¡Œåœ°å€ä¿®æ­£ã€‚</p><h4 id="é‡å®šä½è¡¨">é‡å®šä½è¡¨</h4><p>é“¾æ¥å™¨é€šè¿‡ELFæ–‡ä»¶ä¸­çš„é‡å®šä½è¡¨æ¥å®ŒæˆæŒ‡ä»¤ä¸­åœ°å€çš„è°ƒæ•´ã€‚</p><h4 id="abi">ABI</h4><p>æŒ‡çš„æ˜¯å’ŒäºŒè¿›åˆ¶å…¼å®¹æ€§æœ‰å…³çš„å†…å®¹ï¼š</p><ul><li>å†…ç½®ç±»å‹çš„å¤§å°å’Œåœ¨å­˜å‚¨å™¨ä¸­çš„æ”¾ç½®æ–¹å¼ï¼ˆå¤§ç«¯ï¼Œå°ç«¯ï¼Œå¯¹é½æ–¹å¼ç­‰ï¼‰</li><li>ç»„åˆç±»å‹ï¼ˆç»“æ„ä½“ï¼Œæ•°ç»„ç­‰ï¼‰çš„å­˜å‚¨æ–¹å¼å’Œå†…å­˜åˆ†å¸ƒ</li><li>å¤–éƒ¨ç¬¦å·ä¸ç”¨æˆ·å®šä¹‰çš„ç¬¦å·ä¹‹é—´çš„å‘½åæ–¹å¼å’Œè§£ææ–¹å¼</li><li>å‡½æ•°è°ƒç”¨æ–¹å¼ï¼Œæ¯”å¦‚å‚æ•°å…¥æ ˆé¡ºåºï¼Œè¿”å›å€¼å¦‚ä½•ä¿å­˜ç­‰</li><li>å †æ ˆçš„åˆ†å¸ƒæ–¹å¼ï¼Œæ¯”å¦‚å‚æ•°å’Œå±€éƒ¨å˜é‡åœ¨å †æ ˆä¸­çš„ä½ç½®ï¼Œå‚æ•°ä¼ é€’æ–¹å¼ç­‰</li><li>å¯„å­˜å™¨ä½¿ç”¨çº¦å®š</li></ul><h4 id="é™æ€é“¾æ¥åº“">é™æ€é“¾æ¥åº“</h4><p>é™æ€é“¾æ¥åº“å®é™…ä¸Šå°±æ˜¯ä¸€ç»„ç›®æ ‡æ–‡ä»¶çš„é›†åˆã€‚å³å¾ˆå¤šç›®æ ‡æ–‡ä»¶ç»è¿‡å‹ç¼©æ‰“åŒ…ä¹‹åçš„ä¸€ä¸ªæ–‡ä»¶ã€‚</p><p><img src="3.png" width="50%" height="50%" alt=""></p><h2 id="è£…è½½">è£…è½½</h2><h3 id="è™šæ‹Ÿåœ°å€ç©ºé—´">è™šæ‹Ÿåœ°å€ç©ºé—´</h3><p>é¦–å…ˆ32ä½CPUæŒ‡çš„æ˜¯CPUçš„æ•°æ®çº¿æ˜¯32ä½çš„ï¼Œä½†æ˜¯å…¶åœ°å€çº¿ä¸ä¸€å®šåªæœ‰32ä½ï¼ŒPAEåœ°å€æ‰©å±•æ–¹å¼ä¿®æ”¹äº†é¡µæ˜ å°„çš„æ–¹å¼ä½¿å¾—å¯ä»¥è®¿é—®åˆ°æ›´å¤šçš„ç‰©ç†å†…å­˜ã€‚è€Œæ“ä½œç³»ç»Ÿæä¾›ä¸€ä¸ªçª—å£æ˜ å°„çš„æ–¹å¼ï¼Œå°†è¿™äº›é¢å¤–çš„å†…å­˜æ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´ä¸­ã€‚åº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®éœ€è¦æ¥ç”³è¯·å’Œæ˜ å°„ï¼Œæ¯”å¦‚Linuxä¸­çš„mmapç³»ç»Ÿè°ƒç”¨ã€‚</p><p>å…³äºç°ä»£æ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜ç®¡ç†æœºåˆ¶è¿™é‡Œä¸å±•å¼€ä»‹ç»ã€‚</p><h3 id="å†…æ ¸è£…è½½elfå¯æ‰§è¡Œæ–‡ä»¶">å†…æ ¸è£…è½½ELFå¯æ‰§è¡Œæ–‡ä»¶</h3><p>ä¸€å…±æœ‰å¦‚ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p><h4 id="è¿›ç¨‹åˆ›å»º">è¿›ç¨‹åˆ›å»º</h4><p><strong>ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ </strong></p><p>åˆ›å»ºè™šæ‹Ÿç©ºé—´å®é™…ä¸Šå¹¶ä¸æ˜¯åˆ›å»ºç©ºé—´è€Œæ˜¯åˆ›å»ºæ˜ å°„å‡½æ•°æ‰€éœ€è¦çš„ç›¸åº”çš„æ•°æ®ç»“æ„ã€‚åœ¨i386çš„Linuxä¸‹ï¼Œ<strong>åˆ›å»ºè™šæ‹Ÿåœ°å€ç©ºé—´å®é™…ä¸Šå°±æ˜¯åˆ†é…ä¸€ä¸ªé¡µç›®å½•</strong>å°±å¯ä»¥äº†ï¼Œç”šè‡³ä¸è®¾ç½®é¡µæ˜ å°„å…³ç³»â€”â€”è¿™äº›ç­‰åˆ°åé¢ç¨‹åºå‘ç”Ÿç¼ºé¡µä¸­æ–­çš„æ—¶å€™å†è¿›è¡Œè®¾ç½®ï¼ˆ<strong>å½“ç¨‹åºå‘ç”Ÿäº†é¡µé”™è¯¯ï¼Œæ“ä½œç³»ç»Ÿå°†ä»ç‰©ç†å†…å­˜ä¸­åˆ†é…ä¸€ä¸ªç‰©ç†é¡µï¼Œç„¶åå°†è¯¥â€œç¼ºé¡µâ€ä»ç£ç›˜ä¸­è¯»å–åˆ°å†…å­˜ä¸­ï¼Œåœ¨è®¾ç½®ç¼ºé¡µå’Œç‰©ç†é¡µæ¡†çš„æ˜ å°„å…³ç³»</strong>ï¼‰ã€‚</p><p><strong>è¿™ä¸€æ­¥æœ¬è´¨ä¸Šå°±æ˜¯å®Œæˆè™šæ‹Ÿç©ºé—´åˆ°ç‰©ç†å†…å­˜çš„æ˜ å°„å…³ç³»ã€‚</strong></p><h4 id="å®Œæˆelfå’Œè¿›ç¨‹çš„æ˜ å°„">å®ŒæˆELFå’Œè¿›ç¨‹çš„æ˜ å°„</h4><p><strong>ç¬¬äºŒæ­¥æ˜¯è¯»å–å¯æ‰§è¡Œæ–‡ä»¶å¤´ï¼Œå¹¶ä¸”å»ºç«‹è™šæ‹Ÿç©ºé—´ä¸å¯æ‰§è¡Œæ–‡ä»¶çš„æ˜ å°„å…³ç³»ã€‚ </strong></p><p>å¾ˆæ˜æ˜¾ï¼Œè¿™ç§æ˜ å°„å…³ç³»æ˜¯ä¿å­˜åœ¨æ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼ˆç±»ä¼¼é¡µç›®å½•ï¼‰ã€‚<strong>Linuxä¸­å°†è¿›ç¨‹è™šæ‹Ÿç©ºé—´ä¸­çš„ä¸€ä¸ªæ®µå«åšè™šæ‹Ÿå†…å­˜åŒºåŸŸï¼ˆVMAï¼ŒVirtual Memory Areaï¼‰ã€‚</strong>æ“ä½œç³»ç»Ÿåœ¨å†…éƒ¨ä¿å­˜è¿™ç§VMAç»“æ„ï¼Œå°±æ˜¯å› ä¸ºå½“ç¨‹åºå‘ç”Ÿæ®µé”™è¯¯çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡æŸ¥æ‰¾è¿™æ ·ä¸€ä¸ªæ•°æ®ç»“æ„æ¥å®šä½é”™è¯¯é¡µåœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„ä½ç½®ã€‚</p><h4 id="è¿è¡Œ">è¿è¡Œ</h4><p><strong>ç¬¬ä¸‰æ­¥æ˜¯å°†CPUçš„æŒ‡ä»¤å¯„å­˜å™¨è®¾ç½®æˆå¯æ‰§è¡Œæ–‡ä»¶çš„å…¥å£åœ°å€ï¼Œå¯åŠ¨è¿è¡Œã€‚</strong></p><p>æ“ä½œç³»ç»Ÿè¿›è¡Œå†…æ ¸å †æ ˆå’Œç”¨æˆ·å †æ ˆçš„åˆ‡æ¢ï¼ŒCPUè¿è¡Œæƒé™çš„åˆ‡æ¢ï¼Œç„¶åè®¾ç½®CPUçš„æŒ‡ä»¤å¯„å­˜å™¨å¹¶å°†æ§åˆ¶æƒäº¤ç»™è¿›ç¨‹ã€‚</p><h4 id="ç¼ºé¡µä¸­æ–­">ç¼ºé¡µä¸­æ–­</h4><p>åœ¨ä¸Šè¿°æ­¥éª¤éƒ½å®Œæˆä¹‹åï¼Œå…¶å®å¯æ‰§è¡Œæ–‡ä»¶çš„çœŸæ­£æŒ‡ä»¤å’Œæ•°æ®éƒ½æ²¡æœ‰è¢«è£…è½½è¿›å†…å­˜ä¸­ã€‚<strong>æ“ä½œç³»ç»Ÿåªæ˜¯é€šè¿‡å¯æ‰§è¡Œæ–‡ä»¶å¤´éƒ¨çš„ä¿¡æ¯å»ºç«‹èµ·æ¥å¯æ‰§è¡Œæ–‡ä»¶å’Œè¿›ç¨‹è™šå­˜ä¹‹é—´çš„æ˜ å°„å…³ç³»è€Œå·²ã€‚</strong></p><p><strong>å½“å‘ç”Ÿä¸€æ¬¡ç¼ºé¡µä¸­æ–­çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿå°†æŸ¥è¯¢è¿™ä¸ªæ•°æ®ç»“æ„ï¼Œç„¶åæ‰¾åˆ°ç©ºé¡µé¢æ‰€åœ¨çš„VMA ï¼Œè®¡ç®—å‡ºç›¸åº”çš„é¡µé¢åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„åç§»ï¼Œç„¶ååœ¨ç‰©ç†å†…å­˜ä¸­åˆ†é…ä¸€ä¸ªç‰©ç†é¡µé¢ï¼Œå°†è¿›ç¨‹ä¸­è¯¥è™šæ‹Ÿé¡µä¸ç‰©ç†é¡µä¹‹é—´å»ºç«‹æ˜ å°„å…³ç³»ï¼Œå®ŒæˆçœŸæ­£çš„è£…è½½ã€‚</strong></p><p><img src="4.png" width="50%" height="50%" alt=""></p><h3 id="è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´åˆ†å¸ƒ">è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´åˆ†å¸ƒ</h3><h4 id="elfæ–‡ä»¶é“¾æ¥è§†å›¾å’Œæ‰§è¡Œè§†å›¾">ELFæ–‡ä»¶é“¾æ¥è§†å›¾å’Œæ‰§è¡Œè§†å›¾</h4><p>æ“ä½œç³»ç»Ÿè£…è½½ELFå¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™æ˜¯ä»¥æ®µsegmentä¸ºå•ä½çš„ï¼Œä¸€èˆ¬åªå…³å¿ƒè·Ÿè£…è½½æœ‰å…³çš„é—®é¢˜ï¼Œæœ€ä¸»è¦çš„æ˜¯æ®µçš„æƒé™(å¯è¯»ï¼Œå¯å†™ï¼Œå¯æ‰§è¡Œ)ã€‚ELFæ–‡ä»¶ä¸­ï¼Œæ®µçš„æƒé™å¾€å¾€åªæœ‰ä¸ºæ•°ä¸å¤šçš„å‡ ç§ç»„åˆï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¸‰ç§ï¼š</p><ul><li>ä»¥ä»£ç æ®µä¸ºä»£è¡¨çš„æƒé™ä¸ºå¯è¯»å¯æ‰§è¡Œçš„æ®µ</li><li>ä»¥æ•°æ®æ®µå’ŒBSSæ®µä¸ºä»£è¡¨çš„æƒé™ä¸ºå¯è¯»å¯å†™çš„æ®µ</li><li>ä»¥åªè¯»æ•°æ®æ®µä¸ºä»£è¡¨çš„æƒé™ä¸ºåªè¯»çš„æ®µ</li></ul><p><strong>ä¸€èˆ¬å¯¹äºç›¸åŒæƒé™çš„æ®µï¼ŒæŠŠå®ƒä»¬åˆå¹¶åœ¨ä¸€èµ·ä½œä¸ºä¸€ä¸ªæ®µè¿›è¡Œæ˜ å°„â€”â€”æˆä¸ºsegmentã€‚å¤šä¸ªsectionsç»„åˆæˆä¸ºsegmentï¼Œè£…è½½çš„æ—¶å€™ä¸€ä¸ªsegmentåœ¨è¿›ç¨‹è™šæ‹Ÿç©ºé—´ä¸­åªæœ‰ä¸€ä¸ªå¯¹åº”çš„VMAï¼Œè¿™æ ·å¯ä»¥æ˜æ˜¾çš„å‡å°‘å†…éƒ¨ç¢ç‰‡ï¼Œä»è€ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚ </strong></p><p>æ‰€ä»¥å¯¹äºç³»ç»Ÿæ¥è®²ï¼Œsectionæ˜¯é“¾æ¥è§†å›¾ï¼Œè€Œsegmentæ˜¯æ‰§è¡Œè§†å›¾ã€‚</p><p>åœ¨æ“ä½œç³»ç»Ÿè£…è½½çš„æ—¶å€™ï¼ŒVMAé™¤äº†ç”¨æ¥æ˜ å°„å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„å„ä¸ªsegmentä»¥å¤–ï¼Œäº‹å®ä¸Šè¿›ç¨‹è™šæ‹Ÿç©ºé—´ä¸­çš„å †æ ˆä¹Ÿæ˜¯ä»¥VMAçš„å½¢å¼å­˜åœ¨çš„ã€‚æ‰€ä»¥æ€»ç»“ä¸€ä¸‹ï¼Œæ“ä½œç³»ç»Ÿé€šè¿‡ç»™è¿›ç¨‹ç©ºé—´åˆ’åˆ†å‡ºä¸€ä¸ªä¸ªVMAæ¥ç®¡ç†è¿›ç¨‹çš„è™šæ‹Ÿç©ºé—´ï¼ŒåŸºæœ¬åŸåˆ™å°±æ˜¯ç›¸åŒæƒé™å±æ€§çš„ï¼Œæœ‰ç›¸åŒæ˜ åƒæ–‡ä»¶çš„æ˜ å°„æˆä¸€ä¸ªVMAï¼Œä¸€ä¸ªè¿›ç¨‹åŸºæœ¬ä¸Šå¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ ç§VMAåŒºåŸŸï¼š</p><ul><li>ä»£ç VMAï¼Œæƒé™åªè¯»ã€å¯æ‰§è¡Œï¼›æœ‰æ˜ åƒæ–‡ä»¶</li><li>æ•°æ®VMAï¼Œæƒé™å¯è¯»å†™ï¼Œå¯æ‰§è¡Œï¼›æœ‰æ˜ åƒæ–‡ä»¶</li><li>å †VMAï¼Œæƒé™å¯è¯»å†™ï¼Œå¯æ‰§è¡Œï¼›æ— æ˜ åƒæ–‡ä»¶ï¼ŒåŒ¿åï¼Œå¯å‘ä¸Šæ‰©å±•</li><li>æ ˆVMAï¼Œæƒé™å¯è¯»å†™ï¼Œä¸å¯æ‰§è¡Œï¼›æ— æ˜ åƒæ–‡ä»¶ï¼ŒåŒ¿åï¼Œå¯å‘ä¸‹æ‰©å±•</li></ul><p><img src="5.png" width="50%" height="50%" alt=""></p><h4 id="æ®µåœ°å€å¯¹é½">æ®µåœ°å€å¯¹é½</h4><p>å› ä¸ºè£…è½½è¿‡ç¨‹æ˜¯é€šè¿‡è™šæ‹Ÿå†…å­˜çš„é¡µæ˜ å°„æœºåˆ¶å®Œæˆçš„ã€‚å‡è®¾é¡µå¤§å°é»˜è®¤ä¸º4096Bytesï¼Œæ‰€ä»¥å¦‚æœè¦å°†ä¸€æ®µç‰©ç†å†…å­˜å’Œè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¹‹é—´å»ºç«‹æ˜ å°„å…³ç³»ï¼Œ<strong>è¿™æ®µå†…å­˜ç©ºé—´çš„é•¿åº¦å¿…é¡»æ˜¯4Kçš„æ•´æ•°å€ï¼Œå¹¶ä¸”è¿™æ®µç©ºé—´åœ¨ç‰©ç†å†…å­˜å’Œè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„èµ·å§‹åœ°å€å¿…é¡»æ˜¯4096çš„æ•´æ•°å€ã€‚ </strong> ç³»ç»Ÿä¸ºäº†é˜²æ­¢ç¢ç‰‡åŒ–ï¼Œä¹Ÿä¼šé‡‡å–ä¸€äº›ä¼˜åŒ–çš„æ˜ å°„æ–¹æ¡ˆï¼Œè¿™é‡Œä¸æ·±å…¥äº†ã€‚</p><h2 id="åŠ¨æ€é“¾æ¥">åŠ¨æ€é“¾æ¥</h2><p>é™æ€é“¾æ¥æœ‰<strong>ç©ºé—´æµªè´¹</strong>å’Œ<strong>æ›´æ–°å›°éš¾</strong>ä¸¤ä¸ªé—®é¢˜ã€‚</p><p>å…±äº«æ–‡ä»¶åœ¨å†…å­˜ä¸­åªå­˜åœ¨ä¸€ä»½ï¼Œè¿™æ ·ä¸ä»…ä»…èŠ‚çœå†…å­˜ï¼Œè¿˜å¢åŠ CPUç¼“å­˜çš„å‘½ä¸­ç‡ã€‚ELFåŠ¨æ€é“¾æ¥æ–‡ä»¶ç§°ä¸º<strong>.so</strong>å…±äº«å¯¹è±¡æ–‡ä»¶ï¼Œè€ŒWindowsåŠ¨æ€é“¾æ¥åº“ç§°ä¸º<strong>.dll</strong>æ–‡ä»¶ã€‚</p><p>å½“ç¨‹åºè¢«è£…è½½çš„æ—¶å€™ï¼Œç³»ç»Ÿçš„<strong>åŠ¨æ€é“¾æ¥å™¨</strong>ä¼šå°†ç¨‹åºæ‰€éœ€è¦çš„æ‰€æœ‰åŠ¨æ€é“¾æ¥åº“è£…è½½åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œå¹¶ä¸”å°†ç¨‹åºä¸­æ‰€æœ‰<strong>æœªå†³è®®çš„ç¬¦å·</strong>ç»‘å®šåˆ°ç›¸åº”çš„åŠ¨æ€é“¾æ¥åº“ä¸­ï¼Œå¹¶è¿›è¡Œé‡å®šä½å·¥ä½œã€‚<strong>ä¹Ÿå°±æ˜¯è¯´åŠ¨æ€é“¾æ¥å™¨æŠŠé“¾æ¥è¿™ä¸ªè¿‡ç¨‹ä»æœ¬æ¥çš„ç¨‹åºè£…è½½å‰è¢«æ¨è¿Ÿåˆ°è£…è½½çš„æ—¶å€™ã€‚</strong>è¿™æ ·çš„è¯<strong>åŠ¨æ€é“¾æ¥ä¸é™æ€é“¾æ¥ç›¸æ¯”ï¼Œæ€§èƒ½æŸå¤±å¤§çº¦åœ¨5%ä»¥ä¸‹ã€‚è¿™ç‚¹æŸå¤±æ¢å–ç©ºé—´ä¸Šçš„èŠ‚çœå’Œç¨‹åºæ„å»ºå’Œå‡çº§æ—¶çš„çµæ´»æ€§ï¼Œæ˜¯æƒ³å½“å€¼å¾—çš„ã€‚</strong></p><p><img src="6.png" width="50%" height="50%" alt=""></p><h3 id="åœ°å€æ— å…³ä»£ç ">åœ°å€æ— å…³ä»£ç </h3><p>ç”±æ€§è´¨å¯ä»¥çŸ¥é“<strong>å…±äº«å¯¹è±¡åœ¨ç¼–è¯‘çš„æ—¶å€™ä¸èƒ½å‡è®¾è‡ªå·±åœ¨è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„ä½ç½®ã€‚</strong>è€Œå¯æ‰§è¡Œæ–‡ä»¶åŸºæœ¬å¯ä»¥ç¡®å®šè‡ªå·±åœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„èµ·å§‹ä½ç½®ã€‚è¿™é‡Œæ³¨æ„åŠ¨æ€é“¾æ¥çš„æ¨¡å—æ¦‚å¿µï¼šå¯æ‰§è¡Œæ–‡ä»¶æ¨¡å—å’Œæ­£å¸¸é™æ€é“¾æ¥ä¸€æ ·ï¼Œè€Œå…±äº«å¯¹è±¡æ¨¡å—å³åŠ¨æ€é“¾æ¥åº“å°±ä¸è¡Œã€‚</p><p>é‚£å…±äº«å¯¹è±¡åœ¨è¢«åŠ è½½çš„æ—¶å€™ï¼Œå¦‚ä½•ç¡®å®šå®ƒåœ¨è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„ä½ç½®ï¼Ÿ</p><p>è¿™é‡Œæå‡ºä¸€ä¸ªé—®é¢˜ï¼š<code>å¦‚æœç›´æ¥å°†ç›®æ ‡æ–‡ä»¶æ¨è¿Ÿåˆ°è£…è½½çš„æ—¶å€™å†é“¾æ¥å¯ä»¥å—ï¼Ÿ</code></p><p>ç­”æ¡ˆæ˜¯ä¸è¡Œã€‚<strong>åŠ¨æ€é“¾æ¥æ¨¡å—è¢«è£…è½½æ˜ å°„åˆ°è™šæ‹Ÿç©ºé—´ä¹‹åï¼ŒæŒ‡ä»¤éƒ¨åˆ†æ˜¯åœ¨å¤šä¸ªè¿›ç¨‹ä¸­å…±äº«çš„ï¼Œç”±äºè£…è½½çš„æ—¶å€™é‡å®šä½çš„æ–¹æ³•éœ€è¦ä¿®æ”¹æŒ‡ä»¤ï¼ˆä¼šå½±å“ä»£ç æ®µä¸­çš„ç»å¯¹åœ°å€å¼•ç”¨ï¼‰ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•åšåˆ°åŒä¸€ä»½æŒ‡ä»¤è¢«å¤šä¸ªè¿›ç¨‹å…±äº«ã€‚</strong></p><p>æ‰€ä»¥æœ€ç»ˆçš„è§£å†³åŠæ³•å°±æ˜¯ï¼š<strong>å°†å…±äº«çš„æŒ‡ä»¤éƒ¨åˆ†ä¸­é‚£äº›éœ€è¦è¢«ä¿®æ”¹çš„éƒ¨åˆ†åˆ†ç¦»å‡ºæ¥ï¼Œè·Ÿæ•°æ®éƒ¨åˆ†æ”¾åœ¨ä¸€èµ·ï¼Œè¿™æ ·æŒ‡ä»¤éƒ¨åˆ†å°±å¯ä»¥ä¿æŒä¸å˜ï¼Œè€Œæ•°æ®éƒ¨åˆ†å¯ä»¥åœ¨æ¯ä¸ªè¿›ç¨‹ä¸­æ‹¥æœ‰ä¸€ä»½å‰¯æœ¬â€”â€”æ‰€è°“åœ°å€æ— å…³ä»£ç (PIC, Pisition-independent Code)æŠ€æœ¯ã€‚</strong></p><h4 id="ä»£ç æ®µåœ°å€æ— å…³ä»£ç ">ä»£ç æ®µåœ°å€æ— å…³ä»£ç </h4><p>è¿™é‡ŒæŠŠå…±äº«å¯¹è±¡æ¨¡å—ä¸­çš„åœ°å€å¼•ç”¨æŒ‰ç…§æ˜¯å¦è·¨æ¨¡å—åˆ†ä¸ºä¸¤ç±»ï¼šæ¨¡å—å†…éƒ¨å¼•ç”¨å’Œæ¨¡å—å¤–éƒ¨å¼•ç”¨ï¼›æŒ‰ç…§ä¸åŒçš„å¼•ç”¨æ–¹å¼æœ‰å¯ä»¥åˆ†ä¸ºæŒ‡ä»¤å¼•ç”¨å’Œæ•°æ®è®¿é—®ã€‚</p><ul><li>æ¨¡å—å†…éƒ¨çš„å‡½æ•°è°ƒç”¨ï¼Œè·³è½¬ç­‰</li><li>æ¨¡å—å†…éƒ¨çš„æ•°æ®è®¿é—®ï¼Œæ¯”å¦‚æ¨¡å—ä¸­å®šä¹‰çš„å…¨å±€å˜é‡ï¼Œé™æ€å˜é‡</li><li>æ¨¡å—å¤–éƒ¨çš„å‡½æ•°è°ƒç”¨ï¼Œè·³è½¬ç­‰</li><li>æ¨¡å—å¤–éƒ¨çš„æ•°æ®è®¿é—®ï¼Œæ¯”å¦‚æ¨¡å—ä¸­å®šä¹‰çš„å…¨å±€å˜é‡ï¼Œé™æ€å˜é‡</li></ul><p><img src="7.png" width="50%" height="50%" alt=""></p><p>è¿™é‡Œæä¸€ä¸‹æ¨¡å—é—´ï¼Œå› ä¸ºè¿™äº›å…¨å±€å˜é‡çš„åœ°å€æ˜¯è·Ÿæ¨¡å—è£…è½½åœ°å€æœ‰å…³çš„ã€‚ELFçš„åšæ³•å°±æ˜¯åœ¨æ•°æ®æ®µä¸­å»ºç«‹ä¸€ä¸ª<strong>æŒ‡å‘è¿™äº›å˜é‡çš„æŒ‡é’ˆæ•°ç»„ï¼Œä¹Ÿè¢«ç§°ä¸ºå…¨å±€åç¦»è¡¨(Global Offset Table GOT)</strong>ï¼Œå½“ä»£ç éœ€è¦å¼•ç”¨è¯¥å…¨å±€å˜é‡çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡GOTä¸­ç›¸å¯¹åº”çš„é¡¹é—´æ¥å¼•ç”¨ã€‚</p><p><img src="8.png" width="50%" height="50%" alt=""></p><p>é“¾æ¥å™¨åœ¨è£…è½½æ¨¡å—çš„æ—¶å€™ä¼šæŸ¥æ‰¾æ¯ä¸ªå˜é‡æ‰€åœ¨çš„åœ°å€ï¼Œç„¶åå¡«å……GOTä¸­çš„å„ä¸ªé¡¹ï¼Œä»¥ç¡®ä¿æ¯ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€æ­£ç¡®ã€‚GOTåœ¨æ•°æ®æ®µæ‰€ä»¥å¯è¢«ä¿®æ”¹ã€‚æ€»ç»“ä¸€ä¸‹ï¼š</p><table><thead><tr class="header"><th></th><th>æŒ‡ä»¤è·³è½¬ï¼Œè°ƒç”¨</th><th>æ•°æ®è®¿é—®</th></tr></thead><tbody><tr class="odd"><td>æ¨¡å—å†…éƒ¨</td><td>ç›¸å¯¹è·³è½¬å’Œè°ƒç”¨</td><td>ç›¸å¯¹åœ°å€è®¿é—®</td></tr><tr class="even"><td>æ¨¡å—å¤–éƒ¨</td><td>é—´æ¥è·³è½¬å’Œè°ƒç”¨GOT</td><td>é—´æ¥è®¿é—®GOT</td></tr></tbody></table><h5 id="å…±äº«æ¨¡å—çš„å…¨å±€å˜é‡é—®é¢˜">å…±äº«æ¨¡å—çš„å…¨å±€å˜é‡é—®é¢˜</h5><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå¦‚æœä¸€ä¸ªæ¨¡å—å¼•ç”¨äº†ä¸€ä¸ªå®šä¹‰åœ¨å…±äº«å¯¹è±¡çš„å…¨å±€å˜é‡çš„æ—¶å€™ã€‚ç¼–è¯‘å™¨æ— æ³•åˆ¤æ–­è¯¥globalæ˜¯åœ¨åŒä¸€ä¸ªæ¨¡å—çš„å…¶ä»–ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œè¿˜æ˜¯å®šä¹‰åœ¨å¦ä¸€ä¸ªå…±äº«å¯¹è±¡ä¸­ã€‚</p><p>è§£å†³åŠæ³•æ˜¯æ‰€æœ‰çš„å…¨å±€å˜é‡éƒ½é€šè¿‡GOTè®¿é—®ã€‚</p><h4 id="æ•°æ®æ®µåœ°å€æ— å…³ä»£ç ">æ•°æ®æ®µåœ°å€æ— å…³ä»£ç </h4><p>æ•°æ®æ®µä¸­ä¹Ÿä¼šå‡ºç°ç»å¯¹åœ°å€å¼•ç”¨çš„æƒ…å†µï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">static int a;</span><br><span class="line">static int *p = &amp;a;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„æŒ‡é’ˆpå°±æ˜¯ä¸€ä¸ªç»å¯¹åœ°å€ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœå‘ç°æ•°æ®æ®µä¸­æœ‰ç»å¯¹åœ°å€å¼•ç”¨ï¼Œç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ä¼šäº§ç”Ÿä¸€ä¸ªé‡å®šä½è¡¨ã€‚</p><p>å¯¹äºå¯æ‰§è¡Œæ–‡ä»¶æ¥è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå¯æ‰§è¡Œæ–‡ä»¶æ˜¯åŠ¨æ€é“¾æ¥çš„ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šä½¿ç”¨PICçš„æ–¹æ³•æ¥äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶çš„ä»£ç æ®µéƒ¨åˆ†ï¼Œä»¥ä¾¿äºä¸åŒçš„è¿›ç¨‹èƒ½å¤Ÿå…±äº«ä»£ç æ®µï¼ŒèŠ‚çœå†…å­˜ã€‚æ‰€ä»¥ä¸€èˆ¬åŠ¨æ€é“¾æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ä¼šæœ‰<code>.got</code>æ®µã€‚</p><h3 id="åŠ¨æ€é“¾æ¥è¿‡ç¨‹">åŠ¨æ€é“¾æ¥è¿‡ç¨‹</h3><p>åŠ¨æ€é“¾æ¥æƒ…å†µä¸‹ï¼Œå¯æ‰§è¡Œæ–‡ä»¶çš„è£…è½½ä¸é™æ€é“¾æ¥æƒ…å†µåŸºæœ¬ä¸€æ ·ã€‚é¦–å…ˆæ“ä½œç³»ç»Ÿä¼šè¯»å–å¯æ‰§è¡Œæ–‡ä»¶çš„å¤´éƒ¨ï¼Œæ£€æŸ¥æ–‡ä»¶çš„åˆæ³•æ€§ï¼Œç„¶åæ–‡ä»¶å¤´ä¸­è¯»å–æ¯ä¸ªâ€œSegmentâ€çš„è™šæ‹Ÿåœ°å€ï¼Œæ–‡ä»¶åœ°å€å’Œå±æ€§ï¼Œå¹¶å°†å®ƒä»¬æ˜ å°„åˆ°è¿›ç¨‹è™šæ‹Ÿç©ºé—´çš„ç›¸åº”ä½ç½®ï¼Œè¿™äº›æ­¥éª¤è·Ÿå‰é¢çš„é™æ€é“¾æ¥æƒ…å†µä¸‹çš„è£…è½½åŸºæœ¬æ— å¼‚ã€‚åœ¨é™æ€é“¾æ¥æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿæ¥ç€å°±å¯ä»¥æŠŠæ§åˆ¶æƒè½¬äº¤ç»™å¯æ‰§è¡Œæ–‡ä»¶çš„å…¥å£åœ°å€ï¼Œç„¶åç¨‹åºå¼€å§‹æ‰§è¡Œï¼Œä¸€åˆ‡å¾ˆé¡ºåˆ©ã€‚</p><p>ä½†æ˜¯åœ¨åŠ¨æ€é“¾æ¥ä¸‹ï¼Œæ“ä½œç³»ç»Ÿè¿˜ä¸èƒ½å†è£…è½½å®Œå¯æ‰§è¡Œæ–‡ä»¶ä¹‹åå°±æŠŠæ§åˆ¶æƒäº¤ç»™å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“å¯æ‰§è¡Œæ–‡ä»¶ä¾èµ–äºå¾ˆå¤šå…±äº«å¯¹è±¡ï¼Œ<strong>è¿™æ—¶å€™å¯æ‰§è¡Œæ–‡ä»¶é‡Œå¯¹äºå¾ˆå¤šå¤–éƒ¨ç¬¦å·çš„å¼•ç”¨è¿˜å¤„äºæ— æ•ˆåœ°å€çš„çŠ¶æ€ï¼Œå³è¿˜æ²¡æœ‰è·Ÿç›¸åº”çš„å…±äº«å¯¹è±¡ä¸­çš„å®é™…ä½ç½®é“¾æ¥èµ·æ¥</strong>ã€‚æ‰€ä»¥åœ¨æ˜ å°„å®Œå¯æ‰§è¡Œæ–‡ä»¶ä¹‹åï¼Œæ“ä½œç³»ç»Ÿä¼šå…¶ä¸­ä¸€ä¸ªåŠ¨æ€é“¾æ¥å™¨ã€‚</p><p>åŠ¨æ€é“¾æ¥åˆ†ä¸ºä¸‰æ­¥ï¼šå¯åŠ¨åŠ¨æ€é“¾æ¥å™¨æœ¬èº«ï¼Œç„¶åè£…è½½æ‰€æœ‰éœ€è¦çš„å…±äº«å¯¹è±¡ï¼Œæœ€åæ˜¯é‡å®šä½å’Œåˆå§‹åŒ–ã€‚</p><h3 id="å…±äº«åº“">å…±äº«åº“</h3><p>å› ä¸ºåŠ¨æ€é“¾æ¥çš„è¯¸å¤šä¼˜ç‚¹ï¼Œæ“ä½œç³»ç»Ÿä¸­ä¸€èˆ¬æœ‰å¾ˆå¤šå…±äº«å¯¹è±¡â€”â€”æŒ‰ç…§åˆç†çš„ç»„ç»‡å’Œä½¿ç”¨æ–¹å¼æ„å»ºèµ·æ¥çš„å…±äº«åº“ã€‚å…±äº«åº“çš„æ›´æ–°ä¼šå½±å“ABIçš„ä½¿ç”¨ã€‚</p><h1 id="è¿è¡Œåº“">è¿è¡Œåº“</h1><p>ç»è¿‡å‰é¢çš„ä»‹ç»ï¼ŒåŸºæœ¬ä¸Šç¼–è¯‘ç³»ç»Ÿçš„æ¦‚å¿µéƒ½ä»‹ç»å®Œäº†ã€‚ä¸‹é¢çš„éƒ¨åˆ†æ¶‰åŠæ“ä½œç³»ç»Ÿæ¥å£ï¼Œä¹Ÿåªæ˜¯ç®€å•çš„ä»‹ç»ä¸€ä¸‹ã€‚</p><p>æ“ä½œç³»ç»Ÿè£…è½½ç¨‹åºä¹‹åï¼Œé¦–å…ˆè¿è¡Œçš„ä»£ç å¹¶ä¸æ˜¯<code>main</code>çš„ç¬¬ä¸€è¡Œï¼Œè€Œæ˜¯æŸäº›åˆ«çš„ä»£ç ï¼Œè¿™äº›ä»£ç è´Ÿè´£å‡†å¤‡å¥½<code>main</code>å‡½æ•°æ‰§è¡Œæ‰€éœ€è¦çš„ç¯å¢ƒï¼Œå¹¶ä¸”è´Ÿè´£è°ƒç”¨<code>main</code>å‡½æ•°ï¼Œè¿™æ—¶å€™æ‰å¯ä»¥ç”³è¯·å†…å­˜ï¼Œä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œè§¦å‘å¼‚å¸¸ï¼Œè®¿é—®I/Oã€‚åœ¨å‡½æ•°è¿”å›ä¹‹åä¼šè®°å½•<code>main</code>çš„è¿”å›å€¼ï¼Œè°ƒç”¨<code>atexit</code>æ³¨å†Œçš„å‡½æ•°ï¼Œç„¶åç»“æŸè¿›ç¨‹ã€‚</p><p>è¿è¡Œè¿™äº›ä»£ç çš„å‡½æ•°æˆä¸º<strong>å…¥å£å‡½æ•°</strong>æˆ–è€…<strong>å…¥å£ç‚¹</strong>ã€‚è¿™äº›éƒ½æ˜¯è¿è¡Œåº“çš„ä¸€éƒ¨åˆ†ã€‚ä¸ªäººç†è§£è¿è¡Œåº“çš„æ¦‚å¿µå°±æ˜¯æ“ä½œç³»ç»Ÿå’Œåº”ç”¨å±‚çš„æ¥å£ï¼ŒåŒºåˆ«äºç³»ç»Ÿè°ƒç”¨ï¼Œæ¯”å¦‚Glibcé‚£æ ·ã€‚</p><h1 id="å¸¸ç”¨äºŒè¿›åˆ¶å·¥å…·åŸºäºllvm">å¸¸ç”¨äºŒè¿›åˆ¶å·¥å…·(åŸºäºLLVM)</h1><table><thead><tr class="header"><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr class="odd"><td><code>llvm-size</code></td><td>æŸ¥çœ‹ELFæ–‡ä»¶çš„å„ä¸ªæ®µçš„å¤§å°</td></tr><tr class="even"><td><code>llvm-readelf -h</code></td><td>æŸ¥çœ‹ELF Header(éƒ¨åˆ†)</td></tr><tr class="odd"><td><code>llvm-readelf -S</code></td><td>æŸ¥çœ‹ELF Header(å…¨éƒ¨)</td></tr><tr class="even"><td><code>llvm-objdump -s</code></td><td>å°†æ‰€æœ‰ELFæ®µä»¥åå…­è¿›åˆ¶çš„æ–¹å¼æ‰“å°</td></tr><tr class="odd"><td><code>llvm-objdump -d</code></td><td>å°†æ‰€æœ‰æŒ‡ä»¤æ®µåæ±‡ç¼– <strong>å­—èŠ‚å¯»å€,å°ç«¯</strong></td></tr><tr class="even"><td><code>llvm-nm</code></td><td>æŸ¥çœ‹ELFæ–‡ä»¶çš„ç¬¦å·è¡¨</td></tr><tr class="odd"><td><code>c++filt</code></td><td>è§£æå‡½æ•°ç­¾å</td></tr><tr class="even"><td><code>ld a.o b.o -e main -o ab</code></td><td>ç›´æ¥ä½¿ç”¨é“¾æ¥å™¨ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶abï¼ˆå°†mainå‡½æ•°ä½œä¸ºç¨‹åºå…¥å£ï¼‰</td></tr><tr class="odd"><td><code>llvm-objdump -r</code></td><td>æŸ¥çœ‹ç›®æ ‡æ–‡ä»¶çš„é‡å®šä½è¡¨</td></tr><tr class="even"><td><code>ar -t libc.a</code></td><td>æŸ¥çœ‹é™æ€é“¾æ¥åº“åŒ…å«äº†é‚£äº›æ–‡ä»¶</td></tr><tr class="odd"><td><code>clang -fPIC -shared lib.so  lib.c</code></td><td>ç¼–è¯‘ä¸€ä¸ªå…±äº«å¯¹è±¡æ–‡ä»¶</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;abstract&quot;&gt;Abstract&lt;/h1&gt;
&lt;p&gt;ä»å¼€å§‹æ¥è§¦ç¼–è¯‘ç³»ç»Ÿçš„å­¦ä¹ å·²ç»å¿«åŠå¹´äº†ï¼Œæœ‰äº›å¿ƒå¾—æ€»ç»“ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;ä»€ä¹ˆæ˜¯ç¼–è¯‘ç³»ç»Ÿï¼Ÿæˆ‘æƒ³ä»ä¸¤ä¸ªè§’åº¦è°ˆä¸€ä¸‹ï¼š&lt;/p&gt;
&lt;p&gt;é¦–å…ˆä»æŠ€æœ¯è§’åº¦æ¥è®²ï¼Œå¹¿ä¹‰çš„ç¼–è¯‘ç³»ç»Ÿè´Ÿè´£å°†é«˜çº§è¯­è¨€è½¬æ¢æˆä¸ºCPUå¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æœºå™¨ä»£ç ã€‚ç¼–è¯‘ç³»ç»ŸåŒ…æ‹¬&lt;strong&gt;ç¼–è¯‘å™¨&lt;/strong&gt;ï¼Œ &lt;strong&gt;æ±‡ç¼–å™¨&lt;/strong&gt;ï¼Œ&lt;strong&gt;é™æ€/åŠ¨æ€é“¾æ¥å™¨&lt;/strong&gt;ï¼Œ&lt;strong&gt;æ“ä½œç³»ç»Ÿè£…è½½å™¨&lt;/strong&gt;ä»¥åŠ&lt;strong&gt;è¿è¡Œåº“&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç¼–è¯‘å™¨ï¼š æ˜¯ç³»ç»Ÿå‰åŠéƒ¨åˆ†çš„æ ¸å¿ƒï¼Œè´Ÿè´£å°†æºæ–‡ä»¶&lt;strong&gt;.c&lt;/strong&gt;è½¬æ¢æˆä¸ºæ±‡ç¼–æ–‡ä»¶&lt;strong&gt;.s&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;æ±‡ç¼–/é“¾æ¥/è£…è½½å™¨ï¼šæ˜¯ç³»ç»ŸååŠéƒ¨åˆ†çš„æ ¸å¿ƒï¼Œä¸»è¦æ˜¯å°†&lt;strong&gt;.s&lt;/strong&gt;è½¬æ¢ä¸º&lt;strong&gt;äºŒè¿›åˆ¶ELFæ–‡ä»¶&lt;/strong&gt;å¹¶è¿›ä¸€æ­¥å›´ç»•&lt;strong&gt;ELF&lt;/strong&gt;å¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;è¿è¡Œåº“ï¼šæ˜¯æ“ä½œç³»ç»Ÿå±‚é¢ç”¨æ¥æ”¯æŒ&lt;strong&gt;é«˜çº§è¯­è¨€è¿è¡Œç¯å¢ƒ&lt;/strong&gt;æ¯”å¦‚å†…å­˜æ± ï¼Œæ ‡å‡†APIç­‰çš„åº“æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç„¶åä»ä¸“ä¸šçš„è§’åº¦æ¥è®²ï¼Œæˆ‘è§‰å¾—å¯ä»¥åˆ†ä¸º&lt;strong&gt;ç³»ç»Ÿå±‚é¢&lt;/strong&gt;å’Œ&lt;strong&gt;ç®—æ³•ä¼˜åŒ–å±‚é¢&lt;/strong&gt;ï¼Œç³»ç»Ÿå±‚é¢ä¸»è¦æ˜¯æ•´ä¸ªç¼–è¯‘æ¡†æ¶æ¯”å¦‚LLVMï¼Œæ ¸å¿ƒæ˜¯å’Œæ“ä½œç³»ç»Ÿäº¤äº’çš„éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†å†…å®¹æ˜¯ç¼–è¯‘å™¨å·¥ç¨‹å¸ˆçš„åŸºæœ¬åŠŸï¼Œéœ€è¦æŒæ¡ç»†èŠ‚ã€‚è€Œç®—æ³•ä¼˜åŒ–å±‚é¢æŒ‡çš„æ˜¯&lt;strong&gt;ç¼–è¯‘ä¼˜åŒ–&lt;/strong&gt;â€”â€”ç¼–è¯‘å™¨å·¥ç¨‹å¸ˆçš„æœ€ç†æƒ³çš„æ–¹å‘å°±æ˜¯åšä¼˜åŒ–ï¼Œè¿™ä¸€éƒ¨åˆ†éœ€è¦ç²¾é€šï¼Œä»é™æ€å•èµ‹å€¼SSAç­‰ä¼ ç»Ÿçš„é™æ€åˆ†æä¼˜åŒ–åˆ°ç°åœ¨ä¸»æµçš„æ·±åº¦å­¦ä¹ æ¨ç†å¼•æ“æ¯”å¦‚TVMç­‰ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦æ˜¯å¯¹ç³»ç»Ÿå±‚é¢çš„å­¦ä¹ ï¼Œå¯¹ç³»ç»Ÿå±‚é¢çš„å­¦ä¹ æ­¢æ­¥äºå¯¹LLVMç¼–è¯‘æ¡†æ¶çš„ä½¿ç”¨å’Œæºä»£ç é˜…è¯»ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="C++" scheme="http://haotianmcihael.github.io/categories/C/"/>
    
    
      <category term="Compiler" scheme="http://haotianmcihael.github.io/tags/Compiler/"/>
    
      <category term="LLVM" scheme="http://haotianmcihael.github.io/tags/LLVM/"/>
    
      <category term="Linker" scheme="http://haotianmcihael.github.io/tags/Linker/"/>
    
      <category term="Loader" scheme="http://haotianmcihael.github.io/tags/Loader/"/>
    
  </entry>
  
  <entry>
    <title>GCC-RISCVäº¤å‰ç¼–è¯‘å·¥å…·é“¾</title>
    <link href="http://haotianmcihael.github.io/2020/02/16/Gcc-RISCV%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E5%B7%A5%E5%85%B7%E9%93%BE/"/>
    <id>http://haotianmcihael.github.io/2020/02/16/Gcc-RISCVäº¤å‰ç¼–è¯‘å·¥å…·é“¾/</id>
    <published>2020-02-15T18:16:45.000Z</published>
    <updated>2022-03-16T10:25:43.082Z</updated>
    
    <content type="html"><![CDATA[<h3 id="absrtact">Absrtact</h3><p>æ—¨åœ¨x86å¹³å°ä¸Šç¼–è¯‘RISCVæ¶æ„çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><p>RISCVä½œä¸ºä¸€æ¬¾æå…·ä½¿å‘½æ„Ÿçš„æŒ‡ä»¤é›†ï¼Œå…¶è½¯ä»¶æ ˆä¹Ÿæ˜¯éå¸¸å®Œæ•´çš„ã€‚äº¤å‰ç¼–è¯‘ç¯å¢ƒå¯ä»¥åœ¨<a href="https://github.com/riscv/riscv-gnu-toolchain" target="_blank" rel="noopener">è¿™é‡Œ</a>ä¸‹è½½ã€‚</p><p>äº¤å‰ç¼–è¯‘å·¥å…·é“¾åŒ…æ‹¬:</p><ul><li><code>GCC</code>ç¼–è¯‘å™¨</li><li>Cè¿è¡Œåº“<ul><li><code>Glibc</code> : <code>gnu</code>æ——ä¸‹çš„åº“ï¼Œä½œä¸º<code>linux</code>çš„æ ‡å‡†åº“å’Œå†…æ ¸æ‰“äº¤é“</li><li><code>Newlib</code>ï¼š åœ¨åµŒå…¥å¼ä¸­ä½¿ç”¨å¹¿æ³›</li></ul></li><li><code>Buntils</code>äºŒè¿›åˆ¶å¥—ä»¶</li><li><code>GDB</code>è°ƒè¯•å™¨</li></ul><a id="more"></a><h3 id="ä¸åŒç‰ˆæœ¬çš„å·¥å…·é“¾">ä¸åŒç‰ˆæœ¬çš„å·¥å…·é“¾</h3><table><thead><tr class="header"><th>Version</th><th>Note</th></tr></thead><tbody><tr class="odd"><td>Riscv-unknown-linux-gnu-gcc</td><td><sup>1</sup>32ä½æ¶æ„çš„<sup>2</sup><strong>Linuxç‰ˆæœ¬</strong></td></tr><tr class="even"><td>Riscv-unknown-elf-gcc</td><td>32ä½æ¶æ„çš„<strong>éLinuxç‰ˆæœ¬</strong></td></tr></tbody></table><ul><li>æ¯ä¸ªç‰ˆæœ¬éƒ½æœ‰32ä½æ¶æ„å’Œ64ä½æ¶æ„ï¼Œè¿™é‡Œçš„ä½æ•°å’Œè¿è¡Œæœ¬æœºçš„å­—é•¿æ— å…³ï¼Œ<strong>æŒ‡çš„æ˜¯æ²¡æœ‰é€šè¿‡<code>-march=</code>å’Œ<code>-mabi=</code>é€‰é¡¹æŒ‡å®šRISCVæ¶æ„çš„ä½å®½</strong></li><li><strong>Linuxç‰ˆæœ¬</strong>æŒ‡çš„æ˜¯<strong>è¯¥å·¥å…·é“¾ä½¿ç”¨Linuxç³»ç»Ÿä¸­è¿è¡Œçš„<code>Glibc</code>ä½œä¸ºCè¿è¡Œåº“â€”â€”</strong>å¦å¤–çš„ä¸ªç‰ˆæœ¬åˆ™ä½¿ç”¨<code>Newlibc</code>åº“</li></ul><h3 id="äº¤å‰ç¼–è¯‘é€‰é¡¹">äº¤å‰ç¼–è¯‘é€‰é¡¹</h3><h4 id="march">-march=</h4><p>â€‹ ç”±äº<span class="math inline">\(RISCV\)</span>ä¸ºæ¨¡å—åŒ–æŒ‡ä»¤ï¼Œè¯¥é€‰é¡¹æ”¯æŒä¸åŒçš„æ¨¡å—åŒ–æŒ‡ä»¤é›†ç»„åˆ,å…³äº<span class="math inline">\(RISCV\)</span>æ¨¡å—è§åé¢çš„ä»‹ç»:</p><ul><li><code>rv32i[m][a][f[d]][c]</code></li><li><code>rv32g[c]</code></li><li><code>rv64i[m][a][f[d]][c]</code></li><li><code>rv64g[c]</code></li></ul><h4 id="mabi">-mabi=</h4><p>â€‹ è¯¥é€‰é¡¹é€‰å®šäº†ç›®æ ‡å¹³å°æ‰€æ”¯æŒçš„<code>ABI</code>å‡½æ•°è°ƒç”¨:</p><ul><li><code>ilp32</code>ï¼Œ<code>ilp32f</code>ï¼Œ<code>ilp32d</code> 32ä½æ¶æ„(int-32ä½ long-32ä½ long long-64ä½)</li><li><code>lp64</code>ï¼Œ<code>lp64f</code>ï¼Œ<code>lp64d</code> 64ä½æ¶æ„(int-32ä½ long-64ä½)</li></ul><h4 id="åç¼€">åç¼€</h4><table><thead><tr class="header"><th>suffix</th><th>Note</th></tr></thead><tbody><tr class="odd"><td>--</td><td>ä½¿ç”¨æµ®ç‚¹ç±»å‹æ“ä½œç›´æ¥ä½¿ç”¨RISCVæµ®ç‚¹æŒ‡ä»¤è¿›è¡Œæ”¯æŒï¼Œä½†æ˜¯å½“æµ®ç‚¹æ•°ä½œä¸ºå‡½æ•°å‚æ•°è¿›è¡Œä¼ é€’æ—¶ï¼Œæ— è®ºæ˜¯å•ç²¾åº¦è¿˜æ˜¯åŒç²¾åº¦å‡éœ€è¦å­˜å‚¨å™¨ä¸­çš„å †æ ˆè¿›è¡Œä¼ é€’</td></tr><tr class="even"><td>-f</td><td>ä½¿ç”¨æµ®ç‚¹ç±»å‹æ“ä½œç›´æ¥ä½¿ç”¨RISCVæµ®ç‚¹æŒ‡ä»¤è¿›è¡Œæ”¯æŒï¼Œä½†æ˜¯å½“æµ®ç‚¹æ•°ä½œä¸ºå‡½æ•°å‚æ•°è¿›è¡Œä¼ é€’æ—¶ï¼Œå•ç²¾åº¦é€šè¿‡å¯„å­˜æ‹¿èµ·ä¼ é€’ï¼ŒåŒç²¾åº¦é€šè¿‡å†…å­˜å †æ ˆä¼ é€’</td></tr><tr class="odd"><td>-d</td><td>ä½¿ç”¨æµ®ç‚¹ç±»å‹æ“ä½œç›´æ¥ä½¿ç”¨RISCVæµ®ç‚¹æŒ‡ä»¤è¿›è¡Œæ”¯æŒï¼Œä½†æ˜¯å½“æµ®ç‚¹æ•°ä½œä¸ºå‡½æ•°å‚æ•°è¿›è¡Œä¼ é€’æ—¶ï¼Œå•/åŒç²¾åº¦å‡å¯é€šè¿‡å¯„å­˜å™¨ä¼ é€’</td></tr></tbody></table><p><strong>åªæœ‰<code>-march=</code>æ”¯æŒæµ®ç‚¹æ‰©å±•ï¼Œ(-mabi=)æ‰å…è®¸åŠ ä¸Š<code>f/d</code>åç¼€ä»¥æ”¯æŒæµ®ç‚¹è¿ç®—ã€‚</strong></p><p><img src="1.png" width="50%" height="50%" alt=""></p><h3 id="riscvæ±‡ç¼–è¯­è¨€ç®€ä»‹">RISCVæ±‡ç¼–è¯­è¨€ç®€ä»‹</h3><p><img src="2.png" width="50%" height="50%" alt=""></p><h3 id="æ€»ç»“">æ€»ç»“</h3><p>ç›®å‰äº¤å‰ç¼–è¯‘å¹³å°ä¸»è¦æœ‰ä¸¤éƒ¨åˆ†: <code>riscv32-unknown-elf-gcc</code>å¹³å°ç¼–è¯‘ç”Ÿæˆ<span class="math inline">\(RISCV\)</span>å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œ<code>qemu-riscv32</code>å¹³å°è¿è¡Œ<code>RISCV</code>å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><p><code>qemu</code>æ˜¯ä¸€æ¬¾å¾ˆå¼ºå¤§çš„è™šæ‹Ÿæœºï¼Œåˆ†ä¸ºç³»ç»Ÿæ¨¡å¼å’Œç”¨æˆ·æ¨¡å¼ï¼Œç”¨æˆ·æ¨¡å¼è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œç³»ç»Ÿæ¨¡å¼æ¨¡æ‹Ÿç‰¹å®šæŒ‡ä»¤é›†ä»è€Œè¿è¡Œæ“ä½œç³»ç»Ÿé•œåƒæ–‡ä»¶ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;absrtact&quot;&gt;Absrtact&lt;/h3&gt;
&lt;p&gt;æ—¨åœ¨x86å¹³å°ä¸Šç¼–è¯‘RISCVæ¶æ„çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;RISCVä½œä¸ºä¸€æ¬¾æå…·ä½¿å‘½æ„Ÿçš„æŒ‡ä»¤é›†ï¼Œå…¶è½¯ä»¶æ ˆä¹Ÿæ˜¯éå¸¸å®Œæ•´çš„ã€‚äº¤å‰ç¼–è¯‘ç¯å¢ƒå¯ä»¥åœ¨&lt;a href=&quot;https://github.com/riscv/riscv-gnu-toolchain&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;è¿™é‡Œ&lt;/a&gt;ä¸‹è½½ã€‚&lt;/p&gt;
&lt;p&gt;äº¤å‰ç¼–è¯‘å·¥å…·é“¾åŒ…æ‹¬:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;GCC&lt;/code&gt;ç¼–è¯‘å™¨&lt;/li&gt;
&lt;li&gt;Cè¿è¡Œåº“
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;Glibc&lt;/code&gt; : &lt;code&gt;gnu&lt;/code&gt;æ——ä¸‹çš„åº“ï¼Œä½œä¸º&lt;code&gt;linux&lt;/code&gt;çš„æ ‡å‡†åº“å’Œå†…æ ¸æ‰“äº¤é“&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Newlib&lt;/code&gt;ï¼š åœ¨åµŒå…¥å¼ä¸­ä½¿ç”¨å¹¿æ³›&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;Buntils&lt;/code&gt;äºŒè¿›åˆ¶å¥—ä»¶&lt;/li&gt;
&lt;li&gt;&lt;code&gt;GDB&lt;/code&gt;è°ƒè¯•å™¨&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Assembly" scheme="http://haotianmcihael.github.io/categories/Assembly/"/>
    
    
      <category term="RISCV" scheme="http://haotianmcihael.github.io/tags/RISCV/"/>
    
      <category term="Compiler" scheme="http://haotianmcihael.github.io/tags/Compiler/"/>
    
  </entry>
  
  <entry>
    <title>ä»syscallçš„è§’åº¦ç†è§£æ“ä½œç³»ç»Ÿ</title>
    <link href="http://haotianmcihael.github.io/2019/06/25/%E4%BB%8Esyscall%E7%9A%84%E8%A7%92%E5%BA%A6%E7%90%86%E8%A7%A3%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
    <id>http://haotianmcihael.github.io/2019/06/25/ä»syscallçš„è§’åº¦ç†è§£æ“ä½œç³»ç»Ÿ/</id>
    <published>2019-06-25T06:34:20.000Z</published>
    <updated>2022-03-16T09:53:19.648Z</updated>
    
    <content type="html"><![CDATA[<h1 id="abstract">Abstract</h1><p>æ“ä½œç³»ç»Ÿæ§åˆ¶ç¡¬ä»¶èµ„æºå¹¶å®Œæˆåº•å±‚æŠ½è±¡ã€‚</p><p>UNIXå’ŒCçš„å‘å±•ä¸€è„‰ç›¸æ‰¿ã€‚20ä¸–çºª80å¹´ä»£ä»¥æ¥ï¼Œé’ˆå¯¹UNIXçš„å„ç§<strong>æ ‡å‡†åŒ–å·¥ä½œ</strong>å¯¹å…¶å®ç°æä¾›äº†å…·ä½“çš„é™åˆ¶ä»¥æ­¤æ¥å®Œå–„ç³»ç»Ÿä¸åŒå®ç°ä¹‹é—´çš„å¯ç§»æ¤æ€§â€”â€”<strong>ISO-Cï¼ŒIEEE-POSIXä»¥åŠSingle UNIX Specification</strong>ç­‰ç­‰ã€‚</p><p><strong>è¿™äº›æ ‡å‡†æœ¬è´¨ä¸Šæ˜¯åº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿæ¥å£çš„å­é›†ã€‚</strong>ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„å…·ä½“å®ç°é™¤äº†å†…æ ¸ä¹‹å¤–ï¼Œæœ€é‡è¦çš„å°±æ˜¯å¯¹APIçš„å°è£…ã€‚<strong>UNIXä¸€èˆ¬é€šè¿‡ç³»ç»Ÿè°ƒç”¨å’Œè¿è¡Œåº“çš„æ–¹å¼æ¥å®Œæˆåº”ç”¨ç¨‹åºæ¥å£ï¼Œæ¯”å¦‚GNUä¸ºLinuxå¼€å‘çš„Gblicå°±æ”¯æŒISO-Cå’ŒIEEE-POSIXç­‰æ ¸å¿ƒæ ‡å‡†ã€‚</strong></p><p>ä¸ªäººè§‰å¾—ä»<strong>ç³»ç»Ÿç¼–ç¨‹å’Œå†…å­˜</strong>çš„è§’åº¦å»ç†è§£<strong>æ–‡ä»¶ç³»ç»Ÿ</strong>å’Œ<strong>è¿›ç¨‹/çº¿ç¨‹</strong>ç­‰OSæ ¸å¿ƒæ¦‚å¿µä¼šæ¯”è¾ƒæœ‰è¶£ã€‚</p><a id="more"></a><h1 id="æ–‡ä»¶ç³»ç»Ÿ">æ–‡ä»¶ç³»ç»Ÿ</h1><p>æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ç§æŒä¹…æ€§å­˜å‚¨çš„ç³»ç»ŸæŠ½è±¡ã€‚å¹¶æ¶‰åŠåˆ°<strong>ç£ç›˜ç©ºé—´</strong>å’Œ<strong>å†…å­˜ç©ºé—´</strong>çš„IOæ“ä½œï¼Œæ¯”è¾ƒéš¾ç†è§£ï¼š</p><ul><li><strong>æ–‡ä»¶æè¿°ç¬¦è¡¨</strong>ï¼Œ<strong>æ‰“å¼€æ–‡ä»¶è¡¨</strong>ï¼Œ<strong>ièŠ‚ç‚¹</strong>æ˜¯æ–‡ä»¶å­˜å‚¨çš„æœ¬è´¨ï¼Œè€Œ<strong>æ–‡ä»¶é•¿åº¦</strong>ï¼Œ<strong>æ–‡ä»¶åç§»é‡</strong>ï¼Œ<strong>æ–‡ä»¶æ‰€å ç£ç›˜ç©ºé—´</strong>ï¼Œ<strong>æ–‡ä»¶ç”¨æˆ·æƒé™</strong>æ˜¯æ–‡ä»¶çš„é‡è¦å±æ€§ã€‚å¯ä»¥ä»<code>dup</code>ï¼Œ<code>lseek</code>ï¼Œ<code>stat/chmod</code>ç­‰å‡½æ•°ç†è§£</li><li><strong>ç†è§£å†…æ ¸è·å–æ–‡ä»¶çš„è¿‡ç¨‹æ˜¯æœ€æ ¸å¿ƒçš„</strong>ã€‚è¿™æ¶‰åŠåˆ°<strong>å†…æ ¸é¡µé«˜é€Ÿç¼“å­˜</strong>ï¼Œ<strong>ç”¨æˆ·åŒºé—´ç¼“å†²åŒº</strong>ï¼Œ<strong>æ ‡å‡†IOç¼“å†²åŒº</strong>ç­‰æ ¸å¿ƒæ¦‚å¿µã€‚å¯ä»¥ä»<code>read/write</code>ï¼Œ<code>fgets/fputs</code>ï¼Œ<code>sync/flush</code>å‡½æ•°ç†è§£</li><li>ä»<strong>ç”¨æˆ·æ—¶é—´</strong>å’Œ<strong>CPUæ—¶é—´</strong>ç†è§£æ ‡å‡†IOå‡½æ•°å’Œ<code>read/write</code>ç­‰ç³»ç»Ÿè°ƒç”¨ã€‚<strong>ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€è¦å¤§äºå‡½æ•°è°ƒç”¨ã€‚</strong>è€Œè¿™ä¸€åˆ‡éƒ½å–å†³äºåŒæ–¹ç¼“å†²åŒºçš„é€‰æ‹©</li></ul><h1 id="è¿›ç¨‹">è¿›ç¨‹</h1><p>è¿›ç¨‹æ˜¯ç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºåœ¨æ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡åŠ¨æ€æ‰§è¡Œè¿‡ç¨‹ã€‚</p><ul><li>å‡†å¤‡</li><li>å°±ç»ª</li><li>é˜»å¡</li><li>æ‰§è¡Œ</li><li>ç»“æŸ</li></ul><p>å†…æ ¸ä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤ä¸€ä¸ª<strong>è¿›ç¨‹æ§åˆ¶å—</strong>ï¼Œä»<code>fork/exit/wait</code>ç­‰å‡½æ•°å¯ä»¥ç†è§£è¿™äº›çŠ¶æ€ã€‚å¦å¤–<code>fork/exec</code>åŒºåˆ†äº†çˆ¶å­è¿›ç¨‹åœ¨åˆ›å»ºå‰åæ‰€å…±äº«çš„èµ„æºï¼š</p><ul><li>ä»£ç æ®µï¼ˆ<strong>ä½†æ˜¯å­è¿›ç¨‹è·å¾—çˆ¶è¿›ç¨‹æ•°æ®ç©ºé—´ï¼Œå †æ ˆç©ºé—´çš„å‰¯æœ¬</strong>ï¼‰</li><li>æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦</li><li>å®é™…IDï¼Œæœ‰æ•ˆIDï¼Œè®¾ç½®ID</li><li>å­˜å‚¨æ˜ åƒ</li></ul><h1 id="çº¿ç¨‹">çº¿ç¨‹</h1><p>æ¯ä¸ªçº¿ç¨‹éƒ½åŒ…å«åˆè¡¨ç¤ºæ‰§è¡Œç¯å¢ƒæ‰€å¿…éœ€çš„ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬è¿›ç¨‹ä¸­è¡¨ç¤ºçº¿ç¨‹çš„çº¿ç¨‹IDï¼Œä¸€ç»„å¯„å­˜å™¨å€¼ï¼Œæ ˆï¼Œè°ƒåº¦ä¼˜å…ˆçº§å’Œç­–ç•¥ï¼Œä¿¡å·å±è”½å­—ï¼Œerrnoå˜é‡ä»¥åŠçº¿ç¨‹ç§æœ‰æ•°æ®ã€‚<strong>ä¸€ä¸ªè¿›ç¨‹çš„çš„æ‰€æœ‰ä¿¡æ¯å¯¹è¯¥è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯å…±äº«çš„ï¼ŒåŒ…æ‹¬å¯æ‰§è¡Œç¨‹åºçš„ä»£ç ï¼Œç¨‹åºçš„å…¨å±€å†…å­˜å’Œå †å†…å­˜ï¼Œæ ˆä»¥åŠæ–‡ä»¶æè¿°ç¬¦ã€‚</strong></p><ul><li>è¿›ç¨‹æ˜¯èµ„æºåˆ†é…å•ä½</li><li>çº¿ç¨‹æ˜¯CPUè°ƒåº¦å•ä½</li></ul><p><strong>å¤šçº¿ç¨‹åˆ‡æ¢å› ä¸ºç›¸åŒé‚£é‚£ä¸ªçš„åœ°å€ç©ºé—´â€”â€”é¡µè¡¨ï¼Œå› æ­¤åˆ‡æ¢æ›´å¿«ã€‚</strong></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;abstract&quot;&gt;Abstract&lt;/h1&gt;
&lt;p&gt;æ“ä½œç³»ç»Ÿæ§åˆ¶ç¡¬ä»¶èµ„æºå¹¶å®Œæˆåº•å±‚æŠ½è±¡ã€‚&lt;/p&gt;
&lt;p&gt;UNIXå’ŒCçš„å‘å±•ä¸€è„‰ç›¸æ‰¿ã€‚20ä¸–çºª80å¹´ä»£ä»¥æ¥ï¼Œé’ˆå¯¹UNIXçš„å„ç§&lt;strong&gt;æ ‡å‡†åŒ–å·¥ä½œ&lt;/strong&gt;å¯¹å…¶å®ç°æä¾›äº†å…·ä½“çš„é™åˆ¶ä»¥æ­¤æ¥å®Œå–„ç³»ç»Ÿä¸åŒå®ç°ä¹‹é—´çš„å¯ç§»æ¤æ€§â€”â€”&lt;strong&gt;ISO-Cï¼ŒIEEE-POSIXä»¥åŠSingle UNIX Specification&lt;/strong&gt;ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿™äº›æ ‡å‡†æœ¬è´¨ä¸Šæ˜¯åº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿæ¥å£çš„å­é›†ã€‚&lt;/strong&gt;ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„å…·ä½“å®ç°é™¤äº†å†…æ ¸ä¹‹å¤–ï¼Œæœ€é‡è¦çš„å°±æ˜¯å¯¹APIçš„å°è£…ã€‚&lt;strong&gt;UNIXä¸€èˆ¬é€šè¿‡ç³»ç»Ÿè°ƒç”¨å’Œè¿è¡Œåº“çš„æ–¹å¼æ¥å®Œæˆåº”ç”¨ç¨‹åºæ¥å£ï¼Œæ¯”å¦‚GNUä¸ºLinuxå¼€å‘çš„Gblicå°±æ”¯æŒISO-Cå’ŒIEEE-POSIXç­‰æ ¸å¿ƒæ ‡å‡†ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;ä¸ªäººè§‰å¾—ä»&lt;strong&gt;ç³»ç»Ÿç¼–ç¨‹å’Œå†…å­˜&lt;/strong&gt;çš„è§’åº¦å»ç†è§£&lt;strong&gt;æ–‡ä»¶ç³»ç»Ÿ&lt;/strong&gt;å’Œ&lt;strong&gt;è¿›ç¨‹/çº¿ç¨‹&lt;/strong&gt;ç­‰OSæ ¸å¿ƒæ¦‚å¿µä¼šæ¯”è¾ƒæœ‰è¶£ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="C" scheme="http://haotianmcihael.github.io/categories/C/"/>
    
    
      <category term="OS" scheme="http://haotianmcihael.github.io/tags/OS/"/>
    
      <category term="UNIX" scheme="http://haotianmcihael.github.io/tags/UNIX/"/>
    
      <category term="Syscall" scheme="http://haotianmcihael.github.io/tags/Syscall/"/>
    
  </entry>
  
  <entry>
    <title>Mit6.828(Fall 2018) Lab2</title>
    <link href="http://haotianmcihael.github.io/2018/11/22/Mit6-828-Fall-2018-Lab2/"/>
    <id>http://haotianmcihael.github.io/2018/11/22/Mit6-828-Fall-2018-Lab2/</id>
    <published>2018-11-21T20:51:42.000Z</published>
    <updated>2022-03-16T10:32:07.137Z</updated>
    
    <content type="html"><![CDATA[<h2 id="lab2">Lab2</h2><h3 id="before-lab">Before Lab</h3><p>Lab2çš„ä¸»è¦å†…å®¹:<code>Physical Page Management</code>,<code>Virtual Memroy</code>,<code>Kernel Address Space</code>;<strong>ä»£ç å®ç°JOSä¸­çš„å†…å­˜åˆ†é¡µç®¡ç†åŠŸèƒ½ï¼Œæœ‰é¡µé¢ç®¡ç†å’Œé¡µè¡¨ç®¡ç†ä¸¤éƒ¨åˆ†ã€‚</strong>å’Œç†è®ºç›¸æ¯”ï¼Œä»£ç å®ç°éœ€è¦è€ƒè™‘çš„ç»†èŠ‚çœŸæ˜¯å¤ªå¤šã€‚å®éªŒæœ€ç»ˆçš„ç›®çš„æ˜¯é€šè¿‡å‡ ä¸ªæ£€æµ‹å‡½æ•°:</p><p><img src="1.png" width="50%" height="50%" alt=""></p><p>Lab1å®Œæˆæ—¶æ•´ä¸ªJOSå†…å­˜å¸ƒå±€å¦‚ä¸‹å›¾:</p><p><img src="9.png" width="50%" height="50%" alt=""></p><p>åˆ‡æ¢åˆå¹¶Gitåˆ†æ”¯çš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°å†²çªï¼Œéœ€è¦æ‰‹åŠ¨æ³¨é‡Šæ‰Lab1ä¸­çš„ä¸€äº›æµ‹è¯•ä»£ç æ¥è§£å†³ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ <a id="more"></a></p><h3 id="memlayout.hå’Œpmap.h">memlayout.hå’Œpmap.h</h3><p>æŒæ¡è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„å‡½æ•°æ˜¯å®ŒæˆLab2å¿…ä¸å¯å°‘çš„æ¡ä»¶ï¼Œåœ¨æ­¤è¿›è¡Œæ€»ç»“ã€‚</p><h4 id="pmap.h">pmap.h</h4><p>Lab2ä¸­éœ€è¦é‡ç‚¹å…³æ³¨çš„å¯¹è±¡æœ‰ä¸‰ä¸ª:ç‰©ç†å†…å­˜ï¼Œè™šæ‹Ÿå†…å­˜ï¼Œç©ºé—²é“¾è¡¨<strong><code>struct PageInfo</code></strong>ã€‚è¯¥å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°å®ç°äº†ä¸‰è€…ä¹‹é—´çš„ç›¸äº’è½¬åŒ–ã€‚</p><p><img src="2.png" width="50%" height="50%" alt=""></p><p>å¦å¤–è¿˜æœ‰å‡ ä¸ªå¤–éƒ¨å˜é‡ä¹Ÿéœ€è¦é‡ç‚¹å…³æ³¨ä¸€ä¸‹:</p><ul><li><code>bootstack</code> å†…æ ¸æ ˆ</li><li><code>pages</code> æ‰€æœ‰ç‰©ç†å†…å­˜æŒ‰ç…§4KBåˆ’åˆ†çš„å¯¹åº”æ˜ å°„æ•°ç»„</li><li><code>npage</code> æ•°ç»„å…ƒç´ ä¸ªæ•°</li><li><code>kern_pgdir</code> é¡µç›®å½•</li></ul><p><strong>æ³¨æ„pagesä¸æ˜¯ç©ºé—²é“¾è¡¨ï¼Œä»…ä»…åªæ˜¯ä¸€ä¸ªæ•°ç»„è€Œå·²ã€‚è€Œpagesæ•°ç»„ç´¢å¼•å°±æ˜¯æ‰€æœ‰é¡µå¼ç‰©ç†å†…å­˜çš„ç´¢å¼•ã€‚</strong>æ‰€ä»¥<code>struct PageInfo *pp</code>å’Œç‰©ç†å†…å­˜å…³ç³»å¾ˆç´§å¯†ï¼š**(pp-pages)*4KBå°±æ˜¯è¯¥æ•°ç»„å…ƒç´ å¯¹åº”çš„ç‰©ç†é¡µé¢pageçš„ç‰©ç†åœ°å€**ï¼Œè¿™ä¹Ÿæ˜¯<code>page2pa</code>å‡½æ•°çš„åŸå‹ã€‚</p><h4 id="memlayout.h">memlayout.h</h4><p>ä»‹ç»äº†JOSè™šæ‹Ÿå†…å­˜çš„è¯¦ç»†å¸ƒå±€ï¼Œå®šä¹‰äº†æ‰€æœ‰éœ€è¦ä½¿ç”¨çš„å®ã€‚<strong>åœ¨Lab2ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆçš„æ˜¯å†…æ ¸éƒ¨åˆ†è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†çš„æ˜ å°„ã€‚æ‰€ä»¥é‡ç‚¹å…³æ³¨çš„æ˜¯UTOPä¹‹ä¸Šçš„å¸ƒå±€.</strong>å½“ç„¶éœ€è¦æ³¨æ„çš„ç»†èŠ‚å°±å¾ˆå¤šäº†ï¼Œæ¯”å¦‚å¤§å°ï¼Œæƒé™ï¼Œæ¯ä¸€éƒ¨åˆ†å†…å­˜çš„ä½œç”¨ç­‰ã€‚</p><p><img src="3.png" width="50%" height="50%" alt=""></p><p>ä¸Šå›¾åªæ˜¯ä¸€ä¸ªç®€åŒ–å›¾ï¼Œç»“åˆæºç çœ‹ä¼šå¥½å¾ˆå¤šï¼Œæ¯”å¦‚ä¸€äº›å’Œå¤§å°æœ‰å…³çš„å®å®šä¹‰:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#define PGSIZE          4096            // bytes mapped by a page</span><br><span class="line">#define KSTKSIZE        (8*PGSIZE)              // size of a kernel stack</span><br><span class="line">#define PTSIZE          (PGSIZE*NPTENTRIES) // bytes mapped by a page directory entry</span><br><span class="line">#define NPTENTRIES      1024            // page table entries per page table</span><br></pre></td></tr></table></figure><p>å…¶ä¸­é˜´å½±éƒ¨åˆ†æŒ‡çš„æ˜¯<code>page_init()</code>å‡½æ•°ä¹‹å‰å·²ç»åˆå§‹åŒ–å¥½çš„ã€‚è¿™æ˜¯å› ä¸ºåœ¨<code>page_init()</code>å‡½æ•°ä¹‹å‰åˆ†é¡µæœºåˆ¶è¿˜æ²¡æœ‰å»ºç«‹å¥½ï¼Œæ‰€ä»¥åªèƒ½ç”¨å­—èŠ‚åˆ†é…çš„æ–¹æ³•åˆ†é…ç‰©ç†å†…å­˜ã€‚è¿™äº›é˜´å½±éƒ¨åˆ†çš„ç‰©ç†å†…å­˜éƒ½æ˜¯<code>boot_alloc(uing32_t n)</code>å‡½æ•°åˆ†é…çš„ï¼›è€Œ<code>page_init()</code>å‡½æ•°ä¹‹åï¼Œæ‰€æœ‰çš„ç‰©ç†å†…å­˜åˆ†é…éƒ½æ˜¯ä»¥é¡µ<strong>Page</strong>ä¸ºå•ä½ï¼Œæ‰€ä»¥å­—èŠ‚åˆ†é…å‡½æ•°<code>boot_alloc()</code>ä¹Ÿè¢«ç¦ç”¨äº†ã€‚</p><h4 id="æ€»ç»“">æ€»ç»“</h4><p>æˆ‘è§‰å¾—æ•´ä¸ªLab2å°±æ˜¯åœ¨å®ç°ä¸¤ç§æ˜ å°„ï¼š<strong>ç‰©ç†å†…å­˜åˆ°ç©ºé—²é“¾è¡¨çš„æ˜ å°„</strong>å’Œ<strong>è™šæ‹Ÿå†…å­˜åˆ°ç‰©ç†å†…å­˜çš„æ˜ å°„</strong>ã€‚è€Œä¸Šè¿°çš„ä¸¤ä¸ªå¤´æ–‡ä»¶åŸºæœ¬è®²æ¸…æ¥šäº†æ˜ å°„éœ€è¦å®ç°çš„æ­¥éª¤å’ŒåŸç†ï¼Œåº”è¯¥åå¤é˜…è¯»ã€‚åˆæ­¤ä¹‹å¤–è¿˜åº”è¯¥å¯¹Cè¯­è¨€çš„<strong>å¼ºè½¬</strong>ï¼Œ<strong>æŒ‡é’ˆ</strong>ï¼Œ<strong>ä½è¿ç®—</strong>æœ‰ä¸€ä¸ªå¾ˆæ·±çš„äº†è§£ï¼Œæœ€å¥½å…ˆçœ‹ä¸€ä¸‹TCPLã€‚</p><h3 id="physical-page-management">Physical Page Management</h3><p>ç†è®ºè¯¾å¾ˆå¤§çš„ä¸€éƒ¨åˆ†ç¼ºå¤±å°±æ˜¯æ²¡æœ‰å¯¹ç‰©ç†å†…å­˜å¸ƒå±€è¿›è¡Œè®²è§£ã€‚è€Œæ²¡æœ‰ç‰©ç†å†…å­˜çš„åŸºç¡€ï¼Œæ˜ å°„ï¼ˆMappingï¼‰æ ¹æœ¬æ— ä»è°ˆèµ·ã€‚é¡µé¢ç®¡ç†åˆ†æå¦‚ä¸‹:<br>ä»ä»£ç è§’åº¦çœ‹ï¼ŒLab2æ¥ä¸ŠLab1ä¸­<code>kern/entry.S</code>è·³è½¬åˆ°<code>kern/init.c</code>ä¸­çš„<code>i386_init()</code>å¼€å§‹æ‰§è¡Œã€‚å¯ä»¥å‘ç°<code>mem_init()</code>å‡½æ•°ï¼Œæ•´ä¸ªLab2å°±æ˜¯å®Œå–„è¿™ä¸ªå†…å­˜å‡½æ•°çš„è¿‡ç¨‹ã€‚è€Œç¬¬ä¸€éƒ¨åˆ†ç‰©ç†å†…å­˜å°±æ˜¯å®Œæˆå°†ç‰©ç†å†…å­˜æ˜ å°„åˆ°ç©ºé—²é“¾è¡¨ä¸Šã€‚<br>PartOneéœ€è¦<strong>å®Œæˆç‰©ç†å†…å­˜çš„ç®¡ç†ï¼Œå¹¶å®ç°ç‰©ç†å†…å­˜çš„å¸ƒå±€ã€‚</strong>è¿™é‡Œçš„å¸ƒå±€æŒ‡çš„æ˜¯å¯¹ç©ºé—²é“¾è¡¨çš„ç®¡ç†ã€‚æ‰€ä»¥<strong>æˆ‘ä»¬é¦–å…ˆè¦åˆ›å»ºç©ºé—²é“¾è¡¨ï¼Œç„¶åç”¨ç©ºé—²é“¾è¡¨å¯¹è¿™ä¸€æ•´å—ç‰©ç†å†…å­˜è¿›è¡Œç®¡ç†ï¼Œå½“ç„¶ç®¡ç†çš„å•ä½æ˜¯Pageï¼ˆ4Kï¼‰</strong>ã€‚<br>åŸºæœ¬ä¸Šéœ€è¦å®ç°çš„ä»£ç éƒ½åœ¨<code>pmap.c</code>ä¸­ã€‚æˆ‘ä»¬ç”¨Taglistç»Ÿç­¹ä¸€ä¸‹è¯¥æ–‡ä»¶ä¸­æ‰€æœ‰çš„å‡½æ•°å’Œå®å®šä¹‰:</p><p><img src="4.png" width="50%" height="50%" alt=""></p><h4 id="boot_alloc">boot_alloc</h4><p>å½¼æ—¶<code>mem_init()</code>å‡½æ•°ä¸­è¿˜åªæœ‰ä¸€ä¸ªå‡½æ•°â€”â€”â€”â€”<code>i386_detect_memory()</code>ã€‚ç”¨æ¥æ£€æµ‹ç‰©ç†å†…å­˜çš„ç¡¬ä»¶çŠ¶æ€åŠå…¶å‚æ•°ï¼Œå…¶ä¸­æœ‰å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„å˜é‡:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npages: æœªåˆ†é…</span><br><span class="line">npages_basemem: 160</span><br><span class="line">kern_pgdir: æœªåˆ†é…</span><br><span class="line">basemem: 640KB</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>basemem=640K</code>æ˜¯å› ä¸ºåœ¨<code>inc/memlayout.h</code>ä¸­å®šä¹‰è¿‡ä¸€ä¸ªå®:<code>#define IOPHYSMEM 0xA0000</code>ã€‚åœ¨Lab1çš„å†…å­˜å¸ƒå±€ä¸­æœ‰è¯¦ç»†çš„åˆ†å¸ƒï¼Œåœ¨è¿™ä¸ªå®å®šä¹‰çš„åœ°å€å¾€ä¸Šæ˜¯ å®æ¨¡å¼ä¸‹IDTå’Œç¬¬ä¸€éƒ¨åˆ†bootsectorã€‚æ‰€ä»¥å°†å®å®šä¹‰ä»¥ä¸‹åˆ°<code>0x00000000</code>çš„å†…å­˜ç§°ä¸ºbase_memã€‚è€Œè¿™éƒ¨åˆ†éœ€è¦è¢«æ˜ å°„åˆ°ç©ºé—²é“¾è¡¨ä¸­ï¼Œæ‰€ä»¥æŒ‰ç…§é¡µå¼å•ä½å¯ä»¥æ˜ å°„640K/4K=160ä¸ªpagesã€‚<br>æ¥ä¸‹æ¥å°±æ˜¯å®ç°ä»£ç ã€‚å› ä¸ºä»£ç å¤ªå¤šä¸æ‰“ç®—è´´å‡ºæ¥ï¼Œä¸»è¦æ˜¯åšLabçš„æ€è·¯å¹¶åˆ†äº«ä¸€äº›å®Œå–„å†…å­˜å¸ƒå±€è¿‡ç¨‹ä¸­ç”»çš„è‰ç¨¿ã€‚<br>ä»<code>mem_init()</code>çš„è¿›åº¦æ¥çœ‹ï¼Œé¦–å…ˆéœ€è¦å®ç°<code>boot_alloc()</code>å‡½æ•°ï¼Œç„¶åç”¨è¯¥å‡½æ•°ç›´æ¥åˆ†é…ç‰©ç†å†…å­˜ç»™<code>kern_pgdir</code>å’Œ<code>pages</code>ä¸¤ä¸ªæ•°æ®ç»“æ„ã€‚è€Œ<code>boot_alloc</code>ä¸­å€¼å¾—ä¸€æå°±æ˜¯<code>extern char end[]</code>å’Œå¯¹é½å‡½æ•°<code>ROUNDUP(a, n)</code>ã€‚<strong>åœ¨Lab1å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°†å†…æ ¸æ”¾åˆ°<code>0x10000000</code>è¿™ä¸ªä½ç½®ç›´åˆ°<code>end</code>ç»“æŸï¼Œæ‰€ä»¥<code>end</code>æ˜¯é“¾æ¥å™¨åšé“¾æ¥æ—¶å†…æ ¸åŠ è½½ç»“æŸçš„åœ°å€ã€‚</strong>è€Œ<code>ROUNDUP(a, n)</code>çš„åŠŸèƒ½æ˜¯å‘ä¸Šå¯¹é½ã€‚å› ä¸ºæˆ‘ä»¬çš„æ“ä½œéƒ½æ˜¯4KBå¯¹é½çš„ï¼Œæ‰€ä»¥éœ€è¦åœ¨<code>end</code>åé¢è¿›è¡Œå¯¹é½æ“ä½œã€‚è¯¦ç»†è§Lab1çš„å†…å­˜å¸ƒå±€ã€‚<strong>æœ€åå‡½æ•°è¿”å›çš„æ˜¯å·²åˆ†é…å†…å­˜çš„è™šæ‹Ÿé¦–åœ°å€ã€‚</strong><br>æŒ‡å¯¼ä¹¦ä¸­æ¨èä½¿ç”¨æ–­è¨€<strong>assert</strong>è¿›è¡Œè°ƒè¯•çš„æ–¹æ³•ã€‚ä¸è¿‡æˆ‘ä¸€èˆ¬ä½¿ç”¨è¾“å‡ºè°ƒè¯•<strong>cprintf+return</strong>ã€‚å½“åˆ†é…å¥½<code>kern_pgdir</code>å’Œ<code>pages</code>ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨è¾“å‡ºè°ƒè¯•çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªæ•°æ®ç»“æ„çš„è™šæ‹Ÿåœ°å€:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">void boot_alloc() &#123;</span><br><span class="line">cprintf(&quot;before allocating nextfree is %x\n&quot;, nextfree);</span><br><span class="line">/*</span><br><span class="line">address allocator</span><br><span class="line">*/</span><br><span class="line">cprintf(&quot;after allocating nextfree is %x\n&quot;, nextfree);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹è¾“å‡ºç»“æœ:</p><p><img src="5.png" width="50%" height="50%" alt=""></p><p>ç„¶åå°±æ˜¯å®ç°<code>page_init()</code>å‡½æ•°ã€‚<strong>æ­¤æ—¶æˆ‘ä»¬å·²ç»å»ºç«‹äº†ä¸€ä¸ªå’Œå…¨éƒ¨ç‰©ç†å†…å­˜ç›¸å¯¹åº”çš„æ•°ç»„pages</strong>ã€‚è¿™ä¸ºæ¥ä¸‹æ¥ç©ºé—²é“¾è¡¨çš„å®ç°å¥ å®šäº†åŸºç¡€:<strong><code>page_init()</code>å‡½æ•°å°±æ˜¯æŒ‰ç…§Hintsä¸­æç¤ºçš„ç‰©ç†å†…å­˜çš„åŸºæœ¬å¸ƒå±€ï¼Œæ‰¾åˆ°é‚£äº›ç©ºé—²çš„ç‰©ç†å†…å­˜å¹¶å°†å…¶å¯¹åº”çš„pagesæ•°ç»„å…ƒç´ é“¾æ¥èµ·æ¥å½¢æˆä¸€ä¸ªé“¾è¡¨ã€‚</strong>å¯èƒ½ä¸å¥½ç†è§£ï¼Œç›´æ¥ä¸Šå›¾:</p><p><img src="6.jpeg" width="50%" height="50%" alt=""></p><p>è¿™ä¸ªåŠŸèƒ½æ˜¯ç”±ä¸‹é¢ç®€å•çš„å‡ å¥Cè¯­è¨€å®ç°çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Part of the code:</span><br><span class="line"></span><br><span class="line"> for (i = 1; i &lt; npages_basemem; i++) &#123;</span><br><span class="line">                pages[i].pp_ref = 0;</span><br><span class="line">                pages[i].pp_link = page_free_list;</span><br><span class="line">                page_free_list = &amp;pages[i];</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p><code>page_init</code>å‡½æ•°å®ç°äº†ç©ºé—²é“¾è¡¨ã€‚è‡³æ­¤å†…å­˜çš„å¸ƒå±€å·²ç»å¾ˆæ¸…æ¥šäº†ï¼š</p><p><img src="8.jpeg" width="50%" height="50%" alt=""></p><h4 id="page_alloc">page_alloc</h4><p><code>page_alloc</code>å‡½æ•°å®ç°ç‰©ç†å†…å­˜çš„é¡µå¼åˆ†é…â€”â€”â€”â€”åˆ†é…ä¸€é¡µç©ºé—²çš„ç‰©ç†å†…å­˜ã€‚æ ¹æ®ä¸Šé¢çš„æ€è·¯:<strong>pagesæ•°ç»„å°±æ˜¯å…¨éƒ¨ç‰©ç†å†…å­˜çš„æ˜ å°„ï¼Œè€Œpage_free_listæ˜¯ç©ºé—²ç‰©ç†å†…å­˜çš„æ˜ å°„æ‰€ä»¥æ˜¯éƒ¨åˆ†pageså…ƒç´ é“¾æˆçš„ã€‚</strong>æ‰€ä»¥æˆ‘ä»¬å®é™…ä¸Šå¯ä»¥é€šè¿‡<code>page_free_list</code>æŒ‡é’ˆæ¥ç¡®å®šå…·ä½“çš„ç‰©ç†åœ°å€:**(page_free_list-pages)*4K**ã€‚<br>å®ç°å¾ˆç®€å•ï¼Œå½“ä¸­éœ€è¦æ³¨æ„çš„ç»†èŠ‚åˆå§‹åŒ–å‡½æ•°<code>memset(void *v, int c, size_t n)</code>ä¸­éœ€è¦çš„åœ°å€æ˜¯è™šæ‹Ÿåœ°å€ã€‚è¿™é‡Œå…ˆå‚è€ƒä¸€ä¸‹<code>kern_pgdir</code>çš„å®ç°å’Œåˆå§‹åŒ–ã€‚</p><p><img src="7.png" width="50%" height="50%" alt=""></p><p>æ‰€ä»¥åœ¨å®ç°ä¸­<strong>éœ€è¦å°†page_free_listæŒ‡å‘çš„pageså…ƒç´ æ˜ å°„åˆ°å…·ä½“çš„ç‰©ç†åœ°å€<code>page2pa</code>, ç„¶åå°†ç‰©ç†åœ°å€è½¬åŒ–ä¸ºè™šæ‹Ÿåœ°å€<code>PADDR</code></strong>å¹¶è¿”å›ã€‚</p><h4 id="ç»†èŠ‚">ç»†èŠ‚</h4><p>è‡³æ­¤ç‰©ç†æ˜ å°„åˆ°ç©ºé—²é“¾è¡¨çš„è¿‡ç¨‹å·²ç»å®ç°ã€‚<code>boot_alloc</code>å’Œ<code>page_alloc</code>æœ€ç»ˆè¿”å›çš„éƒ½æ˜¯<strong>è™šæ‹Ÿåœ°å€</strong>ã€‚è¿˜æœ‰ä¸€äº›å®å®šä¹‰å’Œå‡½æ•°æ¯”å¦‚<code>PGNUM(la)</code>ï¼Œ<code>memset(void *v, int c, size_t n)</code>çš„å‚æ•°ä¹Ÿæ˜¯è™šæ‹Ÿåœ°å€ã€‚åœ¨Lab2ä¸­ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜å°±æ˜¯åŒºåˆ†<strong>ç‰©ç†åœ°å€</strong>è¿˜æ˜¯<strong>è™šæ‹Ÿåœ°å€</strong>ã€‚<br>å› ä¸ºmmuçš„ç¼˜æ•…ï¼Œè®¿é—®å†…å­˜çš„æ—¶å€™ä¼šè¿›è¡Œä¸€æ¬¡çº¿æ€§åœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢ã€‚æ‰€ä¸èƒ½ç›´æ¥ä½¿ç”¨ç‰©ç†åœ°å€ã€‚<strong>æˆ‘ä»¬ç´¢æ€§æ‰€æœ‰è‡ªå®šä¹‰ç”¨åˆ°åœ°å€çš„åœ°æ–¹éƒ½ä½¿ç”¨è™šæ‹Ÿåœ°å€ï¼Œå¦‚æœéœ€è¦ç‰©ç†åœ°å€å†ä½¿ç”¨<code>PADDR(la)</code>è½¬åŒ–ã€‚</strong></p><h3 id="virtual-memory">Virtual Memory</h3><h4 id="question">Question</h4><p>é¦–å…ˆåŒºåˆ†<strong>é€»è¾‘åœ°å€</strong>ï¼Œ<strong>çº¿æ€§åœ°å€</strong>å’Œ<strong>ç‰©ç†åœ°å€</strong>çš„æ¦‚å¿µã€‚Lab2å±è”½äº†é€»è¾‘åœ°å€åˆ°çº¿æ€§åœ°å€çš„è½¬åŒ–ï¼Œä¹Ÿå°±æ˜¯GDTæ®µå¼å­˜å‚¨ç®¡ç†ã€‚ç›´æ¥ä»çº¿æ€§åœ°å€å¼€å§‹ã€‚<br>æŒ‡å¯¼ä¹¦ä¸­é‡ç‚¹è®²è§£äº†è™šæ‹Ÿå†…å­˜ï¼Œç‰©ç†å†…å­˜å’ŒæŒ‡é’ˆè¿™å‡ ä¸ªæ¦‚å¿µã€‚è§‰å¾—æœ‰ä¸€äº›æ„æ€ï¼Œå°±æŠŠç¿»è¯‘è´´ä¸Šäº†:</p><p><img src="10.png" width="50%" height="50%" alt=""></p><p>å¦å¤–ï¼Œåœ¨ä¹‹åçš„Labä¸­ä¼šé‡åˆ°å¾ˆå¤š<strong>ä¸€ä¸ªç‰©ç†é¡µé¢åŒæ—¶è¢«æ˜ å°„åˆ°å¥½å‡ å—è™šæ‹Ÿå†…å­˜ä¸­</strong>çš„æƒ…å†µã€‚JOSä½¿ç”¨<code>struct PageInfo-&gt;pp_ref</code>æ¥ç®¡ç†é¡µç›®å½•å¯¹é¡µè¡¨é¡µçš„å¼•ç”¨çš„æ•°é‡ã€‚è§ä¸‹é¢ä»£ç :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mystery_t x;</span><br><span class="line">char* value = return_a_pointer();</span><br><span class="line">*value = 10;</span><br><span class="line">x = (mystery_t) value;</span><br></pre></td></tr></table></figure><p>æ ¹æ®ä¸Šé¢çš„åˆ†æï¼ŒæŒ‡é’ˆ<code>value</code>æ˜¯è™šæ‹Ÿåœ°å€ã€‚è€Œå¯¹valueè¿›è¡Œå¼ºè½¬å¹¶èµ‹å€¼çš„åªèƒ½æ˜¯è™šæ‹Ÿåœ°å€äº†ã€‚</p><h4 id="pgdir_walk">pgdir_walk</h4><p>åœ¨å®ç°ä¸‹é¢çš„ä»£ç ä¹‹å‰ï¼Œé»˜è®¤ç†Ÿæ‚‰<code>inc/mmu.h</code>ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚<br>è¯¥å‡½æ•°çš„ä½œç”¨å¾ˆå…³é”®ã€‚<strong>ç»™å®šä¸€ä¸ªè™šæ‹Ÿåœ°å€ï¼Œpgdir_walkå‡½æ•°è¿”å›ä¸€ä¸ªæŒ‡å‘è¯¥åœ°å€å¯¹åº”é¡µè¡¨é¡¹çš„æŒ‡é’ˆã€‚è€Œè¿™ä¸ªå‡½æ•°ä¸»è¦æ˜¯ä¸ºå®Œæˆä¸€éƒ¨åˆ†è™šæ‹Ÿåœ°å€åˆ°ä¸€éƒ¨åˆ†ç‰©ç†åœ°å€çš„æ˜ å°„å‡½æ•°<code>boot_map_region</code>åšå‡†å¤‡çš„ã€‚æ‰€ä»¥åªéœ€è¦å®šä½åˆ°é¡µè¡¨é¡¹å°±å¯ä»¥ï¼Œè€Œä¸éœ€è¦åŠ ä¸Šå12ä½åç§»é‡ã€‚</strong>JOSçš„é¡µç›®å½•ï¼ˆè¡¨ï¼‰é¡¹<strong>PDE&amp;PTE</strong>çš„æ ¼å¼è§ä¸‹:</p><p><img src="11.png" width="50%" height="50%" alt=""></p><p>è¯¥å‡½æ•°çš„åˆ†æå¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pte_t *</span><br><span class="line">pgdir_walk(pde_t *pgdir, const void *va, int create)</span><br><span class="line">&#123;</span><br><span class="line">        uintptr_t ptIndex = PTX(va);    //PTXå–å‡ºé¡µè¡¨é¡¹çš„åç§»é‡</span><br><span class="line">        struct  PageInfo * newAlloc;     //ç©ºé—²é“¾è¡¨æŒ‡é’ˆ</span><br><span class="line">        if(!(pgdir[PDX(va)] &amp; PTE_P)) &#123;   //&amp;ä½è¿ç®—æ˜¯å–å‡ºPTE_Pè¿™ä¸€ä½ï¼Œçœ‹é¡µè¡¨æ˜¯å¦å­˜åœ¨</span><br><span class="line">                if(create) &#123;</span><br><span class="line">                        if((newAlloc = page_alloc(1)) == NULL)</span><br><span class="line">                                return NULL;</span><br><span class="line">                        newAlloc-&gt;pp_ref++;</span><br><span class="line">// |ä½è¿ç®—æ˜¯åˆå¹¶ä½ï¼› ã€20ã€‘+ã€12ã€‘åˆ†åˆ«ä¸ºé¡µç›®å½•é¡¹ï¼ˆæ³¨æ„ä¸æ˜¯é¡µè¡¨é¡¹ï¼‰20ä½çš„åœ°å€ï¼Œå12ä½çš„æ ‡å¿—ä½</span><br><span class="line">                        pgdir[PDX(va)] = page2pa(newAlloc) | PTE_P | PTE_U | PTE_W;             </span><br><span class="line">                &#125;else &#123;</span><br><span class="line">                        return NULL;</span><br><span class="line">                &#125;       </span><br><span class="line">        &#125;</span><br><span class="line">        pte_t * pdPtr = KADDR(PTE_ADDR(pgdir[PDX(va)])); //å–å‡ºé¡µç›®å½•é¡¹çš„å‰20ä½</span><br><span class="line">        return pdPtr + ptIndex;   //å…·ä½“çš„æŒ‡å‘å…·ä½“é¡µè¡¨é¡¹çš„æŒ‡é’ˆ</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­å¯¹é¡µè¡¨é¡¹è¿›è¡Œé‡æ–°æ˜ å°„æ˜¯å…³é”®çš„æ“ä½œï¼Œä¾¿äºç†è§£è¿˜å¯ä»¥å…ˆå–å‡ºå‰20ä½åœ°å€ç„¶åå†åŠ ä¸Šæ ‡å¿—ä½:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">if(create) &#123;</span><br><span class="line">                        if((newAlloc = page_alloc(1)) == NULL)</span><br><span class="line">                                return NULL;</span><br><span class="line">                  newAlloc-&gt;pp_ref++;</span><br><span class="line">                      pgdir[PDX(va)] = page2pa(newAlloc);   </span><br><span class="line">                      test = KADDR(pgdir[PDX(va)]);   //å…ˆå–å‡º20ä½</span><br><span class="line">  pgdir[PDX(va)] = page2pa(newAlloc) | PTE_P | PTE_U | PTE_W;</span><br><span class="line">                      return test + ptIndex;//ç›´æ¥è¿”å›</span><br><span class="line">                &#125;else &#123;</span><br><span class="line">                        return NULL;</span><br><span class="line">                &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>åˆ†é¡µæœºåˆ¶åŸç†è§ä¸‹å›¾ï¼Œè€Œ<code>pgdir_walk</code>å‡½æ•°å®Œæˆçš„æ˜¯å‰ä¸¤éƒ¨åˆ†çš„ï¼Œæœ€åçš„<code>offset</code>å¹¶ä¸åœ¨å…¶ä¸­:</p><p><img src="12.png" width="50%" height="50%" alt=""></p><h4 id="boot_map_region">boot_map_region</h4><p>æ¥ä¸Š<code>pgdir_walk</code>å‡½æ•°è¿”å›è™šæ‹Ÿåœ°å€ç›¸å¯¹åº”çš„é¡µè¡¨é¡¹æŒ‡é’ˆã€‚æ³¨æ„è¯¥å‡½æ•°çš„å‚æ•°ä¸­æœ‰ä¸€é¡¹æ˜¯æƒé™<code>perm</code>æ˜¯å’Œ<code>PTE_P</code>ä¸€èµ·çš„ï¼Œä¸€æ—¦æ˜ å°„å°±å­˜åœ¨äº†ã€‚å› ä¸ºæ˜¯é¡µè¡¨é¡¹æ‰€ä»¥æ˜¯4KBå¯¹é½çš„ï¼ˆå› ä¸ºå±è”½æ‰å12ä½ï¼‰ã€‚æˆ‘ä»¬ä½¿ç”¨é¡µè¡¨é¡¹å®Œæˆè™šåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">static void</span><br><span class="line">boot_map_region(pde_t *pgdir, uintptr_t va, size_t size, physaddr_t pa, int perm)</span><br><span class="line">&#123;</span><br><span class="line">    int i;</span><br><span class="line">        for(i=0; i&lt;size/PGSIZE; i++, va+=PGSIZE, pa+=PGSIZE) &#123;  //4K å¯¹é½</span><br><span class="line">                pte_t *pte = pgdir_walk(pgdir,(void*)va, 1);   </span><br><span class="line">                if(pte == NULL) panic(&quot;boot_map_region panic : out of memory!\n&quot;);</span><br><span class="line">                *pte = pa | perm | PTE_P;    //å®Œæˆæ˜ å°„ï¼Œå¹¶è®¾ç½®æ ‡å¿—ä½æ¥ç¡®å®šé¡µè¡¨æƒé™</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åé¢å‡ ä¸ªå‡½æ•°å®ç°éƒ½å¾ˆç®€å•ï¼Œä¸å†èµ˜è¿°ã€‚<br>è‡³æ­¤ï¼Œæˆ‘ä»¬å®ç°äº†å†…å­˜é¡µå¼ç®¡ç†çš„é¡µè¡¨ç®¡ç†éƒ¨åˆ†ã€‚</p><h3 id="kernel-address-space">Kernel Address Space</h3><h4 id="mapping">Mapping</h4><p>å…³äºå­¦ä¹ JOSå¯¹è™šæ‹Ÿå†…å­˜ç©ºé—´çš„æ•´ä½“å¸ƒå±€ã€‚JOSæ˜¯32ä½çš„æ“ä½œç³»ç»Ÿï¼Œä¸€å…±æœ‰4Gçš„è™šæ‹Ÿç©ºé—´ã€‚<strong>ä»¥<code>ULIM</code>ä¸ºåˆ†ç•Œçº¿ï¼Œç•Œé™ä»¥ä¸‹ä¸ºç”¨æˆ·ç©ºé—´ï¼Œä»¥ä¸Šä¸ºå†…æ ¸ç©ºé—´ã€‚</strong>å…¶ä¸­ä»<code>ULIM</code>åˆ°<code>KERNBASE</code>éƒ¨åˆ†ä½œä¸ºå†…æ ¸çš„ç³»ç»Ÿæ ˆå…±4Mç©ºé—´ã€‚å¯¹äºå†…å­˜è¯¦ç»†çš„å¸ƒå±€å¯ä»¥ä»<code>inc/memlayout.h</code>ä¸­çœ‹åˆ°ï¼Œè¿™é‡Œçš„é‡ç‚¹æ˜¯å› ä¸ºå†…æ ¸å’Œç”¨æˆ·ç©ºé—´åŒæ—¶è¢«æ˜ å°„åˆ°ç‰©ç†å†…å­˜ä¸­ï¼Œæ‰€ä»¥éœ€è¦ä¸€ç§æ–¹å¼æ¥é¿å…ä¸¤è€…ä¹‹é—´ç›¸äº’è¯»å†™ã€‚<strong>è€Œä¸”JOSå’Œå…¶ä»–ç°ä»£æ“ä½œç³»ç»Ÿä¸åŒçš„æ˜¯ï¼Œæ•´ä¸ªOSåªæœ‰ä¸€ä¸ªé¡µç›®å½•<code>kern_pgdir</code>ï¼ˆåº”è¯¥æ˜¯æ¯ä¸€ä¸ªè¿›ç¨‹æœ‰ä¸€å¥—å®Œæ•´çš„é¡µè¡¨ç³»ç»Ÿï¼‰ã€‚</strong><br>æ–¹æ³•æ˜¯æƒé™ä½:</p><p><img src="13.png" width="50%" height="50%" alt=""></p><p>å½“ä¸€ä¸ªç¨‹åºè¯•å›¾è®¿é—®ä¸€ä¸ªè™šæ‹Ÿåœ°å€çš„æ•°æ®çš„æ—¶å€™ï¼Œx86ç³»ç»Ÿçš„ä¿æŠ¤æœºåˆ¶è¿è¡Œä¸º:</p><ul><li>å…ˆæ£€æŸ¥çŸ­æƒé™ä½DPLï¼Œä¸è¿‡å’Œé¡µå¼åˆ†é…æ— å…³</li><li>å†æ£€æŸ¥é¡µç›®å½•ç›¸åº”è¡¨é¡¹çš„è®¿é—®æƒé™ï¼Œå¦‚æœä¸è¿‡ä¹Ÿäº§ç”Ÿå¼‚å¸¸</li><li>æœ€åæ£€æŸ¥äºŒçº§é¡µè¡¨ç›¸åº”é¡µè¡¨çš„è®¿é—®æƒé™ï¼Œä¸å¤Ÿå°±äº§ç”Ÿå¼‚å¸¸</li></ul><p>x86å¯¹æƒé™çš„åŸåˆ™æ˜¯<strong>ä¸åœ¨é¡µç›®å½•è¿™ä¸€ç¯èŠ‚é™åˆ¶å¤ªå¤šï¼Œè®©æœ€ç»ˆçš„è®¿é—®æ§åˆ¶åœ¨äºŒçº§é¡µè¡¨è¿™ä¸€ç¯èŠ‚ä¸Šåœ¨è®¾ç½®ã€‚</strong>å®é™…ä¸ŠIntelæ‰‹å†Œä¸Šç»™å‡ºäº†ä¸€ä¸ªé¡µç›®å½•åŠ é¡µè¡¨çš„è®¿é—®æ§åˆ¶çš„ç»„åˆæ§åˆ¶æ•ˆæœ:</p><p><img src="15.png" width="50%" height="50%" alt=""></p><p>å®ç°<code>mem_init</code>å‡½æ•°çš„æœ€åä¸€éƒ¨åˆ†å†…å®¹ï¼Œå®ç°JOSçš„è™šæ‹Ÿæ˜ å°„:<br>é¦–å…ˆæˆ‘ä»¬å°†è™šæ‹Ÿåœ°å€ä¸­<strong>[UPAGES, sizeof(pages)]</strong>éƒ¨åˆ†æ˜ å°„åˆ°ç‰©ç†åœ°å€<strong>[pages, sizeof(pages)]</strong>ä¸Šã€‚<br>ç„¶åæˆ‘ä»¬å°†è™šæ‹Ÿåœ°å€ä¸­<strong>[KSTACKTOP-KSTKSIZE, KSTACKTOP]</strong>éƒ¨åˆ†æ˜ å°„åˆ°<strong>[bootstack, KSTKSIZE]</strong>ä¸Šã€‚<br>æœ€åå°†<code>KERNBASE</code>ä»¥ä¸Šçš„è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°æ‰€æœ‰ç‰©ç†åœ°å€ä¸Šã€‚ è¿™é‡Œæ³¨æ„ä¸€ä¸‹ä¸€ä¸ªç»†èŠ‚:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">void mem_init() &#123;</span><br><span class="line">...</span><br><span class="line">// Permissions: kernel R, user R</span><br><span class="line">kern_pgdir[PDX(UVPT)] = PADDR(kern_pgdir) | PTE_U | PTE_P;</span><br><span class="line">    ... </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯åœ¨<code>mem_init</code>å‡½æ•°ç”³è¯·<code>kern_pgdir</code>ä¹‹åå°±å‘ç”Ÿçš„æ˜ å°„ï¼Œè€Œè¿™å¥ä»£ç æœ¬è´¨ä¸Šå°±æ˜¯æ˜ å°„å‡½æ•°<code>boot_map_region</code>ã€‚ç›®çš„å¾ˆç®€å•â€”â€”â€”â€”<strong>å®Œæˆ<code>kern_pgdir</code>è‡ªèº«åˆ°<code>UVPT</code>çš„æ˜ å°„</strong>ã€‚æˆ‘ä»¬ä¸éš¾æ˜ç™½ï¼Œæ•´ä¸ªJOSåªæœ‰ä¸€ä¸ªé¡µç›®å½•ã€‚LabåŸºæœ¬ç»“æŸï¼Œè¿™æ—¶å€™çš„JOSå†…å­˜æ•´ä½“å¸ƒå±€å¦‚ä¸‹:</p><p><img src="14.png" width="50%" height="50%" alt=""></p><h4 id="question-1">Question</h4><p>ç¬¬ä¸€ä¸ªé—®é¢˜ä¸Šé¢åˆšå›ç­”è¿‡äº†ï¼Œå°±æ˜¯æ˜ å°„çš„ç»†èŠ‚é—®é¢˜ã€‚<br>åœ¨æ˜ å°„çš„æ—¶å€™è®¾ç½®äº†<code>PTE_U</code>çš„ç”¨æˆ·æ‰æœ‰è¯»å†™æƒé™ã€‚<br>æˆ‘ä»¬çš„<code>UPAGES</code>æœ‰4MBçš„ç©ºé—´ï¼Œä¸€ä¸ª<code>struct PageInfo</code>å¤§å°8Bã€‚æ‰€ä»¥èƒ½ç®¡ç†çš„ç‰©ç†å—ä¸º**4MB/8*4KB = 2GB<strong>ã€‚<br>ç®¡ç†å†…å­˜çš„å¼€é”€ä¸€å…±æœ‰</strong>ç‰©ç†æ˜ å°„pages<strong>,</strong>é¡µç›®å½•<strong>,</strong>é¡µè¡¨**ã€‚å¦‚æœç¬¬ä¸‰ä¸ªé—®é¢˜æˆç«‹ä¹Ÿå°±æ˜¯è¯´ç‰©ç†å†…å­˜æœ€å¤§ä¸€å…±æœ‰2Gçš„è¯ï¼Œé‚£pageså¤§å°ä¸€å…±æœ‰2G/4K*8=4Mã€‚è€Œé¡µç›®å½•<code>kern_pgdir</code>ä¸€å…±æœ‰4KBå¤§å°ï¼›ç›¸åº”çš„é¡µè¡¨æ˜¯4MBã€‚ä¸€å…±æœ‰8MB+4KBã€‚</p><h5 id="entry.s">entry.S</h5><p>è¿™éƒ¨åˆ†æ˜¯åœ¨Lab1çš„æ—¶å€™é—ç•™ä¸‹æ¥çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨ç³»ç»Ÿåˆšå¯åŠ¨çš„æ—¶å€™åˆå§‹åŒ–è¿‡ä¸€ä¸ªé¡µç›®å½•<code>entry_pgdir</code>ã€‚å…³äºç»†èŠ‚å¯ä»¥å‚çœ‹<code>kern/entrypgdir.c</code>å’Œ<code>kern/entry.S</code>ã€‚è¿™é‡Œä»‹ç»ä¸€äº›QEMUçš„æ–°ç”¨æ³•æ¥è¿›è¡Œè°ƒè¯•ï¼ˆå…¶å®ä¹Ÿåœ¨Lab2ä¸­æ˜¯è¦æ±‚æŒæ¡çš„ï¼‰:</p><ul><li><code>xp/Nx paddr</code> è¾“å‡ºä»paddrç‰©ç†åœ°å€å¼€å§‹çš„Nä¸ªå­—èŠ‚çš„å€¼</li><li><code>info register</code> è¾“å‡ºå½“å‰å¯„å­˜å™¨çš„çŠ¶æ€</li><li><code>info mem</code> è¾“å‡ºå½“å‰å®Œæˆæ˜ å°„çš„è™šæ‹Ÿåœ°å€å’Œå¯¹åº”æƒé™</li><li><code>info pg</code> è¾“å‡ºå½“å‰é¡µè¡¨ï¼Œé¡µç›®å½•å’Œé¡µè¡¨é¡¹æ˜¯åˆ†å¼€çš„</li></ul><p>å…¶å®æˆ‘ä»¬ä»Lab1çš„æ—¶å€™å·²ç»è°ƒè¯•è¿‡ï¼Œ<code>movl    %eax,%cr0</code>æ‰§è¡Œç»“æŸçš„æ—¶å€™<strong>æ‰“å¼€åˆ†é¡µæœºåˆ¶</strong>ã€‚ä½†æ˜¯è¿™æ¬¡å¯ä»¥ç›´æ¥çœ‹åˆ°åˆ†é¡µçš„ç»“æœå’Œæ˜ å°„çš„ç»“æœè¿˜æ˜¯å¾ˆçˆ½çš„ï¼Œç»“åˆ<code>kern/entrypgdir.c</code>æ¥çœ‹ä¸€ä¸‹ä¾¿å¾ˆå®¹æ˜“å›ç­”æœ€åä¸€ä¸ªé—®é¢˜:</p><p><img src="16.png" width="50%" height="50%" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// The entry.S page directory maps the first 4MB of physical memory</span><br><span class="line">// starting at virtual address KERNBASE (that is, it maps virtual</span><br><span class="line">// addresses [KERNBASE, KERNBASE+4MB) to physical addresses [0, 4MB)).</span><br><span class="line">// We choose 4MB because that&apos;s how much we can map with one page</span><br><span class="line">// table and it&apos;s enough to get us through early boot.  We also map</span><br><span class="line">// virtual addresses [0, 4MB) to physical addresses [0, 4MB); this</span><br><span class="line">// region is critical for a few instructions in entry.S and then we</span><br><span class="line">// never use it again.</span><br><span class="line">//</span><br><span class="line">// Page directories (and page tables), must start on a page boundary,</span><br><span class="line">// hence the &quot;__aligned__&quot; attribute.  Also, because of restrictions</span><br><span class="line">// related to linking and static initializers, we use &quot;x + PTE_P&quot;</span><br><span class="line">// here, rather than the more standard &quot;x | PTE_P&quot;.  Everywhere else</span><br><span class="line">// you should use &quot;|&quot; to combine flags.</span><br><span class="line">__attribute__((__aligned__(PGSIZE)))</span><br><span class="line">pde_t entry_pgdir[NPDENTRIES] = &#123;</span><br><span class="line">        // Map VA&apos;s [0, 4MB) to PA&apos;s [0, 4MB)</span><br><span class="line">        [0]</span><br><span class="line">                = ((uintptr_t)entry_pgtable - KERNBASE) + PTE_P,</span><br><span class="line">        // Map VA&apos;s [KERNBASE, KERNBASE+4MB) to PA&apos;s [0, 4MB)</span><br><span class="line">        [KERNBASE&gt;&gt;PDXSHIFT]</span><br><span class="line">                = ((uintptr_t)entry_pgtable - KERNBASE) + PTE_P + PTE_W</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ä¸éš¾å‘ç°å…¶å®åœ¨<code>entry_pgdir</code>ä¸­å·²ç»å®Œæˆäº†<code>0x00000000-0x00400000</code>åˆ°<code>0xf0000000-0xf0400000</code>å’Œåˆ°<code>0x00000000-0x00400000</code>çš„æ˜ å°„ã€‚è€Œå®ç°æ˜ å°„çš„æ–¹å¼ä¹Ÿæ˜¯ç›´æ¥è®²åœ°å€å†™åˆ°é¡µè¡¨é¡¹<code>entry_pgdir</code>ä¸­ã€‚<br>é€šè¿‡è°ƒè¯•ï¼Œå‘ç°ä¸¤æ¬¡é¡µç›®å½•çš„åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œæ˜ å°„çš„åœ°å€éƒ½ä¸ä¸€æ ·:</p><p><img src="17.png" width="50%" height="50%" alt=""></p><p>è‡³æ­¤Lab2å®Œæˆï¼ŒChallengeæ—¶é—´å…³ç³»ä¸åšäº†ã€‚è¿™æ˜¯<a href="https://github.com/haotianmichael/JOS" target="_blank" rel="noopener">æºä»£ç </a>.</p><p><img src="18.png" width="50%" height="50%" alt=""></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;lab2&quot;&gt;Lab2&lt;/h2&gt;
&lt;h3 id=&quot;before-lab&quot;&gt;Before Lab&lt;/h3&gt;
&lt;p&gt;Lab2çš„ä¸»è¦å†…å®¹:&lt;code&gt;Physical Page Management&lt;/code&gt;,&lt;code&gt;Virtual Memroy&lt;/code&gt;,&lt;code&gt;Kernel Address Space&lt;/code&gt;;&lt;strong&gt;ä»£ç å®ç°JOSä¸­çš„å†…å­˜åˆ†é¡µç®¡ç†åŠŸèƒ½ï¼Œæœ‰é¡µé¢ç®¡ç†å’Œé¡µè¡¨ç®¡ç†ä¸¤éƒ¨åˆ†ã€‚&lt;/strong&gt;å’Œç†è®ºç›¸æ¯”ï¼Œä»£ç å®ç°éœ€è¦è€ƒè™‘çš„ç»†èŠ‚çœŸæ˜¯å¤ªå¤šã€‚å®éªŒæœ€ç»ˆçš„ç›®çš„æ˜¯é€šè¿‡å‡ ä¸ªæ£€æµ‹å‡½æ•°:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;1.png&quot; width=&quot;50%&quot; height=&quot;50%&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;Lab1å®Œæˆæ—¶æ•´ä¸ªJOSå†…å­˜å¸ƒå±€å¦‚ä¸‹å›¾:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;9.png&quot; width=&quot;50%&quot; height=&quot;50%&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;åˆ‡æ¢åˆå¹¶Gitåˆ†æ”¯çš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°å†²çªï¼Œéœ€è¦æ‰‹åŠ¨æ³¨é‡Šæ‰Lab1ä¸­çš„ä¸€äº›æµ‹è¯•ä»£ç æ¥è§£å†³ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚
    
    </summary>
    
      <category term="C" scheme="http://haotianmcihael.github.io/categories/C/"/>
    
    
      <category term="MIT 6.828" scheme="http://haotianmcihael.github.io/tags/MIT-6-828/"/>
    
      <category term="OS" scheme="http://haotianmcihael.github.io/tags/OS/"/>
    
      <category term="Linux" scheme="http://haotianmcihael.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Mit6.828(Fall 2018) Shell</title>
    <link href="http://haotianmcihael.github.io/2018/11/17/Mit6-828-Fall-2018-Shell/"/>
    <id>http://haotianmcihael.github.io/2018/11/17/Mit6-828-Fall-2018-Shell/</id>
    <published>2018-11-17T07:48:07.000Z</published>
    <updated>2022-03-16T10:32:54.749Z</updated>
    
    <content type="html"><![CDATA[<h2 id="hwshell">HW:Shell</h2><h3 id="abstract">Abstract</h3><p>6.828é™¤äº†Labä¹‹å¤–è¿˜æœ‰é’ˆå¯¹å°å‹æ“ä½œç³»ç»ŸXV-6çš„Readingså’ŒHomeWorkã€‚æ•´ä¸ª6.828ä¹Ÿæ˜¯å›´ç»•è¿™ä¸¤æ¡çº¿ï¼ˆLabå’ŒHWï¼‰åœ¨èµ°ã€‚Lab1è®©æˆ‘é€‚åº”äº†JOSçš„å®éªŒç¯å¢ƒå’Œè°ƒè¯•æŠ€å·§ï¼Œä½†æ˜¯Shellå’ŒSystem Callsæ‰æ˜¯çœŸæ­£å±äºæ“ä½œç³»ç»Ÿçš„çŸ¥è¯†ã€‚å…³äºXV-6çš„HomeWorkéƒ½æ˜¯å»ºç«‹åœ¨ReadingsåŸºç¡€ä¹‹ä¸Šçš„ï¼Œæœ¬æ¬¡HW<strong>éœ€è¦å®ç°ä¸€ä¸ªå°å‹çš„Shell</strong>ï¼Œéœ€è¦é˜…è¯»çš„Readingsæœ‰:</p><ul><li>XV-6.Chapter.0ï¼ˆé‡ç‚¹èµ„æ–™ï¼‰</li><li>man fork, (3)execï¼Œopenï¼Œ close</li><li>TCPL</li></ul><p>å­¦ä¹ è¿‡ç¨‹ä¸­æœ€æœ‰æ„æ€çš„å½“å±æ–©è·æ–°æŠ€èƒ½å’Œæ–°å·¥å…·äº†:)ä»‹ç»ä¸€ä¸ªæ–°çš„vimæ’ä»¶ç¥å™¨â€”â€”â€”â€”<a href="http://vim-taglist.sourceforge.net/manual.html#taglist-using" target="_blank" rel="noopener">Taglist</a>ã€‚</p><p><img src="27.png" width="50%" height="50%" alt=""></p><a id="more"></a><p>ç®€å•æ¥è®²ï¼Œå®ƒä»¥ç›®å½•æ ‘çš„å½¢å¼åˆ—å‡ºå½“å‰æ–‡ä»¶ä¸­çš„symbol:å‡½æ•°åï¼Œå®å®šä¹‰å’Œå˜é‡ã€‚å¸®åŠ©æˆ‘ä»¬ä»å®è§‚ä¸Šå¿«é€Ÿäº†è§£æºç ã€‚æœ¬èº«æ”¯æŒè·³è½¬ã€‚å®‰è£…manualä¸­è®²çš„å¾ˆæ¸…æ¥šï¼Œå°±ä¸å†èµ˜è¿°äº†ã€‚ä¸‹é¢æ˜¯æˆ‘çš„é…ç½®:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nnoremap &lt;silent&gt; &lt;F8&gt; :TlistToggle&lt;CR&gt;&lt;CR&gt;   &quot;æŒ‰f8å¼€å¯Taglist</span><br><span class="line">let Tlist_Show_One_File=0                    </span><br><span class="line">let Tlist_Exit_OnlyWindow=1                  </span><br><span class="line">let Tlist_Use_Left_Window=1                 </span><br><span class="line">let Tlist_File_Fold_Auto_Close=1             </span><br><span class="line"></span><br><span class="line">     add the above Configs to your ~/.vimrc</span><br></pre></td></tr></table></figure><h3 id="æ“ä½œç³»ç»Ÿè°ƒç”¨system-calls">æ“ä½œç³»ç»Ÿè°ƒç”¨â€”â€”System Calls</h3><p>æ“ä½œç³»ç»Ÿçš„å·¥ä½œæ€»ç»“èµ·æ¥å°±æ˜¯<strong>æŠ½è±¡</strong>å’Œ<strong>èµ„æºåˆ†é…</strong>ã€‚<br>èµ„æºæœ‰å†…å­˜åˆ†é…ï¼ŒCPUè°ƒåº¦ç­‰ã€‚è€ŒæŠ½è±¡æŒ‡çš„å°±æ˜¯ç³»ç»Ÿè°ƒç”¨ã€‚å®éªŒéœ€è¦å®ç°Shellä¸­çš„å‘½ä»¤ï¼Œé‡å®šå‘å’Œç®¡é“ã€‚æ¯ä¸€ä¸ªåŠŸèƒ½éƒ½æ˜¯ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨æ¥å®ç°çš„ï¼Œæ‰€ä»¥å°†System Callsç§°ä¸ºæ“ä½œç³»ç»Ÿçš„æ¥å£ä¸€ç‚¹éƒ½ä¸è¿‡åˆ†ã€‚</p><h3 id="executing-simple-commands">Executing Simple Commands</h3><h4 id="fork">fork</h4><p><code>fork</code>ç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¯¹äºçˆ¶è¿›ç¨‹è¿”å›å­è¿›ç¨‹çš„pidï¼Œå¯¹äºå­è¿›ç¨‹è¿”å›0ã€‚è§ä¸‹é¢ä»£ç :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">int pid = fork(); //åˆ›å»ºäº†å­è¿›ç¨‹</span><br><span class="line">if(pid == 0) &#123;   //çˆ¶å­è¿›ç¨‹éƒ½ä»è¿™é‡Œå¼€å§‹æ‰§è¡Œï¼Œå”¯ä¸€åŒºåˆ«å°±æ˜¯pidä¸ä¸€æ ·</span><br><span class="line">   printf(&quot;child: existing!\n&quot;);</span><br><span class="line">   exit();</span><br><span class="line">&#125;else if(pid &gt; 0) &#123;</span><br><span class="line">printf(&quot;parent: %d&quot;, pid);</span><br><span class="line">wait();  //çˆ¶è¿›ç¨‹ç­‰å¾…</span><br><span class="line">printf(&quot;child is done\n&quot;);</span><br><span class="line">&#125;else &#123;</span><br><span class="line">fprintf(stdeer, &quot;fork error!\n&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å…¶ä¸­<code>wait()</code>ç³»ç»Ÿè°ƒç”¨è¿”å›ä¸€ä¸ªé€€å‡ºçš„å­è¿›ç¨‹ã€‚</strong>ä¸Šé¢è¿™æ®µä»£ç å…¶å®å°±æ˜¯æ•´ä¸ªShellæ‰§è¡ŒæŒ‡ä»¤çš„åŸç†:<strong>Shellæç¤ºç¬¦ç”±çˆ¶è¿›ç¨‹æä¾›ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ‰§è¡ŒçœŸæ­£çš„å‘½ä»¤ï¼Œè€Œçˆ¶è¿›ç¨‹åˆ™<code>wait()</code>ç›´åˆ°å­è¿›ç¨‹è¿”å›,ç„¶åçˆ¶è¿›ç¨‹ç­‰å¾…ä¸‹ä¸€æ¡å‘½ä»¤ã€‚</strong><br>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹:</p><p><img src="28.png" width="50%" height="50%" alt=""></p><p>å›åˆ°Shellä¸­æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹å­è¿›ç¨‹ä¸­çš„ä»£ç ï¼Œèƒ½å¤Ÿæ­£ç¡®æ‰§è¡Œç®€å•çš„å‘½ä»¤ã€‚æ¶‰åŠåˆ°<code>exec()</code>å‡½æ•°æ—ã€‚</p><h4 id="exec">exec</h4><p>execæä¾›äº†åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­æ‰§è¡Œå¦ä¸€ä¸ªè¿›ç¨‹çš„æ–¹æ³•: æ ¹æ®å‚æ•°æä¾›çš„æ–‡ä»¶è·¯å¾„å’Œåç§°æ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œã€‚æ‰§è¡Œç»“æŸä¹‹ååŸè°ƒç”¨è¿›ç¨‹çš„å†…å®¹é™¤è¿›ç¨‹å·ä¹‹å¤–å…¶ä»–çš„å…¨éƒ¨è¢«æ›¿æ¢ã€‚<strong>é€šå¸¸å’Œforkä¸€èµ·è”åˆå®ç°è¿›ç¨‹ä¸­æ‰§è¡Œç¨‹åºã€‚</strong><code>exec</code>å‡½æ•°æ—æ˜¯ç”±6ä¸ªä»¥execå¼€å¤´çš„å‡½æ•°æ„æˆçš„ï¼Œè¿™6ä¸ªå‡½æ•°çš„ç”¨æ³•æ ¹æ®åç§°çš„ä¸åŒä¼šæœ‰äº›å¾®çš„åŒºåˆ«:</p><p><img src="29.png" width="50%" height="50%" alt=""></p><h5 id="æŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶çš„æ–¹å¼">æŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶çš„æ–¹å¼</h5><p>å…¶ä¸­<code>execlp</code>ï¼Œ<code>execvp</code>åœ¨æŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™ä¸ç”¨å†™æ–‡ä»¶çš„<strong>ç»å¯¹è·¯å¾„</strong>ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ ¹æ®ç¯å¢ƒå˜é‡â€œ<span class="math inline">\(PATHâ€æŸ¥æ‰¾ã€‚`env`å‘½ä»¤å¯ä»¥åˆ—å‡ºç³»ç»Ÿä¸­å½“å‰çš„\)</span>PATHã€‚</p><h5 id="å‚æ•°ä¼ é€’æ–¹å¼">å‚æ•°ä¼ é€’æ–¹å¼</h5><p>å…¶ä¸­<code>execlp</code>,<code>execl</code>,<code>execle</code>è¿™ä¸‰ä¸ªç¬¬äº”ä¸ªå­—æ¯æ˜¯<code>l</code>çš„å‡½æ•°å‚æ•°åªèƒ½åˆ†åˆ«åˆ—å‡ºæ¥â€”â€”â€”â€”<code>const char *argv...</code>ã€‚è€Œ<code>execv</code>,<code>execve</code>,<code>execvp</code>è¿™ä¸‰ä¸ªç¬¬äº”ä¸ªå­—æ¯æ˜¯<code>v</code>çš„å‡½æ•°å‚æ•°å¯ä»¥æ•´ä½“æ„é€ æ•°ç»„ä¼ é€’â€”â€”â€”â€”<code>char *const argv[]</code>ã€‚<strong>æ‰€æœ‰çš„å‚æ•°éƒ½åº”è¯¥ä»¥<code>NULL</code>ç»“å°¾</strong>ã€‚</p><h5 id="ç¯å¢ƒå˜é‡">ç¯å¢ƒå˜é‡</h5><p>å…¶ä¸­<code>execle</code>å’Œ<code>execle</code>å¯ä»¥åœ¨ä½¿ç”¨æŒ‡å®šçš„ç¯å¢ƒå˜é‡ã€‚é€šè¿‡åœ¨å‚æ•°æœ«å°¾åŠ ä¸Š<code>char *const envp[]</code>çš„æ–¹æ³•ã€‚</p><p>æ€»ç»“è§ä¸‹å›¾:</p><p><img src="30.png" width="50%" height="50%" alt=""></p><h5 id="execå‡½æ•°æ—ä½¿ç”¨æ³¨æ„äº‹é¡¹">execå‡½æ•°æ—ä½¿ç”¨æ³¨æ„äº‹é¡¹</h5><ul><li>å› ä¸ºexecå‡½æ•°ç»å¸¸è°ƒç”¨å¤±è´¥ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Šåˆ¤æ–­è¯­å¥</li><li>æœ€åå‚æ•°ä¸€å®šç”¨<code>NULL</code>ç»“å°¾ <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int exec() &#123;</span><br><span class="line">int ret;</span><br><span class="line">if( fork() == 0 )&#123;</span><br><span class="line">if((ret = execlp(&quot;ls&quot;, &quot;ls&quot;, &quot;-al&quot;, NULL)) &lt; 0)  //å‚æ•°ä»¥NULLç»“æŸ</span><br><span class="line">fprintf(stderror, &quot;execlp error!\n&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="å®ç°å‘½ä»¤">å®ç°å‘½ä»¤</h4><p><a href="https://pdos.csail.mit.edu/6.828/2018/homework/sh.c" target="_blank" rel="noopener">Shellä»£ç </a>åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†:è¯æ³•åˆ†æå’Œå‘½ä»¤æ‰§è¡Œï¼›<br>å®éªŒéœ€è¦ä¿®æ”¹<code>runcmd()</code>å‡½æ•°ä»£ç ï¼Œå®ç°å…·ä½“çš„EXECã€‚éœ€è¦å…³æ³¨å‡½æ•°ç±»å‹ï¼Œå‚æ•°ä¸¤ä¸ªç»†èŠ‚ã€‚æ ¹æ®è°ƒè¯•çŸ¥é“<code>' '</code>ä¸ºEXECï¼Œè€Œ<code>execcmd</code>ç»“æ„ä½“ä¸­argv[0]ä¸­å­˜å‚¨çš„æ˜¯å‘½ä»¤çš„åç§°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨<code>execvp</code>æ¥å®ç°ï¼Œ<code>execvp</code>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯æ‰§è¡Œæ–‡ä»¶çš„åç§°ï¼Œå¾€åçš„å‚æ•°å¯ä»¥ç”¨æ•°ç»„è¡¨ç¤ºï¼Œè¿™æ ·å¯ä»¥ä¿è¯è¯¥å‘½ä»¤çš„å¯å˜å‚æ•°å¾—åˆ°å®ç°ã€‚ä»£ç å¦‚ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">case &apos; &apos;:</span><br><span class="line">           ecmd = (struct execcmd*)cmd;</span><br><span class="line">           if(ecmd-&gt;argv[0] == 0)</span><br><span class="line">               _exit(0);</span><br><span class="line">           int pid, ret;</span><br><span class="line">           if ((pid = fork()) == 0) &#123;</span><br><span class="line">               if((ret = execvp(ecmd-&gt;argv[0], ecmd-&gt;argv)) &lt; 0) &#123;</span><br><span class="line">                   fprintf(stderr, &quot;Bash: command not found:%s\n&quot;, ecmd-&gt;argv[0]);</span><br><span class="line">                   exit(-1);</span><br><span class="line">               &#125;</span><br><span class="line">               exit(0);</span><br><span class="line">           &#125; else if (pid &gt; 0) &#123;</span><br><span class="line">               wait(0);</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">           break;</span><br></pre></td></tr></table></figure><p>æ³¨æ„å› ä¸ºæ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œæ‰€ä»¥è°ƒè¯•çš„æ—¶å€™ä¼šå‡ºç°å¾ˆå¤šä¸å¯æ€è®®çš„ç°è±¡ã€‚<strong>å¯ä»¥å…ˆå°†fork()éƒ¨åˆ†æ³¨é‡Šæ‰ï¼Œè¿›å…¥æ‰§è¡Œå‡½æ•°çœ‹ä¸€ä¸‹ç°è±¡ï¼Œç„¶åè¾“å‡ºè°ƒè¯•ã€‚</strong>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹:</p><p><img src="31.png" width="50%" height="50%" alt=""></p><h3 id="io-redirection">I/O Redirection</h3><h4 id="æ–‡ä»¶æè¿°ç¬¦">æ–‡ä»¶æè¿°ç¬¦</h4><p>æ–‡ä»¶æè¿°ç¬¦æ˜¯å¾ˆé‡è¦çš„æ¦‚å¿µï¼Œå®ƒä½¿å¾—é‡å®šå‘æˆä¸ºå¯èƒ½ã€‚<code>File Descriptor</code>æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå¸¸å¸¸æŠŠå…¶æŒ‡å‘çš„å¯¹è±¡ç§°ä¸ºæ–‡ä»¶ã€‚æœ¬å®éªŒä¸­éœ€è¦äº†è§£<code>open</code>ï¼Œ<code>creat</code>ï¼Œ<code>close</code>ï¼Œ<code>dup2</code>ç­‰ç³»ç»Ÿè°ƒç”¨è¿”å›å€¼å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚<strong>æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å°†Shellæœ¬èº«çš„æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘å…¶ä»–çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»è€Œå®ç°é‡å®šå‘ã€‚</strong>Shellä¿è¯åœ¨ä»»ä½•æ—¶å€™éƒ½æœ‰3ä¸ªæ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦â€”â€”â€”â€”<code>0-æ ‡å‡†è¾“å…¥</code>,<code>1-æ ‡å‡†è¾“å‡º</code>,<code>2-é”™è¯¯è¾“å‡º</code>ã€‚<br>ä¸‹é¢æ˜¯ä¼šç”¨åˆ°çš„å‡ ä¸ªç³»ç»Ÿè°ƒç”¨:</p><ul><li><code>open(&quot;file_name&quot;, O_RDWR):</code> æ‰“å¼€æ–‡ä»¶ï¼Œæ‰“å¼€æˆåŠŸè¿”å›å€¼æœ€å°çš„æ–‡ä»¶æè¿°ç¬¦â€”â€”â€”â€”æ ‡å‡†è¾“å…¥0ï¼Œæ‰“å¼€å¤±è´¥è¿”å›-1</li><li><code>create(&quot;file_name&quot;, 0777):</code> åˆ›å»ºæ–‡ä»¶ï¼Œè¿”å›å€¼åŒopen</li><li><code>close(fd):</code> é‡Šæ”¾ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦</li><li><code>dup2(oldfd, newfd):</code> å°†oldfdå¤åˆ¶ç»™newfd</li></ul><p>é‡å®šå‘ä¸éœ€è¦è€ƒè™‘å­è¿›ç¨‹çš„é—®é¢˜ï¼Œä½†è¿˜æ˜¯éœ€è¦æ·±å…¥äº†è§£<code>fork</code>å‡½æ•°çš„æœºç†ï¼Œ<strong>ä¸€æ—¦forkï¼Œçˆ¶è¿›ç¨‹æ‹¥æœ‰å’Œå­è¿›ç¨‹ä¸€æ¨¡ä¸€æ ·çš„æ–‡ä»¶æè¿°ç¬¦</strong>ã€‚è€Œé‡å®šå‘éœ€è¦è€ƒè™‘çš„æ˜¯åœ¨å­è¿›ç¨‹ä¸­å°†æ ‡å‡†è¾“å…¥ï¼ˆè¾“å‡ºï¼‰å®šå‘åˆ°å…¶ä»–æ–‡ä»¶å³å¯ã€‚</p><h4 id="è¾“å…¥é‡å®šå‘">&lt; è¾“å…¥é‡å®šå‘</h4><p>è¾ƒç®€å•ï¼Œä¸€æ—¦æ–‡ä»¶ä¸å­˜åœ¨ç›´æ¥æŠ¥é”™:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">case &apos;&lt;&apos;:</span><br><span class="line">           rcmd = (struct redircmd*)cmd;</span><br><span class="line">           close(0);//å…³æ‰çˆ¶è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥</span><br><span class="line">           if(open(rcmd-&gt;file, O_RDONLY) &lt; 0) &#123;</span><br><span class="line">               fprintf(stderr, &quot;Bash: No such file or directory:  %s\n&quot;, rcmd-&gt;file);  //è¾“å…¥ä¸å­˜åœ¨ç›´æ¥æŠ¥é”™</span><br><span class="line">           &#125;else &#123;</span><br><span class="line">//ä¸€æ—¦openå‡½æ•°æ‰§è¡ŒæˆåŠŸï¼Œå®ƒè¿”å›å¾—æ–‡ä»¶æè¿°ç¬¦å°±æ˜¯0ï¼Œæ‰€ä»¥è¿™æ—¶å€™è¯¥æ–‡ä»¶å°±å˜æˆäº†è¾“å…¥,å®šå‘æˆåŠŸ</span><br><span class="line">               runcmd(rcmd-&gt;cmd);  //è¿™é‡Œå°±æ˜¯æ‰§è¡ŒEXECéƒ¨åˆ†ï¼Œæ‰€ä»¥forkçš„æ—¶å€™æ ‡å‡†è¾“å…¥ä¹Ÿæ˜¯å…³é—­çš„ï¼ˆå’Œçˆ¶è¿›ç¨‹ä¸€æ ·closeï¼‰</span><br><span class="line">           &#125;</span><br><span class="line">           break;</span><br></pre></td></tr></table></figure><h4 id="è¾“å‡ºé‡å®šå‘">&gt; è¾“å‡ºé‡å®šå‘</h4><p>å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ã€‚åˆ›å»ºæ–°çš„æ–‡ä»¶æ—¶éœ€è¦æ³¨æ„æ–‡ä»¶çš„æƒé™ã€‚<code>creat</code>å‡½æ•°çš„å‚æ•°0777æƒé™ä¸º<code>-rwx rwx rwx</code>ã€‚å…³äºumaskçš„çŸ¥è¯†è§<a href="https://my.oschina.net/alphajay/blog/112428" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">case &apos;&gt;&apos;:</span><br><span class="line">rcmd = (struct redircmd*)cmd;</span><br><span class="line">int fd;</span><br><span class="line">if((fd = open(rcmd-&gt;file, O_RDWR)) &lt; 0) &#123;  //fdä¸ºæ–°æ‰“å¼€æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦</span><br><span class="line">if((fd = creat(rcmd-&gt;file, 0777)) &lt; 0 ) &#123;</span><br><span class="line">fprintf(stderr, &quot;Bash: No such file or directory:  %s\n&quot;, rcmd-&gt;file);</span><br><span class="line">&#125;else &#123;</span><br><span class="line">dup2(fd, 1);   //å°†æ ‡å‡†è¾“å‡ºæŒ‡å‘åˆ°æ–°æ‰“å¼€çš„æ–‡ä»¶fdä¸Šï¼Œæ‰€ä»¥è¾“å‡ºå°±åˆ°äº†è¯¥æ–‡ä»¶ä¸Šï¼ˆå®ç°äº†é‡å®šå‘ï¼‰</span><br><span class="line">runcmd(rcmd-&gt;cmd);</span><br><span class="line">&#125;</span><br><span class="line">&#125;else &#123;</span><br><span class="line">dup2(fd, 1);</span><br><span class="line">runcmd(rcmd-&gt;cmd);</span><br><span class="line">&#125;</span><br><span class="line">break;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹:</p><p><img src="32.png" width="50%" height="50%" alt=""></p><h3 id="implement-pipes">Implement pipes</h3><p>ç®¡é“æ˜¯ä¸€ä¸ªå°å°çš„å†…å’Œç¼“å†²åŒºï¼Œå®ƒä»¥<strong>æ–‡ä»¶æè¿°ç¬¦å¯¹</strong>çš„å½¢å¼æä¾›ç»™è¿›ç¨‹ï¼Œä»ç®¡é“çš„ä¸€ç«¯å†™æ•°æ®å¯ä»¥ä»ç®¡é“çš„å¦ä¸€ç«¯è¯»å–ã€‚ç³»ç»Ÿè°ƒç”¨<code>pipe</code>å°†æ•°ç»„<code>int p[2]</code>åˆå§‹åŒ–ä¸ºç®¡é“çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æ¥ä¸‹æ¥åšçš„æ— éå°±æ˜¯é‡å®šå‘äº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> case &apos;|&apos;:</span><br><span class="line">pcmd = (struct pipecmd*)cmd;</span><br><span class="line">int p[2];</span><br><span class="line">pipe(p);    //ç®¡é“åˆå§‹åŒ–</span><br><span class="line">if(fork() == 0) &#123;    </span><br><span class="line">dup2(p[0], 0);   //å°†æ ‡å‡†è¾“å…¥é‡å®šå‘åˆ°ç®¡é“çš„è¾“å…¥p[0]ä¸Š</span><br><span class="line">close(p[0]);</span><br><span class="line">close(p[1]);</span><br><span class="line">runcmd(pcmd-&gt;right);</span><br><span class="line">&#125;else &#123;</span><br><span class="line">dup2(p[1], 1);  //è®²æ ‡æ³¨è¾“å‡ºé‡å®šå‘å¥¥ç®¡é“é¢è¾“å‡ºp[1]ä¸Š</span><br><span class="line">runcmd(pcmd-&gt;left);  </span><br><span class="line">close(p[0]);</span><br><span class="line">close(p[1]);</span><br><span class="line">&#125;</span><br><span class="line">break;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ•ˆæœå¦‚ä¸‹:</p><p><img src="33.png" width="50%" height="50%" alt=""></p><h3 id="make-grade">Make grade</h3><p>6.828å¯¹äºHWçš„æµ‹è¯•æ˜¯ç›´æ¥åœ¨ä¸»æœºä¸Šæµ‹è¯•çš„ï¼Œç¼–è¯‘Shellæ–‡ä»¶:<code>gcc Shell</code>å¾—åˆ°<code>a.out</code>ã€‚å·²çŸ¥è¯¥æ–‡ä»¶t.sh:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ls &gt; y</span><br><span class="line">cat &lt; y | sort | uniq | wc &gt; y1</span><br><span class="line">cat y1</span><br><span class="line">rm y1</span><br><span class="line">ls |  sort | uniq | wc</span><br><span class="line">rm y</span><br></pre></td></tr></table></figure><blockquote><p>åœ¨ä¸»æœºä¸Šï¼Œæ‰§è¡Œ<code>./a.out &lt; t.sh</code>ä¸åœ¨ä¸»æœºShellä¸Šæ‰§è¡Œ<code>source t.sh</code>å¯¹æ¯”ç»“æœï¼Œå¦‚ä¸‹:</p></blockquote><p><img src="34.png" width="50%" height="50%" alt=""></p><blockquote><p>æœ¬æ¬¡å®éªŒçš„æºä»£ç åœ¨<a href="https://github.com/haotianmichael/JOS/tree/master/Shell" target="_blank" rel="noopener">Github</a>ä¸Šã€‚<br>ç¬¬ä¸€æ¬¡æ¥è§¦Linuxç³»ç»Ÿç¼–ç¨‹ï¼Œå¾ˆå¤šé›¶ç¢çš„çŸ¥è¯†å’Œç»†èŠ‚å­¦èµ·æ¥å¾ˆæ˜¯åƒåŠ›ã€‚ä¸è¿‡åœ¨ç‹¬ç«‹ææ‡‚Shellçš„æœºåˆ¶ä¹‹ååˆè§‰å¾—å¾ˆçˆ½ï¼Œè¿˜æ˜¯å¾ˆæœŸå¾…ä¹‹åçš„æŒ‘æˆ˜:)</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;hwshell&quot;&gt;HW:Shell&lt;/h2&gt;
&lt;h3 id=&quot;abstract&quot;&gt;Abstract&lt;/h3&gt;
&lt;p&gt;6.828é™¤äº†Labä¹‹å¤–è¿˜æœ‰é’ˆå¯¹å°å‹æ“ä½œç³»ç»ŸXV-6çš„Readingså’ŒHomeWorkã€‚æ•´ä¸ª6.828ä¹Ÿæ˜¯å›´ç»•è¿™ä¸¤æ¡çº¿ï¼ˆLabå’ŒHWï¼‰åœ¨èµ°ã€‚Lab1è®©æˆ‘é€‚åº”äº†JOSçš„å®éªŒç¯å¢ƒå’Œè°ƒè¯•æŠ€å·§ï¼Œä½†æ˜¯Shellå’ŒSystem Callsæ‰æ˜¯çœŸæ­£å±äºæ“ä½œç³»ç»Ÿçš„çŸ¥è¯†ã€‚å…³äºXV-6çš„HomeWorkéƒ½æ˜¯å»ºç«‹åœ¨ReadingsåŸºç¡€ä¹‹ä¸Šçš„ï¼Œæœ¬æ¬¡HW&lt;strong&gt;éœ€è¦å®ç°ä¸€ä¸ªå°å‹çš„Shell&lt;/strong&gt;ï¼Œéœ€è¦é˜…è¯»çš„Readingsæœ‰:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;XV-6.Chapter.0ï¼ˆé‡ç‚¹èµ„æ–™ï¼‰&lt;/li&gt;
&lt;li&gt;man fork, (3)execï¼Œopenï¼Œ close&lt;/li&gt;
&lt;li&gt;TCPL&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å­¦ä¹ è¿‡ç¨‹ä¸­æœ€æœ‰æ„æ€çš„å½“å±æ–©è·æ–°æŠ€èƒ½å’Œæ–°å·¥å…·äº†:)ä»‹ç»ä¸€ä¸ªæ–°çš„vimæ’ä»¶ç¥å™¨â€”â€”â€”â€”&lt;a href=&quot;http://vim-taglist.sourceforge.net/manual.html#taglist-using&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Taglist&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;27.png&quot; width=&quot;50%&quot; height=&quot;50%&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="C" scheme="http://haotianmcihael.github.io/categories/C/"/>
    
    
      <category term="MIT 6.828" scheme="http://haotianmcihael.github.io/tags/MIT-6-828/"/>
    
      <category term="OS" scheme="http://haotianmcihael.github.io/tags/OS/"/>
    
      <category term="Linux" scheme="http://haotianmcihael.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Mit6.828(Fall 2018) Lab1</title>
    <link href="http://haotianmcihael.github.io/2018/11/05/Mit6-828-Fall2018-Lab1/"/>
    <id>http://haotianmcihael.github.io/2018/11/05/Mit6-828-Fall2018-Lab1/</id>
    <published>2018-11-04T21:31:02.000Z</published>
    <updated>2022-03-16T10:34:57.562Z</updated>
    
    <content type="html"><![CDATA[<h2 id="lab1">Lab1</h2><h3 id="before-lab">Before Lab</h3><p>Lab1ä¸€å…±æœ‰ä¸‰éƒ¨åˆ†:<code>Bootstrap</code>,<code>BootLoader</code>,<code>Kernel</code>;å‰ä¸¤éƒ¨åˆ†éƒ½æ˜¯GDBè°ƒè¯•ä¸ºä¸»ï¼Œç†Ÿæ‚‰GDBçš„è°ƒè¯•æŠ€å·§å’Œæ“ä½œç³»ç»Ÿçš„å¯åŠ¨æµç¨‹ã€‚æœ€åå®ç°ä¸€å°éƒ¨åˆ†<code>monitor</code>ä¸­<strong>test_backtrace</strong>çš„åŠŸèƒ½ã€‚<br>å¦‚æœ<code>GDB</code>è°ƒè¯•å‡ºé”™ï¼Œå¯èƒ½æ˜¯å› ä¸ºè°ƒè¯•å™¨æ²¡æœ‰é“¾æ¥åˆ°æ“ä½œç³»ç»Ÿä¸Šï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add </span><br><span class="line">add-auto-load-safe-path /Your Working Dir/.gdbinit</span><br><span class="line">line to your configuration file &quot;/root/.gdbinit&quot;</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="pc-bootstrap">PC Bootstrap</h3><h4 id="getting-started-with-x86-assembly">Getting Started with x86 assembly</h4><h5 id="exercise-1">Exercise 1</h5><p>JOSä¸­ä½¿ç”¨AT&amp;Tæ ¼å¼çš„æ±‡ç¼–è¯­è¨€ï¼Œåœ¨Lab0ä¸­ä»‹ç»äº†ç›¸å…³èµ„æ–™ã€‚å®éªŒè¦æ±‚ç†Ÿæ‚‰<strong>x86æ±‡ç¼–</strong>å’Œ<strong>Inlineæ±‡ç¼–</strong>ä¸¤ç§å†™æ³•ã€‚</p><h4 id="simulating-the-x86">Simulating the x86</h4><p>Lab1çš„å·¥ä½œç›®å½•:</p><ul><li><code>/boot</code>ç›®å½•åŒ…å«å’Œå¯åŠ¨ç›¸å…³çš„æ–‡ä»¶ã€‚</li><li><code>/kern</code>ç›®å½•åŒ…å«å†…æ ¸å’Œç›‘è§†å™¨ç›¸å…³çš„æ–‡ä»¶ã€‚</li><li><code>/lib</code>ç›®å½•åŒ…å«ä¸€äº›é“¾æ¥ä½¿ç”¨çš„åº“å‡½æ•°æ¯”å¦‚printfã€‚</li><li><code>/inc</code>ç›®å½•åŒ…å«å¤´æ–‡ä»¶ï¼Œç”³æ˜äº†éœ€è¦ä½¿ç”¨çš„æ•°æ®ç»“æ„ã€‚</li><li><code>/obj</code>ç›®å½•æ˜¯makeä¹‹åç›¸åº”çš„åæ±‡ç¼–ä»£ç ï¼Œä¾›è°ƒè¯•ä½¿ç”¨ã€‚</li></ul><p>Lab1ä¸»è¦åˆ†æ<code>/obj/kern/kern.asm</code>å’Œ<code>obj/boot/boot.asm</code>ä¸¤ä¸ªæ–‡ä»¶ã€‚è¿™ä¸¤ä¸ªæ–‡ä»¶åˆ†åˆ«æ˜¯<code>/boot</code>å’Œ<code>/kern</code>ç›®å½•ä¸‹çš„æ–‡ä»¶ç¼–è¯‘è¿æ¥åçš„ç›®æ ‡æ–‡ä»¶è¢«åæ±‡ç¼–è€Œç”Ÿæˆçš„ã€‚ä¹‹æ‰€ä»¥è¿™æ ·åšæ˜¯å› ä¸ºåæ±‡ç¼–ä¹‹åå¯ä»¥çœ‹åˆ°æ¯ä¸€æ¡æŒ‡ä»¤åœ¨å†…å­˜ä¸­çš„ç»å¯¹åœ°å€ã€‚è¿™æ ·è°ƒè¯•çš„æ—¶å€™éå¸¸æ–¹ä¾¿ã€‚è‡³äº<strong>å®æ¨¡å¼</strong>å’Œ<strong>ä¿æŠ¤æ¨¡å¼</strong>ä¸‹çš„åœ°å€è½¬æ¢åœ¨åç»­çš„å®éªŒä¸­ä¹Ÿä¼šé‡ç‚¹å…³æ³¨ã€‚</p><h4 id="the-pcs-physical-address-space">The PC's Physical Address Space</h4><p>æœ€æ—©çš„8086æœºå™¨åªæœ‰1Mbçš„å¯»å€ç©ºé—´ï¼Œåé¢çš„80x86ç³»åˆ—æœºå™¨ä¸ºäº†å‘åå…¼å®¹æ‰€ä»¥è¡ç”Ÿå‡ºå®æ¨¡å¼å’Œä¿æŠ¤æ¨¡å¼è¿™ä¸¤ç§æ¦‚å¿µï¼Œä½†æ˜¯BIOSä¸€ç›´éƒ½å­˜åœ¨äºä»<code>0x00000000</code>åˆ°<code>0x00100000</code>è¿™1Mbçš„ç©ºé—´ä¸­ã€‚JOSçš„å†…å­˜å¸ƒå±€ä¹Ÿæ˜¯è§„å®šåªæœ‰<code>0x00000000</code>åˆ°<code>0x10000000</code>è¿™256MBå¤§å°çš„ç©ºé—´ï¼Œä½†æ˜¯é»˜è®¤åœ°å€çº¿æ˜¯32ä½çš„ã€‚<strong>è¿™ä¸ªå¾ˆé‡è¦ï¼Œå› ä¸ºåé¢å®éªŒå¯¹JOSè¿›è¡Œè™šæ‹Ÿå†…å­˜åˆ†é…çš„æ—¶å€™é¡µæ¡†åœ°å€æœ€å¤§ä¹Ÿåªèƒ½æ˜¯<code>0x10000000</code>ï¼Œå†…æ ¸å¦‚ä½•å¤„ç†æ˜ å°„å°±æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚</strong>å…·ä½“å¸ƒå±€è§ä¸‹å›¾:</p><p><img src="6.png" width="50%" height="50%" alt=""></p><h4 id="the-rom-bios">The ROM BIOS</h4><h5 id="exercise-2">Exercise 2</h5><p>è¿™é‡Œä»‹ç»ä¸€ä¸‹å¸¸ç”¨çš„GDBè°ƒè¯•å‚æ•°:</p><ul><li><code>si</code>: å•æ­¥è°ƒè¯•</li><li><code>info register</code>: æŸ¥çœ‹å½“å‰å„å¯„å­˜å™¨çš„å€¼</li><li><code>x/Nx Addr</code>: æŸ¥çœ‹å†…å­˜åœ°å€Addrä¹‹å<strong>Nå­—</strong>çš„å†…å®¹</li><li><code>x/Ni Addr</code>: æŸ¥çœ‹å†…å­˜åœ°å€Addrä¹‹åçš„Næ¡åæ±‡ç¼–æŒ‡ä»¤</li><li><code>x/Ni $eip</code>: æŸ¥çœ‹CPUå½“å‰æ‰§è¡Œçš„ä¸‹Næ¡æŒ‡ä»¤ï¼ˆå…¶ä¸­$eipå¯ä»¥æ¢æˆä¸åŒçš„å¯„å­˜å™¨ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼‰</li></ul><p>é€šè¿‡åˆ†æå‰é¢çš„JOSå†…å­˜çš„å¸ƒå±€ï¼ŒBIOSä½œä¸ºå›ºä»¶å­˜åœ¨äº<code>0xf0000</code>åˆ°<code>0xfffff</code>è¿™64KBçš„ç©ºé—´ä¸Šã€‚<strong>æ³¨æ„å¯åŠ¨ä¸ºå®æ¨¡å¼ï¼ŒCPUçš„åœ°å€çº¿å¯»å€éƒ½æ˜¯20ä½çš„ã€‚</strong>å¯åŠ¨ä»¿çœŸå™¨ä¹‹åçœ‹åˆ°ç¬¬ä¸€æ¡ä»£ç åœåœ¨äº†<code>0xffff0</code>çš„åœ°å€ä¸Šï¼Œè¯´æ˜è¿™æ˜¯BIOSç¨‹åºçš„å…¥å£ã€‚<code>0xffff0</code>åˆ°BIOSç¨‹åºé¡¶éƒ¨<code>0xfffff</code>åªæœ‰16å­—èŠ‚çš„ç©ºé—´ï¼Œéœ€è¦æ›´å¤§çš„è¿è¡Œç©ºé—´ï¼Œå› æ­¤ç¬¬ä¸€æ¡æŒ‡ä»¤<code>ljmp   $0xf000,$0xe05b</code>ï¼›ä¹Ÿå°±æ˜¯è·³è½¬åˆ°<code>0xfe05b</code>è¿™ä¸ªåœ°å€æ­£å¼å¼€å§‹è¿è¡ŒBIOSçš„ç¨‹åºã€‚<br>BIOSæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¤æ‚çš„ç³»ç»Ÿï¼Œä½†æ˜¯å’ŒOSå…³ç³»ä¸å¤§ã€‚é€šè¿‡è°ƒè¯•BIOSçš„ä»£ç æˆ‘ä»¬çŸ¥é“äº†å®ƒçš„åŠŸèƒ½:</p><ul><li>å»ºç«‹ä¸­æ–­å‘é‡è¡¨åŠç›¸åº”çš„ä¸­æ–­ä¾‹ç¨‹</li><li>åˆå§‹åŒ–éƒ¨åˆ†ç¡¬ä»¶åŠè‡ªæ£€(POST)</li><li>æ¿€æ´»<code>INT 19</code>ä¸­æ–­æ¥åŠ è½½å¯åŠ¨ç›˜ç¬¬ä¸€æ‰‡åŒº512å­—èŠ‚çš„å†…å®¹åˆ°å†…å­˜(Linux)</li></ul><p>è¿™é‡Œåº”è¯¥è¯´æ˜ç¬¬ä¸€æ‰‡åŒºçš„å†…å®¹æ˜¯<code>/boot</code>ç›®å½•ä¸‹çš„å†…å®¹:<code>boot.S</code>å’Œ<code>main.c</code>,è¿™ä¸¤ä¸ªæ–‡ä»¶æœ€åè¢«ç¼–è¯‘é“¾æ¥æˆä¸ºå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶(è¿™é‡Œéœ€è¦ELFçš„çŸ¥è¯†)ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶å¤§å°å°±æ˜¯512å­—èŠ‚ï¼Œæ­£å¥½æ”¾åœ¨å¯åŠ¨ç›˜çš„ç¬¬ä¸€ä¸ªsectorä¸­,è¢«ç§°ä¸º<strong>bootsect</strong>ã€‚è€ŒBIOSçš„ä¸»è¦å·¥ä½œä¹‹ä¸€å°±æ˜¯å°†<code>bootsect</code>åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ‰§è¡Œå®Œä»»åŠ¡ä¹‹åï¼ŒBIOSè·³è½¬åˆ°<code>bootsect</code>çš„åˆå§‹ä½ç½®ã€‚è‡³æ­¤BIOSå°†æƒé™äº¤ç»™æ“ä½œç³»ç»Ÿï¼ŒOSç»§ç»­å®Œæˆå‰©ä¸‹çš„å¯åŠ¨è¿‡ç¨‹ã€‚ è¿™é‡Œå‘ç°äº†ä¸€ä¸ªå°é—®é¢˜:å°±æ˜¯åœ¨æŸ¥çœ‹<code>/obj/boot</code>ç›®å½•çš„æ—¶å€™ï¼Œå‘ç°å‡ºç°äº†<code>boot.out</code>å’Œ<code>boot</code>ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¦‚ä¸‹:</p><p><img src="7.png" width="50%" height="50%" alt=""></p><p><code>strip</code>å‘½ä»¤å°†ELFæ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨ä¿¡æ¯ç­‰è°ƒè¯•ä¿¡æ¯åˆ æ‰ï¼Œå‡å°‘æ–‡ä»¶æœ¬èº«çš„å¤§å°ã€‚ç†è®ºä¸Šè®²<code>bootsect</code>æœ€ååº”è¯¥è¢«é“¾æ¥åˆ°å¯åŠ¨ç›˜<code>kernel</code>çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºä¸Šï¼Œæ¢å¥è¯è®²æœ€åçš„<strong>æ“ä½œç³»ç»Ÿå¯åŠ¨ç›˜</strong>åªæœ‰ä¸€ä¸ªã€‚æŸ¥çœ‹<code>/obj/boot</code>ç›®å½•ä¸‹ç”Ÿæˆçš„è¿™ä¸ªä¸¤ä¸ªæ–‡ä»¶:<code>boot.out</code>çš„æ ¼å¼ä¸º<strong>å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶</strong>ï¼Œ<code>boot</code>æ˜¯<strong>x86 boot sector</strong>çš„æ ¼å¼ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶ä¸­ä¸€å®šæœ‰ä¸€ä¸ªä½œä¸º<code>bootsect</code>é“¾æ¥ä½¿ç”¨ã€‚è§ä¸‹å›¾:</p><p><img src="8.png" width="50%" height="50%" alt=""></p><p>å¯æ˜¯ç»è¿‡åˆ†æè¿™ä¸¤ä¸ªæ–‡ä»¶å¤§å°éƒ½æ˜¯<strong>8K</strong>,ç»è¿‡ä¼˜åŒ–ä¹‹åä¹Ÿè¦<strong>4K</strong>å¤§å°ï¼Œå’Œ<code>512Bytes</code>ç›¸å·®å¤ªè¿œã€‚è€Œä¸”æ–‡ä»¶<code>boot</code>è¿˜ä¸å¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶å·¥å…·åˆ†æã€‚è¿™ä¸ªç»†èŠ‚æ–¹é¢åº”è¯¥å’Œ<strong>é“¾æ¥</strong>å…³ç³»å¾ˆå¤§ï¼Œ<a href="https://book.douban.com/subject/3652388/" target="_blank" rel="noopener">ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹</a>è¿™æœ¬ä¹¦æ˜¯å›½å†…å°‘æœ‰çš„è®²é“¾æ¥è£…è½½çš„å¥½ä¹¦ï¼Œæœ‰æ—¶é—´å†æ‹œè¯»å§ã€‚</p><h3 id="the-boot-loader">The Boot Loader</h3><h4 id="code">Code</h4><h5 id="åˆ†æbootboot.s">åˆ†æboot/boot.S</h5><p>åˆ†æä¸€ä¸‹<code>/boot/boot.S</code>è¿™ä¸ªæ–‡ä»¶:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">##############1.ç”³æ˜éƒ¨åˆ†###############</span><br><span class="line"></span><br><span class="line">.set PROT_MODE_CSEG, 0x8       </span><br><span class="line">.set PROT_MODE_DSEG, 0x10       </span><br><span class="line">.set CR0_PE_ON,      0x1        </span><br><span class="line"></span><br><span class="line">#################2.16ä½å®æ¨¡å¼éƒ¨åˆ†##########</span><br><span class="line"></span><br><span class="line">.globl start</span><br><span class="line">start:</span><br><span class="line">  .code16                     </span><br><span class="line">  cli                      %ç¦æ­¢ä¸­æ–­   </span><br><span class="line">  cld                        </span><br><span class="line"></span><br><span class="line">  xorw    %ax,%ax            %æ¸…é›¶æ®µå¯„å­˜å™¨</span><br><span class="line">  movw    %ax,%ds            </span><br><span class="line">  movw    %ax,%es            </span><br><span class="line">  movw    %ax,%ss            </span><br><span class="line">  </span><br><span class="line">###å¼€å¯A20åœ°å€çº¿##</span><br><span class="line">seta20.1:</span><br><span class="line">  inb     $0x64,%al          % å°†64å·ç«¯å£çš„å†…å®¹è¯»åˆ°%alå¯„å­˜å™¨ä¸­   </span><br><span class="line">  testb   $0x2,%al           %æ£€æµ‹%alçš„ç¬¬äºŒä½æ˜¯å¦ä¸ºé›¶ï¼ˆä»£è¡¨è¾“å…¥ç¼“å†²åŒºæ˜¯å¦ä¸ºæ»¡ï¼Œå¯ä»¥å¯¹ç«¯å£ç»§ç»­è¯»å†™ï¼‰</span><br><span class="line">  jnz     seta20.1           %ä¸ä¸ºé›¶åˆ™é‡å¤æ‰§è¡Œseta20.1</span><br><span class="line"></span><br><span class="line">  movb    $0xd1,%al          %å°†$0xd1å†™å…¥%alå¯„å­˜å™¨</span><br><span class="line">  outb    %al,$0x64          %å°†%alå¯„å­˜å™¨çš„å€¼å†™å…¥64å·ç«¯å£</span><br><span class="line"></span><br><span class="line">seta20.2:                     %åŒæ ·çš„æ–¹å¼</span><br><span class="line">  inb     $0x64,%al              </span><br><span class="line">  testb   $0x2,%al</span><br><span class="line">  jnz     seta20.2</span><br><span class="line"></span><br><span class="line">  movb    $0xdf,%al              </span><br><span class="line">  outb    %al,$0x60          %ä¸¤ä¸ªç«¯å£è¯»å†™   æ¿€æ´»A20åœ°å€çº¿</span><br><span class="line">###å®æ¨¡å¼â€”â€”â€”â€”&gt;ä¿æŠ¤æ¨¡å¼##</span><br><span class="line">  lgdt    gdtdesc    %åŠ è½½GDT</span><br><span class="line">  movl    %cr0, %eax</span><br><span class="line">  orl     $CR0_PE_ON, %eax    %å–å‡º%CR0å¯„å­˜å™¨çš„ç¬¬é›¶ä½å¹¶ç½®1</span><br><span class="line">  movl    %eax, %cr0      %å®æ¨¡å¼å‘ä¿æŠ¤æ¨¡å¼çš„è½¬æ¢</span><br><span class="line"></span><br><span class="line">  ljmp    $PROT_MODE_CSEG, $protcseg    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###########3.32ä½ä¿æŠ¤æ¨¡å¼éƒ¨åˆ†#############</span><br><span class="line"></span><br><span class="line">  .code32</span><br><span class="line">protcseg:</span><br><span class="line">  movw    $PROT_MODE_DSEG, %ax   </span><br><span class="line">  movw    %ax, %ds               </span><br><span class="line">  movw    %ax, %es               </span><br><span class="line">  movw    %ax, %fs               </span><br><span class="line">  movw    %ax, %gs               </span><br><span class="line">  movw    %ax, %ss               </span><br><span class="line"></span><br><span class="line">  movl    $start, %esp</span><br><span class="line">  call bootmain</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">spin:   %BUG Pointï¼</span><br><span class="line">  jmp spin</span><br><span class="line"></span><br><span class="line">###########4.æ•°æ®åŒº################</span><br><span class="line">.p2align 2                       </span><br><span class="line">gdt:</span><br><span class="line">  SEG_NULL</span><br><span class="line">  SEG(STA_X|STA_R, 0x0, 0xffffffff)</span><br><span class="line">  SEG(STA_W, 0x0, 0xffffffff)   </span><br><span class="line"></span><br><span class="line">gdtdesc:</span><br><span class="line">  .word   0x17                     </span><br><span class="line">  .long   gdt</span><br></pre></td></tr></table></figure><p><strong>ç”³æ˜éƒ¨åˆ†</strong>ä¸¤ä¸ªå®å®šä¹‰æ˜¯åœ¨ä¿æŠ¤æ¨¡å¼ä¸‹çš„æ®µæè¿°ç¬¦çš„ç”³æ˜ï¼Œå¯¹äºä¿æŠ¤æ¨¡å¼åé¢è¿˜ä»‹ç»ï¼Œè¿™é‡ŒæƒæŠŠå®ƒä»¬çœ‹æˆæ˜¯<code>CS</code>å’Œ<code>DS</code>æ®µå¯„å­˜å™¨ã€‚<br><strong>å®æ¨¡å¼éƒ¨åˆ†</strong>é¦–å…ˆå…³æ‰äº†ä¸­æ–­<code>cli</code>ï¼Œå› ä¸ºæ¥ä¸‹æ¥å°±è¦è¿›è¡Œå®æ¨¡å¼ä¸‹ä¸­æ–­æœåŠ¡ä¾‹ç¨‹å‘ä¿æŠ¤æ¨¡å¼ä¸‹IDTä¸­æ–­æè¿°ç¬¦çš„äº¤æ¥ã€‚æœŸé—´ç³»ç»Ÿæ— æ³•å“åº”æ­£å¸¸çš„ä¸­æ–­æœåŠ¡ã€‚<code>cld</code>å°†æ ‡å¿—ä½DFç½®é›¶ï¼ŒDFå’Œå­—ç¬¦ä¸²æ“ä½œç›¸å…³;æ¸…é›¶æ®µå¯„å­˜å™¨ã€‚å¹¶æ‰“å¼€äº†ç¬¬21ï¼ˆA20ï¼‰åˆ°ç¬¬32æ ¹åœ°å€çº¿ï¼Œåœ¨æ²¡æ‰“å¼€ä¹‹å‰é«˜äº1MBçš„åœ°å€æ€»æ˜¯ä¼šâ€œå›æ»šâ€åˆ°0ï¼Œè¿™ä¹Ÿæ˜¯Linuxæ£€æµ‹ä¿æŠ¤æ¨¡å¼å’Œå®æ¨¡å¼çš„ä¸€ä¸ªæ–¹æ³•ã€‚<strong>æ¥ä¸‹æ¥åŠ è½½GDTï¼Œ<code>movl %eax, %cr0</code>è¿™å¥è¯æ˜¯å°†ç³»ç»Ÿæ§åˆ¶å¯„å­˜å™¨<code>%CR0</code>çš„ç¬¬0ä½ï¼ˆPEä½ï¼‰ç½®ä¸€ï¼Œæ„å‘³ç€å¤„ç†å™¨å·¥ä½œæ–¹å¼å˜ä¸ºä¿æŠ¤æ¨¡å¼ã€‚</strong>è¿™é‡Œæ²¡æœ‰ç›´æ¥å¯¹<code>%CR0</code>è¿›è¡Œæ“ä½œï¼Œè€Œæ˜¯é€šè¿‡<code>%eax</code>æ¥å®ç°ä¸»è¦æ˜¯ä¸ºäº†ä¸ç ´åå¯„å­˜å™¨çš„å…¶ä»–ä½ï¼Œå€¼å¾—å€Ÿé‰´ã€‚æœ€å<code>ljmp $PROT_MODE_CSEG, $protcseg</code>æ˜¯è·³è½¬æŒ‡ä»¤ï¼Œ<strong>éœ€è¦æ³¨æ„çš„æ˜¯ç°åœ¨å·²ç»æ˜¯ä¿æŠ¤æ¨¡å¼äº†ï¼Œè€Œåœ¨å®æ¨¡å¼ä¸‹å’Œä¿æŠ¤æ¨¡å¼ä¸‹å¯¹äºåœ°å€çš„è½¬æ¢æ–¹å¼å·²ç»ä»æ®µå¯»å€å˜æˆGDTå¯»å€ã€‚</strong>è¿™é‡Œåªéœ€è¦çŸ¥é“è·³è½¬åˆ°äº†<code>protcseg</code>è¿™ä¸ªåœ°å€ã€‚<br><strong>ä¿æŠ¤æ¨¡å¼</strong>åˆå§‹åŒ–äº†é‡è¦çš„æ®µå¯„å­˜å™¨ï¼Œç„¶åè·³è½¬åˆ°<code>boot/main.c/bootmain</code>å‡½æ•°ï¼Œå¼€å§‹å°†å¯åŠ¨ç›˜å‰©ä½™çš„å†…æ ¸éƒ¨åˆ†è½½å…¥å†…å­˜ã€‚<strong>æ³¨æ„åœ¨AT&amp;Tæ ¼å¼çš„æ±‡ç¼–è¯­è¨€ä¸­ï¼Œæ“ä½œæ•°çš„å­—é•¿æ˜¯ç”±æ“ä½œç¬¦çš„æœ€åä¸€ä¸ªå­—æ¯å†³å®šçš„ï¼Œåç¼€'b','w','l'åˆ†åˆ«è¡¨ç¤ºå­—èŠ‚ï¼ˆbyte:8ä½ï¼‰ï¼Œå­—ï¼ˆword:16ä½ï¼‰å’Œé•¿å­—ï¼ˆlong:32ä½ï¼‰ã€‚</strong><br><strong>æ•°æ®åŒºéƒ¨åˆ†</strong>éƒ½æ˜¯åœ¨ä¿æŠ¤æ¨¡å¼ä¸‹å»ºç«‹GDTå…¨å±€æè¿°ç¬¦çš„æ—¶å€™ç›¸å…³çš„å®å®šä¹‰ã€‚</p><h5 id="åˆ†æbootmain.c">åˆ†æboot/main.c</h5><p>åˆ†æä¸€ä¸‹<code>boot/main.c</code>è¿™ä¸ªæ–‡ä»¶:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#define SECTSIZE 512</span><br><span class="line">#define ELFHDR ((struct Elf *) 0x100000)</span><br><span class="line"></span><br><span class="line">void readsect(void*, uint32_t);</span><br><span class="line">void readseg(uint32_t, uint32_t, uint32_t);</span><br><span class="line">void bootmain(void);</span><br></pre></td></tr></table></figure><p>å…ˆçœ‹è¿™ä¸¤ä¸ªå®å®šä¹‰ï¼Œ<code>SECTSIZE</code>æ˜¯ç£ç›˜ä¸€ä¸ª<code>sector</code>çš„å¤§å°ï¼Œä¸€èˆ¬è¯»å†™æ“ä½œéƒ½è¦æ±‚åœ°å€å¯¹é½ï¼Œè¿™ä¸ªå®å®šä¹‰å°±ä¼šæ´¾ä¸Šç”¨åœºã€‚<code>ELFHDR</code>æ˜¯ä¸€ä¸ªæŒ‡å‘ELFæ–‡ä»¶ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œä¸å¾—ä¸è¯´<strong>å¼ºè½¬</strong>æ˜¯Cè¯­è¨€æœ€æœ‰åŠ›çš„å·¥å…·ä¹‹ä¸€ï¼Œç”±æ­¤å¯çŸ¥<code>0x100000</code>ä¾¿æ˜¯å†…å­˜è½½å…¥çš„é¦–åœ°å€ã€‚è¿™ä¸ªåœ°å€ä¹Ÿæ˜¯BIOSç¨‹åºç»“æŸçš„åœ°æ–¹ï¼Œå¯è§JOSå¯¹äºå†…å­˜çš„è§„åˆ’åˆ†é…è¿˜æ˜¯å¾ˆç²¾ç¡®çš„ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">void</span><br><span class="line">readseg(uint32_t pa, uint32_t count, uint32_t offset)</span><br><span class="line">&#123;</span><br><span class="line">    //paæ˜¯åŠ è½½åœ°å€    countæ˜¯åŠ è½½æ–‡ä»¶å¤§å°    offsetæ˜¯åœ¨å†…æ ¸æ–‡ä»¶ä¸­çš„åç§»é‡</span><br><span class="line">        uint32_t end_pa;</span><br><span class="line">        end_pa = pa + count;   //ç»“æŸåœ°å€</span><br><span class="line">        pa &amp;= ~(SECTSIZE - 1);  //å°†åŠ è½½åœ°å€ä¸æœ€å°å•ä½512å¯¹é½</span><br><span class="line">        offset = (offset / SECTSIZE) + 1;   //è®¡ç®—åŠ è½½éƒ¨åˆ†åœ¨å¯åŠ¨ç›˜ä¸­çš„å“ªä¸€ä¸ªsectorä¸­ï¼Œå› ä¸ºsectorä»1å¼€å§‹ç®—èµ·</span><br><span class="line">        while (pa &lt; end_pa) &#123;</span><br><span class="line">                readsect((uint8_t*) pa, offset);  </span><br><span class="line">                pa += SECTSIZE;    //è¿™å¥è¯è¡¨æ˜ æœ€ç»ˆåˆ†é…çš„å†…å­˜æœ‰å¯èƒ½æ˜¯å¤§äºå®é™…éœ€è¦å†…å­˜çš„ï¼Œå› ä¸ºæ€»æ˜¯ä»¥512ä¸ºæœ€å°åˆ†é…å•å…ƒåˆ†é…çš„</span><br><span class="line">                offset++;  </span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>readseg</code>å‡½æ•°ä¸­çš„å¯¹é½ï¼Œçœ‹ä¸‹é¢è¿™ä¸ªsampleå‡½æ•°:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line"></span><br><span class="line">long SECSIZE = 0x200;  </span><br><span class="line">long pa = 0x30301;</span><br><span class="line">long to = 0x10387;</span><br><span class="line"></span><br><span class="line">to &amp;= ~(SECSIZE - 1);</span><br><span class="line">pa &amp;= ~(SECSIZE - 1);</span><br><span class="line"></span><br><span class="line">printf(&quot;secsize is : %lx\n&quot;, SECSIZE);</span><br><span class="line">printf(&quot;pa is : %lx\n&quot;, pa);</span><br><span class="line">printf(&quot;to is : %lx\n&quot;, to);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹æ‰€ä»¥éœ€è¦å¯¹é½ï¼Œå› ä¸ºç£ç›˜å’Œå†…å­˜ä¹‹é—´è¯»å†™å¦‚æœæŒ‰ç…§è§„å®šçš„æœ€å°ç²’åº¦è¿›è¡Œï¼ŒCPUçš„è®¿é—®æ€§èƒ½ä¼šæé«˜ã€‚å…·ä½“è§<a href="https://www.ibm.com/developerworks/library/pa-dalign/" target="_blank" rel="noopener">IBM.alignment</a>ã€‚ä¸Šè¿°å‡½æ•°çš„æ‰§è¡Œç»“æœè§ä¸‹å›¾:</p><p><img src="9.png" width="50%" height="50%" alt=""></p><p><code>readsect</code>å‡½æ•°éƒ½æ˜¯ä¸€äº›ç«¯å£æ“ä½œã€‚ä¹Ÿæ²¡ä»”ç»†ç ”ç©¶Orzã€‚ä¸‹é¢ä¸»è¦çœ‹ä¸€ä¸‹<code>bootmain</code>å‡½æ•°å‰©ä¸‹çš„éƒ¨åˆ†:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   ph = (struct Proghdr *) ((uint8_t *) ELFHDR + ELFHDR-&gt;e_phoff);</span><br><span class="line">   eph = ph + ELFHDR-&gt;e_phnum;</span><br><span class="line">   for (; ph &lt; eph; ph++)</span><br><span class="line">            readseg(ph-&gt;p_pa, ph-&gt;p_memsz, ph-&gt;p_offset);</span><br><span class="line">((void (*)(void)) (ELFHDR-&gt;e_entry))();</span><br></pre></td></tr></table></figure><p>å…³äºJOSå¯¹äºELFæ–‡ä»¶çš„ç”³æ˜è§<code>/inc/elf.h</code>ã€‚ä¸€å…±æœ‰ä¸‰ä¸ªç»“æ„ä½“ï¼Œ<code>Elf</code>ä»£è¡¨æ–‡ä»¶å¤´ï¼›<code>Proghdr</code>ä»£è¡¨åŠ è½½æ—¶å€™segmentçš„ä¿¡æ¯ï¼›<code>Secthdr</code>ä»£è¡¨è¿è¡Œæ—¶sectionçš„ä¿¡æ¯ï¼›<br>åœ¨Lab0ä¸­ï¼Œæˆ‘ä»¬åˆ†æè¿‡å¯¹ä¸€ä¸ªç¨‹åºåŠ è½½çš„æ—¶å€™æ˜¯ä»¥<code>segments</code>ä¸ºæœ€å°ç²’åº¦çš„ã€‚æ‰€ä»¥æˆ‘ä»¬é‡ç‚¹å…³æ³¨<code>Elf</code>å’Œ<code>Proghdr</code>è¿™ä¸¤ä¸ªç»“æ„ä½“çš„ç»†èŠ‚ã€‚</p><ul><li><code>e_phoff</code>: segmentè¡¨åœ¨æ•´ä¸ªç¨‹åºä¸­çš„åç§»é‡</li><li><code>e_phnum</code>: segmentè¡¨é¡¹çš„ä¸ªæ•°</li><li><code>ph-&gt;p_pa</code>: è¯¥segmentåœ¨å†…å­˜ä¸­çš„åŠ è½½åœ°å€</li><li><code>ph-&gt;p_memsz</code>: è¯¥segmentçš„å¤§å°</li><li><code>ph-&gt;p_offset</code>: è¯¥segmentç›¸å¯¹äºè¡¨èµ·å§‹åœ°å€çš„åç§»é‡</li></ul><p>æ‰€ä»¥<code>ph</code>å°±æ˜¯segmentæ®µè¡¨çš„å¼€å§‹åœ°å€ã€‚è€Œ<code>eph</code>å°±æ˜¯segmentæ®µè¡¨çš„é¡¹æ•°ã€‚è¿™ä¸ªå¾ªç¯æ˜¯æŠŠæ‰€æœ‰çš„segmentséƒ½åŠ è½½åˆ°ç›¸å¯¹åº”çš„å†…å­˜åœ°å€ä¸­ã€‚<br>åŠ è½½ç»“æŸåï¼Œå†æ¬¡è·³è½¬<code>((void (*)(void)) (ELFHDR-&gt;e_entry))()</code>,é€šè¿‡è°ƒè¯•åæ±‡ç¼–ä»£ç ï¼Œå‘ç°è·³è½¬çš„è¿™ä¸ªåœ°å€ä¸º<code>call *0x10018</code>,æ³¨æ„è¿™é‡Œæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå¯ä»¥çœ‹åˆ°å†…æ ¸å‡½æ•°çœŸæ­£çš„å…¥å£åœ¨<code>0x0010000c</code>ã€‚æ‰€ä»¥æ­£ç¡®çš„æ“ä½œè§ä¸‹å›¾:</p><p><img src="10.png" width="50%" height="50%" alt=""></p><h5 id="exercise-3">Exercise 3</h5><p>åœ¨ä¸Šé¢åˆ†æçš„è¿‡ç¨‹åŸºæœ¬ä¸Šå›ç­”äº†æ‰€æœ‰çš„é—®é¢˜:</p><ul><li><code>%CR0</code>æ ‡å¿—ä½çš„æ”¹å˜æ„å‘³ç€å®æ¨¡å¼åˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼</li><li><code>call *0x10018</code>æ˜¯æœ€åä¸€æ¡BootLoaderæ‰§è¡Œçš„æŒ‡ä»¤ï¼Œ<code>movw $0x1234, 0x472</code>æ˜¯å†…æ ¸ç¬¬ä¸€æ¡æŒ‡ä»¤ï¼Œè¿™æ¡æŒ‡ä»¤åœ¨<code>0x0010000c</code>è¿™ä¸ªå…¥å£åœ°å€ã€‚</li><li>é€šè¿‡è¯»å–ELFæ–‡ä»¶ä¸­å…³äºåŠ è½½segmentsçš„ä¿¡æ¯ï¼Œå› ä¸ºmainå‡½æ•°æœ€å¼€å§‹åŠ è½½äº†8ä¸ªsectorsçš„å†…å®¹åˆ°å†…å­˜ä¸­ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°±æ˜¯å’ŒELFæ ¼å¼å’Œç»†èŠ‚ä¿¡æ¯æœ‰å…³ç³»ã€‚</li></ul><h4 id="loading-the-kernel">Loading the Kernel</h4><h5 id="exercise-4">Exercise 4</h5><p>é‡æ¸©Cè¯­è¨€æŒ‡é’ˆï¼Œå®éªŒä¸­æ¨è<a href="https://book.douban.com/subject/1236999/" target="_blank" rel="noopener">TCPL</a>ã€‚åˆ†æå®éªŒä¸­ç»™å‡ºçš„éƒ¨åˆ†ç¤ºä¾‹ä»£ç ï¼Œä½“ä¼šæŒ‡é’ˆçš„é­…åŠ›:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c = (int *) ((char *) c + 1);</span><br><span class="line">*c = 500;</span><br><span class="line">printf(&quot;5: a[0] = %d, a[1] = %d, a[2] = %d, a[3] = %d\n&quot;,</span><br><span class="line">a[0], a[1], a[2], a[3]);</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å°†cå¼ºè½¬æˆä¸ºcharç±»å‹çš„æŒ‡é’ˆä¹‹ååŠ ä¸€ï¼Œç„¶åèµ‹å€¼ä¸º500ï¼›é—®é¢˜å°±å‡ºç°åœ¨charç±»å‹å’Œintç±»å‹çš„æŒ‡é’ˆå¤§å°æ˜¯ä¸ä¸€æ ·çš„ã€‚intç±»å‹ä¸º4ä¸ªå­—èŠ‚ï¼Œè€Œcharç±»å‹åªæœ‰1ä¸ªå­—èŠ‚;æ‰€ä»¥è¿™æ ·åŠ¿å¿…ä¼šå¯¼è‡´èµ‹å€¼çš„æ—¶å€™æ”¹å˜æ•°ç»„ä¸­åŸæ¥çš„å¸ƒå±€ã€‚å·²çŸ¥a[1]åŸæ¥çš„å€¼400ï¼Œ16è¿›åˆ¶ä¸º0x190;a[2]çš„å€¼åŸæ¥ä¸º301ï¼Œ16è¿›åˆ¶ä¸º0x12D;500çš„16è¿›åˆ¶ä¸º0x1F4;ä¸€ä¸ªåœ°å€å•å…ƒä¸ºä¸€ä¸ªå­—èŠ‚ï¼Œä¸ºè§ä¸‹å›¾:</p><p><img src="11.png" width="50%" height="50%" alt=""></p><p>å¯ä»¥çœ‹åˆ°è¯»å†™æ“ä½œæ˜¯æŒ‰ç…§å­—èŠ‚ä¸ºæœ€å°å•å…ƒï¼Œæœ€åå¯¼è‡´a[1]çš„å€¼å˜æˆ0x1F490ä¹Ÿå°±æ˜¯åè¿›åˆ¶çš„128144ï¼›è€Œa[2]ç”±äºè¢«æŠ¹æ‰ä»¥ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥å˜æˆ0x100ä¹Ÿå°±æ˜¯256ã€‚ä¸‹å›¾æ˜¯æœ€ç»ˆçš„è¿è¡Œç»“æœ:</p><p><img src="12.png" width="50%" height="50%" alt=""></p><h5 id="exercise-5">Exercise 5</h5><p>å…³äºé“¾æ¥å™¨å’ŒåŠ è½½å™¨ï¼Œæœ€ç»å…¸çš„å½“ç„¶æ˜¯è¿™æœ¬<a href="https://www.iecc.com/linker/" target="_blank" rel="noopener">loader and linker</a>ã€‚è¿™æ˜¯ä¸­è¯‘æœ¬<a href="https://paper.seebug.org/papers/Archive/refs/elf/ã€Šé“¾æ¥å™¨å’ŒåŠ è½½å™¨ã€‹ä¸­è¯‘æœ¬.pdf" target="_blank" rel="noopener">ll.Ch</a>ã€‚ä¸è¿‡æˆ‘åšå®éªŒçš„æ—¶å€™æ²¡æœ‰æƒ³æ˜ç™½ä»–ä»¬ä¸ºä»€ä¹ˆè¦åœ¨è¿™é‡Œå¼•å…¥è¿™ä¸¤ä¸ªå¤æ‚çš„æ¦‚å¿µï¼›é¢˜ç›®å¾ˆç®€å•ï¼Œä½†æ˜¯ä¸çŸ¥é“<code>LMA</code>å’Œ<code>VMA</code>æ˜¯å’Œè™šæ‹Ÿå†…å­˜æœ‰å…³ç³»è¿˜æ˜¯å’Œé“¾æ¥å™¨ï¼ŒåŠ è½½å™¨æœ‰å…³ç³»ã€‚åæ¥ç”¨<code>readelf -h kernel</code>å‘ç°<code>VMA</code>å°±æ˜¯è™šæ‹Ÿåœ°å€ï¼Œæ‰€ä»¥è¿™é‡Œä»–ä»¬æ‰€è°“çš„linking addresså’Œloading addressåªæ˜¯å®éªŒä¸­è‡ªè¡Œå®šä¹‰çš„å­—é¢æ„æ€<strong>åŠ è½½çš„åœ°å€</strong>å’Œ<strong>æ‰§è¡Œçš„åœ°å€</strong>ï¼Œå’Œé“¾æ¥å™¨åŠ è½½å™¨æ²¡æœ‰å…³ç³»ï¼ï¼å¦å¤–åœ¨Lab0ä¸­å·²ç»åˆ†æè¿‡åŠ è½½æ—¶å€™çš„<code>section</code>æ˜¯æ‰€æœ‰<code>sections</code>ç»„åˆæˆçš„ä¸€ä¸ªèšåˆèŠ‚ï¼Œè¿™é‡Œä¸è€ƒè™‘é“¾æ¥æ—¶å€™çš„å•ä¸ª<code>section</code>çš„æ¦‚å¿µã€‚<strong>è¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥æ˜ç™½å®éªŒè®²è§£çš„æ€è·¯â€”â€”â€”â€”å¼•å…¥ä½¿ç”¨ELFä¸­<code>segments</code>çš„æ¦‚å¿µæ¥è§£é‡ŠåŠ è½½è¿‡ç¨‹ï¼Œè€ŒåŠ è½½è¿‡ç¨‹æ—¶å€™å·²ç»å¼€å¯äº†åˆ†é¡µæœºåˆ¶ï¼Œæ‰€ä»¥è¿™æ—¶å€™ç”¨<code>loading address</code>å’Œ<code>linking address</code>æ¥è§£é‡Š<code>0xf0100000</code>å’Œ<code>0x00100000</code>çš„åŒºåˆ«ã€‚è€Œå®é™…ä¸Š<code>0xf0100000</code>å°±æ˜¯æ˜ å°„åˆ°<code>0x00100000</code>ä¸Šï¼Œç›¸å…³ç»†èŠ‚åœ¨Kerneléƒ¨åˆ†ä¼šç»§ç»­åˆ†æã€‚</strong> readelfå’Œobjdumpçš„æ“ä½œè§ä¸‹å›¾:</p><p><img src="14.png" width="50%" height="50%" alt=""></p><p>å°†é“¾æ¥åœ°å€æ”¹æ‰ä¹‹åï¼Œç¬¬ä¸€æ¡æŠ¥é”™çš„åº”è¯¥æ˜¯å’Œé“¾æ¥åœ°å€ç›´æ¥ç›¸å…³çš„æŒ‡ä»¤ï¼Œè·³è½¬æŒ‡ä»¤<code>ljmp $PROT_MODE_CSEG, $protcseg</code>;</p><h5 id="exercise-6">Exercise 6</h5><p>å‰é¢åˆ†æè¿‡<code>#define ELFHDR ((struct Elf *) 0x100000)</code>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå†…æ ¸çš„è£…è½½åœ°å€(load address)å°±æ˜¯<code>0x00100000</code>ï¼Œè€Œå†…æ ¸å¼€å§‹æ‰§è¡Œçš„åœ°å€åº”è¯¥æ˜¯<code>e_entry</code>ä¹Ÿå°±æ˜¯<code>0x0010000c</code>ã€‚ä»BIOSåˆ°BootLoaderçš„æ—¶å€™ï¼Œå†…æ ¸è¿˜æ²¡æœ‰å¼€å§‹è£…è½½ã€‚æ‰€ä»¥<code>0x00100000</code>æ˜¯ç©ºçš„ã€‚</p><p><img src="13.png" width="50%" height="50%" alt=""></p><h3 id="the-kernel">The Kernel</h3><h4 id="using-virtual-memory-to-work-around-position-dependence">Using virtual memory to work around position dependence</h4><p>Lab1ä¸­çš„åœ°å€æ˜ å°„: <code>0x00000000</code>â€”â€”â€”â€”<code>0x00400000</code>æ˜ å°„åˆ°<code>0x00000000</code>â€”â€”â€”â€”<code>0x00400000</code>ï¼›<code>0xf0000000</code>â€”â€”â€”â€”<code>0xf0400000</code>æ˜ å°„åˆ°<code>0x00000000</code>â€”â€”â€”â€”<code>0x00400000</code>;<br>åœ¨å®éªŒè¿‡ç¨‹ä¸­å…³æ³¨äº†ä¸€ä¸‹åœ°å€: åœ¨æ‰§è¡Œåˆ°<code>kern/entry.S</code>æ–‡ä»¶ä¹‹å‰ï¼Œæ‰€æœ‰çš„å†…å­˜åœ°å€éƒ½æ˜¯ç‰©ç†åœ°å€ï¼ˆä¹¦ä¸­ä»£è¨€ä¸ºçº¿æ€§åœ°å€ï¼Œä½†æ˜¯çº¿æ€§åœ°å€=ç‰©ç†åœ°å€æ‰€ä»¥æ²¡æœ‰å¤ªå¤§åŒºåˆ†ï¼‰ã€‚ç›´åˆ°<code>%CR0</code>å¯„å­˜å™¨çš„PGæ ‡å¿—ä½è¢«ç½®é›¶ã€‚è¿™æ—¶å€™åˆ†é¡µæœºåˆ¶æ‰è¢«æ¿€æ´»ã€‚<code>0x00100000</code>å’Œ<code>0xf0100000</code>éƒ½æ˜ å°„åˆ°<code>0x00100000</code>ï¼Œæ‰€æœ‰ä¸¤ä¸ªåœ°å€å­˜å‚¨çš„æ•°å€¼æ˜¯ä¸€æ ·çš„ã€‚è€Œåœ¨æ˜ å°„è¿˜æ²¡æœ‰å»ºå¥½ä¹‹å‰æ˜¯ä¸ä¸€æ ·çš„ã€‚</p><h5 id="exercise-7">Exercise 7</h5><p><code>%CR0</code>å¯„å­˜å™¨PGä½æ§åˆ¶åˆ†é¡µæœºåˆ¶çš„å®ç°ã€‚çœ‹åˆ°<code>mov %eax, %cr0</code>æ‰§è¡Œç»“æŸä¹‹åï¼Œç´¢å¼•åœ°å€å˜æˆäº†<code>0xf0100010</code>ã€‚åœ°å€æ˜ å°„ä¸å¯¹ï¼Œç¬¬ä¸€æ¡é”™è¯¯çš„æŒ‡ä»¤ä¸€å®šä¼šæ˜¯è·³è½¬æŒ‡ä»¤<code>jmp *%eax</code>ã€‚å…·ä½“çš„åˆ†é¡µç»†èŠ‚åœ¨Lab2ä¸­åˆ†æã€‚å®éªŒæ“ä½œè§ä¸‹å›¾:</p><p><img src="15.png" width="50%" height="50%" alt=""></p><h4 id="code-1">Code</h4><h5 id="åˆ†ækernprintf.c">åˆ†ækern/printf.c</h5><p>ä¸‹é¢åˆ†æä¸€ä¸‹<code>kern/printf.c</code>è¿™ä¸ªæ–‡ä»¶:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">static void putch(int ch, int *cnt)</span><br><span class="line">&#123;</span><br><span class="line">        cputchar(ch);//æ˜¾ç¤ºå±è¾“å‡ºå‡½æ•°console</span><br><span class="line">        *cnt++;   //æ¯è¿›è¡Œä¸€æ¬¡æ˜¾ç¤ºå±è¾“å‡ºï¼Œå‚æ•°è‡ªåŠ </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int vcprintf(const char *fmt, va_list ap)</span><br><span class="line">&#123;</span><br><span class="line">        int cnt = 0;   //cntå°†è‡ªèº«æŒ‡é’ˆä¼ ç»™putch(int, int*)ï¼Œåœ¨å‡½æ•°é‡Œè¿›è¡Œè‡ªåŠ </span><br><span class="line">        vprintfmt((void*)putch, &amp;cnt, fmt, ap);  //æ ¼å¼åˆ¤æ–­</span><br><span class="line">        return cnt;                  //è¿”å›æœ€ç»ˆè¾“å‡ºçš„å‚æ•°ä¸ªæ•°</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int cprintf(const char *fmt, ...)</span><br><span class="line">&#123;</span><br><span class="line">        va_list ap;</span><br><span class="line">        int cnt;</span><br><span class="line">        va_start(ap, fmt);</span><br><span class="line">        cnt = vcprintf(fmt, ap);//å˜å‚ä¼ é€’</span><br><span class="line">        va_end(ap);</span><br><span class="line">        return cnt;  //è¿”å›å‚æ•°ä¸ªæ•°</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>cprintf</code>æ˜¯ä¸»å‡½æ•°ï¼Œè¿™é‡Œç”¨åˆ°äº†Cè¯­è¨€çš„å˜å‚ç‰¹æ€§ã€‚å˜å‚åœ¨Cåº“<code>stdarg.h</code>ä¸­å®šä¹‰è‡³å°‘è¦æœ‰ä¸€ä¸ªå›ºå®šçš„å‚æ•°:<code>fun(const char *fmt, ...)</code>ã€‚ä¸»è¦æœ‰ä¸‰ä¸ªå®ç»„æˆ:</p><ul><li><code>va_list</code>: ç”³æ˜å¯å˜å‚æ•°æŒ‡é’ˆapï¼Œä¾æ¬¡æŒ‡å‘çœç•¥å·è¡¨ç¤ºçš„å¯å˜å‚æ•°</li><li><code>va_start(ap, lastFix)</code>: åˆå§‹åŒ–apï¼Œå¼€å§‹æŒ‡å‘ç¬¬ä¸€ä¸ªå¯å˜å‚æ•°</li><li><code>va_arg(ap, type)</code>: å°†apæŒ‡å‘ä¸‹ä¸€ä¸ªå¯å˜å‚æ•°</li><li><code>va_end(ap)</code>: æ¸…é™¤apæŒ‡é’ˆï¼Œç»“æŸå‡½æ•°</li></ul><p>å¯ä»¥çœ‹åˆ°å˜å‚<code>fmt</code>å’Œå˜å‚æŒ‡é’ˆ<code>ap</code>è¢«ä¸€è·¯ä¼ åˆ°<code>vcprintf</code>â€”â€”â€”&gt;<code>vprintfmt</code>ã€‚åœ¨<code>vprintfmt</code>ä¸­ä½¿ç”¨ã€‚è¯¥æ–‡ä»¶ä¸­é‡ç‚¹å…³æ³¨ä¸¤ä¸ªå‡½æ•°:</p><ul><li>åœ¨<code>lib/printfmt.c</code>ä¸­çš„å‡½æ•°: <code>vprintfmt(void (*putch)(int, void*), void *putdat, const char *fmt, va_list ap)</code></li><li>åœ¨<code>kern/console.c</code>ä¸­çš„å‡½æ•°: <code>cputchar(int c)</code></li></ul><p>ç»è¿‡è§‚å¯Ÿä¹‹åå°±å¯ä»¥çŸ¥é“: <strong><code>vprintfmt</code>å‡½æ•°åˆ¤æ–­å­—ç¬¦ä¸²è¾“å‡ºå‚æ•°çš„ç±»å‹å¹¶è°ƒç”¨<code>cputchar</code>å‡½æ•°å°†ç›¸åº”çš„è¾“å‡ºæ˜¾ç¤ºåˆ°æ˜¾ç¤ºå±ä¸Š</strong>ã€‚<br>åœ¨å‡½æ•°åˆ†æä¹‹å‰å†ä»‹ç»ä¸€ä¸ªvimçš„æ–°æŠ€èƒ½:æœç´¢é«˜äº®<code>:match Search /xxx/</code>,å¯ä»¥å¯¹ç°åœ¨æ­£åœ¨å…³æ³¨çš„å…³é”®å­—è¿›è¡Œé«˜äº®æ˜¾ç¤ºï¼Œè°ƒè¯•çš„æ—¶å€™å¾ˆæœ‰ç”¨:</p><p><img src="22.png" width="50%" height="50%" alt=""></p><h6 id="åˆ†æå‡½æ•°vprintfmt">åˆ†æå‡½æ•°vprintfmt</h6><p><code>vprintfmt</code>å‡½æ•°å…¶å®å¾ˆç®€å•ï¼Œä¸»ä½“å°±æ˜¯ä¸€ä¸ªwhileå¾ªç¯:åœ¨é‡åˆ°<code>%</code>ä¹‹å‰ç›´æ¥è¾“å‡ºï¼Œé‡åˆ°<code>%</code>ä¹‹åå¼€å§‹åˆ¤æ–­æ ¼å¼å¹¶è¾“å‡ºã€‚</p><h6 id="åˆ†æå‡½æ•°cputchar">åˆ†æå‡½æ•°cputchar</h6><p><strong>åœ¨<code>vprintfmt</code>å‡½æ•°ä¸­éœ€è¦æ³¨æ„ä¸€ä¸ªå˜é‡:<code>ch = *(unsigned char *) fmt++</code>ã€‚<code>ch</code>ä»£è¡¨äº†å½“å‰apæŒ‡é’ˆæŒ‡å‘çš„å˜å‚ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦è¾“å‡ºçš„å†…å®¹ã€‚</strong><code>cputchar(ch)</code>ä¸­çš„å‚æ•°æ­£å¥½å°±æ˜¯è¿™ä¸ª<code>ch</code>ã€‚æˆ‘ä»¬ä½¿ç”¨Ctagsè·Ÿè¸ªè¿™ä¸ª<code>ch</code>å‚æ•°ç»è¿‡çš„å‡½æ•°:<code>putch(int ch, int *)</code>â€”â€”â€”â€”&gt;<code>cputchar(int ch)</code>â€”â€”â€”â€”&gt;<code>cons_putc(int ch)</code>ã€‚ç°åœ¨åŸºæœ¬ä¸Šå¯ä»¥çœ‹æ¸…æ‰€æœ‰çš„æ§åˆ¶å°è¾“å‡ºæ“ä½œéƒ½æ˜¯å®šä¹‰åœ¨<code>console.c</code>æ–‡ä»¶ä¸­çš„ã€‚æˆ‘ä»¬ç›´æ¥åˆ†æä¸€ä¸‹<code>cons_putc(int ch)</code>è¿™ä¸ªå‡½æ•°:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">static void cons_putc(int c)</span><br><span class="line">&#123;</span><br><span class="line">        serial_putc(c);</span><br><span class="line">        lpt_putc(c);</span><br><span class="line">        cga_putc(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šä¸‰ä¸ªå­å‡½æ•°éƒ½æ¶‰åŠåˆ°çš„å†…è”æ±‡ç¼–<code>inb()</code>å’Œ<code>outb()</code>ä¸¤ä¸ªå‡½æ•°åœ¨<code>inc/x86.h</code>ä¸­æœ‰å®šä¹‰ã€‚å…¶ä¸­<code>serial_putc</code>æ˜¯ä¸²å£è¾“å‡ºï¼Œ<code>lpt_putc</code>æ˜¯å¹¶å£è¾“å‡ºï¼Œè€Œ<code>cga_putc</code>æ˜¯æ˜¾ç¤ºå±è¾“å‡ºï¼Œå…·ä½“ä¸ç»†åˆ†æäº†:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (i = 0; !(inb(0x378+1) &amp; 0x80) &amp;&amp; i &lt; 12800; i++)</span><br><span class="line">       delay();    //åˆ¤æ–­æ•°æ®ç¼“å†²åŒºå¯„å­˜å™¨æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™ä¸€ç›´å¾ªç¯</span><br><span class="line">   outb(0x378+0, c);     //å°†Cå‚æ•°ä»£è¡¨çš„å†…å®¹å†™åˆ°ç«¯å£ä¸­</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œåœ¨<code>cga_putc(c)</code>å‡½æ•°ä¸­ï¼Œæœ‰ä¸€æ®µä»£ç :</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if (crt_pos &gt;= CRT_SIZE) &#123;</span><br><span class="line">    int i;</span><br><span class="line">    memmove(crt_buf, crt_buf + CRT_COLS, (CRT_SIZE - CRT_COLS) * sizeof(uint16_t));</span><br><span class="line">    for (i = CRT_SIZE - CRT_COLS; i &lt; CRT_SIZE; i++)</span><br><span class="line">        crt_buf[i] = 0x0700 | &apos; &apos;;</span><br><span class="line">    crt_pos -= CRT_COLS;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çŸ¥é“<code>cga_putc(c)</code>å‡½æ•°æ˜¯ç”¨äºæ˜¾ç¤ºå±è¾“å‡ºçš„å‡½æ•°ï¼Œè€ŒæŸ¥çœ‹è¿™å‡ ä¸ªå®å®šä¹‰:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">static uint16_t crt_pos //å…‰æ ‡</span><br><span class="line">#define CRT_ROWS        25   //æ˜¾ç¤ºå±è¡Œ</span><br><span class="line">#define CRT_COLS        80    //æ˜¾ç¤ºå±åˆ—</span><br><span class="line">#define CRT_SIZE        (CRT_ROWS * CRT_COLS)  //æ˜¾ç¤ºå±é¢ç§¯</span><br></pre></td></tr></table></figure><p>ç®€å•æ¥è®²å°±æ˜¯å¦‚æœè¾“å‡ºæ»¡å±ä¹‹åï¼Œéœ€è¦é¡µé¢å‘ä¸Šæ»šåŠ¨ä¸€è¡Œã€‚</p><h4 id="formatted-printing-to-the-console">Formatted Printing to the Console</h4><h5 id="exercise-8">Exercise 8</h5><p>ç»è¿‡ä¸Šé¢çš„åˆ†æä¹‹åï¼ŒçŸ¥é“æ ¼å¼åŒ–è¾“å‡ºæ˜¯åœ¨<code>kern/printfmt.c/vprintfmt()</code>è¿™ä¸ªå‡½æ•°ä¸­ã€‚æ‰¾åˆ°ç›¸åº”çš„ä½ç½®ä¿®æ”¹å°±è¡Œã€‚</p><p><img src="16.png" width="50%" height="50%" alt=""></p><h5 id="questions">Questions</h5><p>è¿™æ˜¯Exercise.8åé¢çš„ä¸€äº›é—®é¢˜ï¼Œå½“ç„¶å¾ˆç®€å•äº†:<br>1.cputchar(int c) 2.ä¸€å¥è¯ï¼Œå°±æ˜¯æ»¡å±æ—¶å€™çš„å¤„ç†æ–¹æ³• 3.ä¸»è¦æ˜¯å˜å‚æŒ‡é’ˆ<code>ap</code>å’Œæ ¼å¼åŒ–å˜å‚<code>fmt</code>çš„æŒ‡å‘é—®é¢˜ï¼Œä¹‹å‰åˆ†æè¿‡<br>4.å°†ä»£ç åŠ åˆ°<code>kern/monitor.c</code>ä¸­ï¼Œè¾“å‡ºè§ä¸‹å›¾ã€‚å› ä¸º57616çš„åå…­è¿›åˆ¶å°±æ˜¯ellã€‚è€Œ0x0x00646c72åœ¨å°ç«¯å­˜å‚¨çš„æœºå™¨ä¸Šç”¨char*è¡¨ç¤ºå°±æ˜¯<code>rld\0</code>ã€‚å¦‚æœæƒ³è¦ç”¨å¤§ç«¯å­˜å‚¨çš„è¯ï¼Œåªè¦åè¿‡æ¥å°±è¡Œ0x726c6400ã€‚</p><p><img src="17.png" width="50%" height="50%" alt=""></p><p>5.æ ¹æ®å˜å‚çš„å®šä¹‰ï¼Œå¦‚æœfmtå‚æ•°ä¸å¤Ÿï¼Œé‚£æœ€ç»ˆapæŒ‡é’ˆä¼šæŒ‡å‘ä¸€ä¸ªæœªçŸ¥å†…å­˜åŒºåŸŸã€‚æ‰€ä»¥è¾“å‡ºçš„æ•°ä¸ä¸€å®šã€‚è§ä¸‹å›¾:</p><p><img src="18.png" width="50%" height="50%" alt=""></p><p>6.å…³äºå˜å‚çš„å®šä¹‰æ˜¯åœ¨<code>inc/stdarg.h</code>ä¸­,æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>va_arg</code>æ˜¯å¦‚ä½•ä¸€æ¬¡ä¸€æ¬¡å–å‡ºå˜å‚çš„:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#define va_arg(ap, type) __builtin_va_arg(ap, type) //Fall 2018</span><br><span class="line"></span><br><span class="line">#define va_arg(ap, type) \</span><br><span class="line">(*(type *)((ap) += __va_size(type), (ap) - __va_size(type)))  //Fall 2015</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°va_argæ˜¯é€šè¿‡åœ°å€å¾€åå¢é•¿æ¥å–å‡ºä¸‹ä¸€ä¸ªå˜å‚çš„ã€‚<strong>è€Œæ­£å¸¸ç¼–è¯‘å™¨æ˜¯ä»å³å¾€å·¦çš„é¡ºåºå°†å‚æ•°å…¥æ ˆçš„ï¼ˆå› ä¸ºæ ˆæ˜¯ä»é«˜åœ°å€å‘ä½åœ°å€å»¶ä¼¸çš„ï¼‰ã€‚</strong>å¦‚æœè¿™æ—¶å€™æ ˆçš„é¡ºåºå˜äº†ï¼Œé‚£åªéœ€è¦å°†va_argå‡½æ•°ä¸­çš„å¯¹åœ°å€çš„åŠ æ³•æ”¹ä¸ºå‡æ³•å°±è¡Œã€‚</p><h4 id="the-stack">The Stack</h4><h5 id="exercise-9">Exercise 9</h5><p>å…³äºæ ˆçš„å®šä¹‰åœ¨<code>kern/entry.S</code>ä¸­ã€‚è§ä¸‹å›¾:</p><p><img src="19.png" width="50%" height="50%" alt=""></p><p>å› ä¸ºæ ˆæ˜¯ä»é«˜åœ°å€å‘ä½åœ°å€å»¶ä¼¸çš„ï¼Œæ‰€ä»¥<code>mov $(bootstacktop) %esp</code>å°†æ ˆé¡¶åœ°å€èµ‹å€¼ç»™<code>%esp</code>å¯„å­˜å™¨ã€‚è€Œåœ¨æ•°æ®æ®µä¸­å¯¹æ ˆå¤§å°çš„å®šä¹‰ä¹Ÿå¾ˆæ¸…æ¥šäº†â€”â€”â€”â€”<code>KSTKSIZE</code>æ˜¯ä¸€ä¸ªå®å®šä¹‰ï¼Œå¤§å°ä¸º8x4KB=32KBã€‚</p><h5 id="exercise-10">Exercise 10</h5><p>éœ€è¦æ·±å…¥äº†è§£æ ˆè°ƒç”¨çš„æœºåˆ¶ï¼Œå°±éœ€è¦äº†è§£<strong>stack pointer</strong><code>%esp</code>å’Œ<strong>base pointer</strong><code>%ebp</code>è¿™ä¸¤ä¸ªå¯„å­˜å™¨çš„ç”¨æ³•ã€‚æˆ‘ä»¬é€šè¿‡è°ƒè¯•<code>test_backtrace()</code>å‡½æ•°æ¥æ·±å…¥äº†è§£ã€‚(å®é™…ä¸Šåªè¦æœ‰å‡½æ•°è°ƒç”¨å°±ä¼šæœ‰æ ˆï¼Œä½†å¾ˆæ˜æ˜¾test_backtraceä¸æ˜¯ç¬¬ä¸€ä¸ªè°ƒç”¨çš„å‡½æ•°ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä»ç¬¬ä¸€ä¸ªå‡½æ•°i386_initå¼€å§‹ï¼Œè¿™ä¸ªæ—¶å€™%espä¹Ÿåˆšåˆšå®Œæˆåˆå§‹åŒ–0xf0110000,æ„Ÿè§‰ä¼šæ›´çˆ½ä¸€äº›)ã€‚<br><code>test_backtrace</code>å‡½æ•°çš„è°ƒç”¨å‘ç”Ÿåœ¨<code>kern/init.c/i386_init()</code>ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬ç¬¬ä¸€ä¸ªæ–­ç‚¹è®¾ç½®åœ¨<code>0xf01000de</code>ã€‚ä»åæ±‡ç¼–ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¼€å§‹è°ƒç”¨<code>test_backtrace</code>ä¹‹å‰ï¼Œè¿˜æœ‰ä¸¤æ¡æŒ‡ä»¤:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">movl $0x5, (%esp)</span><br><span class="line">call f0100040 &lt;test_backtrace&gt;</span><br></pre></td></tr></table></figure><p>åœ¨è¿˜æ²¡æœ‰å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼ŒæŸ¥çœ‹ä¸€ä¸‹å¯„å­˜å™¨çš„çŠ¶æ€<code>info registers</code>:<code>%esp</code>çš„å€¼ä¸º<code>0xf010ffe0</code>ï¼Œ<code>%ebp</code>çš„å€¼ä¸º<code>0xf010fff8</code>ã€‚<br>ç„¶åå¼€å§‹æ‰§è¡Œç¬¬ä¸€å¥ï¼Œå°†å‚æ•°5<strong>movl</strong>åˆ°æ ˆé¡¶ï¼Œæ³¨æ„è¿™é‡Œä¸æ˜¯å‹æ ˆè€Œæ˜¯ç›´æ¥å­˜è¿›å»çš„ï¼Œæ‰€ä»¥æ ˆæŒ‡é’ˆ<code>%esp</code>æ˜¯ä¸ä¼šç§»åŠ¨çš„ã€‚ä½†æ˜¯è¿™æ—¶å€™æ ˆé¡¶å…ƒç´ åº”è¯¥æ˜¯0x5ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>info registers</code>å‘½ä»¤å’Œ<code>x/8x $esp</code>æ¥åˆ†åˆ«éªŒè¯ï¼Œæ•ˆæœå¦‚ä¸‹:</p><p><img src="20.png" width="50%" height="50%" alt=""></p><p>åœ¨çœ‹ä¸€ä¸‹ç¬¬äºŒæ¡æŒ‡ä»¤<code>call f0100040</code>ã€‚<code>call</code>æŒ‡ä»¤å¯ä»¥åˆ†æˆä¸¤æ¡æŒ‡ä»¤:<code>push %eip</code>å’Œ<code>jmp 0xf0100040</code>ã€‚æ‰€ä»¥çœ‹åˆ°<code>push</code>æŒ‡ä»¤æ˜¯æ­£å®—çš„å‹æ ˆæŒ‡ä»¤ï¼Œè¿™æ—¶å€™<code>%esp</code>å¯„å­˜å™¨çš„å€¼æ˜¯è¦-4çš„ï¼Œè€Œä¸”é€’å‡æ»¡å †æ ˆçš„é¡ºåºæ˜¯<strong>å…ˆ-4ï¼Œå†å‹æ ˆ</strong>ã€‚è¿™æ¬¡æ ˆé¡¶å…ƒç´ åº”è¯¥æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€<code>0xf01000ea</code>ï¼Œè€Œä¸”<code>%esp</code>çš„å€¼è¿˜å¾—-4ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>info registers</code>å’Œ<code>x/8x $esp</code>æ¥åˆ†åˆ«éªŒè¯:</p><p><img src="21.png" width="50%" height="50%" alt=""></p><p>ç¬¬ä¸‰æ¡æŒ‡ä»¤å°±æ­£å¼è¿›å…¥åˆ°<code>test_backtrace</code>å‡½æ•°å†…éƒ¨äº†ã€‚åˆ†æä¸€ä¸‹å‡½æ•°å†…éƒ¨çš„<strong>è°ƒç”¨ä»£ç </strong>:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">void test_backtrace(int x)</span><br><span class="line">&#123;</span><br><span class="line">f0100040:       55                      push   %ebp</span><br><span class="line">f0100041:       89 e5                   mov    %esp,%ebp</span><br><span class="line">f0100043:       53                      push   %ebx</span><br><span class="line">f0100044:       83 ec 14                sub    $0x14,%esp</span><br><span class="line">f0100047:       8b 5d 08                mov    0x8(%ebp),%ebx</span><br><span class="line">        cprintf(&quot;entering test_backtrace %d\n&quot;, x);</span><br><span class="line">f010004a:       89 5c 24 04             mov    %ebx,0x4(%esp)</span><br><span class="line">f010004e:       c7 04 24 20 1a 10 f0    movl   $0xf0101a20,(%esp)</span><br><span class="line">f0100055:       e8 c1 09 00 00          call   f0100a1b &lt;cprintf&gt;</span><br><span class="line">        if (x &gt; 0)</span><br><span class="line">f010005a:       85 db                   test   %ebx,%ebx    </span><br><span class="line">f010005c:       7e 0d                   jle    f010006b &lt;test_backtrace+0x2b&gt;</span><br><span class="line">                test_backtrace(x-1);</span><br><span class="line">f010005e:       8d 43 ff                lea    -0x1(%ebx),%eax</span><br><span class="line">f0100061:       89 04 24                mov    %eax,(%esp)</span><br><span class="line">f0100064:       e8 d7 ff ff ff          call   f0100040 &lt;test_backtrace&gt;</span><br><span class="line">f0100069:       eb 1c                   jmp    f0100087 &lt;test_backtrace+0x47&gt;</span><br><span class="line">        else</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸºæœ¬ä¸Šæ‰€æœ‰è¢«è°ƒç”¨çš„å‡½æ•°å¼€å¤´éƒ½ä¼šæœ‰è¿™ä¸¤æ¡æŒ‡ä»¤:<code>push %ebp</code>;<code>mov %esp, %ebp</code>;<br>å®éªŒæŒ‡å¯¼ä¹¦ä¸Šä¹Ÿè§£é‡Šäº†<code>%ebp</code>å¯„å­˜å™¨çš„ä½œç”¨:<strong>On entry to a C function, the function's prologue code normally saves the previous function's base pointer by pushing it onto the stack, and then copies the current esp value into ebp for the duration of the function.</strong>æ¯ä¸€ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ª<code>%ebp</code>å€¼ï¼Œä½œä¸ºå‡½æ•°çš„æ ˆå¸§ï¼Œéœ€è¦åœ¨æ¯æ¬¡è°ƒç”¨æ–°å‡½æ•°çš„æ—¶å€™å‹æ ˆä»¥ä¿å­˜ä¸Šä¸€ä¸ªå‡½æ•°çš„è¿”å›åœ°å€ã€‚<br>è¿™ä¸ªæ—¶å€™è«åå…¶å¦™çš„å‹æ ˆäº†ä¸€ä¸ªå¯„å­˜å™¨<code>%ebx</code>ã€‚æˆ‘ä»¬å°†<code>%ebx</code>å…¨å±€é«˜äº®æ˜¾ç¤ºå‘ç°ï¼Œåé¢ç´§æ¥ç€ä¼šæœ‰<code>mov 0x8(%ebp), %ebx</code>ã€‚é‚£<code>0x8(%ebp)</code>å­˜å‚¨çš„åˆ°åº•æ˜¯å•¥ï¼Ÿä¸éš¾æƒ³åˆ°å°±æ˜¯å‚æ•°5ã€‚ç„¶å<code>%esp</code>æŒ‡é’ˆæ¥ç€æ‰©å±•å½“å‰å‡½æ•°çš„æ ˆç©ºé—´ã€‚å…³æ³¨ä¸€ä¸‹ç¬¬äºŒæ¬¡è°ƒç”¨<code>test_backtrace()</code>ï¼Œå‰ä¸€æ¡æŒ‡ä»¤<code>mov %eax, (%esp)</code>å’Œç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™å®Œå…¨ä¸€æ ·ï¼Œè€Œ<code>%eax</code>ä¸­å­˜çš„ä¹Ÿæ˜¯å‚æ•°5-1=4;å½“ç„¶è°ƒç”¨æŒ‡ä»¤<code>call</code>ä¹Ÿéœ€è¦ä¸€æ¬¡å‹æ ˆã€‚æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯ä»<code>push %ebp</code>å¼€å§‹ç®—èµ·æ˜¯å‡½æ•°æ ˆçš„å¼€å¤´çš„è¯ï¼Œé‚£æˆ‘ä»¬æ¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ä¼šèŠ±è´¹<code>4ï¼ˆpush %ebpï¼‰+4(push %ebx)+20(sub $0x14,%esp)+4(call)</code>ä¸€å…±æ˜¯32Byteså­—èŠ‚çš„ç©ºé—´ã€‚æ‰€ä»¥æ•´ä¸ªæ ˆçš„å¸ƒå±€è§ä¸‹å›¾:</p><p><img src="23.png" width="50%" height="50%" alt=""></p><p>å½“ç„¶åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­è¿˜è°ƒç”¨äº†<code>cprintf()</code>è¿™ä¸ªå‡½æ•°ï¼Œä¸è¿‡20å­—èŠ‚ç”¨æ¥åˆ†é…æ ˆç©ºé—´ä¹Ÿå¤Ÿäº†ã€‚</p><h5 id="exercise-11">Exercise 11</h5><p>ç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œæ ˆçš„å¸ƒå±€å·²ç»å¾ˆæ¸…æ¥šäº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦çŸ¥é“å¯¹äº<code>read_ebp()</code>å‡½æ•°æ¥è¯´è¯»å‡ºçš„æ˜¯å½“å‰<code>%ebp</code>æŒ‡é’ˆæŒ‡å‘çš„åœ°å€ï¼Œæ‰€ä»¥æŒ‰ç…§ä¸Šé¢æ ˆçš„å¸ƒå±€:<code>(%ebp)--&gt;ä¸Šä¸€ä¸ª%ebp</code>,<code>0x4ï¼ˆ%ebpï¼‰--&gt;%eip</code>,<code>0x8(%ebp)--&gt;å‚æ•°1</code>...å½“ç„¶è¿™é‡Œçš„å‚æ•°æ¯”5ä¸ªå°‘ã€‚<br>ä¸‹é¢å°±æ˜¯è€ƒéªŒCè¯­è¨€çš„æ—¶åˆ»ï¼Œä¸€å®šè¦æ³¨æ„æ ¼å¼:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">int</span><br><span class="line">mon_backtrace(int argc, char **argv, struct Trapframe *tf)</span><br><span class="line">&#123;</span><br><span class="line">        // Your code here.</span><br><span class="line">        /*</span><br><span class="line">         parameter &quot;argc&quot; indicates numbers of paras passed by the command-line;  parameter &quot;argv&quot; indicates specific paras accordingly.</span><br><span class="line">        */</span><br><span class="line">        struct Eipdebuginfo info;</span><br><span class="line">        cprintf(&quot;Stack backtrace:\n&quot;);</span><br><span class="line">        uint32_t *ebp = (uint32_t*)read_ebp();</span><br><span class="line">        while(ebp) &#123;</span><br><span class="line">                uint32_t eip = ebp[1];</span><br><span class="line">                cprintf(&quot;  ebp %x  eip %x  args &quot;, ebp, eip);</span><br><span class="line">                cprintf(&quot;%08.x &quot;, *(ebp+2));//è¿™é‡Œæä¸€ä¸‹æŒ‡é’ˆçš„ç”¨æ³•ï¼ŒæŒ‡å¯¼ä¹¦ä¸­æœ‰è®²è§£</span><br><span class="line">                cprintf(&quot;%08.x &quot;, *(ebp+3));</span><br><span class="line">                cprintf(&quot;%08.x &quot;, *(ebp+4));</span><br><span class="line">                cprintf(&quot;%08.x &quot;, *(ebp+5));</span><br><span class="line">                cprintf(&quot;%08.x\n&quot;, *(ebp+6));</span><br><span class="line"></span><br><span class="line">                ebp = (uint32_t*)*(ebp);</span><br><span class="line">        &#125;</span><br><span class="line">        return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="exercise-12">Exercise 12</h5><p>å¯¹æ¯ä¸€ä¸ª<code>%eip</code>ï¼Œå°è¯•ç€ç»™å‡ºå…¶<strong>æ–‡ä»¶åç§°</strong>ï¼Œ<strong>å‡½æ•°åç§°</strong>å’Œ<strong>è¡Œå·</strong>ã€‚è¿™äº›ä¿¡æ¯éƒ½å±äºè°ƒçš„ä¿¡æ¯ã€‚å®éªŒè¦åšçš„æ˜¯æ‰¾åˆ°è¿™äº›è°ƒè¯•ä¿¡æ¯ï¼Œå¹¶æŒ‰ç…§è§„å®šæ ¼å¼å°†å®ƒä»¬è¾“å‡ºã€‚è¿™é‡Œéœ€è¦äº†è§£<a href="https://sourceware.org/gdb/onlinedocs/stabs.html#Stab-Sections" target="_blank" rel="noopener">STAB</a>ç¬¦å·è¡¨çš„æ¦‚å¿µã€‚<br>é¦–å…ˆæŸ¥çœ‹ä¸‹<code>kern/kernel.ld</code>é“¾æ¥è„šæœ¬ã€‚å‘ç°äº†æœ‰å…³<code>_STAB_*</code>çš„ä¸¤ä¸ªä¿¡æ¯â€”â€”â€”â€”<code>.stab</code>å’Œ<code>.stabstr</code>ã€‚å…¶ä¸­stabæ˜¯ä»Šå¤©çš„é‡ç‚¹ã€‚<code>kern/kdebug.c</code>ä¸­çš„å®å®šä¹‰è¯´æ˜äº†stabå’Œstabstrçš„å…³ç³»ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">extern const struct Stab __STAB_BEGIN__[];      // Beginning of stabs table</span><br><span class="line">extern const struct Stab __STAB_END__[];        // End of stabs table</span><br><span class="line">extern const char __STABSTR_BEGIN__[];          // Beginning of string table</span><br><span class="line">extern const char __STABSTR_END__[];            // End of string table</span><br></pre></td></tr></table></figure><p>å†çœ‹ä¸€ä¸‹<code>inc/stab.h</code>å¯¹stabå®šä¹‰çš„æ•°æ®ç»“æ„:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// Entries in the STABS table are formatted as follows.</span><br><span class="line">struct Stab &#123;</span><br><span class="line">        uint32_t n_strx;        // index into string table of name    è¯¥é¡¹å¯¹åº”çš„åœ¨stabstrèŠ‚å†…çš„ç´¢å¼•åç§»</span><br><span class="line">        uint8_t n_type;         // type of symbol   è¯¥é¡¹æè¿°çš„ç¬¦å·ç±»å‹   é‡ç‚¹å…³æ³¨</span><br><span class="line">        uint8_t n_other;        // misc info (usually empty)   </span><br><span class="line">        uint16_t n_desc;        // description field  æºæ–‡ä»¶çš„è¡Œå·  é‡ç‚¹å…³æ³¨</span><br><span class="line">        uintptr_t n_value;      // value of symbol   åœ°å€å€¼   é‡ç‚¹å…³æ³¨</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>objdump -G obj/kern/kernel</code>æ¥æŸ¥çœ‹å½“å‰ELFæ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨ä¿¡æ¯ã€‚è§ä¸‹å›¾:</p><p><img src="24.png" width="50%" height="50%" alt=""></p><p>ä»”ç»†è§‚å¯Ÿä¸Šå›¾ï¼Œå‘ç°æ¯ä¸€åˆ—çš„åˆ†ç±»å°±æ˜¯æŒ‰ç…§stabæ•°æ®ç»“æ„åˆ†ç±»çš„ã€‚é‡ç‚¹å…³æ³¨ä¸€ä¸‹<code>n_type</code>è¿™ä¸ªå…³é”®å­—ï¼Œå®ƒè¡¨ç¤ºè¯¥æè¿°é¡¹çš„ç¬¦å·ç±»å‹ï¼Œä¸Šå›¾ä¸­å‡ºç°æœ‰å¾ˆå¤š<code>SO</code>ï¼Œ<code>FUN</code>...ç­‰ç¬¦å·ç±»å‹ã€‚å°†è¿™äº›åˆ—å•ç‹¬åˆ—å‡ºæ¥è¿›è¡Œå¯¹æ¯”:</p><p><img src="25.png" width="50%" height="50%" alt=""></p><p>å¾ˆæ˜æ˜¾<code>SO</code>æŒ‡çš„æ˜¯æ–‡ä»¶åï¼Œ<code>FUN</code>æŒ‡çš„æ˜¯å‡½æ•°åã€‚<strong>æ³¨æ„è¿™æ˜¯objdumpå¯¹åº”çš„ç¬¦å·è¡¨ï¼ŒJOSå¯¹ç¬¦å·è¡¨æœ‰è‡ªå·±å®šä¹‰çš„æ•°æ®ç»“æ„è§<code>inc/stab.h</code></strong>ã€‚è¾“å‡ºçš„é¡ºåºéƒ½æ˜¯æŒ‰ç…§åœ°å€æ¥æ’åºçš„ï¼Œå¾ˆæ•´é½ã€‚æ‰€ä»¥<code>stab_binsearch()</code>æŸ¥æ‰¾å‡½æ•°åŸç†ä¹Ÿå°±çŒœçš„å·®ä¸å¤šäº†ï¼Œ<strong>è¿™äº›è°ƒè¯•ä¿¡æ¯å’Œç›¸åº”åœ°å€çš„å…³ç³»æ˜¯é€šè¿‡ç¬¦å·è¡¨æ¥è¿æ¥çš„ã€‚å½“ç„¶æ‰€æœ‰çš„è¿™äº›çŸ¥è¯†éƒ½å¯ä»¥é€šè¿‡<code>kern/kdebug.c</code>è¿™ä¸ªæ–‡ä»¶ä¸­å¯¹<code>stab</code>çš„æ³¨é‡Šï¼ˆè§è¿‡æœ€å…¨çš„æ³¨é‡Šäº†ï¼‰å­¦ä¹ åˆ°ã€‚æ‰€ä»¥æˆ‘ä»¬æœ€ååˆ†æä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶:</strong><br>æ•´ä¸ªæ–‡ä»¶ä¸€å…±æœ‰ä¸¤ä¸ªå‡½æ•°<code>debuginfo_eip</code>å’Œ<code>stab_binsearch</code>ã€‚JOSå»ºç«‹äº†ä¸€ä¸ªæ•°æ®ç»“æ„<code>Eipdebuginfo</code>ç”¨æ¥å­˜æ”¾è°ƒè¯•ä¿¡æ¯ï¼Œ<code>debuginfo_eip</code>è°ƒç”¨<code>stab_binsearch</code>å‡½æ•°å®Œæˆä¸€ä¸ªå®ä¾‹åŒ–çš„<code>Eipdebuginfo</code>ï¼Œæ‰€æœ‰çš„è¾“å‡ºä¿¡æ¯å…¶å®æœ€åéƒ½å­˜å‚¨åœ¨è¿™ä¸ªå®ä¾‹ä¸­ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">struct Eipdebuginfo &#123;</span><br><span class="line">        const char *eip_file;           // Source code filename for EIP</span><br><span class="line">        int eip_line;                   // Source code linenumber for EIP</span><br><span class="line"></span><br><span class="line">        const char *eip_fn_name;        // Name of function containing EIP</span><br><span class="line">                                        </span><br><span class="line">        int eip_fn_namelen;             // Length of function name</span><br><span class="line">        uintptr_t eip_fn_addr;          // Address of start of function</span><br><span class="line">        int eip_fn_narg;                // Number of function arguments</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>stab_binsearch(const struct Stab *stabs, int *region_left, int *region_right, int type, uintptr_t addr)</code>å‡½æ•°æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªäºŒåˆ†æŸ¥æ‰¾ã€‚<strong><code>type</code>æŒ‡çš„å°±æ˜¯ç¬¦å·è¡¨é¡¹çš„ç¬¦å·ç±»å‹ï¼Œè¯¥å‡½æ•°æ¯æ¬¡æŸ¥æ‰¾çš„æ—¶å€™éƒ½éœ€è¦ç¡®å®šæŸ¥æ‰¾çš„ç¬¦å·ç±»å‹</strong>ã€‚æˆ‘ä»¬éœ€è¦å®Œæˆçš„éƒ¨åˆ†æ˜¯è¡Œå·ï¼Œé€šè¿‡æ£€æŸ¥<code>inc/stab.h</code>æ–‡ä»¶ï¼Œå¾ˆå®¹æ˜“çŸ¥é“è¡Œå·çš„å®å®šä¹‰æ˜¯<code>S_LINE</code>ã€‚äºŒåˆ†æŸ¥æ‰¾å¤±è´¥çš„æ ‡å¿—å°±æ˜¯<code>LeftA &gt; rightA</code>ã€‚æ‰€ä»¥ä»£ç ä¹Ÿå¾ˆç®€å•äº†:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// Your code here.</span><br><span class="line">       stab_binsearch(stabs, &amp;lline, &amp;rline, N_SLINE, addr);   </span><br><span class="line">       if(lline &lt;= rline)&#123;</span><br><span class="line">               info-&gt;eip_line = stabs[lline].n_desc;  //ç¡®å®šè¡Œå·</span><br><span class="line">       &#125;else &#123;</span><br><span class="line">               return -1;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure><p>æœ€åå°†monitorçš„å‘½ä»¤è¡¥å……å®Œæ•´å°±æ›´ç®€å•äº†:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">add :</span><br><span class="line">debuginfo_eip(eip, &amp;info);</span><br><span class="line">                cprintf(&quot;\t%s:%d: %.*s+%d\n&quot;, info.eip_file, info.eip_line, info.eip_fn_namelen, info.eip_fn_name, info.eip_fn_addr);</span><br><span class="line">to kern/monitor.c/mon_backtrace()</span><br><span class="line"></span><br><span class="line">add :</span><br><span class="line">        &#123;&quot;backtrace&quot;, &quot;Display each stack frame called&quot;, mon_backtrace &#125;,</span><br><span class="line">to kern/monitor/commands[]</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœè§ä¸‹å›¾:</p><p><img src="26.png" width="50%" height="50%" alt=""></p><p>å®éªŒè¿‡ç¨‹ä¸­æœ‰å‡ å¤„ç»†èŠ‚æ¶‰åŠåˆ°ç¼–è¯‘å™¨çš„ä¼˜åŒ–ï¼Œå› ä¸ºè¿˜ä¸æ˜¯å¾ˆäº†è§£ç¼–è¯‘é“¾æ¥çš„ç»†èŠ‚å’ŒåŸç†ï¼Œæ‰€ä»¥è¢«æˆ‘å¿½ç•¥æ‰äº†ã€‚<br>è‡³æ­¤Lab1ç»“æŸã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;lab1&quot;&gt;Lab1&lt;/h2&gt;
&lt;h3 id=&quot;before-lab&quot;&gt;Before Lab&lt;/h3&gt;
&lt;p&gt;Lab1ä¸€å…±æœ‰ä¸‰éƒ¨åˆ†:&lt;code&gt;Bootstrap&lt;/code&gt;,&lt;code&gt;BootLoader&lt;/code&gt;,&lt;code&gt;Kernel&lt;/code&gt;;å‰ä¸¤éƒ¨åˆ†éƒ½æ˜¯GDBè°ƒè¯•ä¸ºä¸»ï¼Œç†Ÿæ‚‰GDBçš„è°ƒè¯•æŠ€å·§å’Œæ“ä½œç³»ç»Ÿçš„å¯åŠ¨æµç¨‹ã€‚æœ€åå®ç°ä¸€å°éƒ¨åˆ†&lt;code&gt;monitor&lt;/code&gt;ä¸­&lt;strong&gt;test_backtrace&lt;/strong&gt;çš„åŠŸèƒ½ã€‚&lt;br&gt;
å¦‚æœ&lt;code&gt;GDB&lt;/code&gt;è°ƒè¯•å‡ºé”™ï¼Œå¯èƒ½æ˜¯å› ä¸ºè°ƒè¯•å™¨æ²¡æœ‰é“¾æ¥åˆ°æ“ä½œç³»ç»Ÿä¸Šï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;add &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;add-auto-load-safe-path /Your Working Dir/.gdbinit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;line to your configuration file &amp;quot;/root/.gdbinit&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="C" scheme="http://haotianmcihael.github.io/categories/C/"/>
    
    
      <category term="MIT 6.828" scheme="http://haotianmcihael.github.io/tags/MIT-6-828/"/>
    
      <category term="OS" scheme="http://haotianmcihael.github.io/tags/OS/"/>
    
      <category term="Linux" scheme="http://haotianmcihael.github.io/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>Mit6.828(Fall 2018) Lab0</title>
    <link href="http://haotianmcihael.github.io/2018/11/05/Mit6-828-Fall-2018-Lab0/"/>
    <id>http://haotianmcihael.github.io/2018/11/05/Mit6-828-Fall-2018-Lab0/</id>
    <published>2018-11-04T16:35:45.000Z</published>
    <updated>2022-03-16T10:30:51.286Z</updated>
    
    <content type="html"><![CDATA[<h2 id="lab0">Lab0</h2><h3 id="abstract">Abstract</h3><p>ä»<code>8086æ±‡ç¼–</code>å®éªŒä¹‹åï¼Œå‰åä¸¤å‘¨çš„æ—¶é—´å‹‰å¼ºé€šè¿‡Lab1ã€‚<br>æœ€å¤§çš„æ„Ÿè§¦æ˜¯<strong>åŸºç¡€å¤ªå·®</strong>:å¯¹Cè¯­è¨€çš„ç†è§£ï¼Œå¯¹ç¨‹åºç¼–è¯‘é“¾æ¥æœ¬è´¨çš„ç†è§£ï¼Œå¯¹<code>GDB</code>ç­‰å·¥å…·çš„ä½¿ç”¨â€¦â€¦å½“ç„¶ä¹ŸåŒ…æ‹¬å¼±å¼±çš„è‹±è¯­ç†è§£èƒ½åŠ›ã€‚å¯¼è‡´å®ŒæˆLab1ç”¨äº†è¿™ä¹ˆä¹…çš„æ—¶é—´ã€‚ ä½†æ˜¯è¿™æ¬¡è§¦åŠ¨ä¸­å´åˆå¤šäº†ä¸€ä¸<code>è§å±±ä¸æ˜¯å±±ï¼Œè§å±±åˆæ˜¯å±±</code>çš„æ„Ÿè§‰ã€‚ä¸»è¦ä½“ç°åœ¨æˆ‘å¯¹æ“ä½œç³»ç»Ÿçš„ç†è§£æœ€ç»ˆéƒ½å›å½’åˆ°ä»£ç ä¸Šæ¥ã€‚æ¯”å¦‚<code>printf</code>å‡½æ•°çš„å®ç°å°±æ¶‰åŠCè¯­è¨€ä¸­å˜å‚çš„ç‰¹æ€§ã€‚æœ‰ç†ç”±ç›¸ä¿¡è¿™ç§<strong>è¡€æµ“äºæ°´</strong>çš„å…³ç³»åœ¨åç»­çš„Labä¸­è¿˜ä¼šè¿›ä¸€æ­¥åŠ å¼ºï¼Œæ‰€ä»¥æˆ‘ä¹Ÿå¸Œæœ›è¿™ä¼šæ˜¯æˆ‘å­¦ä¹ OSæœ€å®Œç¾çš„æ–¹æ³•è®ºâ€”â€”â€”â€”â€”â€”<strong>Talk is cheap, show me the code.</strong>ã€‚ æˆªæ­¢åˆ°Lab1ï¼Œæ•´ä¸ªå­¦ä¹ çš„è¿‡ç¨‹æ˜¾å¾—å¾ˆæ¸…æ™°â€”â€”â€”â€”å°±æ˜¯<strong>é€šè¿‡è°ƒè¯•<code>kernel</code>çš„åæ±‡ç¼–ä»£ç æ¥ç†è§£è¿è¡ŒåŸç†å¹¶åŠ ä»¥ä¿®æ”¹</strong>ã€‚Lab0æ˜¯æˆ‘åœ¨å®éªŒè¿‡ç¨‹ä¸­æ‰è¿›çš„å‘ï¼ŒæŸ¥é˜…çš„èµ„æ–™å’Œé€æ¸ç‚¹äº®çš„æŠ€èƒ½æ ‘ï¼Œç¼©çŸ­å®éªŒå‰çš„å‡†å¤‡æ—¶é—´å¯¹ç†è§£OSæœ¬èº«è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚ <a id="more"></a></p><h3 id="å®éªŒç¯å¢ƒçš„æ­å»º">6.828å®éªŒç¯å¢ƒçš„æ­å»º</h3><ul><li>è™šæ‹Ÿæœºç¯å¢ƒ: Ubuntu14.4 (<strong>32ä½</strong>)</li><li>ä»¿çœŸå™¨: Qemu <code>git clone https://github.com/mit-pdos/6.828-qemu.git qemu</code></li><li>å®éªŒä»£ç : Lab <code>git clone https://pdos.csail.mit.edu/6.828/2018/jos.git lab</code></li></ul><p>è™šæ‹Ÿæœºç¯å¢ƒ<code>32ä½</code>ï¼Œå› ä¸º<code>JOS</code>å°±æ˜¯32ä½çš„æ“ä½œç³»ç»Ÿã€‚<br>ä»¿çœŸå™¨ä½¿ç”¨MITè¿›è¡Œpatchedè¿‡çš„(è§ä¸Šé“¾æ¥)ã€‚åŸå› æ˜¯å®éªŒä¸­åˆ†é¡µæœºåˆ¶æ˜¯æœ‰æ„ä¿®æ”¹è¿‡çš„ï¼Œä½¿ç”¨<code>patched version</code>çš„è¯åœ¨åé¢<code>Exercise</code>ä¸­ä¸éœ€è¦æ‰‹åŠ¨è½¬æ¢åœ°å€ã€‚<br>å…³äºå®éªŒä»£ç ï¼Œé»˜è®¤ç†Ÿæ‚‰<code>Git</code>å’Œ<code>MakeFile</code>ã€‚æ¯åšå®Œä¸€ä¸ª<code>Exercise</code>å¯ä»¥ä½¿ç”¨<code>make grade</code>è¿›è¡Œæµ‹è¯•ã€‚<br>åœ¨æ•´ä¸ªå®éªŒç¯å¢ƒæ­å»ºçš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå› ä¸ºè™šæ‹Ÿæœºå‘å‹ç‰ˆæœ¬çš„ä¸åŒè€Œå‡ºç°ä¸åŒçš„é“¾æ¥åº“ä¸¢å¤±ï¼ŒGoogleä¸€ä¸‹ã€‚è¯¦ç»†çš„æ­å»ºè¿‡ç¨‹è§<a href="https://pdos.csail.mit.edu/6.828/2018/tools.html#" target="_blank" rel="noopener">Tools Guide</a></p><h3 id="å…³äº6.828">å…³äº6.828</h3><p>MITçš„OSè¯¾ç¨‹ã€‚å­¦ä¹ å…±æœ‰ä¸‰æ¡ä¸»çº¿:<code>Lectures</code>,<code>Readings</code>,<code>Labs</code>ã€‚<br>å½“ç„¶æœ€é‡è¦çš„å°±æ˜¯<code>Labs</code>ã€‚å…³äºå‰©ä½™çš„ä¸¤éƒ¨åˆ†ï¼Œä¸»è¦å›´ç»•ä¸€ä¸ªå«åš<code>xv6</code>çš„å°å‹OSå±•å¼€çš„ã€‚ç®€å•æ¥è®²ï¼Œè¿™æ˜¯ä¸€ä¸ª<strong>éº»é›€è™½å°äº”è„ä¿±å…¨</strong>çš„OSã€‚æœ‰<code>Documents</code>å’Œ<code>Source Code</code>ä¸¤ä»½èµ„æ–™ã€‚çŸ¥ä¹ä¸Šè¯„ä»·å¾ˆé«˜ï¼Œæœ‰äººå°†å…¶ç¿»è¯‘æˆä¸ºä¸­æ–‡ç‰ˆæœ¬ä¸Šä¼ è‡³Github.<a href="https://github.com/ranxian/xv6-chinese" target="_blank" rel="noopener">XV6_Ch</a>ï¼Œä¼ è¯´çœ‹æ‡‚æºç ä¹‹åå¯ä»¥è¶…ç¥â€¦â€¦<br>åš<code>Lab</code>çš„è¿‡ç¨‹ä¸­ï¼Œè¯¾ç¨‹ä¼šæä¾›å¤§é‡çš„Readingsæ¥é˜…è¯»ï¼Œå½“ç„¶éƒ½æ˜¯è‹±æ–‡çš„ã€‚è¯¦ç»†è§<a href="https://pdos.lcs.mit.edu/6.828/2018/reference.html" target="_blank" rel="noopener">Reference</a>ã€‚</p><h3 id="æ±‡ç¼–å’Œå†…è”æ±‡ç¼–">80386æ±‡ç¼–å’Œå†…è”æ±‡ç¼–</h3><h4 id="att-80386">AT&amp;T-80386</h4><p>åœ¨ä¹‹å‰çš„æ±‡ç¼–å®éªŒä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†16ä½çš„<code>Intel-8086</code>æ±‡ç¼–ã€‚è€Œåœ¨32ä½æœºå™¨ä¸Šéœ€è¦ä½¿ç”¨32ä½çš„<code>80386</code>æ±‡ç¼–è¯­è¨€ã€‚è™½ç„¶å¯¹äº<code>Linux</code>æ¥è¯´ï¼Œ<code>8086</code>å’Œ<code>80386</code>çš„æœºå™¨æ˜¯æœ‰å¾ˆå¤§çš„å·®åˆ«çš„ï¼Œä¸»è¦ä½“ç°åœ¨å®æ¨¡å¼å’Œä¿æŠ¤æ¨¡å¼ä¸Šã€‚ä½†æ˜¯å°±è¯­è¨€æœ¬èº«è€Œè¨€ï¼Œæ›´å¤šçš„æ˜¯é€’è¿›çš„å…³ç³»è€Œè¯­æ³•å·®åˆ«å¹¶ä¸å¤§ã€‚ç›®å‰è¿˜æ²¡æœ‰é‡åˆ°ä¿æŠ¤æ¨¡å¼ç›¸å…³çš„éšœç¢ã€‚<br><code>x86</code>çš„æ±‡ç¼–ä¸»è¦æœ‰ä¸¤ç§æ ¼å¼:<code>Intel</code>å’Œ<code>AT&amp;T</code>ã€‚<code>6.828</code>ä½¿ç”¨çš„æ˜¯<code>AT&amp;T</code>,è€Œå®é™…ä¸ŠLinuxä¸­çš„æ±‡ç¼–ä¹Ÿæ˜¯åè€…å±…å¤šã€‚<strong>æ±‡ç¼–è¯­è¨€æœ¬èº«ä¸»è¦æœ‰æŒ‡ä»¤é›†<code>Instruction Set</code>å’Œä¼ªæŒ‡ä»¤<code>Directives</code>ä¸¤å¤§éƒ¨åˆ†å†…å®¹</strong>ã€‚å½“ç„¶æœ€å…¨çš„æ–‡çŒ®æ˜¯Intelè‡ªå®¶çš„Documentsï¼Œä¸è¿‡æˆ‘è§‰å¾—æœ‰äº›å¤ªæ‚å’Œå¤šäº†ã€‚ä¸‹é¢çš„çš„èµ„æ–™åœ¨å®éªŒè¿‡ç¨‹ä¸­å¸®äº†æˆ‘å¾ˆå¤šã€‚å€¼å¾—ç»†çœ‹ã€‚</p><ul><li>MIT----<a href="https://pdos.lcs.mit.edu/6.828/2018/readings/pcasm-book.pdf" target="_blank" rel="noopener">pcasm-book</a>ã€‚</li><li>Wikipedia----<a href="https://en.wikipedia.org/wiki/X86_instruction_listings#Added_with_80386" target="_blank" rel="noopener">x86 Instruction Set</a></li><li>Oracle----<a href="https://docs.oracle.com/cd/E26502_01/html/E28388/eoiyg.html" target="_blank" rel="noopener">x86 Assembler Directives</a></li></ul><h4 id="å†…è”æ±‡ç¼–">å†…è”æ±‡ç¼–</h4><p>å› ä¸ºæ“ä½œç³»ç»Ÿæœ¬èº«å°±æ˜¯å’Œç¡¬ä»¶æ‰“äº¤é“æœ€é¢‘ç¹çš„ç³»ç»Ÿè½¯ä»¶ï¼Œæœ‰äº›åœ°æ–¹éœ€è¦ä½¿ç”¨åˆ°æ±‡ç¼–æ¥ç®€å•ç²—æš´çš„å®Œæˆå·¥ä½œã€‚<strong>å†…è”æ±‡ç¼–</strong>å°±æ˜¯åµŒå…¥åœ¨Cè¯­è¨€ä¸­çš„æ±‡ç¼–è¯­è¨€ï¼Œæ ¼å¼å’ŒåŸæ¥çš„æœ‰å¾ˆå¤§çš„ä¸åŒã€‚ä¸è¿‡IBMçš„é‚£ä»½èµ„æ–™å¯ä»¥è§£å†³ä¸€å¤§åŠé—®é¢˜ï¼Œä¹Ÿæ˜¯éš¾å¾—çš„ä¸­æ–‡æ–‡æ¡£â€¦â€¦</p><ul><li>MIT----<a href="http://www.delorie.com/djgpp/doc/brennan/brennan_att_inline_djgpp.html" target="_blank" rel="noopener">Brennan's Guide to Inline Assembly</a></li><li>IBM----<a href="https://www.ibm.com/developerworks/cn/linux/l-assembly/index.html" target="_blank" rel="noopener">æ±‡ç¼–è¯­è¨€å¼€å‘æŒ‡å—</a></li></ul><h3 id="elfæ–‡ä»¶">ELFæ–‡ä»¶</h3><p>å®åDissç½‘ä¸Šå„ç§å¯¹ELFçš„è®²è§£ï¼Œæ•…æ„å¼„æ··<code>section</code>å’Œ<code>segment</code>çš„æ¦‚å¿µã€‚åŠ ä¸Šå¯¹äºŒè¿›åˆ¶å·¥å…·ä½¿ç”¨çš„ä¸ç†Ÿç»ƒï¼Œè®©æˆ‘ä¸€åº¦ä»¥ä¸ºé“¾æ¥çš„éš¾åº¦ç³»æ•°æ˜¯æ•´ä¸ªå®éªŒè¿‡ç¨‹ä¸­æœ€é«˜çš„â€¦â€¦ç›´åˆ°æˆ‘çœ‹åˆ°<code>CSAPP</code>ä¸­å…³äºé“¾æ¥éƒ¨åˆ†çš„è®²è§£ã€‚</p><h4 id="ç¼–è¯‘é©±åŠ¨ç¨‹åº">ç¼–è¯‘é©±åŠ¨ç¨‹åº</h4><p><code>Compiler driver</code>æŒ‡çš„æ˜¯ä»Cæ–‡ä»¶å˜æˆäºŒè¿›åˆ¶æ–‡ä»¶çš„æœºå™¨æ“ä½œè¿‡ç¨‹ã€‚æˆ‘ä»¬ä»ä¸¤ä¸ªè§’åº¦ç†è§£è¿™ä¸ªè¿‡ç¨‹:<strong>æœºå™¨è¿è¡Œçš„è§’åº¦å’ŒCæ–‡ä»¶ç±»å‹å˜åŒ–çš„è§’åº¦</strong>ã€‚ç¼–è¯‘å™¨å’Œæ±‡ç¼–å™¨å°†å¤šä¸ª<code>C</code>æ–‡ä»¶ç¼–è¯‘æˆç›¸åº”çš„å¤šä¸ª<strong>å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶</strong>ï¼Œä¹Ÿå°±æ˜¯å¹³æ—¶çš„<code>.o</code>æ–‡ä»¶ï¼Œè¿™ç§æ–‡ä»¶ç”±ä¸åŒçš„ä»£ç èŠ‚å’Œæ•°æ®èŠ‚æ„æˆï¼Œ<strong>èŠ‚</strong>åœ¨åŸæ–‡ä¸­æ˜¯<code>section</code>ã€‚è€Œé“¾æ¥å™¨å°†å¤šä¸ª<code>.o</code>æ–‡ä»¶é“¾æ¥æˆä¸ºä¸€ä¸ª<strong>å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶</strong>ä¹Ÿå°±æ˜¯å¹³æ—¶çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è§ä¸‹å›¾:</p><p><img src="3.png" width="50%" height="50%" alt=""></p><p>ç†Ÿæ‚‰ä¸€ä¸ªç¨‹åºçš„ç¬¬ä¸€æ­¥æ˜¯å…³æ³¨å…¶è¾“å…¥è¾“å‡ºã€‚ä¸€å¥è¯æ€»ç»“é“¾æ¥å™¨çš„åŠŸèƒ½:<strong>ä»¥ä¸€ç»„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶å’Œå‘½ä»¤è¡Œå‚æ•°ä½œä¸ºè¾“å…¥ï¼Œç”Ÿæˆä¸€ä¸ªå®Œå…¨é“¾æ¥çš„å¯ä»¥åŠ è½½å’Œè¿è¡Œçš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä½œä¸ºè¾“å‡ºã€‚</strong> ç«™åœ¨æœºå™¨çš„è§’åº¦ï¼Œç¼–è¯‘å™¨å’Œæ±‡ç¼–å™¨å°†ASCIIæ ¼å¼çš„Cæ–‡ä»¶ç¼–è¯‘æˆä¸ºå­—èŠ‚å—<strong>section</strong>çš„é›†åˆï¼Œè€Œé“¾æ¥å™¨åšçš„å°±æ˜¯å°†<strong>ä¸åŒ</strong>å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ä¸­çš„å„ç§<code>sections</code>åšå½’ç±»ï¼Œ<strong>ç¡®å®šè¢«é“¾æ¥å—çš„è¿è¡Œæ—¶çš„å†…å­˜ä½ç½®</strong>ã€‚è¿™æ˜¯é‡ç‚¹ï¼Œç›®æ ‡æ–‡ä»¶çº¯ç²¹æ˜¯å­—èŠ‚å—çš„é›†åˆï¼Œè€Œé“¾æ¥å™¨æœ¬èº«å¯¹ç¨‹åºä¹Ÿæ‰€çŸ¥ç”šå°‘ï¼Œå¥¹åšçš„ä»…ä»…æ˜¯å¯¹<strong>å­—èŠ‚æ–‡ä»¶</strong>åšå¤„ç†ï¼Œå°†å¤šä¸ªæ–‡ä»¶çš„å­—èŠ‚å—æ”¾åˆ°äº†ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p><h4 id="é“¾æ¥è¿‡ç¨‹">é“¾æ¥è¿‡ç¨‹</h4><p>é“¾æ¥å™¨åšä¸¤ä»¶äº‹:</p><ul><li>ç¬¦å·è§£æ: è¾“å…¥æ–‡ä»¶çš„ç¬¦å·å¼•ç”¨éƒ½å¯¹åº”åˆ°å…¶å®šä¹‰ä¸Šã€‚</li><li>é‡å®šä½: ç¼–è¯‘å™¨å’Œæ±‡ç¼–å™¨ç”Ÿæˆçš„æ–‡ä»¶åœ°å€éƒ½æ˜¯ä»0å¼€å§‹çš„ï¼Œå¹¶æ²¡æœ‰å’Œå†…å­˜æŒ‚ä¸Šå…³ç³»ã€‚è€Œé“¾æ¥å™¨å°†è¿™äº›ä¸åŒçš„<code>section</code>å®šä½åˆ°å†…å­˜ä¸­çš„ä¸€ä¸ªåœ°å€ã€‚ä¹Ÿå°±æ˜¯å…¶åŠ è½½åœ°å€ã€‚</li></ul><p>é‡ç‚¹å…³æ³¨ç¬¬äºŒæ­¥é‡å®šä½ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å°†å¤šä¸ªå¯é‡å®šä½æ–‡ä»¶ä¸­åŒç±»å‹çš„<code>.section</code>åˆå¹¶ä¸ºä¸€ä¸ªå¤§çš„èšåˆèŠ‚ã€‚ä½†æ˜¯æ³¨æ„è¿™æ—¶å€™è¿˜æ²¡æœ‰<code>segment</code>çš„æ¦‚å¿µ,èšåˆèŠ‚è¿˜æ˜¯å«åš<code>.section</code>ã€‚æˆ‘æŸ¥é˜…äº†<code>CSAPP</code>çš„è‹±æ–‡ç‰ˆï¼Œå…¨ä¹¦ç¬¬ä¸€æ¬¡æåˆ°<code>segment</code> æ˜¯åœ¨é“¾æ¥å™¨éƒ¨åˆ†çš„æœ€æœ«å°¾ï¼Œä¹Ÿå°±æ˜¯è®²é‡å®šä½çš„æ—¶å€™ã€‚ä¸‹é¢æ˜¯åŸæ–‡:</p><p><img src="4.png" width="50%" height="50%" alt=""></p><p>æ˜æ˜¾çœ‹åˆ°<code>segment</code>è¿˜æ˜¯å†…å­˜çš„æ¦‚å¿µè€Œéå¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„éƒ¨åˆ†ã€‚æ‰€ä»¥ä»å¤´åˆ°å°¾é“¾æ¥è¿‡ç¨‹éƒ½æ²¡æœ‰ç”Ÿæˆè¿‡<code>segment</code>è¿™æ ·ä¸€ç§ä¸œè¥¿ï¼Œå…¶åªæ˜¯å¤šä¸ª<code>sections</code>å¯¹åº”äºå†…å­˜ä¸­çš„<strong>æ˜ å°„</strong>ã€‚å…¨ä¹¦å¯¹é“¾æ¥éƒ¨åˆ†çš„è®²è§£ä¹Ÿå¾ˆå°‘æåŠ<code>segment</code>ï¼Œ<strong>æ‰€ä»¥æˆ‘ä»¬å¯¹é“¾æ¥çš„ç†è§£æœ€å°å•ä½åº”è¯¥æ˜¯<code>section</code>ï¼Œé“¾æ¥è¿‡ç¨‹å°±æ˜¯å¯¹<code>section</code>è¿›è¡Œæ“ä½œ;è€Œæœ€åé‡å®šä½çš„æ—¶å€™å°†å¤šä¸ªå¤§çš„<code>section</code>æ˜ å°„åˆ°ä¸€æ®µå†…å­˜ä¸­ï¼Œæ˜ å°„çš„å•ä½æ‰æ˜¯<code>segment</code></strong>ã€‚ç°åœ¨çœ‹ä¸‹å›¾å°±å¾ˆæ¸…æ¥šäº†:</p><p><img src="5.png" width="50%" height="50%" alt=""></p><p>ä»æ–‡ä»¶ç±»å‹çš„è§’åº¦æ¥çœ‹: ç›®å‰æˆ‘ä»¬è°ˆåˆ°çš„ELFæ–‡ä»¶æœ‰å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶å’Œå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶å·¥å…·ELFæ–‡ä»¶è¿›è¡Œåˆ†æã€‚å…³äºé“¾æ¥æ›´æœ¬è´¨çš„è¿‡ç¨‹è¿˜æ˜¯å¾ˆå¤æ‚çš„ï¼ŒLab1åé¢ä¼šæœ‰ä¸€éƒ¨åˆ†å’Œ<strong>ç¬¦å·è¡¨</strong>ç›¸å…³çš„å®éªŒï¼Œå»ºè®®å…ˆè¯¦ç»†çœ‹çœ‹<code>CSAPP</code>å’Œä¸‹é¢æä¾›çš„èµ„æ–™ã€‚</p><ul><li>MIT----<a href="https://pdos.csail.mit.edu/6.828/2018/readings/elf.pdf" target="_blank" rel="noopener">The definitive standard for the ELF format</a></li><li>Wikipedia----<a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format" target="_blank" rel="noopener">Executable and Linkable Format</a></li><li>ELFä¸­æ–‡æ–‡æ¡£----<a href="https://paper.seebug.org/papers/Archive/refs/elf/Understanding_ELF.pdf" target="_blank" rel="noopener">ELF.Ch</a> ### äºŒè¿›åˆ¶åˆ†æå·¥å…· 6.828ä¸­ä¸»è¦ä½¿ç”¨<code>objdump</code>ï¼ŒåŸºæœ¬å·¥å…·å¯ä»¥é€šè¿‡<code>man</code>æ¥æŸ¥çœ‹ç”¨æ³•ï¼Œè¿™é‡Œåˆ—å‡ºå‡ ä¸ªæœ€å¸¸è§çš„å‚æ•°ã€‚</li></ul><h4 id="objdump">Objdump</h4><p>å¯¹ç›®æ ‡æ–‡ä»¶è¿›è¡Œåˆ†æï¼Œåœ¨Linuxå¹³å°ä¸Šæœ‰ä¸‰ç§<code>object file</code>:<code>Relocatable object File</code>,<code>Executable object File</code>,<code>Shared object File</code>ï¼Œä¸€ç›´æ²¡ææ‡‚ä¸ºå•¥éƒ½å«<code>object File</code>ã€‚ä¸è¿‡å› ä¸ºè¿™ä¸‰ç§ç›®æ ‡æ–‡ä»¶å¯¹åº”äºé“¾æ¥çš„ä¸åŒé˜¶æ®µï¼Œæ‰€ä»¥å¯¹äºé“¾æ¥è¿‡ç¨‹æœ¬è´¨çš„ç†è§£ç›´æ¥å½±å“è¿™é‡Œä½¿ç”¨è¿™ä¸ªäºŒè¿›åˆ¶åˆ†æå·¥å…·ã€‚</p><ul><li><code>-f</code> Display file headers</li><li><code>-d</code> Disassembly</li><li><code>-h</code> Section headers</li><li><code>-x</code> All headers</li><li><code>-S</code> Display source code</li></ul><h4 id="nm">Nm</h4><p>åˆ—å‡ºç›®æ ‡æ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨å†…å®¹ï¼Œåº”è¯¥å’Œé‡å®šä½å…³ç³»å¯†åˆ‡ã€‚</p><h3 id="é˜…è¯»æºç cliå·¥å…·">é˜…è¯»æºç CLIå·¥å…·</h3><p>è™½ç„¶æˆ‘æ˜¯<a href="https://www.gnu.org/software/emacs/" target="_blank" rel="noopener">Emacs</a>å…šï¼Œä½†æ˜¯ä¸å¾—ä¸æ‰¿è®¤VIMåœ¨è¿›è¡Œæ–‡æœ¬æ“ä½œçš„æ—¶å€™è¿˜æ˜¯æ›´<strong>æ–¹ä¾¿:)</strong>ä¸€äº›ã€‚</p><h4 id="vim-ctags">VIM-Ctags</h4><p>è¿™ä¸ªå°±å¾ˆå¼ºå¤§äº†ï¼Œç”¨äºåœ¨<code>tags</code>æ–‡ä»¶æ‰€åœ¨çš„æ ¹ç›®å½•ä¸‹å¯»æ‰¾å‡½æ•°å£°æ˜å’Œå®å®šä¹‰ï¼Œåœ¨é˜…è¯»æºç çš„æ—¶å€™åŸºæœ¬ä¸Šä¸çŸ¥é“çš„å®šä¹‰å’Œå…³é”®å­—éƒ½å¯ä»¥ä½¿ç”¨<code>Ctags</code>æ¥è¿›è¡Œå®šä½ï¼Œéå¸¸å®ç”¨ã€‚<br>å®‰è£…æˆåŠŸä¹‹åï¼Œåœ¨å·¥ç¨‹ç›®å½•ä¸‹é¢æ‰§è¡Œå‘½ä»¤<code>ctags -R *</code>å¯¹å½“å‰ç›®å½•é€’å½’å»ºç«‹ç´¢å¼•ï¼Œä¼šç”Ÿæˆ<code>tags</code>æ–‡ä»¶ã€‚åœ¨æºç ä¸­é‡åˆ°æœªè§è¿‡çš„å‡½æ•°ä¾¿å°†å…‰æ ‡æ”¾åœ¨å…¶ä¸Š<code>Ctrl - }</code>å³å¯è·³è½¬åˆ°å…¶å£°æ˜çš„ä½ç½®ã€‚<code>Ctrl - o</code>è‡ªåŠ¨è¿”å›ã€‚</p><h4 id="vim_taglist">VIM_TagList</h4><p>è¿™ä¸ªå®é™…ä¸Šæ²¡æ€ä¹ˆç”¨ï¼ŒåŠŸèƒ½æ˜¯åœ¨VIMä¸­æ‰“å¼€ç›®å½•æ ‘ï¼Œä¾¿äºç¨‹åºå‘˜æ“ä½œã€‚å¯ä»¥å…ˆç•™ä¸‹æ¥ï¼Œè¿›ä¸€æ­¥è§‚å¯Ÿã€‚</p><h4 id="tmux">Tmux</h4><p>è¿™åˆæ˜¯ä¸€ä¸ªç¥å™¨ï¼Œç»ˆç«¯åˆ†å±åŠŸèƒ½å¼ºå¤§ï¼Œæœ‰<code>window</code>,<code>pannel</code>ç­‰æ¦‚å¿µã€‚å’Œ<code>on-my-zsh</code>é…åˆä½¿ç”¨ç®€ç›´äº†ã€‚ä¸æ„¿æ„æŠ˜è…¾çš„è¯ä¹Ÿå¯ä»¥åœ¨<code>bash</code>ä¸‹ç›´æ¥ä½¿ç”¨ã€‚æˆ‘ä»¬åœ¨<code>GDB</code>è°ƒè¯•OSçš„æ—¶å€™ä½¿ç”¨å¥¹ä½œä¸ºåˆ†å±å·¥å…·ï¼Œéœ€è¦åœ¨å®¶ç›®å½•ä¸‹åŠ å…¥é…ç½®æ–‡ä»¶<code>~/.tmux.conf</code>ã€‚<br><img src="1.png" width="50%" height="50%" alt=""></p><h4 id="vimgrep">VimGrep</h4><p>ç”¨äºåœ¨æŒ‡å®šç›®å½•ä¸‹è¿›è¡Œå…¨å±€æœç´¢å¹¶åœ¨å¦ä¸€ä¸ªçª—å£æ‰“å¼€;å…³é”®å­—<code>sample</code>;åœ¨vimå‘½ä»¤æ¨¡å¼ä¸‹æ‰§è¡Œå‘½ä»¤ï¼›</p><ul><li>:<code>vim/sample/% | copen</code> å½“å‰æ–‡ä»¶æœç´¢</li><li><p>:<code>vim/sample/* | copen</code> å½“å‰ç›®å½•æœç´¢</p></li><li>:<code>vim/sample/ ../** | copen</code> ä»ä¸Šä¸€çº§ç›®å½•å¼€å§‹é€’å½’æœç´¢</li><li>:<code>vim/sample path1/**  path2/** | copen</code> å¤šè·¯å¾„æœç´¢</li><li><p>: <code>cclose</code> å…³é—­å½“å‰æœç´¢<br><img src="2.png" width="50%" height="50%" alt=""></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;lab0&quot;&gt;Lab0&lt;/h2&gt;
&lt;h3 id=&quot;abstract&quot;&gt;Abstract&lt;/h3&gt;
&lt;p&gt;ä»&lt;code&gt;8086æ±‡ç¼–&lt;/code&gt;å®éªŒä¹‹åï¼Œå‰åä¸¤å‘¨çš„æ—¶é—´å‹‰å¼ºé€šè¿‡Lab1ã€‚&lt;br&gt;
æœ€å¤§çš„æ„Ÿè§¦æ˜¯&lt;strong&gt;åŸºç¡€å¤ªå·®&lt;/strong&gt;:å¯¹Cè¯­è¨€çš„ç†è§£ï¼Œå¯¹ç¨‹åºç¼–è¯‘é“¾æ¥æœ¬è´¨çš„ç†è§£ï¼Œå¯¹&lt;code&gt;GDB&lt;/code&gt;ç­‰å·¥å…·çš„ä½¿ç”¨â€¦â€¦å½“ç„¶ä¹ŸåŒ…æ‹¬å¼±å¼±çš„è‹±è¯­ç†è§£èƒ½åŠ›ã€‚å¯¼è‡´å®ŒæˆLab1ç”¨äº†è¿™ä¹ˆä¹…çš„æ—¶é—´ã€‚ ä½†æ˜¯è¿™æ¬¡è§¦åŠ¨ä¸­å´åˆå¤šäº†ä¸€ä¸&lt;code&gt;è§å±±ä¸æ˜¯å±±ï¼Œè§å±±åˆæ˜¯å±±&lt;/code&gt;çš„æ„Ÿè§‰ã€‚ä¸»è¦ä½“ç°åœ¨æˆ‘å¯¹æ“ä½œç³»ç»Ÿçš„ç†è§£æœ€ç»ˆéƒ½å›å½’åˆ°ä»£ç ä¸Šæ¥ã€‚æ¯”å¦‚&lt;code&gt;printf&lt;/code&gt;å‡½æ•°çš„å®ç°å°±æ¶‰åŠCè¯­è¨€ä¸­å˜å‚çš„ç‰¹æ€§ã€‚æœ‰ç†ç”±ç›¸ä¿¡è¿™ç§&lt;strong&gt;è¡€æµ“äºæ°´&lt;/strong&gt;çš„å…³ç³»åœ¨åç»­çš„Labä¸­è¿˜ä¼šè¿›ä¸€æ­¥åŠ å¼ºï¼Œæ‰€ä»¥æˆ‘ä¹Ÿå¸Œæœ›è¿™ä¼šæ˜¯æˆ‘å­¦ä¹ OSæœ€å®Œç¾çš„æ–¹æ³•è®ºâ€”â€”â€”â€”â€”â€”&lt;strong&gt;Talk is cheap, show me the code.&lt;/strong&gt;ã€‚ æˆªæ­¢åˆ°Lab1ï¼Œæ•´ä¸ªå­¦ä¹ çš„è¿‡ç¨‹æ˜¾å¾—å¾ˆæ¸…æ™°â€”â€”â€”â€”å°±æ˜¯&lt;strong&gt;é€šè¿‡è°ƒè¯•&lt;code&gt;kernel&lt;/code&gt;çš„åæ±‡ç¼–ä»£ç æ¥ç†è§£è¿è¡ŒåŸç†å¹¶åŠ ä»¥ä¿®æ”¹&lt;/strong&gt;ã€‚Lab0æ˜¯æˆ‘åœ¨å®éªŒè¿‡ç¨‹ä¸­æ‰è¿›çš„å‘ï¼ŒæŸ¥é˜…çš„èµ„æ–™å’Œé€æ¸ç‚¹äº®çš„æŠ€èƒ½æ ‘ï¼Œç¼©çŸ­å®éªŒå‰çš„å‡†å¤‡æ—¶é—´å¯¹ç†è§£OSæœ¬èº«è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚
    
    </summary>
    
      <category term="C" scheme="http://haotianmcihael.github.io/categories/C/"/>
    
    
      <category term="MIT 6.828" scheme="http://haotianmcihael.github.io/tags/MIT-6-828/"/>
    
      <category term="OS" scheme="http://haotianmcihael.github.io/tags/OS/"/>
    
      <category term="Linux" scheme="http://haotianmcihael.github.io/tags/Linux/"/>
    
  </entry>
  
</feed>
