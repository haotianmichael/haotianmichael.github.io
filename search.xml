<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[MIT6.824(Spring 2021)-MapReduce]]></title>
    <url>%2F2022%2F01%2F03%2FMIT6-824-Spring-2021-MapReduce%2F</url>
    <content type="text"><![CDATA[Abstract æœ€è¿‘ç»ˆäºŽæœ‰æ—¶é—´ç ”ç©¶ä¸€ä¸‹MITçš„ç¥žè¯¾6.824ã€‚ è¿™é—¨è¯¾æ•™Distributed Systemï¼Œå³å¤šå°ç‰©ç†éš”ç¦»çš„è®¡ç®—æœºé€šè¿‡ç½‘ç»œæ¥åè°ƒï¼Œå…±åŒå®Œæˆä¸€è‡´æ€§ä»»åŠ¡ï¼Œå¯ä»¥æ˜¯è®¡ç®—ä»»åŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å­˜å‚¨ä»»åŠ¡ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿå’Œå•æœºç›¸æ¯”ï¼Œé™¤äº†æœ‰å¾ˆå¤šé«˜å¹¶å‘çš„Partial Failuresï¼Œæ›´å¤šçš„æ˜¯ç¡¬ä»¶è€åŒ–ï¼Œæ–­ç”µï¼Œç½‘å¡å¤±çµç­‰è¿™ç§çŽ°å®žé—®é¢˜ã€‚å› æ­¤è®¾è®¡ä½Žæˆæœ¬é«˜æ€§èƒ½ç³»ç»Ÿä»¥åŠå¤„ç†å¹¶å‘å’Œç½‘ç»œé—®é¢˜â€”â€”Performanceæ€§èƒ½å’ŒFault Toleranceå®¹é”™æ˜¯è¿™é—¨è¯¾çš„æ ¸å¿ƒã€‚ è¯¾ç¨‹å…±æœ‰20ä¸ªLectureså’Œ4ä¸ªlabsã€‚å’Œ6.828ä¸€æ ·é‡è§†å®žè·µâ€”â€”çœ‹è®ºæ–‡ï¼ŒæŸ¥èµ„æ–™ï¼Œåšlab~ç®€å•ç²—æš´ã€‚æ‰€ä»¥å­¦ä¹ è¿‡ç¨‹åŸºæœ¬ä¸Šå°±æŒ‰ç…§å¦‚ä¸‹æŽ¨è¿›ï¼š æå‰çœ‹Lectureè¦æ±‚çš„papers å¬å¯¹åº”çš„Lectures æŸ¥æ‰¾labç›¸å…³çš„å­¦ä¹ èµ„æ–™ åšlab ä¹‹å‰åš6.828çš„æ—¶å€™å°±å‘çŽ°æˆ‘åœ¨åšè¿™ç§å­¦ä¹ è¿‡ç¨‹å¾ˆé•¿ï¼Œæ€è€ƒå†…å®¹åˆå¾ˆæ·±çš„è¯¾ç¨‹è®­ç»ƒæ—¶å¾ˆå®¹æ˜“é’»ç‰›è§’å°–è€Œè®©è‡ªå·±ä¹±äº†èŠ‚å¥ï¼Œæ€ç»´å¦‚è‹¥ä¸èƒ½æ”¾æ¾ä¸‹æ¥æ•ˆæžœè‚¯å®šä¸ä¼šå¤ªå¥½â€”â€”å¸Œæœ›è¿™æ¬¡èƒ½å°½é‡è°ƒæ•´è¿‡æ¥ã€‚ Paper è®ºæ–‡MapReduce:Simplified Data Processing on Large Clustersæ˜¯å…³äºŽGoogleå·²ç»æ·˜æ±°æŽ‰çš„å¤§è§„æ¨¡æ•°æ®é›†å¤„ç†ç¼–ç¨‹æž¶æž„MapReduceã€‚å½“æ—¶çš„Googleé¢ä¸´åœ¨å¤šå°æœºå™¨ä¸Šçš„å¤§è§„æ¨¡æ•°æ®é›†å¤„ç†æ¯”å¦‚è®¡ç®—PageRankæˆ–è€…å¯¹æ‰€æœ‰æ–‡ä»¶è¿›è¡Œgrepç­‰ã€‚ è€Œç»Ÿä¸€åŒ–ç¼–ç¨‹æ¨¡åž‹å¯ä»¥å¾ˆå¥½çš„æŠ½è±¡æŽ‰å› ä¸ºå¤§è§„æ¨¡é›†ç¾¤å¯¼è‡´çš„å¹¶è¡Œï¼Œç½‘ç»œï¼Œå®¹é”™ç­‰é—®é¢˜â€”â€”å°†è¿™äº›ç»†èŠ‚éšè—èµ·æ¥ï¼Œåªç•™ä¸€ä¸ªä¾›ç¨‹åºå‘˜ä½¿ç”¨çš„ç¼–ç¨‹æŽ¥å£å¯ä»¥å¤§å¤§æé«˜å¼€å‘æ•ˆçŽ‡ã€‚è€Œå·¥ä¸šçº§MapReduceçš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªåˆ©ç”¨æ™®é€šæœºå™¨ç»„æˆçš„å¤§è§„æ¨¡è®¡ç®—é›†ç¾¤è¿›è¡Œå¹¶è¡Œï¼Œé«˜å®¹é”™ï¼Œé«˜æ€§èƒ½çš„å¤§æ•°æ®å¤„ç†å‡½æ•°æ¡†æž¶ã€‚ ç†è®ºæ¨¡åž‹ ç†è®ºæ¨¡åž‹å€Ÿé‰´äºŽLispè¯­è¨€ä¸­çš„map/reduceå‡½æ•°ã€‚ 12345678910111213141516&gt; void map(string key, string value) &#123;&gt; //key: æ–‡æ¡£å&gt; //value: æ–‡æ¡£å†…å®¹&gt; for each word w in value:&gt; EmitIntermediate(w, "1"); &gt; &#125;&gt; &gt; void reduce (string key, Iterator values) &#123;&gt; //key: ä¸€ä¸ªå•è¯&gt; //value: è®¡æ•°å€¼åˆ—è¡¨&gt; int result = 0;&gt; for each v in value:&gt; result += ParseInt(v);&gt; Emit(toString(result)); &gt; &#125;&gt; è¿™é‡Œä¸¤ä¸ªå‡½æ•°æ¨¡åž‹çš„ç±»åž‹åˆ†åˆ«æ˜¯: map: (k1, v1) â€”&gt; list(k2, v2) reduce: (k2, list(v)) â€”&gt; list(v2) å¯¹äºŽä¸€ä¸ªmapæ“ä½œï¼Œå°†keyæ–‡æ¡£ä¸­çš„å†…å®¹æŒ‰ç…§ä¸€å®šæ–¹å¼è¯»å–ï¼Œå¹¶ç»Ÿè®¡å…¶ä¸­çš„wé¡¹çš„é¢‘çŽ‡valueå¹¶è¾“å‡ºåˆ°ä¸€ä¸ªä¸­é—´æ–‡ä»¶ä¸Šã€‚è€Œreduceä»Žä¸­é—´æ–‡ä»¶ä¸­è¯»å–å¹¶è¿­ä»£å…¶listsï¼Œå°†å¯¹åº”çš„keyé¡¹ç»Ÿè®¡ã€‚ è¿™ä¸€æ¨¡åž‹å¯ä»¥å¾ˆå¥½çš„å¤„ç†å¹¶è¡ŒåŒ–æ“ä½œâ€”â€”å› ä¸ºmapçš„è¿‡ç¨‹å¯ä»¥åœ¨å¤šå°æœºå™¨ä¸Šå¹¶è¡Œå®Œæˆè€Œæ²¡æœ‰ä¾èµ–ã€‚reduceè¿‡ç¨‹ä¹Ÿæ˜¯ã€‚ä½†æ˜¯æ•´ä½“reduceå’Œmapä¹‹é—´å­˜åœ¨ç€é¡ºåºä¾èµ–å…³ç³»å³å¿…é¡»æ˜¯ç›¸åº”çš„mapæ“ä½œç»“æŸæ‰å¯ä»¥å”¤é†’reduceæ“ä½œã€‚ è¿™æ ·çš„è¯æ‰€æœ‰çš„ä¾èµ–å’Œåè°ƒè¿‡ç¨‹éƒ½è¢«éšè—åœ¨mapå’Œreduceå‡½æ•°çš„æ•°æ®åˆ†å‘ä¹‹é—´ï¼Œè€Œå¼€å‘è€…å¯ä»¥å®Œå…¨ä¸ç”¨è€ƒè™‘åˆ†å¸ƒå¼ç»†èŠ‚è€Œå•ç‹¬ç¼–å†™è¿™ä¸¤ä¸ªå‡½æ•°ä»¥è¾¾åˆ°è‡ªå·±çš„ç›®çš„ã€‚ å®žçŽ° ä»Žå®žçŽ°è§’åº¦çœ‹ç³»ç»Ÿçš„å¾ˆå¤šè¡Œä¸ºæ˜¯ç”±MapReduceå†…ç½®çš„åº“å®Œæˆçš„ã€‚è¿™é‡Œæœ‰å‡ ä¸ªå®¹æ˜“æ··æ·†çš„æ¦‚å¿µï¼š user programï¼šç”¨æˆ·ç¨‹åºï¼Œä¼šè¢«å¤šæ¬¡forkæˆä¸ºmasterå’Œworker master: ä¸»èŠ‚ç‚¹ï¼Œç”¨æ¥å°†taskåˆ†é…ç»™ç›¸åº”çš„workerï¼Œè®°å½•å·¥ä½œèŠ‚ç‚¹çš„å½“å‰çŠ¶æ€å’Œå£°æ˜Žå‘¨æœŸ taskï¼šmapä»»åŠ¡æˆ–è€…reduceä»»åŠ¡ï¼Œç”±ç›¸åº”çš„workerå®Œæˆ worker: å·¥ä½œèŠ‚ç‚¹ï¼Œç”¨æ¥å®Œæˆç›¸åº”çš„task user-defined map/reduce: å¼€å‘è€…è‡ªå®šä¹‰çš„map/reduceå‡½æ•° è¾“å…¥é¢„å¤„ç† é¦–å…ˆåº“å‡½æ•°ä¼šå°†è¾“å…¥æ–‡ä»¶åˆ‡åˆ†æˆMä»½ï¼Œå¹¶åœ¨ä¸€ä¸ªé›†ç¾¤çš„è‹¥å¹²å°æœºå™¨ä¸Šå¯åŠ¨ç¨‹åºçš„å¤šä¸ªå‰¯æœ¬ã€‚å‰¯æœ¬ä¸­é™¤äº†æœ‰ä¸€ä¸ªä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œå…¶ä»–éƒ½æ˜¯å·¥ä½œèŠ‚ç‚¹ã€‚ ä¸»èŠ‚ç‚¹å°†Mä¸ªmapä»»åŠ¡Rä¸ªreduceä»»åŠ¡åˆ†é…ç»™ç©ºé—²çš„å·¥ä½œèŠ‚ç‚¹ï¼ˆç†è§£taskåœ¨è¢«åˆ†é…ç»™workeråŽä¸¤è€…æ˜¯ä¸€ä¸ªæ„æ€ï¼‰ã€‚ mapå·¥ä½œèŠ‚ç‚¹ï¼ˆåŒºåˆ†å·¥ä½œèŠ‚ç‚¹å’Œç”¨æˆ·å‡½æ•°ï¼‰ æ¯ä¸€ä¸ªè¢«åˆ†é…mapçš„å·¥ä½œèŠ‚ç‚¹éœ€è¦è¯»å–ç›¸åº”å†…å®¹å¹¶è§£æžå‡ºkey/valueå¯¹ï¼Œå¹¶å°†è¿™äº›ä½œä¸ºå‚æ•°æä¾›ç»™ç”¨æˆ·è‡ªå®šä¹‰çš„mapå‡½æ•°ï¼Œè€Œå‡½æ•°è¾“å‡ºçš„ä¸­é—´ç»“æžœç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚ ç¼“å­˜çš„ä¸­é—´key/valueå¯¹ä¼šè¢«åˆ’åˆ†ä¸ºRå—å¹¶å†™å…¥æœ¬åœ°ç£ç›˜ï¼Œè€Œè¿™äº›æ•°æ®å¯¹åœ¨ç£ç›˜ä¸­çš„ç›¸åº”ä½ç½®ä¼šè¢«ä¼ å›žä¸»èŠ‚ç‚¹â€”â€”ç”±ä¸»èŠ‚ç‚¹å†ä¼ ç»™ç›¸åº”çš„reduceå·¥ä½œèŠ‚ç‚¹ã€‚ reduceå·¥ä½œèŠ‚ç‚¹ï¼ˆåŒºåˆ†å·¥ä½œèŠ‚ç‚¹å’Œç”¨æˆ·å‡½æ•°ï¼‰ ä¿è¯mapæ“ä½œç»“æŸåŽï¼Œä¸»èŠ‚ç‚¹å”¤é†’reduceå·¥ä½œèŠ‚ç‚¹å¹¶å‘ŠçŸ¥å…¶ä¸­é—´è¾“å‡ºçš„ç£ç›˜ä½ç½®ã€‚reduceå·¥ä½œèŠ‚ç‚¹ä½¿ç”¨RPCè°ƒç”¨èŽ·å–è¿™äº›ä¸­é—´æ•°æ®ã€‚å½“reduceè¯»å–å®Œæ‰€æœ‰çš„æ•°æ®ï¼Œéœ€è¦æŒ‰ç…§keyå¯¹å…¶è¿›è¡ŒæŽ’åºï¼Œæ˜¯ä¸ºäº†æœ€åŽè¿­ä»£å™¨ç»Ÿè®¡è®¡æ•°æä¾›å‰ç½®æ¡ä»¶ã€‚æœ€åŽreduceå·¥ä½œèŠ‚ç‚¹è¿­ä»£æŽ’å¥½åºçš„ä¸­é—´æ•°æ®ï¼Œå¹¶å°†æ¯ä¸€ä¸ªä¸­é—´keyå’Œå®ƒå…³è”ä¸€ç»„ä¸­é—´valueä¼ é€’ç»™ç”¨æˆ·å®šä¹‰çš„reduceå‡½æ•°ã€‚ shuffleè¿‡ç¨‹ï¼ˆæ ¸å¿ƒçŠ¶æ€æœºï¼‰ æ•´ä¸ªmapå’Œreduceä¹‹é—´çš„æ•°æ®shuffleæ˜¯ç³»ç»Ÿåˆ†å¸ƒå¼çš„æ ¸å¿ƒï¼Œå…³é”®å°±æ˜¯mapç”Ÿæˆçš„ä¸­é—´æ–‡ä»¶åŠå…¶å‘½åã€‚ å¦‚ä¸Šå›¾ï¼Œå‡è®¾æœ‰5ä¸ªmapå·¥ä½œèŠ‚ç‚¹å’Œ3ä¸ªreduceå·¥ä½œèŠ‚ç‚¹ã€‚ mapå·¥ä½œèŠ‚ç‚¹çš„è¾“å‡ºåˆ†ä¸º3ç±»ï¼Œåˆ†åˆ«ç”±R0ï¼ŒR1å’ŒR2å¤„ç†ï¼Œå½“mapçš„è§£æžå‡½æ•°ä¸€è‡´æ—¶ï¼Œç›¸åŒçš„keyä¸€å®šè¢«åˆ†åˆ°äº†åŒä¸€ä¸ªä¸­é—´æ–‡ä»¶ä¸­ã€‚å³0-0.txtã€1-0.txtå’Œ0-2.txtä¸‰ä¸ªæ–‡ä»¶ä¸­keyç±»åž‹çš„äº¤é›†æ˜¯ç©ºé›†ã€‚ md5(key)%Rè®¡ç®—mapæœ€ç»ˆè¾“å‡ºè½å…¥åˆ°å“ªä¸ªä¸­é—´æ–‡ä»¶ ä¸­é—´æ–‡ä»¶å‘½åï¼šmapä»»åŠ¡ç¼–å·-reduceä»»åŠ¡ç¼–å· å› æ­¤5ä¸ªmapæ“ä½œç»“æŸåŽä¼šç”Ÿæˆ5*3çš„ä¸­é—´æ–‡ä»¶çŸ©é˜µã€‚ mapç»“æŸåŽï¼Œ3ä¸ªreduceå·¥ä½œèŠ‚ç‚¹é€šè¿‡RPCåˆ†åˆ«èŽ·å–çŸ©é˜µçš„æ¯ä¸€åˆ—æ–‡ä»¶æ•°æ® æ¯”å¦‚R0è°ƒç”¨0-0.txtã€1-0.txtã€2-0.txtã€3-0.txtã€4-0.txtã€‚å› ä¸ºåŒä¸€åˆ—ä¸­ç±»åž‹ç›¸åŒï¼Œæ‰€ä»¥åªéœ€è¦å†…éƒ¨æŽ’åºã€‚ æ‰€è°“shuffleå°±æ˜¯map/reduceå¯¹ä¸­é—´æ–‡ä»¶çš„è¡Œåˆ—æ“ä½œï¼Œå…¶ç»“æžœæ˜¯å°†ä¸­é—´æ–‡ä»¶è¿›ä¸€æ­¥å¤„ç†æˆä¸º&lt;value, list&lt;key&gt;&gt;ä½œä¸ºç”¨æˆ·å®šä¹‰reduceå‡½æ•°çš„è¾“å…¥è¿›è¡Œè®¡æ•°ç»Ÿè®¡ã€‚ æœ€ç»ˆè¾“å‡º reduceå·¥èŠ‚ç‚¹å¤„ç†å®Œè®¡æ•°åŽï¼Œå°†ç»“æžœè¾“å‡ºåˆ°ç£ç›˜ä¸Šä½œä¸ºä¸‹ä¸€æ¬¡MapReduceçš„è¾“å…¥ã€‚ å·¥ä¸šçº§å¤„ç† åœ¨æ¡†æž¶å®žçŽ°çš„è¿‡ç¨‹ä¸­å‡ºçŽ°äº†å¾ˆå¤šçš„ç»†èŠ‚ã€‚Googleåœ¨å°†MapReduceå·¥ä¸šåŒ–è½åœ°çš„è¿‡ç¨‹ä¸­ä¹Ÿå°†è¿™äº›å½±å“ç³»ç»Ÿæ€§èƒ½å’Œå¯é æ€§çš„ä¸»è¦å› ç´ è¿›è¡Œäº†ä¼˜åŒ–â€”â€”è€Œä¸€ä¸ªä¼˜ç§€çš„ç³»ç»Ÿæœ¬èº«å°±æ˜¯åœ¨å®žè·µä¸­ä¸æ–­è¿­ä»£å‡ºæ¥çš„ï¼Œè¿™é‡Œç®€å•æ¦‚æ‹¬ä¸€ä¸‹ï¼Œä¸åšè¯¦ç»†è®¨è®ºã€‚ å®¹é”™ åˆ†å¸ƒå¼å®¹é”™çš„æœ¬è´¨å°±æ˜¯å¦‚ä½•åœ¨ä¸å¯é çš„ç¡¬ä»¶ä¸Šæž„å»ºå¯é çš„è½¯ä»¶ã€‚å› ä¸ºæ˜¯å¤§è§„æ¨¡é›†ç¾¤ï¼Œæ‰€ä»¥å¾ˆéš¾é¿å…Partial Failureâ€”â€”ä»Žå®žçŽ°è§’åº¦çœ‹å°±æ˜¯å„ä¸ªèŠ‚ç‚¹çš„å®¹é”™ã€‚ ä¸»èŠ‚ç‚¹ï¼šä¸»èŠ‚ç‚¹å¥”æºƒä¹‹åŽä¼šcoredumpåˆ°ä¸€ä¸ªæ¢å¤æ–‡ä»¶ä¸­ï¼Œé‡å¯åŽå¯ä»¥ä»Žæœ€è¿‘çš„æ¢å¤ç‚¹é‡æ–°æ‰§è¡ŒMapReduce å·¥ä½œèŠ‚ç‚¹ï¼šå¥”æºƒåŽä¸€èˆ¬éƒ½è¦å°†å½“å‰çš„taské‡æ–°åˆ†é…åˆ°ä¸€ä¸ªèŠ‚ç‚¹å®Œæˆ mapï¼šè¾“å‡ºæ˜¯ä¸€ä¸ªä¸­é—´æ–‡ä»¶æ‰€ä»¥ç¬¦åˆåŽŸå­æäº¤å³åŽé¢çš„ä»»åŠ¡ä¼šå°†æ–‡ä»¶è¦†ç›– reduceï¼šå…¶è¾“å‡ºæ˜¯ä¸€ä¸ªæŒä¹…æ€§çš„æ–‡ä»¶æ‰€ä»¥éœ€è¦é‡å‘½åä¸€ä¸ªæ–°çš„æ–‡ä»¶é˜²æ­¢å†²çª åŠ é€Ÿ å½“å‡ºçŽ°å¤§è§„æ¨¡çš„æœºå™¨èŠ‚ç‚¹æ—¶ï¼Œå¾ˆå¤šæ€§èƒ½é—®é¢˜ä¼šæˆä¸ºä¼˜åŒ–çš„æ–¹å‘ã€‚æ¯”å¦‚è¿›ä¸€æ­¥ä¼˜åŒ–ç½‘ç»œå’Œç£ç›˜æ€§èƒ½ã€‚ å±€éƒ¨æ€§ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè¾“å…¥æ–‡ä»¶ä¼ åˆ°mapèŠ‚ç‚¹ï¼Œmapä¸­é—´æ–‡ä»¶ä¼ åˆ°reduceèŠ‚ç‚¹éƒ½éœ€è¦ç½‘ç»œå¸¦å®½ã€‚å¯ä»¥è€ƒè™‘å°†mapç›´æŽ¥åˆ†é…åˆ°æœ¬åœ°ç£ç›˜ä¸Šç­‰æ“ä½œå¢žåŠ å¹¶è¡Œæ€§ã€‚ ä»»åŠ¡ç²’åº¦ï¼šMä¸ªmapèŠ‚ç‚¹ï¼ŒRä¸ªreduceèŠ‚ç‚¹ã€‚åˆ†é…å¤ªå¤šèŠ‚ç‚¹å¯¼è‡´ç½‘ç»œå¸¦å®½ä¸å¤Ÿï¼Œåˆ†é…å¤ªå°‘å¯¼è‡´å¹¶è¡Œåº¦ä¸å¤Ÿã€‚ è´Ÿè½½å‡è¡¡ï¼šä¸åŒçš„å·¥ä½œèŠ‚ç‚¹æ€§èƒ½ä¹Ÿä¸åŒï¼Œå¦‚æžœç³»ç»Ÿå¡åœ¨æœ€åŽå‡ ä¸ªèŠ‚ç‚¹å¯¼è‡´è´Ÿè½½è¿‡é«˜èŠ±è´¹æ—¶é—´è¿‡é•¿ï¼Œå°±ä¼šè®©æ•´ä¸ªç³»ç»Ÿå¤„äºŽä¸å¹³è¡¡çš„çŠ¶æ€ã€‚ Lecture1~2 goè¯­è¨€çŽ¯å¢ƒé…ç½® ä½œä¸ºä¸€ä¸ªVIMé‡åº¦ç”¨æˆ·æˆ‘å·²ç»ä¸ç”¨IDEå¾ˆå¤šå¹´äº†ã€‚å°±è‡ªè¡Œé…ç½®äº†Vim-Goå¼€å‘çŽ¯å¢ƒã€‚ Goå®‰è£…é…ç½® æˆ‘ç”¨MacOs CatalinaçŽ¯å¢ƒï¼Œä¸‹è½½å®‰è£…å°±ä¸è¯´äº†ã€‚ä¸»è¦å…³æ³¨GoçŽ¯å¢ƒå˜é‡ï¼Œéœ€è¦å†™å…¥ç›¸åº”çš„SHELLé…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ‘çš„åœ¨.zshrcä¸­ï¼š GOROOT: Goè¯­è¨€çš„å®‰è£…ç›®å½•ï¼Œä¸€èˆ¬æ˜¯/usr/local/go GOPATH: å·¥ä½œåŒºå³å†™ä»£ç çš„ç›®å½•ï¼Œä¸€èˆ¬åˆ†ä¸ºä¸‰ä¸ªå­ç›®å½•ï¼š src bin pkg GOBIN: å­˜æ”¾GOè¯­è¨€å¯æ‰§è¡Œæ–‡ä»¶çš„ç›®å½•ï¼ˆè¿™é‡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸»è¦æŒ‡é€šè¿‡go getä¸‹è½½å¹¶ç¼–è¯‘å¥½çš„åº“ï¼Œä¾›ç›´æŽ¥è°ƒç”¨çš„ï¼‰ PATH: éœ€è¦å°†å½“å‰çš„å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•æ”¾åˆ°PATHä¸‹é¢ 1234567&gt; # æ³¨æ„""çš„ä½¿ç”¨&gt; export GOROOT=/usr/local/go&gt; export GOPATH=~/go/golib:~/go/goproject #è¿™é‡Œè®¾ç½®äº†ä¸¤ä¸ªå·¥ä½œåŒº&gt; export GOBIN=~/go/gobin&gt; export PATH="$GOROOT/bin:$GOBIN:$PATH"&gt; &gt; é•œåƒ å› ä¸ºGithubå’ŒGoå®˜ç½‘ä¸å¤ªå¥½ç”¨ï¼Œæ‰€ä»¥ä½¿ç”¨é•œåƒæ¥ä¸‹è½½éœ€è¦çš„åº“æ¯”è¾ƒæ–¹ä¾¿ã€‚ 1234&gt; # Mac/LinuxçŽ¯å¢ƒä¸‹&gt; export GO111MODULE=on&gt; export GOPROXY=https://goproxy.cn&gt; äºŒè¿›åˆ¶å·¥å…· vim-goæ˜¯ä¸€ä¸ªå¼€å‘goçš„vimæ’ä»¶ã€‚æˆ‘ä½¿ç”¨vundleåŒ…ç®¡ç†å·¥å…·æ¥ç®¡ç†vimæ’ä»¶ã€‚ 123&gt; # å¦‚ä½•ä½¿ç”¨vundleè‡ªè¡ŒGoogle&gt; Plugin 'fatih/vim-go'&gt; å› ä¸ºè¿™ä¸ªæ’ä»¶å¯åŠ¨è¿˜éœ€è¦ä¸€äº›å’ŒäºŒè¿›åˆ¶å·¥å…·ï¼Œå…·ä½“çš„åˆ—è¡¨å¯æ‰“å¼€&quot;~/.vim/bundle/vim-go/plugin/go.vim&quot;å¦‚ä¸‹ï¼š å¸¸è§„åšæ³•æ˜¯åœ¨vimå‘½ä»¤è¡Œæ¨¡å¼ä¸‹é¢ç›´æŽ¥æ‰§è¡Œ:GoInstallBinariesæ¥è‡ªåŠ¨å®‰è£…ã€‚å¦‚æžœæ²¡æœ‰å®‰è£…ä»£ç†çš„è¯å°½ç®¡æœ‰é•œåƒè¿˜æ˜¯å¾ˆå®¹æ˜“å‡ºé”™ï¼Œæ‰€ä»¥æˆ‘çš„åšæ³•æ˜¯ä¸€ä¸ªä¸€ä¸ªä»Žå®˜ç½‘ä¸Šgo getç„¶åŽgo insatllæ‰‹åŠ¨å®‰è£…ã€‚ 123&gt; $ go get github.com/go-delve/delve/cmmd/dlv #ä»Žå®˜ç½‘ä¸Šç›´æŽ¥ä¸‹è½½äºŒè¿›åˆ¶å·¥å…·&gt; $ go install github.com/go-delve/delve/cmmd/dlv@laatest #ä½¿ç”¨go installæ‰‹åŠ¨å®‰è£…&gt; å¦‚æžœæŒ‰ç…§å‰é¢çš„æ–¹å¼é…ç½®å¥½äº†çŽ¯å¢ƒå˜é‡ï¼Œé‚£è¿™äº›äºŒè¿›åˆ¶å·¥å…·å°±ä¼šè¢«å®‰è£…åœ¨~/go/gobinç›®å½•ä¸‹ã€‚éªŒè¯æ–¹å¼å°±æ˜¯æ‰“å¼€vimä¹‹åŽä¸ä¼šæœ‰æ’ä»¶æŠ¥é”™ä¿¡æ¯ã€‚ Lab1 To conclude åœ¨å­¦ä¹ è¿‡ç¨‹ç”¨åˆ°çš„èµ„æ–™åˆ—ä¸¾å¦‚ä¸‹: MIT6.824ä¸­æ–‡ç¿»è¯‘ Goæ–‡æ¡£ Goè¯­è¨€åœ£ç»]]></content>
      <categories>
        <category>Golang</category>
      </categories>
      <tags>
        <tag>Distributed System</tag>
        <tag>MapReduce</tag>
        <tag>MIT6.824</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[NJUé™æ€åˆ†æž(3-Pointer-Analysis)]]></title>
    <url>%2F2021%2F05%2F14%2FNJU%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90-3-Pointer-Analysis%2F</url>
    <content type="text"><![CDATA[Abstract è¿‡ç¨‹é—´åˆ†æžéœ€è¦åŸºäºŽç¨‹åºçš„Call Graphæ¥å®Œæˆã€‚ç”±äºŽCHA Analysisè¿‡åº¦è¿½æ±‚é€Ÿåº¦é€ æˆè¯¯æŠ¥â€”â€”è€Œfalse positiveå¯¹äºŽå¸¸é‡ä¼ æ’­è¿™æ ·çš„muståˆ†æžæ¥è¯´æ˜¯ä¸å¯æŽ¥å—çš„ã€‚å› æ­¤æŒ‡é’ˆåˆ†æžåœ¨POPL'1980è¢«ç¬¬ä¸€æ¬¡æå‡ºInterprocedural Data Flow Analysis in the Presence of Pointers, Procedure Variables, and Label Variablesã€‚ Pointer Analysis computes an over-approximation of the set of which memory-locations(objects) a pointer can point to. æŒ‡é’ˆåˆ†æžé™¤äº†å¯ä»¥æž„å»ºCall Graphç­‰ç¨‹åºåŸºæœ¬ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç”¨äºŽç¼–è¯‘ä¼˜åŒ–ï¼Œç¨‹åºé²æ£’æ€§å’Œå®‰å…¨ç­‰å„ä¸ªé¢†åŸŸï¼Œæ˜¯æœ€åŸºç¡€çš„é™æ€åˆ†æžç®—æ³•ä¹‹ä¸€â€”â€”æ¯”å¦‚æµè¡Œçš„åˆ«ååˆ†æžAlias Analysiså°±æ˜¯ä»ŽæŒ‡é’ˆåˆ†æžä¸­æ´¾ç”Ÿå‡ºæ¥çš„:Alias information can be derived from points-to relations.åœ¨æŒ‡é’ˆåˆ†æžçš„è¾“å‡ºæŒ‡å‘å…³ç³»ä¸­æ˜¯å¦æœ‰ä¸¤ä¸ªæŒ‡é’ˆå¯ä»¥æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚ Introduction æŒ‡é’ˆåˆ†æžæ˜¯ä¸€ç§mayåˆ†æžï¼Œè¾“å…¥æ—¶æ•´ä¸ªç¨‹åºï¼Œåˆ†æžç»“æžœçš„è¾“å‡ºæ˜¯ç±»ä¼¼äºŽmapçš„ä¸€ç³»åˆ—æŒ‡å‘å…³ç³»Points-to relationsã€‚ KeyFactors ä½œä¸ºä¸€é¡¹æ¯”è¾ƒå¤æ‚çš„æŠ€æœ¯ï¼ŒæŒ‡é’ˆåˆ†æžæ¡†æž¶çš„ç²¾åº¦å’Œé€Ÿåº¦å–å†³äºŽå››ä¸ªå¾ˆä¸»è¦çš„å› ç´ ï¼š Factor Problem Choice Heap abtraction How to model heap memory? Allocation-site/Storeless Context sensitivity How to model calling contexts? Context-sensitive/Context-insensitive Flow sensitivity How to model control flow? Flow-sensitive/Flow-insensitive Analysis scope Which parts of program should be analyzed? Whole-program/Demand-driven Heap Abstraction å¦‚ä½•æŠ½è±¡å †æ“ä½œï¼Œæ¯”å¦‚å¾ªçŽ¯å’Œé€’å½’ä¼šåœ¨åŠ¨æ€è¿è¡Œæ—¶åˆ›å»ºå¾ˆå¤šçš„å †å¯¹è±¡ï¼Œå¦‚ä½•å°†è¿™äº›unboundedçš„æ“ä½œè¿›ä¸€æ­¥ç®€åŒ–æŠ½è±¡æˆfiniteçš„é™æ€åˆ†æžå¯¹è±¡ã€‚ å­¦æœ¯ç•Œæœ‰ä¸¤ä¸ªæµæ´¾æ¥å®Œæˆå †æŠ½è±¡ï¼šStore based modelå’ŒStoreless modelã€‚æœ¬èŠ‚è¯¾ä»‹ç»ç¬¬ä¸€ä¸ªæµæ´¾ä¸‹é¢çš„Allocation sitesæ–¹æ³•æ¥å¯¹æ‰€æœ‰å †å¯¹è±¡å®Œæˆå»ºæ¨¡â€”â€”One abstract object per allocation siteã€‚å³æ¯ä¸€ä¸ªåˆ†é…ç‚¹newçš„å †å¯¹è±¡éƒ½æŠ½è±¡åˆ°ä¸€ä¸ªobjectä¸­ã€‚ Context Sensitivity åœ¨å‡½æ•°è°ƒç”¨çš„æ—¶å€™ä¼šäº§ç”Ÿä¸Šä¸‹æ–‡contextã€‚ä¸€ä¸ªmethodè¢«è°ƒç”¨å¤šæ¬¡çš„è¯å¦‚ä½•å¯¹æ¯ä¸€æ¬¡çš„ä¸Šä¸‹æ–‡è¿›è¡ŒæŠ½è±¡ã€‚å…³äºŽä¸Šä¸‹æ–‡æŠ½è±¡ä¹Ÿæœ‰ä¸¤ç§æµæ´¾: Context-sensitive: å¯¹æ¯ä¸€æ¬¡è°ƒç”¨éƒ½åŒºåˆ«å¯¹å¾…ï¼Œå…·ä½“è°ƒç”¨å…·ä½“åˆ†æž Context-insensitive: å¯¹ä¸€ä¸ªmethodçš„æ‰€æœ‰è°ƒç”¨éƒ½mergeåˆ°ä¸€èµ·ï¼Œä¸€æ¬¡æ€§å¤„ç† ä¸Šä¸‹æ–‡æ•æ„Ÿæ˜¯æé«˜é™æ€åˆ†æžæ•ˆçŽ‡éžå¸¸æœ‰æ•ˆçš„å·¥å…·ä¹‹ä¸€ï¼Œæ˜¯è¿™é—¨è¯¾éœ€è¦è®¨è®ºçš„é‡ç‚¹ã€‚ Flow Sensitivity å¦‚ä½•å¯¹æŽ§åˆ¶æµæŠ½è±¡ï¼Œä¹Ÿæœ‰ä¸¤ç§æµæ´¾ï¼š Flow-sensitive: ç¡®ä¿ç¨‹åºçš„æ‰§è¡Œé¡ºåºexecution orderï¼Œç»´æŠ¤æ¯ä¸€ä¸ªç¨‹åºç‚¹çš„points-to relationsè¡¨ Flow-insensitive:å¿½ç•¥æ‰§è¡Œé¡ºåºï¼Œç»´æŠ¤æ•´ä¸ªç¨‹åºçš„æŒ‡å‘è¡¨ ç›®å‰å­¦æœ¯ç•Œè¿˜æ²¡æœ‰ç›´æŽ¥ç ”ç©¶è¡¨æ˜Žflow sensitivityç›¸æ¯”äºŽflow insensitivityå¯¹Javaè¿™æ ·çš„OOPè¯­è¨€ä¼šæœ‰å¤šå°‘ä¼˜åŠ¿ã€‚ Analysis Scope åœ¨è¿›è¡ŒæŒ‡é’ˆåˆ†æžçš„æ—¶å€™ï¼Œå¦‚ä½•é€‰å–éœ€è¦åˆ†æžçš„ç¨‹åºæ®µï¼Ÿ Whole-program Demand-driven æ˜¯ç›´æŽ¥åˆ†æžæ•´å¥—ç¨‹åºè¿˜æ˜¯ä»¥éœ€æ±‚ä¸ºé©±åŠ¨è¿›è¡Œç‰¹å®šç¨‹åºç‰‡æ®µçš„åˆ†æžã€‚å®žé™…ä¸Šå¦‚æžœéœ€æ±‚å¾ˆå¤šçš„è¯ï¼Œå•ç‹¬åˆ†æžçš„å¤æ‚åº¦å’Œç›´æŽ¥è¿›è¡Œæ•´å¥—ç¨‹åºåˆ†æžçš„å¤æ‚åº¦ä¸ç›¸ä¸Šä¸‹ã€‚ Concerned Statements ä¸Šè¿°çš„Key Factorsæ˜¯å…·æœ‰å…¨å±€æ€§è´¨çš„-å³é’ˆå¯¹æ•´ä¸ªæŒ‡é’ˆç®—æ³•æ¡†æž¶ï¼Œé‚£åœ¨å®žçŽ°ä¸Š-å³é’ˆå¯¹Javaç¼–ç¨‹è¯­è¨€çš„å…·ä½“æŒ‡é’ˆåˆ†æžæ¡†æž¶æ¥è¯´ï¼Œæ›´ç»†ç²’åº¦çš„Concerned Statementsä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ Pointers in Java é¦–å…ˆéœ€è¦æ€»ç»“ä¸€ä¸‹Javaä¸­æ‰€æœ‰å¯ä»¥ç”¨ä½œæŒ‡é’ˆçš„å£°æ˜Žã€‚ Local variableï¼šx Static field: C.f Instance field: x.f Array element: array[i] å…±æœ‰4ä¸­å…·ä½“çš„æŒ‡é’ˆç±»åž‹â€”â€”static fieldæ˜¯ä¸€ç§å…¨å±€å˜é‡ã€‚æ•°ç»„å…ƒç´ åœ¨åˆ†æžæ—¶å¯ä»¥å¿½ç•¥æŽ‰ç´¢å¼•ï¼Œçœ‹æˆæ˜¯å¯ä»¥æŒ‡å‘ä»»ä½•æ•°ç»„å…ƒç´ fieldçš„æŒ‡é’ˆç±»åž‹array.arrï¼Œå› æ­¤ä¹Ÿè¢«çœ‹æˆæ˜¯ä¸€ç§Instance fieldã€‚ç»¼ä¸Šæ¥çœ‹ï¼Œé’ˆå¯¹Javaè¯­è¨€çš„æŒ‡é’ˆåˆ†æžä¸»è¦å¤„ç†Local variableå’Œinstance fieldä¸¤ç§æŒ‡é’ˆç±»åž‹ã€‚ Pointer-Affecting Statements æ˜Žç¡®äº†æŒ‡é’ˆåˆ†æžç ”ç©¶å¯¹è±¡Pointersçš„å…·ä½“ç±»åž‹ä¹‹åŽï¼Œç»§ç»­æ€è€ƒå…¨ç¨‹åºçš„æŒ‡é’ˆåˆ†æžå¦‚ä½•æ›´å…·ä½“çš„å®Œæˆå®žçŽ°ï¼Ÿå°±è¯­å¥æœ¬èº«æ¥è¯´ä¾‹å¦‚if/for/breakè¿™æ ·çš„æŽ§åˆ¶æµå¹¶ä¸ä¼šå¯¹æŒ‡é’ˆåˆ†æžçš„ç»“æžœé€ æˆå½±ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çœŸæ­£çš„pointer-affecting statementså¦‚ä¸‹ï¼š New: x = new T() Assign: x = y Store: x.f = y Load: y = x.f Call: r = x.k(a, ...) é‡ç‚¹å…³æ³¨virtual calls Foundations Rules Domains and Notations æŒ‡é’ˆåˆ†æžæ˜¯ä¸€ç§ä»¥æŒ‡å‘å…³ç³»ä½œä¸ºä¼ é€’ä¿¡æ¯çš„æ•°æ®æµåˆ†æžã€‚æ‰€ä»¥å…¶ç†è®ºä¹Ÿéœ€è¦å¼•å…¥åŸŸå’ŒæŸäº›ç¬¦å·è§£é‡Šï¼š Variable: x, y âˆŠ V Fields: f,g âˆŠ F Objects: oi,oj âˆŠ O (Allocation sites) Instance fields: oi.f, oj.g âˆŠ Oâ¨‰F Pointers: Pointer = Vâ‹ƒ(Oâ¨‰F) å…¶ä¸­Variableè¡¨ç¤ºç¨‹åºä¸­çš„æ‰€æœ‰å˜é‡æŒ‡é’ˆç±»åž‹ã€‚Objectå’ŒFieldsåˆ†åˆ«æŒ‡çš„æ˜¯ç¨‹åºä¸­åˆ†é…å †å¯¹è±¡çš„åˆ›å»ºç‚¹å’ŒæŠ½è±¡å †å¯¹è±¡ä¸­çš„åŸŸâ€”â€”å¯¹è±¡å’ŒåŸŸç»„åˆèµ·æ¥çš„Instance Fieldsä¹Ÿè¡¨ç¤ºç¨‹åºä¸­ä¸€ç§æŒ‡é’ˆã€‚PointersæŒ‡çš„æ˜¯ç¨‹åºä¸­æ‰€æœ‰çš„variableå’Œinstance fieldâ€”â€”V â‹ƒ (O x F)ã€‚ æœ€åŽå¼•å…¥æŒ‡å‘å…³ç³»pt(å…¶æœ¬èº«å°±æ˜¯ä¸€ç§æ˜ å°„ï¼Œ ä»£è¡¨æŒ‡é’ˆå¯èƒ½æŒ‡å‘çš„å¯¹è±¡çš„é›†åˆ)ï¼š Points-to relations: pt: Pointer âŸ¶ ð“Ÿ(O) ð“Ÿ(O)è¡¨ç¤ºå¯¹è±¡Oçš„powerset pt(p)è¡¨ç¤ºæŒ‡é’ˆpçš„æŒ‡å‘å…³ç³»é›†åˆ ç†è§£ä¸Šï¼ŒæŒ‡é’ˆæŒ‡å‘å¯¹è±¡â€”â€”æŒ‡é’ˆpçš„å€¼åŸŸå°±æ˜¯V â‹ƒ (O x F)ï¼Œå¯¹è±¡oçš„å€¼åŸŸå°±æ˜¯ð“Ÿ(allocation sites)ã€‚pâŸ¶o â‰¡ oâˆŠpt(p)å³æŒ‡é’ˆpæŒ‡å‘å¯¹è±¡oç­‰ä»·äºŽå¯¹è±¡oå±žäºŽæŒ‡é’ˆpçš„æŒ‡å‘å…³ç³»é›†åˆã€‚ åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¼•å…¥å¦‚ä½•å¤„ç†Pointer-Affecting Statementsçš„å½¢å¼åŒ–Rulesï¼š åˆ†æ•°ä¸Šé¢æ˜¯å‰æpremiseè€Œä¸‹é¢æ˜¯ç»“è®ºconclusionã€‚ New: Newè§„åˆ™ä¸­çš„oi è¡¨ç¤ºä¸€ä¸ªAllocation siteåœ¨è¿™ä¸€ç‚¹åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæŒ‡é’ˆåˆ†æžå¦‚ä½•å¤„ç†ä¸€ä¸ªNewè¯­å¥â€”â€”å³æ‰§è¡Œå®Œè¿™æ¡è¯­å¥åŽè®©xæŒ‡å‘oiå³oi âˆŠ pt(x)ã€‚ Assign: å¦‚æžœoiå±žäºŽyçš„æŒ‡å‘é›†ï¼Œé‚£åœ¨æ‰§è¡Œå®Œè¿™æ¡è¯­å¥åŽoiåˆ™éœ€è¦åŠ å…¥åˆ°xçš„æŒ‡å‘é›†ä¸­ã€‚ Store: å°†æ–°å¯¹è±¡ä¿å­˜åˆ°è¯¥å¯¹è±¡çš„ä¸€ä¸ªåŸŸfâ€”â€”å¦‚æžœxæŒ‡å‘oiè€ŒyæŒ‡å‘ojï¼Œé‚£æ‰§è¡Œå®Œè¿™æ¡è¯­å¥ä¹‹åŽoi.féœ€è¦æŒ‡å‘ojã€‚ Load: å°†æŸä¸ªå¯¹è±¡çš„åŸŸfåŠ è½½åˆ°æ–°å¯¹è±¡ä¸­â€”â€”å¦‚æžœxæŒ‡å‘oiè€Œoiçš„åŸŸfæŒ‡å‘ojï¼Œé‚£æ‰§è¡Œå®ŒåŽå°†ojåŠ å…¥åˆ°yçš„æŒ‡é’ˆé›†å½“ä¸­ã€‚ How to Implement Pointer Analysis åœ¨ç¡®å®šå¥½Domainå’ŒRulesä¹‹åŽå¼€å§‹æ˜Žç¡®å¦‚ä½•å®žçŽ°å…¨ç¨‹åºçš„æŒ‡é’ˆåˆ†æžç®—æ³•ã€‚ Essentiallyï¼Œpointer analysis is to propagate points-to information among pointers(variables &amp; fields). åœ¨ä¸¤ç§æŒ‡é’ˆ(variableå’Œfields)ä¹‹é—´æ ¹æ®Pointer-Affecting Statementså»ºç«‹å’Œä¼ é€’æŒ‡å‘å…³ç³»points-toã€‚ä»Žå¦ä¸€ä¸ªè§’åº¦æ¥è¯´æŒ‡é’ˆåˆ†æžå°±æ˜¯åœ¨è§£å†³æŒ‡é’ˆä¹‹é—´çš„inclusion constraintså³å¯¹äºŽx = yè¯­å¥æŒ‡é’ˆxä¸€å®šåŒ…å«æŒ‡é’ˆyçš„æ‰€æœ‰æŒ‡å‘ä¿¡æ¯ã€‚è€Œå…³é”®çš„æ˜¯å½“pt(x)æ›´æ–°æ—¶ï¼Œè¿™äº›æ”¹å˜ä¹Ÿéœ€è¦ä¼ é€’ç»™xçš„å…¶ä»–ç›¸å…³æŒ‡é’ˆã€‚ è€Œåœ¨å®žçŽ°ä¸Šï¼Œæˆ‘ä»¬ç”¨Graphæ¥è¿žæŽ¥ç›¸å…³è”çš„æŒ‡é’ˆï¼Œå½“pt(x)æ›´æ–°æ—¶ï¼Œå°†æ›´æ–°çš„æ•°æ®æµï¼ˆæ•°æ®æµåˆ†æžæ ¹æ®Domainä¸åŒè€Œä¸åŒï¼ŒæŒ‡å‘å…³ç³»ä¹Ÿæ˜¯ä¸€ç§æ•°æ®æµä¿¡æ¯ï¼‰ä¼ é€’ç»™xçš„åŽç»§å…ƒç´ ï¼Œè¿™ä¸ªå›¾å°±æ˜¯Pointer Flow Graphã€‚ Pointer Flow Graph(PFG) ä¸€ä¸ªç¨‹åºçš„PFGæ˜¯ä¸€ç§è¡¨ç¤ºpoints-toä¿¡æ¯å¦‚ä½•åœ¨pointersä¹‹é—´æµåŠ¨çš„æœ‰å‘å›¾ï¼Œå›¾ä¸­çš„èŠ‚ç‚¹ä»£è¡¨äº†V â‹ƒ (O â¨‰ F)â€”â€”å˜é‡æˆ–è€…æŠ½è±¡å¯¹è±¡(å› ä¸ºPFGæ˜¯é™æ€åˆ†æžå»ºç«‹çš„ï¼Œæ‰€ä»¥æ˜¯æŠ½è±¡çš„å †å¯¹è±¡)çš„åŸŸï¼Œè¾¹ä»£è¡¨äº†å¯¹è±¡åœ¨æŒ‡é’ˆä¹‹é—´çš„æµåŠ¨å…³ç³»Pointer â¨‰ Pointerâ€”â€”æ¯”å¦‚xâŸ¶yä»£è¡¨äº†æŒ‡é’ˆxçš„æŒ‡å‘å¯¹è±¡é›†åˆå¯èƒ½(æŒ‡é’ˆåˆ†æžæ˜¯mayåˆ†æž)ä¼šæµåŠ¨åˆ°yçš„æŒ‡å‘é›†åˆã€‚ PFGä¸­çš„èŠ‚ç‚¹å°±æ˜¯ç¨‹åºä¸­çš„å„ç§æŒ‡é’ˆï¼Œè€Œè¾¹æ˜¯æ ¹æ®æŒ‡é’ˆåˆ†æžçš„Ruleså»ºç«‹çš„ã€‚ æœ‰äº†PFGï¼ŒæŒ‡é’ˆåˆ†æžé—®é¢˜å°±å¯ä»¥çœ‹æˆæ˜¯åœ¨PFGä¸Šæ±‚å…¶ä¼ é€’é—­åŒ…çš„é—®é¢˜ï¼Œæ¯”å¦‚PFGä¸­aç‚¹åˆ°bç‚¹æ˜¯å¯è¾¾çš„ï¼Œé‚£aä¸­çš„æ•°æ®æµä¿¡æ¯å°±å¯ä»¥ç›´æŽ¥æµåˆ°bèŠ‚ç‚¹ä¸Šã€‚ ç»¼ä¸Šï¼ŒæŒ‡é’ˆåˆ†æžçš„æ€è·¯ä¸»è¦æœ‰ä¸¤éƒ¨åˆ†ï¼šåˆ›å»ºPFGâ€”â€”&gt;åœ¨PFGä¸Šä¼ é€’æŒ‡å‘ä¿¡æ¯ã€‚è€Œéš¾ç‚¹åœ¨äºŽè¿™ä¸¤è€…æ˜¯äº’ç›¸ä¾èµ–çš„ã€‚ä¸ºä»€ä¹ˆåˆ›å»ºPFGä¹Ÿä¼šä¾èµ–æŒ‡å‘ä¿¡æ¯å‘¢ï¼Ÿ å› ä¸ºåœ¨å¤„ç†instance fieldsçš„æŒ‡å‘å…³ç³»çš„æ—¶å€™ï¼Œå‰ææ˜¯éœ€è¦çŸ¥é“è¿™äº›fieldçš„objectçš„æŒ‡å‘ä¿¡æ¯â€”â€”ç”±allocation sitesæ›´æ–°å¾—åˆ°ã€‚å› æ­¤PFGæœ¬èº«ä¹Ÿæ˜¯éšç€æŒ‡é’ˆåˆ†æžçš„è¿‡ç¨‹åŠ¨æ€æ›´æ–°çš„ã€‚ Algorithm æœ¬èŠ‚å…·ä½“å®žçŽ°æ•°æ®æµåˆ†æžç®—æ³•ï¼Œé¦–å…ˆæ˜¯ä½¿ç”¨åˆ°çš„æ•°æ®ç»“æž„ï¼š S: è¾“å…¥ç¨‹åºçš„è¯­å¥é›†åˆ WL: work listå­˜å‚¨äº†éœ€è¦å¤„ç†çš„æŒ‡å‘å…³ç³»pairï¼Œå…¶ä¸­æ¯ä¸€é¡¹&lt;n,ð“Ÿ(O)&gt;*æ„å‘³ç€åœ¨ð“Ÿ(O)ä¸­çš„ä¿¡æ¯éœ€è¦ä¼ é€’ç»™nçš„æŒ‡å‘å…³ç³»é›†åˆpt(n)ä¸­ï¼Œç”¨ PFG: æœ‰å‘å›¾ï¼Œè¡¨ç¤ºæˆä¸ºè¾¹çš„é›†åˆï¼Œå…¶ä¸­sâŸ¶tè¡¨ç¤ºsçš„æŒ‡å‘å…³ç³»æµå‘tçš„æŒ‡å‘å…³ç³» Hybrid-Set: ç”¨æ¥å­˜åœ¨pt(s)ï¼Œå³å½“å…ƒç´ å°äºŽ16æ—¶ç”¨HashSetå¤§äºŽ16æ—¶ç”¨BitVector Main Algorithm 12345678910111213141516171819202122232425262728293031323334&gt; Solve(S) &#123;&gt; WL = [], PFG = &#123;&#125;&gt; foreach i: x=new T() âˆŠ S do //å¤„ç†Newè¯­å¥&gt; add &lt;x, &#123;O_i&#125;&gt; to WL &gt; &gt; foreach x=y âˆŠ S do //å¤„ç†Assignè¯­å¥&gt; AddEdge(y, x)&gt; &gt; while WL is not empty do&gt; remove &lt;n, pts&gt; from WL&gt; ðš« = pts - pt(n)&gt; Propagate(n, ðš«) &gt; if n represents a variable x then&gt; foreach o_i âˆŠ ðš« do &gt; foreach x.f=y âˆŠ S do&gt; AddEdge(y, o_i.f) //å¤„ç†Storeè¯­å¥ &gt; foreach y=x.f âˆŠ S do &gt; AddEdge(o_i.f, y) //å¤„ç†Loadè¯­å¥&gt; &#125;&gt; &gt; AddEdge(s, t) &#123; //æž„å»ºPFG&gt; if sâŸ¶t âˆ‰ PFG then &gt; add sâŸ¶t to PFG&gt; if pt(s) is not empty then&gt; add &lt;t, pt(s)&gt; to WL&gt; &#125;&gt; &gt; Propagate(n, pts) &#123; //æ›´æ–°pt(x)&gt; if pts is not empty then&gt; pt(n) â‹ƒ= pts //æ ¸å¿ƒï¼š ä¼ é€’æ•°æ®æµ&gt; foreach nâŸ¶s âˆŠ PFG do &gt; add &lt;s, pts&gt; to WL&gt; &#125;&gt; AddEdge é¦–å…ˆæ¯ä¸€æ¡Newè¯­å¥ç”Ÿæˆä¸€æ¡æŒ‡å‘å…³ç³»å®Œæˆå¯¹WLçš„åˆå§‹åŒ–ã€‚è¿™å¥—ç®—æ³•çš„è¾“å…¥è¯­å¥Sæ˜¯æµä¸æ•æ„Ÿinsensitiveçš„ï¼Œå³å¤„ç†è¿‡ç¨‹ä¸ä¼šå…³æ³¨è¯­å¥é¡ºåºã€‚ AddEdgeå‡½æ•°ä¸»è¦æ˜¯é€šè¿‡å¤„ç†Assignè¯­å¥æž„å»ºPFGã€‚æ¯ä¸€æ¡sâŸ¶téƒ½å¯¹åº”ç€å›¾ä¸Šä¸€æ¡è¾¹ï¼Œæ ¹æ®æŒ‡é’ˆåˆ†æžçš„inclusion constraintsåŽŸç†å°†&lt;t, pt(s)&gt;åŠ å…¥WLä¸­å®žçŽ°æŠŠæŒ‡é’ˆsçš„æŒ‡å‘é›†åˆåŠ åˆ°æŒ‡é’ˆtä¸­ã€‚ Propagate åœ¨æž„å»ºå®Œæœ€åŸºç¡€çš„çš„PFGä¹‹åŽï¼Œç®—æ³•è¿›å…¥Whileå¾ªçŽ¯å¼€å§‹è¿­ä»£å¤„ç†WLä¸­çš„æŒ‡å‘å…³ç³»ã€‚å–å‡ºä¸€é¡¹&lt;n, pts&gt;ï¼Œè¿‡æ»¤æŽ‰æŒ‡é’ˆsæŒ‡å‘å…³ç³»ä¸­æŒ‡é’ˆnå·²ç»å­˜åœ¨çš„æŠ½è±¡å¯¹è±¡å³ðš«=pts-pt(n)â€”â€”ä¸»è¦æ˜¯ä¸ºäº†é¿å…æ›´å¤šçš„å†—ä½™æ“ä½œå·²è¾¾åˆ°Differential Propagation ç„¶åŽå¼€å§‹Propagateå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯çœŸæ­£ä¿®æ”¹äº†æŒ‡é’ˆçš„æŒ‡å‘å…³ç³»å³å®Œæˆæ•°æ®æµçš„ä¼ é€’ï¼Œæ¢å¥è¯è®²æŒ‡é’ˆåˆ†æžçš„è¿‡ç¨‹å°±æ˜¯åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ä¸æ–­å‘ptsä¸­åŠ å…¥æ–°çš„æ•°æ®æµã€‚è€Œè¿›å…¥åˆ°å‡½æ•°å†…çš„ðš«æ˜¯çœŸæ­£éœ€è¦ä¼ é€’ç»™nçš„æŒ‡å‘é›†åˆï¼ŒæŽ¥ç€åˆæ ¹æ®inclusion constraintséœ€è¦æŠŠæŒ‡é’ˆnåˆšæ›´æ–°è¿‡çš„æŒ‡å‘é›†åˆåŠ åˆ°å…¶åœ¨PFGä¸Šçš„åŽç»§ä¸­ï¼Œæ•…éåŽ†æ•´ä¸ªå›¾æ‰¾åˆ°æ‰€æœ‰çš„åŽç»§èŠ‚ç‚¹så¹¶æŠŠ&lt;s, pts&gt;åŠ åˆ°WLä¸­ç­‰å¾…ä¸‹ä¸€è½®æ›´æ–°ã€‚ Differential Propagation æŸ¥åˆ†ä¼ æ’­æ˜¯ä¸ºäº†é¿å…å¤„ç†å†—ä½™çš„æŒ‡é’ˆä¿¡æ¯ã€‚è¿™æ˜¯å› ä¸ºåœ¨PFGä¸Šä»»æ„ç‚¹çš„æŒ‡å‘é›†åˆä¿¡æ¯pt(n)ä¸€å®šå·²ç»ä¼ æ’­åˆ°äº†å…¶åŽç»§å…ƒç´ ï¼Œæ²¡æœ‰å¿…è¦åœ¨ä¼ æ’­ä¸€æ¬¡ã€‚åœ¨æ•´ä¸ªç®—æ³•ä¸­ä¸€å…±æœ‰ä¸¤å¤„æŸ¥åˆ†ä¼ æ’­ï¼Œåˆ†åˆ«æ˜¯åœ¨ðš«=pts-pt(n)è¯­å¥ä»¥åŠå¤„ç†Store/Loadè¯­å¥çš„ä»£ç ç‰‡æ®µforeach O_i âˆŠ ðš« doã€‚ é¦–å…ˆStore/Loadè¯­å¥æ˜ å°„åˆ°PFGä¸Šçš„æ“ä½œæ­£å¥½ç›¸åï¼š Storeï¼šx.f=y oi.f âŸµ y Load: y=x.f yâŸµ oi.f å…³é”®æ˜¯éœ€è¦çŸ¥é“æŒ‡é’ˆxæŒ‡å‘çš„æŠ½è±¡å¯¹è±¡o_iç„¶åŽç»§ç»­æ“ä½œã€‚è€Œforeach o_iâˆŠðš« doæ­£å¥½æ¸…é™¤æŽ‰æŒ‡é’ˆxä»¥å‰çš„æŒ‡å‘ä¿¡æ¯è€Œä¿ç•™äº†è¿™æ¬¡è¿­ä»£ä¸­æ–°åŠ å…¥çš„æŠ½è±¡å¯¹è±¡ã€‚ å°±Store/Loadè¯­å¥æœ¬èº«è€Œè¨€ä¹Ÿæ˜¯é€šè¿‡AddEdgeçš„æ–¹å¼æ¥æ›´æ–°PFGçš„ï¼Œä½†è¿™é‡Œè¦æ³¨æ„çš„æ˜¯å› ä¸ºæœ‰å¯èƒ½ä¸¤ä¸ªå˜é‡ä¼šæŒ‡å‘ç›¸åŒçš„æŠ½è±¡å¯¹è±¡oiï¼Œå³è™½ç„¶oiå¯¹äºŽxæ¥è¯´æ˜¯æ–°åŠ å…¥çš„æŒ‡å‘ä¿¡æ¯ï¼Œä½†æ˜¯æœ‰å¯èƒ½åœ¨å‰å‡ æ¬¡è¿­ä»£ä¸­æœ‰z.f=yä¸­çš„æŒ‡é’ˆzä¹ŸæŒ‡å‘æŠ½è±¡å¯¹è±¡oiï¼Œå³å› ä¸ºæŒ‡é’ˆoi.fä¸­oiæ˜¯ä¸€ä¸ªå¯¹è±¡â€”â€”æœ‰å¯èƒ½ä¼šè¢«å¤šä¸ªæŒ‡é’ˆæŒ‡å‘ï¼Œå› æ­¤è¿™é‡Œçš„AddEdgeæ“ä½œä¸èƒ½ä¿è¯ä¸€å®šä¼šå¼•å…¥æ–°çš„PFGè¾¹ã€‚ Fixed Point ç®—æ³•ç¬¦åˆä¸åŠ¨ç‚¹åŽŸç†â€”â€”WLçš„åŠŸèƒ½å°±æ˜¯å‘ptä¸­æ·»åŠ ä¿¡æ¯ï¼Œè€Œæ ¸å¿ƒpt(n) â‹ƒ =ptsä¹‹åŽå¦‚æžœç›´æŽ¥æ£€æŸ¥åˆå¹¶å‰åŽpté›†åˆæ˜¯å¦æœ‰å˜åŒ–ä¹Ÿä»¥åˆ¤æ–­è¾¾åˆ°ä¸åŠ¨ç‚¹ã€‚ How To Deal With Method Calls å…¨ç¨‹åºçš„æŒ‡é’ˆåˆ†æžç®—æ³•è¿˜éœ€è¦å¤„ç†æ–¹æ³•è°ƒç”¨ã€‚å’Œæ‰€æœ‰è¿‡ç¨‹é—´åˆ†æžä¸€æ ·ï¼ŒInter-procedural pointer analysisä¹Ÿéœ€è¦å»ºç«‹call graphã€‚ä¸è¿‡ç›¸æ¯”äºŽCHA analysisä»…ä»…é€šè¿‡receiver objectçš„å£°æ˜Žç±»åž‹æ¥æž„å»ºè°ƒç”¨å›¾ä¸åŒï¼ŒæŒ‡é’ˆåˆ†æžè¿˜ä½¿ç”¨æŒ‡å‘ä¿¡æ¯points-to relationsæ¥ä½¿å¾—call graphçš„æž„å»ºæ›´åŠ ç²¾ç¡®ã€‚æ¯”å¦‚void foo(A a) {... b = a.bar();...}ä¸­points-to relationså’ŒCall Graphéƒ½æ˜¯åœ¨æŒ‡é’ˆåˆ†æžçš„è¿‡ç¨‹ä¸­åŠ¨æ€æ›´æ–°çš„ï¼Œæ¯”å¦‚æƒ³è¦å»ºç«‹pt(a)éœ€è¦çŸ¥é“å‡½æ•°fooçš„è°ƒç”¨è¾¹ï¼Œè€Œå¦‚æžœæƒ³è¦ç»™a.bar()å»ºç«‹è°ƒç”¨è¾¹åˆ™ä¹Ÿéœ€è¦pt(a)ï¼Œè¿™ç§æ–¹æ³•è¢«ç§°ä¸ºon-the-fly call graph constructionã€‚ CHA: åŸºäºŽaå£°æ˜Žç±»åž‹è§£æžcall targets pointer analysis: åŸºäºŽpt(a)è§£æžcall targets Rule: Call é¦–å…ˆå¼•å…¥æŒ‡é’ˆåˆ†æžå¤„ç†æ–¹æ³•è°ƒç”¨Rulesçš„å½¢å¼åŒ–æè¿°ï¼š æŒ‡é’ˆåˆ†æžå™¨åœ¨é‡åˆ°äº†r = x.k(a1, ...)è°ƒç”¨è¯­å¥çš„æ—¶å€™ï¼Œè‚¯å®šä¼šæ¨¡æ‹Ÿç¼–è¯‘å™¨çš„è¿è¡Œæ—¶è¡Œä¸ºå¹¶è§£æžï¼š oiâˆŠpt(x),m=Dispatch(oi,k) âŸ¶ oiâˆŠpt(mthis)ï¼Œå…¶ä¸­xæ˜¯callerå˜é‡ ouâˆŠpt(aj) âŸ¶ ouâˆŠpt(mpj)ï¼Œå…¶ä¸­ajæ˜¯å½¢å‚ ovâˆŠpt(mret)âŸ¶ovâˆŠpt(mr)ï¼Œå…¶ä¸­mretæ˜¯è¿”å›žå€¼ ä¸ºäº†è§£é‡Šçš„æ›´æ¸…æ¥šï¼Œä¸‹é¢å¯¹è§„åˆ™è¿›è¡Œäº†è¿›ä¸€æ­¥çš„è§£é‡Šï¼š æ ¹æ®pt(x)å¾—åˆ°è¢«è°ƒç”¨æ–¹æ³•kçš„receiver objectå³oiï¼Œç„¶åŽè°ƒç”¨Dispatch(O_i, k)è§£æžå‡ºtarget methodå³m å°†ç›®æ ‡å‡½æ•°mçš„thisæŒ‡é’ˆæŒ‡å‘å˜é‡xæŒ‡å‘çš„å¯¹è±¡é›†åˆpt(x)å³oi å°†å½¢å‚m_pjçš„æŒ‡é’ˆæŒ‡å‘å®žå‚å˜é‡æŒ‡å‘çš„å¯¹è±¡é›†åˆpt(aj)ï¼Œå¹¶å°†å½¢å‚å˜é‡å’Œå¯¹åº”å®žå‚å˜é‡ä¹‹é—´åŠ ä¸ŠPFGè¾¹(a1âŸ¶m_pj) å°†è°ƒç”¨è¯­å¥çš„LHSæŒ‡å‘ç›®æ ‡å‡½æ•°mçš„è¿”å›žå€¼å˜é‡æŒ‡å‘çš„å¯¹è±¡ç»“å©šm_retï¼Œå¹¶å°†è¿™ä¸¤ä¸ªå˜é‡ä¹‹é—´åŠ ä¸ŠPFGçš„è¾¹(râŸµmret) ä¸»è¦éœ€è¦å…³æ³¨çš„æ˜¯receiver objectï¼Œtarget methodï¼Œargumentså’Œreturn valueã€‚ è€Œè¿™é‡Œå¯¹å½¢å‚å’Œå®žå‚ä¹‹é—´ï¼Œè¿”å›žå€¼å’Œå·¦å€¼ä¹‹é—´è¿žä¸ŠPFGçš„è¾¹è€Œæ²¡æœ‰ç»™ç›®æ ‡æ–¹æ³•å’Œè°ƒç”¨è€…ä¹‹é—´åŠ è¾¹çš„åŽŸå› æ˜¯å› ä¸ºcallerå˜é‡xæœ‰å¯èƒ½æœ‰å¤šä¸ªæŒ‡å‘å¯¹è±¡pt(x)ï¼Œè€Œå¯¹äºŽDispatchå‡½æ•°æ¥è¯´ï¼Œåªè¦receiver objectç¡®å®šé‚£target methodä¹Ÿæ˜¯ç¡®å®šçš„ã€‚å¦‚æžœæˆ‘ä»¬éœ€è¦ä¿è¯OOPè¯­è¨€ä¸­æ‰€æœ‰å‡½æ•°çš„thisæŒ‡é’ˆéƒ½æŒ‡å‘å”¯ä¸€æ­£ç¡®çš„receiver objectå³oiï¼Œå‰æå°±æ˜¯ä¿è¯ä¸èƒ½è®©å…¶ä»–è™šå‡çš„pt(x)ä¿¡æ¯ç›´æŽ¥æµå…¥thisæŒ‡é’ˆâ€”â€”å¦‚æžœè´¸ç„¶ç»™xå’Œç›®æ ‡æ–¹æ³•çš„thisæŒ‡é’ˆä¹‹é—´åŠ ä¸ŠPFGåªä¼šå¯¼è‡´å¼•å…¥è™šå‡spuriousä¿¡æ¯ã€‚ Algorithm åœ¨è¿‡ç¨‹é—´æŒ‡é’ˆåˆ†æžä¸­ï¼Œè°ƒç”¨å›¾çš„æž„å»ºå’ŒæŒ‡å‘å…³ç³»çš„æž„å»ºéƒ½æ˜¯åŒæ­¥åŠ¨æ€æ›´æ–°çš„ï¼Œå¼•å…¥reachableå¯è¾¾çš„æ¦‚å¿µï¼šå³ä»Žmainå‡½æ•°å¼€å§‹ï¼Œå°†çœŸæ­£è°ƒç”¨åˆ°çš„å‡½æ•°ä¾æ¬¡çº³å…¥å¯è¾¾æ–¹æ³•é›†åˆä¸­ï¼Œæ‰€æœ‰çš„åˆ†æžåªä»Žè¿™äº›é›†åˆä¸­å®Œæˆã€‚é¦–å…ˆä»‹ç»ç®—æ³•ä¸­ä½¿ç”¨åˆ°çš„æ•°æ®ç»“æž„ï¼š S: å¯è¾¾è¯­å¥reachable statementsçš„é›†åˆ S_m: å‡½æ•°mä¸­çš„è¯­å¥é›†åˆ RM: å¯è¾¾å‡½æ•°é›†åˆ CG: è°ƒç”¨è¾¹Call Graphé›†åˆ 12345678910111213141516171819202122232425262728293031323334353637383940&gt; Solve(m_entry) &#123;&gt; WL = &#123;&#125;, PFG = &#123;&#125;, RM = &#123;&#125;, CG = &#123;&#125;&gt; AddReachable(m_entry)&gt; while(WL is not empty) &#123;&gt; remove &lt;n, pts&gt; from WL&gt; ðš« = pts - pt(n)&gt; Propagate(n, ðš«)&gt; if n represents a variable x &#123;&gt; foreach o_iâˆŠðš« do&gt; foreach x.f=yâˆŠS do&gt; AddEdge(y, o_i.f)&gt; foreach y=x.fâˆŠS do&gt; AddEdge(o_i.f, y)&gt; ProcessCall(x, o_i)&gt; &#125;&gt; &#125;&gt; &#125;&gt; &gt; AddReachable(m) &#123;&gt; if mâˆ‰RM then&gt; add m to RM&gt; S â‹ƒ= S_m&gt; foreach i:x=new T()âˆŠS_m do&gt; add &lt;x, &#123;o_i&#125;&gt; toWL&gt; foreach x=yâˆŠS_m do&gt; AddEdge(y, x)&gt; &#125;&gt; &gt; ProcessCall(x, o_i) &#123;&gt; foreach l:r=x.k(a1,...an)âˆŠS do&gt; m = Dispatch(o_i,k)&gt; add &lt;m_this,&#123;o_i&#125;&gt; to WL&gt; if lâŸ¶mâˆ‰CG then&gt; add lâŸ¶m to CG&gt; AddReachable(m)&gt; foreach parameter p_i of m do&gt; AddEdge(a_i, p_i)&gt; AddEdge(m_ret, r)&gt; &#125;&gt; AddReachable è¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½å°±æ˜¯å°†è¢«è°ƒç”¨çš„æ–¹æ³•åŠ å…¥RMï¼Œå¹¶å°†å¯¹åº”çš„è¯­å¥åŠ å…¥åˆ°Sä¸­ã€‚AddReachableå‡½æ•°åœ¨æ•´ä¸ªç®—æ³•ä¸€å…±ä¸¤ä¸ªåœ°æ–¹è¢«è°ƒç”¨â€”â€”ä¸€ä¸ªæ˜¯åˆå§‹åŒ–å°†mainå‡½æ•°é¦–å…ˆåŠ å…¥ï¼Œå…¶æ¬¡å°±æ˜¯åœ¨æ¯ä¸€æ¬¡æœ‰æ–°çš„Call Graph edgeè¢«åˆ›å»ºçš„æ—¶å€™ã€‚å‡½æ•°æœ¬èº«è¿˜éœ€è¦å¤„ç†å½“å‰Reachable Methodä¸­çš„New/Assignè¯­å¥ã€‚è¿™æ˜¯å› ä¸ºLoad/Store/Callè¯­å¥çš„åˆ†æžéƒ½æ˜¯æ ¹æ®æŒ‡å‘ä¿¡æ¯çš„å˜åŒ–ï¼ˆæ¯”å¦‚x.f=yå¦‚æžœxåˆæŒ‡å‘äº†ä¸€ä¸ªæ–°å¯¹è±¡ï¼‰æ¥æ›´æ–°å¤„ç†çš„ï¼Œä½†æ˜¯New/Assignä¸éœ€è¦ä»»ä½•ä¿¡æ¯å°±å¯ä»¥ç‹¬ç«‹å®Œæˆåˆ†æžã€‚è¿™ä¹Ÿæ˜¯Differentialçš„ç›®çš„ã€‚ ProcessCall]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>PL</tag>
        <tag>Software-Analysis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[NJUé™æ€ç¨‹åºåˆ†æž(2-CHA-Analysis)]]></title>
    <url>%2F2021%2F05%2F10%2FNJU%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%EF%BC%882-CHA-Analysis%EF%BC%89%2F</url>
    <content type="text"><![CDATA[Abstract æ ¹æ®safe-approximationï¼Œè¿‡ç¨‹å†…æ•°æ®æµåˆ†æžIntraproceduralå¯¹æ‰€æœ‰çš„å‡½æ•°è°ƒç”¨method callåšå‡ºè¿‡åº¦ä¿å®ˆçš„å‡è®¾â€”â€”å³æ‰€æœ‰åˆ†æžç»“æžœå¿…é¡»safeï¼Œè€Œæ ¹æ®Latticeç†è®ºè¿™ç§å¤„ç†ä¼šä½¿mustå’Œmayåˆ†æžéƒ½å˜çš„less preciseã€‚æ‰€ä»¥å¼•å…¥è¿‡ç¨‹é—´æ•°æ®æµåˆ†æžInterprocedural Analysisï¼Œé€šè¿‡Call Graphæ¥å®žçŽ°è¿‡ç¨‹é—´çš„æ•°æ®æµä¼ é€’ï¼Œä»Žè€Œè¿›ä¸€æ­¥æé«˜åˆ†æžçš„ç²¾åº¦ã€‚å› æ­¤å¦‚ä½•æž„é€ è¿™äº›call-graphå°±æ˜¯è¿‡ç¨‹é—´åˆ†æžçš„å…³é”®çŽ¯èŠ‚ã€‚ For Better precision, we need Interprocedural Analysisï¼špropagate data-flow information along interprocedural control-flow edges i.e., call and return edges Class hierarchy analysisæ˜¯ç”¨æ¥æž„é€ Call Graphçš„ä¸€ç§ç»å…¸æ–¹æ³•â€”â€”ä¹Ÿæ˜¯è¿‡ç¨‹é—´åˆ†æžçš„åŸºç¡€ã€‚ CHA ä»Žä¸‹é¢å¼€å§‹æˆ‘ä»¬å¼€å§‹ç ”ç©¶åŒ…å«å‡½æ•°è°ƒç”¨çš„ç¨‹åºâ€”â€”è°ƒç”¨å›¾åæ˜ äº†ç¨‹åºä¸­çš„è°ƒç”¨å…³ç³»calling relationshipsï¼Œç¡®åˆ‡çš„è¯´å°±æ˜¯ä¸€ç³»åˆ—ä»Žè°ƒç”¨ç‚¹call-sitesæŒ‡å‘ç›®æ ‡æ–¹æ³•calleesçš„è¾¹çš„é›†åˆï¼Œå¯ä»¥çœ‹å‡ºCall Graphæ˜¯æžå…¶é‡è¦çš„ç¨‹åºä¿¡æ¯ã€‚ å¦‚ä½•æž„é€ Call Graphï¼Ÿé‰´äºŽOOPLsè¯­è¨€æ˜¯ç›®å‰è½¯ä»¶é¢†åŸŸç»å¯¹çš„é¢†å¯¼è€…ï¼Œå› æ­¤æœ¬èŠ‚è¯¾ä¹Ÿä¸»è¦é’ˆå¯¹Javaæ¥æž„é€ è°ƒç”¨å›¾ã€‚ä¸€å…±æœ‰å››ç§æž„é€ ç®—æ³•: Class hierarchy analysis(CHA) Rapid type analysis(RTA) Variable type analysis(VTA) Pointer analysis(k-CFA) å®ƒä»¬çš„åˆ†æžç²¾åº¦ä»Žä¸Šåˆ°ä¸‹è¶Šæ¥è¶Šå‡†ç¡®ï¼Œè€Œåˆ†æžæ—¶é—´ä¹Ÿç›¸åº”çš„è¶Šæ¥è¶Šé•¿ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»ç¬¬ä¸€ç§CHAã€‚ Methods Calls(invocations) in Java Static call Special call Virtual call Instruction Invokestatic Invokespecial Invokeinterface/invokevirtual Receiver objects â¨‰ âœ“ âœ“ Target methods Static methods constructors/private instance methods/superclass instance methods Other instance methods #Target methods 1 1 â‰¥1(polymorphism) Determinacy Compile-time Compile-time Run-time Javaçš„å‡½æ•°è°ƒç”¨ä¸»è¦åˆ†ä¸ºä¸‰ç§ç±»åž‹ã€‚å…¶ä¸­static callè°ƒç”¨é™æ€æ–¹æ³•å› æ­¤æ²¡æœ‰instanceå®žä¾‹ï¼Œè€Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸå°±å¯ä»¥è§£æžå‡ºå‡½æ•°åœ°å€ã€‚special callæœ‰ä¸‰ä¸ªç›®æ ‡å‡½æ•°â€”â€”æž„é€ å‡½æ•°ï¼Œç§æœ‰æˆå‘˜å‡½æ•°ä»¥åŠçˆ¶ç±»å‡½æ•°ï¼Œå› ä¸ºè¯¥è°ƒç”¨çš„receiver objectç±»åž‹ç¡®å®šæ‰€ä»¥ä¹Ÿå¯ä»¥å†ç¼–è¯‘æœŸç¡®å®šã€‚éš¾ç‚¹åœ¨äºŽè™šå‡½æ•°è°ƒç”¨ï¼Œæ‰€è°“è¿è¡Œæ—¶ç»‘å®šæŒ‡çš„æ˜¯åªæœ‰åœ¨è¿è¡Œæ—¶æ‰å¯ä»¥ç¡®å®šå…¶ç›®æ ‡å‡½æ•°ï¼ˆå¤šæ€ï¼‰ï¼Œå› æ­¤æž„é€ è°ƒç”¨å›¾çš„å…³é”®å°±åœ¨äºŽå¯¹è™šå‡½æ•°è°ƒç”¨å®Œæˆæž„å»ºã€‚ Method Dispatch ä¸€ä¸ªè™šå‡½æ•°è°ƒç”¨o1.foo(...)2åœ¨è¿è¡Œæ—¶æ ¹æ®ä¸¤ç‚¹è¢«è§£æžï¼š Receiver objectçš„ç±»åž‹ï¼Œå³å˜é‡oæŒ‡å‘çš„å¯¹è±¡ç±»åž‹ åœ¨call siteçš„å‡½æ•°ç­¾åï¼Œå³foo(...) å…³äºŽå¯¹è±¡ç±»åž‹ï¼Œæ˜¯å˜é‡æŒ‡å‘çš„å®žé™…ç±»åž‹â€”â€”æ¯”å¦‚A x = new B()å’ŒB x = new B()çš„receiver objecteç±»åž‹éƒ½æ˜¯Bã€‚å…³äºŽå‡½æ•°ç­¾åsignatrueçš„åŠŸèƒ½å°±æ˜¯èƒ½å”¯ä¸€ä»£è¡¨ä¸€ä¸ªå‡½æ•°ï¼š Signatrue = class type + method name + descriptor Descriptor = return type + parameter types æ¯”å¦‚class C{T foo(P p, Q q, R r){...}} ä¸­å‡½æ•°fooçš„å‡½æ•°ç­¾åå¯ä»¥å†™æˆC.foo(P, Q, R)ã€‚ æŽ¥ç€å¼•å…¥å‡½æ•°Dispatch(c, m)æ¥æ¨¡æ‹Ÿè¿è¡Œæ—¶å‡½æ•°è‡ªåŠ¨ç»‘å®šçš„è¿‡ç¨‹ï¼š å…¶ä¸­cæ˜¯receiver objectçš„ç±»åž‹ï¼Œè€Œmå°±æ˜¯call sitesçš„å‡½æ•°ç­¾åã€‚Dispatchå‡½æ•°åœ¨cä¸­å¯»æ‰¾å’Œå‡½æ•°ç­¾åmç›¸ç¬¦åˆçš„éžæŠ½è±¡å‡½æ•°non-abstract methodï¼Œå¦‚æžœæ²¡æœ‰æ‰¾åˆ°åˆ™åŽ»cçš„çˆ¶ç±»ä¸­ç»§ç»­æ‰¾ç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ï¼Œè¯¥å‡½æ•°æ˜¯CHAåˆ†æžçš„æ ¸å¿ƒã€‚ CHA CHAæ˜¯Jeffrey Deanåœ¨ECOOPä¸Šæå‡ºæ¥çš„ä¸€ç§ä¼˜åŒ–ç®—æ³•Optimization of Object-Oriented Programs Using Static Class Hierarchy Analysisã€‚ è¯¥ç®—æ³•å¯ä»¥æ ¹æ®receiver objectçš„å£°æ˜Žç±»åž‹ï¼ˆåŒºåˆ«äºŽå®žé™…ç±»åž‹ï¼‰æ¥è§£æžè™šå‡½æ•°è°ƒç”¨ã€‚å®ƒéœ€è¦æ•´ä¸ªç¨‹åºçš„ç»§æ‰¿é“¾ä½œä¸ºä¿¡æ¯åŸºç¡€ï¼Œæ¯”å¦‚A a = ...; a.foo()ä¸­è¯¥ç®—æ³•å‡è®¾å˜é‡aå¯ä»¥æŒ‡å‘class AåŠå…¶æ‰€æœ‰å­ç±»ï¼Œæ®æ­¤è§£æžå‡ºå¤šä¸ªå¯èƒ½çš„ç›®æ ‡æ–¹æ³•ã€‚ä¸‹é¢æ˜¯CHAçš„ç®—æ³•: 123456789101112131415&gt; Resolve(cs) &#123;&gt; T = &#123;&#125;&gt; m = method signature at cs&gt; if cs is a static call then&gt; T = &#123;m&#125;&gt; if cs is special call then&gt; c_m = class type of m&gt; T = &#123;Dispatch(c_m, m)&#125;&gt; if cs is a virtual call then&gt; c = declared type of receiver variable at cs&gt; foreach c' that is a subclass of c or c itself do&gt; add Dispatch(c', m) to T&gt; return T&gt; &#125;&gt; è¿™é‡Œå¯¹Javaçš„ä¸‰ç§è°ƒç”¨ç±»åž‹éƒ½åšäº†è§£æžï¼Œå‚æ•°csæ˜¯ç¨‹åºä¸­çš„è°ƒç”¨ç‚¹â€”â€”å³æ¯ä¸€ç§è°ƒç”¨å®žé™…å‘ç”Ÿçš„åœ°æ–¹ã€‚static callå¯ä»¥ç›´æŽ¥æ ¹æ®å‡½æ•°ç­¾åå¾—åˆ°ç›®æ ‡å‡½æ•°ï¼›å¯¹äºŽspecial callç”±äºŽè¿›è¡Œsuper-callè°ƒç”¨çš„æ—¶å€™éœ€è¦è¿›ä¸€æ­¥è§£æžçˆ¶ç±»ä¸­çš„å‡½æ•°ï¼ˆè¿˜ä¸èƒ½ä¿è¯çˆ¶ç±»ä¸€å®šå­˜åœ¨å‡½æ•°éœ€è¦è¿›ä¸€æ­¥ä¸Šå‡ï¼‰æ‰€ä»¥ä½¿ç”¨äº†Dispatchå‡½æ•°ã€‚ è™šå‡½æ•°è°ƒç”¨åªéœ€è¦æ‹¿åˆ°åœ¨call-siteå¤„receiver variableçš„å£°æ˜Žç±»åž‹ï¼Œç„¶åŽå¯¹è¯¥ç±»åž‹ä»¥åŠè¯¥ç±»åž‹çš„æ‰€æœ‰å­ç±»å¯¹è±¡åšDispatchè§£æžå³å¯ã€‚ è¯¥ç®—æ³•åªè€ƒè™‘è°ƒç”¨ç‚¹å¤„reveriver variableçš„ç±»åž‹å’Œå®ƒçš„ç»§æ‰¿é“¾è€Œå¿½ç•¥äº†å…¶ä»–æ•°æ®æµå’ŒæŽ§åˆ¶æµä¿¡æ¯ï¼Œå› æ­¤é€Ÿåº¦ä¸Šéžå¸¸å¿«ï¼Œä½†æ˜¯ç²¾åº¦ä¸€èˆ¬ã€‚æ•…å…¶ä¸»è¦åº”ç”¨å°±æ˜¯IDEçš„è¡¥å…¨ä¸Šï¼Œæ»¡è¶³é€Ÿåº¦å¿«è´´åˆéœ€æ±‚ä½†æ˜¯ç²¾åº¦ä¹Ÿä¿æŒåœ¨ä¸€ä¸ªå¾ˆå¥½çš„æŽ¥å—èŒƒå›´å†…ã€‚ Call Graph Construction åœ¨CHAåˆ†æžçš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡å‡ºæž„é€ è°ƒç”¨å›¾Call Graphçš„å®Œæ•´ç®—æ³•ï¼Œè¯¥ç®—æ³•åº”ç”¨BFSçš„æ€è·¯ä»Žentryå‡ºå‘å¯¹æ¯ä¸€ä¸ªmethodï¼Œè§£æžè¯¥å‡½æ•°åœ¨æ‰€æœ‰è°ƒç”¨ç‚¹csçš„ç›®æ ‡æ–¹æ³•Resolve(cs)ç›´åˆ°æ‰€æœ‰çš„methodéƒ½å®Œæˆè§£æžã€‚ 1234567891011121314&gt; BuildCallGraph(m_entry) &#123;&gt; WL = [m_entry], CG = &#123;&#125;, RM = &#123;&#125;&gt; while WL is not empty do&gt; remove m from WL&gt; if m âˆ‰ RM then&gt; add m to RM&gt; foreach call-site cs in th m do // Resolve target methods via CHA&gt; T = Resolve(cs)&gt; foreach traget method m' in T do&gt; add cs âŸ¶ m' to CG // Add call edges to call graph&gt; add m' to WL&gt; return CG&gt; &#125;&gt; å…¶ä¸­ï¼š WLåŒ…å«å³å°†è¢«è§£æžçš„method CGåŒ…å«æž„å»ºå‡ºæ¥çš„è°ƒç”¨è¾¹call-edgesé›†åˆ RMåŒ…å«å·²ç»è§£æžå®Œæˆçš„method Inter-procedural Control-Flow Graph æž„å»ºCall Graphçš„ç›®çš„å°±æ˜¯ä¸ºäº†è¿›ä¸€æ­¥æž„å»ºICFGï¼Œå¦‚æžœè¯´CFGè¡¨ç¤ºå•ä¸ªå‡½æ•°çš„ç»“æž„ï¼Œé‚£ICFGè¡¨ç¤ºçš„å°±æ˜¯æ•´ä¸ªç¨‹åºçš„ç»“æž„ã€‚æœ‰äº†ICFGæˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œè¿‡ç¨‹é—´åˆ†æžäº†ï¼ŒICFGä¸»è¦ç”±ä¸¤éƒ¨åˆ†æž„æˆ: ç¨‹åºä¸­æ‰€æœ‰å‡½æ•°çš„CFG ä¸¤ç§æ–°åŠ çš„edges Call edges: ä»Žcall-siteæŒ‡å‘calleesçš„entry Return edges: ä»Žcalleesçš„è¿”å›žè¯­å¥æŒ‡å‘return-site(ç´§è·Ÿç€call-siteçš„è¯­å¥) è€Œè¿™ä¸¤ç§æ–°åŠ çš„è¾¹ä¿¡æ¯å°±æ¥è‡ªäºŽCall Graphã€‚å¯¹äºŽæ•´ä¸ªç¨‹åºçš„ICFGï¼Œåªéœ€è¦å°†å‡½æ•°è°ƒç”¨è¯­å¥å•ç‹¬ä½œä¸ºä¸€ä¸ªBasic Blockå³å¯ï¼Œå…¶ä»–çš„ä¸å˜ã€‚ ä»Žä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®æµä»Žcall-siteæ²¿ç€call edgesæµå‘calleesï¼ŒæŽ¥ç€ä»Žcalleesçš„è¿”å›žè¯­å¥æµå‘return-siteã€‚è€Œcall-siteå’Œreturn-siteä¹‹é—´è¿˜æœ‰ä¸€æ¡è¾¹call-to-return edgeæ˜¯ä¸ºäº†ä¼ é€’æœ¬åœ°å‡½æ•°çš„æ•°æ®æµï¼Œä»¥å…è¿™äº›ä¿¡æ¯è·Ÿç€call graphç»•è¿œè·¯ã€‚ Inter-procedural Data-Flow Analysis åœ¨æž„å»ºå¥½ICFGä¹‹åŽï¼Œå°±å¯ä»¥è¿›è¡Œè¿‡ç¨‹é—´æ•°æ®æµåˆ†æžäº†ã€‚ è¿™é‡Œå¯¹æ¯”è¿‡ç¨‹å†…Intraproceduralå’ŒInterproceduralä¸¤ç§åˆ†æžï¼š Intraprocedural Interprocedural Program representation CFG ICFG = CFGs + call &amp; return edges Transfer functions Node transfer Node transfer + edge transfer å¯ä»¥çœ‹åˆ°è¿‡ç¨‹é—´åˆ†æžæ¯”è¿‡ç¨‹å†…åˆ†æžå¤šäº†ä¸€äº›edge analysisã€‚ä»Žç†è®ºä¸Šçœ‹è¿™äº›edge analysiså®Œæˆäº†å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­çš„è·¨å‡½æ•°æ•°æ®æµæ¯”å¦‚å‚æ•°ï¼Œè¿”å›žå€¼çš„ä¼ é€’ã€‚ Call edge transfer: ä¼ é€’å‚æ•°ï¼ˆä»Žcall-siteåˆ°entry of calleeï¼‰ Return edge transfer: ä¼ é€’è¿”å›žå€¼(ä»Žreturn ofcalleeåˆ°return-site) è€Œè¿‡ç¨‹é—´åˆ†æžå’Œè¿‡ç¨‹å†…åˆ†æžçš„Transfer Functionç›¸æ¯”ï¼Œå¤šäº†ä¸€æ¡è§„åˆ™ï¼š For each call node(call-site), kill data-flow value for the LHS variable. Its value will flow to return site along the return edges. å³è¦killæŽ‰è°ƒç”¨ç‚¹è¯­å¥çš„å·¦å€¼å˜é‡ã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>PL</tag>
        <tag>Software-Analysis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[NJUé™æ€ç¨‹åºåˆ†æž(1-Data Flow Analysis)]]></title>
    <url>%2F2021%2F05%2F04%2FNJU%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90-1-Data-Flow-Analysis%2F</url>
    <content type="text"><![CDATA[Abstract ç¼–è¯‘å™¨ä¸­å¤§éƒ¨åˆ†æœºå™¨æ— å…³çš„å…¨å±€ä¼˜åŒ–æ˜¯åŸºäºŽData-flow Analysiså®žçŽ°çš„ã€‚æ•°æ®æµåˆ†æžæŠ€æœ¯ä»Žä»£ç ä¸­æ”¶é›†ç¨‹åºè¯­ä¹‰ç›¸å…³çš„ä¿¡æ¯ï¼Œæ˜¯ç¨‹åºåˆ†æžçš„åŸºç¡€ã€‚ In each data-flow analysis application, we associate with every program point a data-flow value that represents an abstraction of the set of all possible program states that can be observed for that point. åœ¨å·¥ä¸šç•Œçš„ä¸»æµç¼–è¯‘å™¨ä¸­ï¼ŒCç³»çš„LLVMï¼ŒJavaç³»çš„HotSpotéƒ½æ˜¯åŸºäºŽSSAåšæ•°æ®æµåˆ†æžè€Œä¸æ˜¯ä¼ ç»Ÿçš„latticeã€‚å—å¤§è¿™èŠ‚è¯¾ä¸­æ˜¯åŸºäºŽLatticeæ¥è®²è§£è¿‡ç¨‹å†…Intra-proceduralï¼Œæ— åˆ«åno aliasesçš„ç»å…¸æ•°æ®æµåˆ†æžæ¡†æž¶ã€‚ Applications Overview CFG åˆ†æžæ¡†æž¶éƒ½æ˜¯å»ºç«‹åœ¨control-flow-graphä¸Šçš„ï¼Œè¿™æ˜¯ä¸€ç§IRâ€”â€”ç”±basic-blocksé€šè¿‡control-flowsè¿žæŽ¥è€Œæˆï¼Œå¯ä»¥åˆ†åˆ«çœ‹æˆæ˜¯CFGçš„nodeså’Œedgesã€‚ å¦‚ä½•é€šè¿‡æºç ï¼ˆå•ä¸ªå‡½æ•°ï¼‰ç”ŸæˆCFGè§è¯¾ä»¶ã€‚ Abstract æ•°æ®æµåˆ†æžç”¨æ¥æè¿°æ‰€è°“æ•°æ®å¦‚ä½•åœ¨CFGä¸­æµåŠ¨ã€‚è¿™é‡Œçš„dataæŒ‡çš„æ˜¯ç¨‹åºè¯­ä¹‰ä¿¡æ¯çš„ä¸€ç§abstractionï¼ŒCFGä¸­çš„nodeså’Œedgesåˆ†åˆ«æ˜ å°„transfer-functionå’Œcontrol-flow handlingã€‚æ‰€ä»¥æ•´ä¸ªåˆ†æžæ˜¯å»ºç«‹åœ¨ä¸€å¥—æˆç†Ÿçš„ç†è®ºæ¡†æž¶ä¹‹ä¸Šçš„ã€‚ data(application-specific): ä¸åŒçš„æ•°æ®æµåˆ†æžåº”ç”¨ä¼šæœ‰ä¸åŒçš„æŠ½è±¡å€¼valueï¼Œæ¯”å¦‚åˆ†æžå˜é‡æ•°å€¼æ—¶ï¼š+;-;0;UND;UNKNOW; domain: æŠ½è±¡æ•°æ®æµçš„å€¼åŸŸå³æ‰€æœ‰valueå®šä¹‰çš„é›†åˆ transfer-functions:ä¸åŒçš„ç¨‹åºä¼šæœ‰ä¸åŒçš„CFGè¡¨ç¤ºï¼Œè¿›ä¸€æ­¥éœ€è¦æ·±åˆ»CFGä¸­statementsï¼Œbasic-blocksåœ¨è¢«æ˜ å°„æˆtransfer-functionsæ—¶çš„åŒºåˆ«å’Œè”ç³» control-flows:æŽ§åˆ¶æµåŸºæœ¬ä¸Šåªæœ‰ä¸‰ä¸ªâ€”â€”é¡ºåºï¼Œæ±‡èšä»¥åŠåˆ†æµ safety analysis å¤§éƒ¨åˆ†çš„åˆ†æžæ¡†æž¶è¦æ±‚åˆ†æžç»“æžœæ˜¯Soundçš„å³over-approximationã€‚è€Œå®žé™…ä¸Šå¹¶éžæ‰€æœ‰å¦‚æ­¤â€”â€”è¿™é‡Œæ­£å¼å°†æ‰€æœ‰åˆ†æžåˆ†æˆä¸¤ç±»ï¼šmay analysiså’Œmust analysisã€‚ may analysis: è¦æ±‚åˆ†æžç»“æžœä¸­å¿…é¡»å…¨éƒ¨åŒ…å«æ‰€æœ‰æ­£ç¡®ç­”æ¡ˆï¼Œæ¢ä¸ªè§’åº¦ç†è§£å°±æ˜¯ä¸æ”¾è¿‡ä»»ä½•ä¸€ä¸ªåŠ¨æ€è¿è¡Œæ—¶çš„å¯èƒ½å‡ºé”™çš„è¡Œä¸ºâ€”â€”ä¸€æ—¦å‘çŽ°å°±è¦æŠ¥é”™ï¼Œå³overçš„æ¦‚å¿µ must analysis: è¦æ±‚åˆ†æžç»“æžœä¸€å®šæ˜¯æ­£ç¡®çš„ï¼Œå³ä¸èƒ½æœ‰è¯¯æŠ¥ï¼Œå³underçš„æ¦‚å¿µ è€Œoverå’Œunderåœ¨ä¸åŒçš„åº”ç”¨ä¸­éƒ½ä»£è¡¨äº†å„è‡ªæœ€safeçš„ç»“æžœï¼Œå› æ­¤æ‰€æœ‰çš„é™æ€ç¨‹åºåˆ†æžå¯ä»¥æ€»ç»“æˆï¼šabstractionå’Œsafe-approximationä¸¤ä¸ªé˜¶æ®µï¼Œä¸åŒçš„æ•°æ®æµåˆ†æžæœ‰ä¸åŒçš„abstractionå’Œsafe-approximation strategieså³ä¸åŒçš„transfer-functionså’Œcontrol-flow handlingsã€‚ Preliminaries Input and Output States æ‰€æœ‰çš„æ“ä½œå¯¹è±¡éƒ½æ˜¯åœ¨ä¸€ä¸ªCFGä¸­ã€‚ statements æ˜¯CFGä¸­çš„æ‰§è¡Œçš„æœ€å°å•ä½â€”â€”æ¯ä¸€æ¡statementsçš„æ‰§è¡Œéƒ½ä¼šæ”¹å˜ç¨‹åºçš„çŠ¶æ€ã€‚ æ¯ä¸€ä¸ªstatementså‰åŽéƒ½æœ‰è‡ªå·±çš„program pointåˆ†åˆ«ä»£è¡¨input/output stateï¼Œè®°ä½œIN[S_i]/OUT[S_i]ã€‚åˆå› ä¸ºä¸€ä¸ªbasic-blocksä¸­çš„æ‰€æœ‰statementså¯ä»¥ç»“åˆåœ¨ä¸€èµ·ï¼ˆå› ä¸ºBBå†…éƒ¨åªèƒ½é¡ºåºæ‰§è¡Œï¼‰æ•…æ¯ä¸ªbasic-blockså¼€å§‹å’Œç»“æŸä¹Ÿæœ‰è‡ªå·±çš„program pointï¼Œè®°ä½œIN[B_i]/OUT[B_i]ã€‚ control flowè¡¨ç¤ºäº†å„ä¸ªbasic-blocksçš„æ‰§è¡Œé¡ºåºå…³ç³»ã€‚åˆ†ä¸ºä¸‰ç§ï¼šé¡ºåºï¼Œæ±‡èšå’Œåˆ†æµ é¡ºåºï¼šIN[s2] = OUT[s1] æ±‡èš: IN[s2] = OUT[s1] ^ OUT[s3] æ“ä½œç¬¦^æŒ‡çš„æ˜¯meet operatorï¼Œä¸åŒçš„ç®—æ³•æœ‰ä¸åŒæ“ä½œæ¯”å¦‚å¹¶é›†ï¼Œäº¤é›†ç­‰ åˆ†æµ: IN[s2] = IN[s3] = OUT[s1] éœ€è¦å…³æ³¨çš„æ˜¯æ¯ä¸ªBBæˆ–è€…Statementçš„program pointï¼Œæ•°æ®æµåˆ†æžä¼šç»™æ¯ä¸ªprogram pointä¸€ä¸ªdata-flow valueæ¥æŠ½è±¡å‡ºå½“å‰ä½ç½®ç¨‹åºçš„éƒ¨åˆ†è¯­ä¹‰ä¿¡æ¯ï¼Œå†è¿›ä¸€æ­¥åˆ©ç”¨å„ç§safe-approximation-directed constraintsä»¥è¾¾åˆ°åˆ†æžç›®çš„ï¼Œè¿™é‡Œçš„constraintså…·ä½“æŒ‡çš„æ˜¯ä¸åŒçš„transfer functionså’Œcontrol flow handlingsã€‚ Notations for Transfer Functions' Constraints Forward Analysisï¼š OUT[s] = F_s(IN[s]),å…¶ä¸­F_så°±æ˜¯é’ˆå¯¹å…·ä½“è¾“å…¥çš„Transfer Functionï¼Œå‰å‘åˆ†æžæ˜¯ä»Žè¾“å…¥æŽ¨å¯¼è¾“å‡º Backward Analysisï¼šIN[s] = F_s(OUT[s]),åŽå‘åˆ†æžæ˜¯ä»Žè¾“å‡ºæŽ¨å¯¼è¾“å…¥ Notations for Control Flows' Constraints control flow within a BB åœ¨ä¸€ä¸ªBBå†…éƒ¨ï¼ŒIN[S_(i+1)] = OUT[S_(i)], for all i = 1, 2,...n-1â€”â€”è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œä¸€ä¸ªBBä¸­çš„statementsåªèƒ½é¡ºåºæ‰§è¡Œæ•…åªä¼šæœ‰ä¸€ä¸ªè¾“å…¥è¾“å‡ºã€‚ control flow among BBs å¯¹äºŽä¸€ä¸ªbasic blockæ¥è¯´ï¼šIN[B] = IN[S_1]; OUT[B] = OUT[S_n]ã€‚ è€ŒBBä¹‹é—´çš„æ‰§è¡Œä¸ä»…ä»…æ˜¯é¡ºåºå…³ç³»ã€‚è¿˜æœ‰æ±‡èšå’Œåˆ†æµçš„æ‰§è¡Œé¡ºåºã€‚ é¦–å…ˆæ˜¯æ±‡èšï¼šOUT[B] = F_b(IN[B])ï¼Œå…¶ä¸­F_b = F_sn * ...* F_s2 * F_s1ä¹Ÿå°±æ˜¯ä¸€ä¸ªBBçš„çš„Transfer Functionç”±å†…éƒ¨statementså„è‡ªçš„transfer functionç»„æˆï¼ŒIN[B] = ^ OUT[P]ï¼Œè¡¨ç¤ºæ‰€æœ‰æ±‡èšçš„è¾“å‡ºçš„å¹¶é›†éƒ½æˆä¸ºä¸‹ä¸€ä¸ªçš„è¾“å…¥ï¼Œè¿™é‡Œçš„^å°±æ˜¯è¡¨ç¤ºå¹¶é›†çš„meet operatorè€ŒPè¡¨ç¤ºBçš„æ‰€æœ‰å‰é©±basic blocksã€‚ å…¶æ¬¡æ˜¯åˆ†æµï¼šIN[B] = F_b(OUT[B]);OUT[B] = ^IN[S]è¿™é‡Œè¡¨ç¤ºBçš„è¾“å‡ºéƒ½æˆä¸ºæ‰€æœ‰Sçš„è¾“å…¥ï¼ŒSæ˜¯Bçš„æ‰€æœ‰åŽç»§ã€‚ æœ‰äº†å‰é¢çš„åŸºç¡€ï¼Œä¸‹é¢å…ˆä»‹ç»ä¸‰ç§ç»å…¸çš„æ•°æ®æµåˆ†æžç®—æ³•ï¼š Reaching Definitions Analysis å®šä¹‰ A definition d at program point p reaches a point q if there is a path from p to q such that d is not &quot;killed&quot; along that path.(A definition of a variable is a statement that assigns a value to v). é¦–å…ˆdefinition-å®šä¹‰æŒ‡çš„æ˜¯å¯¹å˜é‡vè¿›è¡Œèµ‹å€¼çš„è¯­å¥ã€‚ä¸€èˆ¬æ¥è®²å®šä¹‰éƒ½æ˜¯ä»Žä¸€ä¸ªprogram pointä¸Šå®Œæˆçš„ã€‚ åœ¨pç‚¹ä¸Šçš„ï¼Œä¸€ä¸ªå¯¹å˜é‡vçš„definitionèƒ½reachåˆ°æŸä¸€ä¸ªæ–°çš„ç‚¹qï¼Œå–å†³äºŽåœ¨æŽ§åˆ¶æµä¸Šæ˜¯å¦å­˜åœ¨ä¸€æ¡ä»Žpåˆ°qçš„è·¯å¾„ï¼ŒåŒæ—¶åœ¨è¿™æ¡è·¯å¾„ä¸Šè¯¥å˜é‡vä¸ä¼šè¢«é‡æ–°å®šä¹‰ï¼Œå°±è¯´æ˜¯è¿™ä¸ªdefinitionå¯ä»¥reachåˆ°qç‚¹ã€‚ åˆ†æžç±»åž‹ ä»Žå®šä¹‰çš„there iså¯ä»¥çœ‹å‡ºï¼Œè¿™æ˜¯ä¸€ä¸ªmay analysisâ€”â€”å³æŽ§åˆ¶æµä¸Šä»Žpåˆ°qçš„æ‰€æœ‰è·¯å¾„è€Œè¨€ï¼Œåªéœ€è¦æœ‰ä¸€æ¡è·¯å¾„æ²¡æœ‰è¢«é‡æ–°å®šä¹‰ï¼Œé‚£è¿™ä¸¤ä¸ªprogram pointä¹‹é—´å°±æ˜¯Reachedçš„ã€‚å¹¶ä¸”è¿˜çŸ¥é“è¿™æ˜¯ä¸€ä¸ªforward analysisâ€”â€”å› ä¸ºæ˜¯å‰é¢çš„program pointä¸Šçš„definitionå¯ä»¥reachåˆ°åŽé¢çš„program pointã€‚ åº”ç”¨ è¯¥åˆ†æžå¯ä»¥ç”¨æ¥æ£€æŸ¥æœªå®šä¹‰çš„å˜é‡ã€‚å¯¹äºŽæ‰€æœ‰éœ€è¦æ£€æµ‹çš„å˜é‡ï¼Œåœ¨CFGçš„entryå…¥å£å¤„éƒ½èµ‹å€¼ä¸ºdummy definitionâ€”â€”å®žé™…ä¸Šå°±æ˜¯ä¸€ä¸ªundefinedçš„æ ‡ç­¾ï¼Œå¦‚æžœå˜é‡vçš„å¯ä»¥åˆ°è¾¾æŸä¸€ä¸ªä½¿ç”¨ç‚¹ï¼Œé‚£è¿™ä¸ªå˜é‡å°±æœ‰å¯èƒ½æ˜¯æœªå®šä¹‰å‰ä½¿ç”¨ã€‚ ç»†èŠ‚ Data Flow Values/Fact é¦–å…ˆæ•°æ®æµåˆ†æžéœ€è¦å¯¹åˆ†æžçš„å¯¹è±¡è¿›è¡ŒæŠ½è±¡ï¼Œè¿™é‡Œä½¿ç”¨BitVectoræ¥è¡¨ç¤ºä¸€ä¸ªCFGï¼ˆå³ä¸€æ®µè¿‡ç¨‹å†…ç¨‹åºä¸­ï¼‰ä¸Šæ‰€æœ‰å˜é‡çš„definitionã€‚ï¼ˆæ³¨æ„å…³æ³¨å¯¹è±¡definitionä¸æ˜¯å˜é‡æœ¬èº«ï¼Œè€Œæ˜¯å®šä¹‰è¿™ä¸ªå˜é‡çš„æ‰€æœ‰program pointã€‚ï¼‰ Transfer Function æ ¹æ®INæ±‚å‡ºæ¯ä¸€ä¸ªstatemetns/basic blocksçš„OUTçš„ã€‚ç”±è¯¥åˆ†æžçš„ç›®çš„å¯ä»¥å¾—å‡ºï¼šOUT[B] = gen_B âˆª (IN[B] - kill_B)ï¼Œå³å¯¹äºŽæ¯ä¸€ä¸ªprogram pointæ¥è¯´ï¼Œå…¶OUTå°±æ˜¯åœ¨è¯¥ç‚¹å¤„æ–°å¢žåŠ çš„å¯¹å˜é‡çš„definitionsé™¤æŽ‰åˆ«å¤„è¿™äº›å˜é‡çš„definitionsã€‚ Control Flow æ ¹æ®ä¸Šä¸€ä¸ªstatements/basic blocksçš„OUTæ±‚å‡ºä¸‹ä¸€ä¸ªçš„INã€‚å› ä¸ºä½œä¸ºmayåˆ†æžï¼Œå…¶ä¸æ”¾è¿‡ä»»ä½•ä¸€ä¸ªè¿è¡Œæ—¶çš„è¡Œä¸ºï¼Œæ‰€ä»¥é’ˆå¯¹æ‰€æœ‰ç•™åˆ°è¯¥INçš„OUTéƒ½è¦æŽ¥æ”¶ã€‚å³IN[B] = âˆª_p(pæ˜¯Bæ‰€æœ‰çš„å‰é©±ç»“ç‚¹)OUT[P]ã€‚ ç®—æ³• 1234567891011121314&gt; /*&gt; INPUT: CFG(kill_B and gen_B computed for each basic blocks B)&gt; OUTOUT: IN[B] and OUT[B] for each basic block B&gt; */&gt; OUT[entry] = nullptr;&gt; for (each basic block B\entry)&gt; OUT[B] = nullptr;&gt; &gt; while(changes to ant OUT occur) &gt; for(each basic blocks B\entry) &#123;&gt; IN[B] = âˆª_OUT[P];&gt; OUT[B] = gen_B âˆª (IN[B] - kill_B); &gt; &#125;&gt; è¿™æ˜¯éžå¸¸å…¸åž‹çš„ä¸åŠ¨ç‚¹ç®—æ³•ï¼Œå¦‚æžœæˆ‘ä»¬ç®€åŒ–æ¨¡åž‹ä»…ä»…åªæ˜¯å…³æ³¨æ¯ä¸€ä¸ªbasic blocksçš„INå’ŒOUT,ä¼šå‘çŽ°å¯¹äºŽæœ‰é™çš„definitioné›†åˆï¼Œåœ¨ç»è¿‡å¤šæ¬¡è¿­ä»£ä¹‹åŽï¼Œæ­£å‘çš„å¢žåŠ gen/survivorsä¸€å®šä¼šå¯¼è‡´OUTè¾¾åˆ°ä¸€ä¸ªå®šå€¼ã€‚ Live Variables Analysis å®šä¹‰ Live variables analysis tells whether the value of variable v at program point p could be used along some path in CFG starting at p. If so, v is live at p; otherwise, v is dead at p. åˆ†æžå˜é‡våœ¨ä¸€ä¸ªprogram point-pä¸Šæ˜¯å¦æ˜¯æ´»è·ƒçš„ï¼Œå–å†³äºŽæ˜¯å¦å­˜åœ¨ä¸€æ¡ä»Žpç‚¹å¼€å§‹ä¸€ç›´åˆ°ç¨‹åºæ‰§è¡Œç»“æŸçš„è·¯å¾„ï¼Œè¯¥è·¯å¾„ä¸­æœ‰ä½¿ç”¨è¿‡vçš„åœ°æ–¹ï¼Œå¹¶ä¸”ä»Žpç‚¹åˆ°ä½¿ç”¨ç‚¹æœŸé—´vä¸å¯ä»¥è¢«é‡æ–°å®šä¹‰â€”â€”åˆ™è¯´æ˜Žè¯¥å˜é‡våœ¨pç‚¹æ˜¯æ´»è·ƒçš„ã€‚ åˆ†æžç±»åž‹ æ ¹æ®å®šä¹‰å¯ä»¥çŸ¥é“è¿™æ˜¯ä¸€ä¸ªmayåˆ†æžï¼Œè¯¥å˜é‡åªè¦æœ‰ä½¿ç”¨ç‚¹åˆ™åˆ†æžç»“æžœå°±æ˜¯æ´»è·ƒçš„ã€‚åˆå› ä¸ºåˆ†æžçš„è¿‡ç¨‹æ˜¯ä»ŽåŽå¾€å‰çš„æ•…è¯¥åˆ†æžä¹Ÿæ˜¯ä¸€ä¸ªbackward analysisã€‚ åº”ç”¨ è¯¥åˆ†æžå¯ä»¥ç”¨æ¥å®Œæˆå¯„å­˜å™¨åˆ†é…ã€‚æ¯”å¦‚åœ¨æ‰§è¡Œåˆ°ç¨‹åºçš„æŸä¸€ç‚¹éœ€è¦å°†æ“ä½œæ•°åŠ è½½åˆ°å…¶ä¸­ä¸€ä¸ªå¯„å­˜å™¨ä¸­â€”â€”è€Œè¿™æ—¶å€™æ‰€æœ‰çš„registerséƒ½æ»¡äº†ã€‚å¦‚ä½•é€‰æ‹©åˆé€‚çš„å¯„å­˜å™¨å‘¢ï¼Ÿå¦‚æžœé€‰æ‹©çš„æ˜¯ä¸€ä¸ªdeadä¸æ´»è·ƒçš„å¯„å­˜å™¨å€¼ï¼ˆæœªæ¥ä¸ä¼šè¢«ç”¨åˆ°ï¼‰ï¼Œé‚£å°±å¯ä»¥ç›´æŽ¥æ›¿æ¢æŽ‰ã€‚è€Œå¦‚æžœè¿™ä¸ªå¯„å­˜å™¨ä¸­çš„å˜é‡å€¼æ˜¯æ´»è·ƒçš„ï¼Œé‚£åŽé¢å†æ¬¡ä½¿ç”¨åˆ°çš„æ—¶å€™å°±éœ€è¦æŠŠå®ƒå†æ¬¡ä»Žå†…å­˜è¯»åˆ°å¯„å­˜å™¨ï¼Œæµªè´¹äº†èµ„æºã€‚ ç»†èŠ‚ Data Flow Value/Fact è¯¥åˆ†æžå…³æ³¨çš„å¯¹è±¡ï¼Œå°±æ˜¯å˜é‡æœ¬èº«ï¼Œä½¿ç”¨BitVectorè¡¨ç¤ºã€‚ Transfer Function IN[B] = use_B âˆª (OUT[B] - def_B)ã€‚è¿™é‡Œçš„use_BæŒ‡çš„æ˜¯æ‰€æœ‰åœ¨é‡æ–°å®šä¹‰ä¹‹å‰å˜é‡çš„ä½¿ç”¨ç‚¹ï¼Œé€šè¿‡backwardçš„æ€è·¯æ¥åˆ†æžï¼Œå¯¹äºŽä¸€ä¸ªbasic blockï¼Œç»™å‡ºå…¶OUTæ¥å¾—åˆ°å…¶INéœ€è¦å…³æ³¨åœ¨BBä¸­å˜é‡æ˜¯å¦æ˜¯æ»¡è¶³æ´»è·ƒçš„å‰æè¦æ±‚çš„ã€‚ Control Flow å› ä¸ºä½œä¸ºmayåˆ†æžï¼Œå…¶ä¸æ”¾è¿‡ä»»ä½•ä¸€ä¸ªè¿è¡Œæ—¶çš„è¡Œä¸ºï¼Œæ‰€ä»¥é’ˆå¯¹æ‰€æœ‰ç•™åˆ°è¯¥INçš„OUTéƒ½è¦æŽ¥æ”¶ã€‚å³IN[B] = âˆª_s(sæ˜¯Bæ‰€æœ‰çš„å‰é©±ç»“ç‚¹)OUT[s]ã€‚ ç®—æ³• 1234567891011121314&gt; /*&gt; INPUT: CFG(def_B and use_B computed for each basic blocks B)&gt; OUTOUT: IN[B] and OUT[B] for each basic block B&gt; */&gt; IN[exit] = nullptr;&gt; for (each basic block B\exit)&gt; IN[B] = nullptr;&gt; &gt; while(changes to ant IN occur) &gt; for(each basic blocks B\exit) &#123;&gt; OUT[B] = âˆª_IN[S];&gt; OUT[B] = use_B âˆª (OUT[B] - def_B); &gt; &#125;&gt; å°†ä¸¤ä¸ªç®—æ³•çš„Transfer Funcæ”¾åˆ°ä¸€èµ·å¯¹æ¯”ï¼š RDA: OUT[B] = gen_B âˆª (IN[B] - kill_B) LVA: IN[B] = use_B âˆª (OUT[B] - def_B) ä¼šå‘çŽ°å¾ˆå¤šçš„æ•°æ®æµåˆ†æžç®—æ³•éƒ½æ˜¯GEN/KILL Problemï¼Œç»Ÿè®¡ä¸€ä¸‹å…¬å¼å°±æ˜¯OUT = gen âˆª (IN - kill)ã€‚ Available Expressions Analysis å®šä¹‰ An expression x op y is available at program point p if (1) all paths from the entry to p must pass through the evaluation of x op y, and (2) after the last evaluation of x op y, there is no redefinition of x or y. åœ¨CFGä¸Šçš„æ‰€æœ‰çš„å¤åˆåž‹è¡¨è¾¾å¼éƒ½ä¼šè¢«æ‹†æˆä¸‰åœ°å€ç ã€‚åˆ¤æ–­ä¸€ä¸ªexpression-x op yåœ¨pç‚¹æ˜¯availableçš„ï¼Œå–å†³äºŽä»Žentryåˆ°pç‚¹æ‰€æœ‰çš„è·¯å¾„éƒ½å¿…é¡»æœ‰è¯¥è¡¨è¾¾å¼çš„evaluationæ±‚å€¼ï¼Œå¹¶ä¸”åœ¨æœ€åŽä¸€ä¸ªæ±‚å€¼ä¹‹åŽä¸èƒ½å¯¹x/yé‡æ–°èµ‹å€¼ï¼Œå³å°±è¯´è¿™ä¸ªè¡¨è¾¾å¼åœ¨pç‚¹äº‹availableçš„ã€‚ åˆ†æžç±»åž‹ å¿…é¡»ä¿è¯æ‰€æœ‰çš„pathéƒ½æœ‰evaluation of expressionåˆ†æžç»“æžœæ‰æ˜¯availableã€‚å› æ­¤è¿™æ˜¯ä¸€ä¸ªmuståˆ†æžï¼Œå³ä¸èƒ½æœ‰è¯¯æŠ¥ä½†å¯ä»¥æœ‰æ¼æŠ¥ï¼Œæ¯”å¦‚ä¸‹å›¾ä¸­çš„æƒ…å†µï¼Œå‡è®¾x = 3å‰åŽéƒ½æˆç«‹é‚£ä¹ˆå®žé™…ä¸Šè¿™ä¸ªè¡¨è¾¾å¼ä¹Ÿæ˜¯å¯ä»¥è¢«ä¼˜åŒ–çš„ï¼Œä½†æ˜¯æ ¹æ®è¯¥muståˆ†æžçš„å®šä¹‰è¿™ä¸ªåˆ†æžç»“æžœæ˜¯not avaliableçš„ã€‚ åº”ç”¨ è¯¥åˆ†æžå¯ä»¥ç”¨æ¥è¿›è¡Œå…¬å…±å­è¡¨è¾¾å¼åˆ é™¤ï¼Œå³ç”¨the last evaluation of available expressionç›´æŽ¥æ›¿æ¢è¯¥è¡¨è¾¾å¼ï¼Œä»Žè€Œä¼˜åŒ–ä»£ç ã€‚ ç»†èŠ‚ Data Flow Value/Fact é¡¾åæ€ä¹‰å°±æ˜¯ç¨‹åºä¸­æ‰€æœ‰çš„expressionã€‚ Transfer Function æ ¹æ®å®šä¹‰OUT[B] = gen_B âˆª (IN[B] - kill_B)ï¼Œå¯¹äºŽæ‰€æœ‰çš„è¾“å…¥çš„è¡¨è¾¾å¼ï¼Œäº§ç”Ÿçš„æ–°è¡¨è¾¾å¼å¹¶ä¸”åˆ é™¤æŽ‰åœ¨å…¶å˜é‡è¢«é‡æ–°èµ‹å€¼çš„è¡¨è¾¾å¼ã€‚ Control Flow å› ä¸ºæ˜¯muståˆ†æžå¯¹äºŽæ‰€æœ‰çš„æƒ…å†µéƒ½è¦è€ƒè™‘ï¼Œæ‰€ä»¥IN[B] = âˆ©(p:predecessors of B)OUT[p]ã€‚ ç®—æ³• 1234567891011121314&gt; /*&gt; INPUT: CFG(kill_B and gen_B computed for each basic blocks B)&gt; OUTOUT: IN[B] and OUT[B] for each basic block B&gt; */&gt; out[entry] = nullptr;&gt; for (each basic block B\entry)&gt; OUT[B] = nullptr;&gt; &gt; while(changes to ant OUT occur) &gt; for(each basic blocks B\entry) &#123;&gt; IN[B] = âˆª_IN[P];&gt; OUT[B] = gen_B âˆª (OUT[B] - kill_B); &gt; &#125;&gt; å¯¹äºŽè¿™ä¸‰ç§åˆ†æžæ¥è¯´ï¼Œå¦‚ä½•ç†è§£may/mustï¼Œfalse positive/false negativeå’Œåœ¨æ‰€æœ‰CFGä¸Šç¨‹åºçš„è¿è¡Œæ—¶è¡Œä¸ºä¹‹é—´çš„å…³ç³»æ˜¯å¾ˆå…³é”®çš„é—®é¢˜ã€‚ Foundations Mathematics Prerequisite Partial Order å®šä¹‰posetååºé›†(P, â‰¼)è¡¨ç¤ºä¸€ä¸ªé›†åˆpï¼Œç¬¦å·â‰¼å®šä¹‰åœ¨è¯¥é›†åˆçš„partial orderingæœ‰å¦‚ä¸‹æ€§è´¨ï¼š Reflexivity. âˆ€ xâˆŠP, xâ‰¼x Antisymmetry. âˆ€ x,yâˆŠP, xâ‰¼y âˆ§ yâ‰¼x âŸ¹ x=y. Transitivity. âˆ€ x,y,zâˆŠP, xâ‰¼y âˆ§ yâ‰¼z âŸ¹ xâ‰¼z. å¦‚ä½•ç†è§£ååº-partial orderingï¼Ÿåœ¨é›†åˆpä¸­å®šä¹‰äº†ä¸€ç§orderï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰ä¸¤ä¸ªå…ƒç´ ä¹‹é—´éƒ½å¿…é¡»æ»¡è¶³è¿™ç§orderâ€”â€”å³é›†åˆä¸­ä¸¤ä¸ªå…ƒç´ ä¹‹é—´å¯ä»¥æ˜¯incomparableçš„ã€‚æ¯”å¦‚power setæ˜¯éžå¸¸å…¸åž‹çš„posetã€‚ Upper and Lower Bounds ç»™å®šååºé›†(P, â‰¼)ä»¥åŠè¯¥é›†åˆçš„ä¸€ä¸ªå­é›†S âŠ† Pã€‚æˆ‘ä»¬ä½¿ç”¨é›†åˆPä¸­çš„ä¸€ä¸ªå…ƒç´ u âˆŠ Pæ¥å®šä¹‰é›†åˆSçš„upper boundå’Œlower bound: âˆ€xâˆŠS, xâ‰¼u âŸ¹ uâˆŠP is an upper bounds of S âˆ€xâˆŠS, lâ‰¼x âŸ¹ lâˆŠP is an lower bound of S åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥å®šä¹‰é›†åˆSçš„least upper bound(lub or join)ç®€å†™ä¸ºâŠ”Sï¼Œä»¥åŠgreatest lower bound(glb or meet)ç®€å†™ä¸ºâŠ“S: for every upper bound of S, say u: âŠ”S â‰¼ u for every lower bound of S, say l:l â‰¼ âŠ“S æ ¹æ®âŠ”S/âŠ“Sçš„å®šä¹‰ï¼Œå¦‚æžœé›†åˆSä¸­åªæœ‰ä¸¤ä¸ªå…ƒç´ a and bã€‚é‚£ä¹ˆï¼š âŠ”S â‰¡ a âŠ” b(aå’Œbçš„å¹¶é›†) âŠ“S â‰¡ a âŠ“ bï¼ˆaå’Œbçš„äº¤é›†ï¼‰ ä¸æ˜¯æ‰€æœ‰çš„ååºé›†éƒ½æœ‰âŠ“S/âŠ”Sï¼Œä½†æ˜¯å¦‚æžœä¸€ä¸ªååºé›†åŒæ—¶æœ‰âŠ”S/âŠ“Sçš„è¯ï¼Œé‚£è¯¥ååºé›†å°±æ˜¯å”¯ä¸€çš„ã€‚ Lattic å¯¹äºŽä¸€ä¸ªååºé›†Pï¼Œå¦‚æžœé›†åˆä¸­ä»»æ„ä¸¤ä¸ªå…ƒç´ ï¼ˆæž„æˆçš„å­é›†Sï¼‰aå’Œbï¼Œå®ƒä»¬çš„aâŠ”bå’ŒaâŠ“béƒ½å­˜åœ¨ï¼Œåˆ™è¿™ä¸ªååºé›†å°±æ˜¯ä¸€ä¸ªlatticeã€‚ Given poset (P, â‰¼), âˆ€a,bâˆŠP, if âˆƒ aâŠ”b, âˆƒ aâŠ“b âˆƒ then P is calles a lattice åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¦‚æžœè¿™ä¸ªååºé›†Pä¸­çš„ä»»æ„ä¸¤ä¸ªå…ƒç´ åªæœ‰aâŠ”bæˆ–è€…aâŠ“bä¸­çš„ä¸€ä¸ªï¼Œåˆ™è¿™ä¸ªååºé›†åˆ†åˆ«ç§°ä¸ºjoin semilatticeå’Œmeet semilatticeã€‚ Complete Lattice å¯¹äºŽä¸€ä¸ªååºé›†Pï¼Œå¦‚æžœé›†åˆä¸­ä»»æ„ä¸€ä¸ªå­é›†Séƒ½å­˜åœ¨âŠ”Så’ŒâŠ“Sï¼Œåˆ™è¿™ä¸ªååºé›†ä¾¿ç§°ä¸ºcomplete latticeã€‚å…¨æ ¼å’Œæ ¼çš„åŒºåˆ«ä¸»è¦åœ¨äºŽï¼Œæ ¼å¯¹å…¶å­é›†çš„è¦æ±‚æ˜¯åªéœ€è¦æœ‰ä¸¤ä¸ªå…ƒç´ è€Œå…¨æ ¼å¯¹å­é›†å…ƒç´ çš„æ•°é‡æ²¡æœ‰é™åˆ¶ã€‚ åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¯¹äºŽä¸€ä¸ªcomplete latticeï¼Œéƒ½æœ‰å­˜åœ¨ï¼š a greatest element âŠ¤ = âŠ”P called top a least element âŠ¥ = âŠ“P called bottom æ¯ä¸€ä¸ªfinite latticeéƒ½æ˜¯ä¸€ä¸ªcomplete latticeã€‚ä½†æ˜¯ä¸€ä¸ªcomplete latticeå´ä¸ä¸€å®šæ˜¯finite latticeã€‚ Product Lattice ç»™å®šå¤šä¸ªlattice-Li = (Pi, â‰¼i)çš„ç¬›å¡å°”ç§¯æž„æˆçš„ä¸€ä¸ªæ–°çš„latticeï¼Œå¦‚æžœè¿™äº›latticeæ¯ä¸€ä¸ªéƒ½æœ‰lubå’Œglbçš„è¯(è¿™é‡Œæ²¡æœ‰è¯´æ˜Žå­é›†Sçš„ä¸ªæ•°ä¸»è¦æ˜¯å› ä¸ºå®ƒå¯ä»¥æ˜¯åªæœ‰ä¸¤ä¸ªå…ƒç´ çš„æ™®é€šlatticeä¹Ÿå¯ä»¥æ˜¯åŒ…æ‹¬ä»»æ„å…ƒç´ çš„complete latticeï¼Œæ¢å¥è¯è¯´å¦‚æžœä¸€ä¸ªproduct latticeæ˜¯complete latticeçš„ç¬›å¡å°”ç§¯ï¼Œé‚£ä¹ˆå®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªcomplete lattice)åˆ™ç§°å…¶ç§¯ä¸ºproduct latticeå¹¶æ»¡è¶³ä¸‹é¢æ€§è´¨: P = P1 x P2...x Pn (x1, ..., xn) â‰¼ (y1, ..., yn) â‰¡ (x1 â‰¼ y1)âˆ§...âˆ§(xnâ‰¼yn) (x1, ..., xn) âŠ” (y1, ..., yn) â‰¡ (x1 âŠ” y1)âˆ§...âˆ§(xn âŠ” yn) (X1, ..., xn) âŠ“ (y1, ..., yn) â‰¡ (x1 âŠ“ y1)âˆ§...âˆ§(xn âŠ“ yn) å³ä¸€ä¸ªproduct latticeä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ latticeæ»¡è¶³çš„æ€§è´¨å®ƒéƒ½æ»¡è¶³ã€‚ Data Flow Analysis Framework via Lattice Iterative Algorithm å›žé¡¾å‰é¢ä¸‰ä¸ªå…·ä½“çš„æ•°æ®æµåˆ†æžç®—æ³•ï¼Œå³ç›¸åº”çš„may/muståˆ†æžä»Žå„è‡ªçš„åˆå§‹çŠ¶æ€å‡ºå‘ï¼Œç»è¿‡ä¸æ–­è¿­ä»£ï¼ˆTransfer Function/Control Flowï¼‰æœ€ç»ˆåˆ°è¾¾ä¸åŠ¨ç‚¹â€”â€”æ•´ä¸ªç¨‹åºçš„æ•°æ®æµä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œç®—æ³•åœæ­¢ã€‚ è¿™é‡Œä»Žæ›´å…·ä½“çš„è§’åº¦æ¥ç†è§£è¿™ä¸ªç®—æ³•ï¼š ç»™å®šä¸€ä¸ªCFGï¼Œå…¶ä¸­æœ‰kä¸ªèŠ‚ç‚¹(è¿™é‡Œç®€åŒ–æˆä¸ºåªå¸¦ä¸€ä¸ªstatementçš„basic block)ã€‚è€Œè¿­ä»£ç®—æ³•åœ¨æ¯æ¬¡è¿­ä»£ä¸­æ›´æ–°è¿™kä¸ªèŠ‚ç‚¹çš„è¾“å‡ºOUTï¼Œå¼•å…¥ä¸€ä¸ªk-tuple: (OUT[n1], OUT[n2], ..., OUT[nk]) â‰¡ (V1 x V2 ... x Vk) k-tupleå°±æ˜¯æ¯ä¸€æ¬¡è¿­ä»£åŽæ‰€æœ‰èŠ‚ç‚¹è¾“å‡ºå€¼çš„productè®°ä¸ºVkã€‚è€Œæ›´å…·ä½“çš„è§£é‡Šå°±æ˜¯ä¸åŒçš„æ•°æ®æµåˆ†æžç®—æ³•åœ¨æ¯æ¬¡è¿­ä»£ä¸­é€šè¿‡åº”ç”¨å„ç§Transfer Function/Control Flowæ¥æ›´æ–°k-tupleçš„å€¼â€”â€”å¯ä»¥å°†æ¯ä¸€æ¬¡è¿­ä»£æŠ½è±¡å‡ºæˆä¸ºä¸€ä¸ªå‡½æ•°:F: Vk âŸ¶ Vkã€‚è€Œå½“æœ€åŽä¸€æ¬¡è¿­ä»£çš„è¾“å‡ºæ²¡æœ‰å‘ç”Ÿå˜åŒ–ä¾¿åˆ°è¾¾äº†ä¸åŠ¨ç‚¹ã€‚ This general iterative algorithm produces a solution to data flow analysisï¼Œæ ¹æ®å‡½æ•°Fçš„ä¸€ä¸ªä¸åŠ¨ç‚¹çš„å®šä¹‰ï¼š X is a fix point of Function F if X = F(X)&gt; å¯ä»¥å¾—åˆ°å½“æŠŠæ¯ä¸€ä¸ªè¿­ä»£æŠ½è±¡æˆä¸ºä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼ŒIterative Algorithmæœ€ç»ˆä¼šåˆ°è¾¾ä¸€ä¸ªä¸åŠ¨ç‚¹ï¼Œè€Œè¿™ä¸ªä¸åŠ¨ç‚¹å°±æ˜¯æ•°æ®æµåˆ†æžçš„ä¸€ä¸ªç»“æžœã€‚ Data Flow Analysis Framework via Lattice å®šä¹‰ä¸€ä¸ªæ•°æ®æµåˆ†æžæ¡†æž¶ä¸»è¦æœ‰ä¸‰ä¸ªéƒ¨åˆ†(D, L, F): D: æŒ‡çš„æ˜¯åˆ†æžçš„æ–¹å‘æ˜¯backwwards/forwards L: æ ¸å¿ƒéƒ¨åˆ†æ˜¯latticeï¼Œä»£è¡¨æ‰€åˆ†æžçš„æ•°æ®æµå€¼åŸŸï¼Œå’Œä¸€ä¸ªmeetâŠ“æˆ–è€…joinâŠ”è¿ç®—ç¬¦ï¼ˆä¸€èˆ¬ä¸€ä¸ªæ•°æ®æµåˆ†æžç®—æ³•åªä¼šç”¨åˆ°å…¶ä¸­ä¸€ä¸ªè¿ç®—ç¬¦â€”â€”æ•…å…¶å®žæ˜¯semilatticeï¼‰ F: æŒ‡çš„æ˜¯åˆ†æžä¸­çš„Transfer Functions åˆ†æžæ¡†æž¶å°±å¯ä»¥çœ‹æˆæ˜¯åœ¨ä¸€ä¸ªlatticeçš„å€¼ä¸Šä¸åœçš„è¿­ä»£transfer functionså’Œjoin/meet operationsã€‚ Fixed Point Theorem åœ¨å­¦å®ŒIterative Algorithmä»¥åŠData FLow Analysis Frameworkä¹‹åŽï¼Œæˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥ç†è§£è¿™ä¸¤è€…ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶æ›´æ·±å±‚æ¬¡çš„ç†è§£åœ¨latticeä¸Šå®šä¹‰çš„å‡½æ•°çš„ä¸åŠ¨ç‚¹åŽŸç†-Fixed Point Theoremï¼Œé¦–å…ˆå¯¹Iterative Algorithmæå‡ºä¸€äº›æ ¸å¿ƒçš„é—®é¢˜: è¿­ä»£ç®—æ³•èƒ½ä¿è¯ä¸€å®šä¼šåˆ°è¾¾ä¸å®šç‚¹ä¹ˆï¼Ÿ å‡è®¾å¯ä»¥åˆ°è¾¾ä¸åŠ¨ç‚¹ï¼Œé‚£è¿™ä¸ªä¸åŠ¨ç‚¹æ˜¯å”¯ä¸€çš„ä¹ˆï¼Œæˆ–è€…é€šè¿‡è¿­ä»£ç®—æ³•åˆ°è¾¾çš„ä¸åŠ¨ç‚¹æ˜¯æœ€ç²¾ç¡®çš„ä¹ˆï¼Ÿ å‡è®¾å¯ä»¥åˆ°è¾¾ä¸åŠ¨ç‚¹ï¼Œé‚£ä»€ä¹ˆæ—¶å€™å¯ä»¥åˆ°è¾¾ï¼Ÿ å‰ä¸¤ä¸ªé—®é¢˜å¼•å‡ºäº†ä¸åŠ¨ç‚¹ç†è®ºåŠå…¶å­˜åœ¨æ€§ä»¥åŠç²¾ç¡®æ€§ã€‚ç”±äºŽå‰é¢ä»‹ç»çš„Iterative Algorithmä¹Ÿæ˜¯å»ºç«‹åœ¨Latticeä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥ä¸ºäº†å›žç­”è¿™ä¸‰ä¸ªIterative Algorithmæœ‰å…³çš„é—®é¢˜ï¼Œé¦–å…ˆåº”è¯¥å¼•å…¥å»ºç«‹åœ¨Latticeä¸Šçš„å‡½æ•°å¹¶ç ”ç©¶è¯¥å‡½æ•°ä¸åŠ¨ç‚¹çš„æ€§è´¨ï¼Œæœ€åŽå°†è¿™ä¸ªå‡½æ•°ä¸ŽIterative Algorithmè”ç³»èµ·æ¥ã€‚ Monotonicity å¼•å…¥åœ¨Latticeå®šä¹‰ä¸Šçš„å‡½æ•°få¹¶å®šä¹‰å…¶å•è°ƒæ€§: f: L âŸ¶ L (L is a Lattice) is monotonic if âˆ€x,yâˆŠL, xâ‰¼ y âŸ¹ f(x) â‰¼ f(y) åœ¨æ­¤åŸºç¡€ä¸Šå¼•å…¥Fixed-Point Theorem: å¯¹äºŽä¸€ä¸ªcomplete lattice(L, â‰¼)ï¼Œå¦‚æžœâ‘ åœ¨å…¶ä¸Šçš„å‡½æ•°f:LâŸ¶Læ˜¯å•è°ƒçš„ï¼Œâ‘¡Læ˜¯finite latticeï¼š é‚£ä¹ˆé€šè¿‡è¿­ä»£f(âŠ¥), f(f(âŠ¥)), ..., f^k(âŠ¥)å¯ä»¥å¾—åˆ°least fixed pointï¼› é€šè¿‡è¿­ä»£f(âŠ¤), f(f(âŠ¤)), ..., f^k(âŠ¤)å¯ä»¥å¾—åˆ°greatest fixed pointã€‚ å¯ä»¥é€šè¿‡è¯æ˜Žè¯¥ç†è®ºæ¥å›žç­”å‰ä¸¤ä¸ªé—®é¢˜ã€‚è¯æ˜Žåˆ†ä¸ºä¸¤æ­¥: ä¸åŠ¨ç‚¹çš„å­˜åœ¨ è¿­ä»£åˆ°è¾¾æœ€å°/å¤§ä¸åŠ¨ç‚¹ Proof Proof-Existence of Fixed Point: â€‹ âˆµ âŠ¥æ˜¯Latticeæœ€å°å…ƒç´ ï¼Œç”±f:LâŸ¶Lçš„å®šä¹‰å¯çŸ¥f(âŠ¥)ä¹Ÿæ˜¯Latticeä¸Šçš„å…ƒç´ âŸ¹ âŠ¥ â‰¼ f(âŠ¥) â€‹ âˆµ fæ˜¯å•è°ƒçš„ âŸ¹ f(âŠ¥) â‰¼ f(f(âŠ¥))=f2(âŠ¥) ç›¸ä¼¼çš„ âŸ¹ âŠ¥â‰¼ f(âŠ¥) â‰¼ f2(âŠ¥) ... â‰¼ fi(âŠ¥) â€‹ âˆµLæ˜¯finiteçš„ âŸ¹ fk(âŠ¥) = f(k+1)(âŠ¥) â€‹ âˆ´ ä¸åŠ¨ç‚¹å­˜åœ¨ Proof-Least Fixed Point: â€‹ å‡è®¾æœ‰å¦ä¸€ä¸ªä¸åŠ¨ç‚¹xï¼ŒâŸ¹ x = f(x), âŠ¥ â‰¼ x Induction: â€‹ âˆµ f æ˜¯å•è°ƒçš„ âŸ¹ f(âŠ¥) â‰¼ f(x) â€‹ å‡è®¾f^i(âŠ¥) â‰¼ fi(x), âˆµ få•è°ƒ âŸ¹ f(i+1)(âŠ¥) â‰¼ f(i+1)(x) â€‹ âˆ´æ ¹æ®å½’çº³æ³• âŸ¹ fi(âŠ¥) âŸ¹ fi(x) â€‹ âˆµxæ˜¯ä¸åŠ¨ç‚¹ï¼Œfi(âŠ¥) â‰¼ fi(x) = xï¼Œ åˆâˆµffix=fk(âŠ¥)æ˜¯ä»ŽâŠ¥å¼€å§‹è¿­ä»£åœæ­¢çš„ä¸åŠ¨ç‚¹ âŸ¹ fk(âŠ¥) â‰¼ x â€‹ âˆ´fk(âŠ¥)æ˜¯å”¯ä¸€çš„æœ€å°ä¸åŠ¨ç‚¹(æœ€å¤§ä¸åŠ¨ç‚¹è¯æ˜Žç±»ä¼¼) Iterative and Fixed-Point ç†è§£æ•°æ®æµåˆ†æžçš„æœ€åŽä¸€æ­¥ï¼Œå°±æ˜¯å°†åˆ†æžçš„Iterative Algorithmä¸Žå‰é¢å»ºç«‹åœ¨Latticeä¸ŠFixed-Point Theoremè”ç³»èµ·æ¥ï¼Œè€Œå…³äºŽä¸åŠ¨ç‚¹åŽŸç†çš„å‰æ: a complete lattice(L, â‰¼)ï¼Œ L is finite f: L âŸ¶ L is monotonic å¯ä»¥çœ‹å‡ºåªéœ€è¦å°†è¿­ä»£ç®—æ³•æŠ½è±¡æˆä¸€ä¸ªä¸ªå®šä¹‰åœ¨Latticeä¸Šçš„å•è°ƒå‡½æ•°å³å¯(æ ¹æ®ä¸åŠ¨ç‚¹åŽŸç†è¯¥å‡½æ•°ä¸€å®šä¼šè¾¾åˆ°æœ€å¤§/å°ä¸åŠ¨ç‚¹)â€”â€”ä¸‹é¢å…·ä½“å¯¹Iterative Algorithmè¿›è¡ŒæŠ½è±¡: è¿­ä»£ç®—æ³•ä¸­çš„CFGæ¯ä¸€ä¸ªèŠ‚ç‚¹çš„è¾“å‡ºViéƒ½å¯ä»¥æŠ½è±¡æˆä¸€ä¸ªLatticeï¼Œæ•…å…¨éƒ¨CFGçš„è¾“å‡ºVkå°±æ˜¯ä¸€ä¸ªproduct latticeã€‚åˆå› ä¸ºèŠ‚ç‚¹æ˜¯æœ‰é™çš„ï¼Œæ•…è¿™ä¸ªproduct latticeæ˜¯complete latticeã€‚ åˆå› ä¸ºè¿­ä»£ç®—æ³•çš„æ ¸å¿ƒå°±æ˜¯Vkåº”ç”¨Transfer Functionå’Œmeet/join Functionå®Œæˆä¸€æ¬¡åˆä¸€æ¬¡çš„è¿­ä»£ï¼Œè¿™é‡Œçš„Transfer /meet.join Functionå¯ä»¥æŠ½è±¡æˆå®šä¹‰åœ¨Latticeä¸Šçš„å‡½æ•°ã€‚ åªè¦ä¿è¯Transfer Functionå’Œmeet/join Functionæ˜¯å•è°ƒçš„ï¼Œå°±å¯ä»¥å®Œæˆè¿­ä»£ç®—æ³•åˆ°ä¸åŠ¨ç‚¹ç†è®ºçš„æ˜ å°„ã€‚ å…¶å®žæ‰€æœ‰çš„Transfer Functionæœ¬è´¨ä¸Šéƒ½æ˜¯gen/kill problemsï¼Œå› æ­¤ç®€åŒ–ä¸ºå‡½æ•°fi: L âŸ¶ Lã€‚å…¶åŸºæœ¬å…¬å¼å¯ä»¥ç®€åŒ–æˆä¸ºOUT[S] = genS â‹ƒ (IN[S] - killS) ã€‚ä»ŽåŸºæœ¬å…¬å¼ä¸­å¯å¾—: genSå’ŒkillSæ˜¯æ ¹æ®æ•°æ®æµåˆ†æžç®—æ³•çš„å®šä¹‰å†³å®šçš„ï¼Œæ‰€ä»¥ä¿æŒä¸å˜ genSæ˜¯å•è°ƒçš„(OUT[S]åªä¼šå¢žåŠ )ï¼ŒIN[S]è¦ä¹ˆè¢«killæŽ‰ï¼Œè¦ä¹ˆä¹ŸåŠ å…¥åˆ°OUT[S]ä¸­ å› æ­¤OUT[S] never shrinks ç”±äºŽè¾“å…¥ä¸€å®šæ˜¯æœ‰é™çš„(è¾“å…¥å°±æ˜¯æ•°æ®æµæ¯”å¦‚all definitions/all variables/all expressions)å› æ­¤è¯¥å‡½æ•°ä¸€å®šä¹Ÿæ˜¯å•è°ƒæœ‰ç•Œçš„ã€‚ ç›¸å¯¹æ¥è¯´meet/join Functionå‡½æ•°âŠ”/âŠ“:L x L âŸ¶ Lï¼Œåªè¯æ˜ŽâŠ”æ˜¯å•è°ƒçš„ï¼ŒâŠ“ç±»ä¼¼: Poof. âˆ€x, y, z âˆŠ L, x â‰¼ y, æˆ‘ä»¬è¦è¯æ˜Ž xâŠ”z â‰¼ yâŠ”z âˆµ xâ‰¼y, y â‰¼ yâŠ”z âŸ¹ x â‰¼ yâŠ”z âˆµ xâŠ”zæ˜¯least upper bound of x and z âˆ´xâŠ”z â‰¼ yâŠ”z å¾—è¯è¯¥å‡½æ•°ä¹Ÿæ˜¯å•è°ƒçš„ã€‚ åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å®Œç¾Žçš„å°†data-flow analysisçš„iterative algorithmè½¬åŒ–æˆä¸ºfixed-point theoremçš„å·²çŸ¥æ¡ä»¶ï¼Œæ•…fixed-point theoremçš„ç»“è®ºå½“ç„¶ä¹Ÿé€‚ç”¨äºŽiterative algorithmã€‚æˆ‘ä»¬ä¹Ÿå›žç­”äº†è¿™ä¸€èŠ‚æœ€å¼€å§‹å…³äºŽè¿­ä»£ç®—æ³•ä¸åŠ¨ç‚¹å­˜åœ¨æ€§å’Œç²¾åº¦çš„é—®é¢˜ã€‚ Complexity å…³äºŽè¿­ä»£ç®—æ³•çš„ä¸åŠ¨ç‚¹ç†è®ºè¿˜æœ‰æœ€åŽä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ç®—æ³•ä¼šåœ¨ä»€ä¹ˆæ—¶å€™åˆ°è¾¾ä¸åŠ¨ç‚¹å³when can we get the solution?è¿™å°±æ¶‰åŠåˆ°äº†åœ¨Latticeå»ºç«‹çš„å‡½æ•°çš„å¤æ‚åº¦ï¼š é¦–å…ˆå¼•å…¥Latticeçš„é«˜åº¦heightï¼Œå³ä»Žlatticeçš„topåˆ°bottomæœ€é•¿çš„ä¸€æ¡è·¯å¾„hï¼Œå‡è®¾è¯¥CFGä¸­èŠ‚ç‚¹çš„æ•°ç›®æ˜¯kï¼Œé‚£æœ€åæƒ…å†µéœ€è¦i = h* kæ¬¡è¿­ä»£æ‰èƒ½åˆ°è¾¾ä¸åŠ¨ç‚¹ã€‚ åˆ°æ­¤ä¸ºæ­¢ï¼Œæ‰€æœ‰çš„ç†è®ºéƒ¨åˆ†éƒ½ä»‹ç»ç»“æŸäº†ï¼ May/Must Analysis On Lattice å‰é¢ä¸€éƒ¨åˆ†ä¸»è¦ä»Žæ•°å­¦è§’åº¦å¼•å…¥åœ¨latticeä¸Šå®šä¹‰çš„å‡½æ•°çš„ä¸åŠ¨ç‚¹å®šç†ï¼Œç„¶åŽè¯æ˜Žäº†æ•°æ®æµåˆ†æžçš„ç®—æ³•æœ¬è´¨ä¸Šå°±æ˜¯é€šè¿‡è¿­ä»£æ¥è¾¾åˆ°ä¸åŠ¨ç‚¹ã€‚ä½†æ˜¯å®žé™…ä¸Šä¸åŒçš„æ•°æ®æµåˆ†æžç®—æ³•æœ‰ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œå„è‡ªå¯¹ç²¾åº¦å’ŒSoundnessçš„è¦æ±‚ä¹Ÿä¸ç›¸åŒâ€”â€”å› æ­¤å¦‚ä½•ç†è§£mayå’Œmuståˆ†æžçš„åˆå§‹åŒ–æ¡ä»¶ä»¥åŠæœ€å¤§/å°ä¸åŠ¨ç‚¹ï¼Ÿ æœ¬èŠ‚è§£å†³ â‘ may/must data-flow analysiså¦‚æžœç”¨latticeè¡¨è¿°ä¼šæ˜¯ä»€ä¹ˆæ ·å­?â‘¡è¿™äº›åˆ†æžå’Œæ±‚è§£latticeä¸Šçš„ä¸åŠ¨ç‚¹æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿå³mayæ±‚è§£æœ€å°ä¸åŠ¨ç‚¹è€Œmustæ±‚è§£æœ€å¤§ä¸åŠ¨ç‚¹ï¼Ÿâ‘¢æ±‚è§£ä¸åŠ¨ç‚¹å’Œåˆ†æžçš„Soundnesså’Œåˆ†æžç²¾åº¦æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿè¿™éƒ¨åˆ†è®²è§£ååˆ†ç²¾å½©ï¼Œå›¾è§è¯¾ä»¶ï¼Œè¿™é‡Œåªæ˜¯è®°å½•æˆ‘è®¤ä¸ºæœ€æ ¸å¿ƒçš„éœ€è¦ç†è§£çš„éƒ¨åˆ†ã€‚ may analysis mayåˆ†æžä»ŽâŠ¥åˆ°âŠ¤ã€‚ æ‹¿Reaching Definitionåº”ç”¨äºŽæ£€æµ‹æœªå®šä¹‰å˜é‡ä¸ºä¾‹ï¼š bottom åˆ†æžçš„âŠ¥æ˜¯no definitions can reachï¼ŒâŠ¥å°±æ„å‘³ç€æ‰€æœ‰å˜é‡éƒ½ä¸æ˜¯æœªå®šä¹‰ï¼Œè¿™ä¸ªåˆ†æžç»“æžœä¸€å®šæ˜¯unsafeçš„ï¼ˆå› ä¸ºå®žé™…ä¸Šå“ªæ€•åªæœ‰ä¸€ä¸ªæœªå®šä¹‰å˜é‡æ²¡æœ‰è¢«æ£€æµ‹å‡ºæ¥ï¼Œè¿è¡Œæ—¶ä¹Ÿä¸€å®šä¼šæŠ¥é”™ï¼‰ã€‚ top åˆ†æžçš„âŠ¤æ˜¯all definitions may reachï¼Œå°±æ„å‘³ç€æ‰€æœ‰çš„å˜é‡éƒ½æ˜¯æœªå®šä¹‰ï¼Œæ•…åˆ†æžç»“æžœä¸€å®šæ˜¯safeçš„ï¼ˆå› ä¸ºå°±ç®—æœ‰ä¸€ä¸ªå®šä¹‰è¿‡çš„å˜é‡è¢«æ£€æµ‹æˆæœªå®šä¹‰ï¼Œè¿è¡Œæ—¶ä¹Ÿä¸ä¼šæŠ¥é”™ï¼‰ã€‚ safe &amp; precision åˆ†æžç®—æ³•ç»§ç»­è¿­ä»£ï¼Œæ²¿ç€æ›´åŠ safeçš„æ–¹å‘èµ°ï¼Œç›´åˆ°åˆ°è¾¾æœ€å°ä¸åŠ¨ç‚¹â€”â€”è¿™éƒ¨åˆ†æ˜¯å·²ç»è¯æ˜Žè¿‡çš„äº†ï¼Œé—®é¢˜æ˜¯å¦‚ä½•ç†è§£åˆ†æžçš„ç²¾åº¦å’Œå®‰å…¨ã€‚ å›žé¡¾mayåˆ†æžç»“æžœå¯ä»¥æœ‰è¯¯æŠ¥ä½†ä¸å¯ä»¥æœ‰æ¼æŠ¥å³false-positiveæˆ–è€…soundã€‚æˆ‘ç†è§£æ˜¯è¿™é‡Œçš„safeå’Œprecisionéƒ½æ˜¯é’ˆå¯¹è¿è¡Œæ—¶æ¥è¯´çš„ï¼ŒâŠ¥ä¸€å®šä¼šåœ¨è¿è¡Œæ—¶æŠ¥é”™ï¼ŒâŠ¤ç¨‹åºä¸ä¼šè¿è¡Œï¼Œè€Œå¦‚ä½•ä¿è¯safeæ˜¯ç”±è®¾è®¡è€…è‡ªå·±è®¾è®¡çš„Transfer Functionå†³å®šçš„ã€‚å¦ä¸€æ–¹é¢ç²¾åº¦é—®é¢˜é’ˆå¯¹åœ¨safeçš„å‰æä¸‹æ˜¯å¦å¯ä»¥å°½é‡å°‘è¯¯æŠ¥ï¼Œå› ä¸ºä¸åŠ¨ç‚¹æœ‰å¾ˆå¤šè€Œæœ€ç»ˆæˆ‘ä»¬éœ€è¦çš„åªæ˜¯æœ€å°çš„é‚£ä¸ªã€‚ must analysis muståˆ†æžä»ŽâŠ¤åˆ°âŠ¥ã€‚ æ‹¿available expressionåº”ç”¨äºŽä¼˜åŒ–å…¬å…±å­è¡¨è¾¾å¼åˆ é™¤ä¸ºä¾‹ï¼š top åˆ†æžçš„âŠ¤æ˜¯all expressions must be availableï¼Œå°±æ„å‘³ç€æ‰€æœ‰çš„è¡¨è¾¾å¼éƒ½æ˜¯å¯ä»¥è¢«ä¼˜åŒ–çš„ï¼Œè¿™ä¸ªåˆ†æžç»“æžœä¸€å®šæ˜¯unsafeçš„ï¼ˆå› ä¸ºå“ªæ€•æœ‰ä¸€ä¸ªè¡¨è¾¾å¼ä¸æ˜¯å…¬å…±çš„ï¼Œé‚£ä¼˜åŒ–ç»“æžœä¸€å®šæ˜¯é”™çš„ï¼‰ã€‚ bottom åˆ†æžçš„âŠ¥æ˜¯no expressions are availableçš„ï¼Œå°±æ„å‘³ç€æ‰€æœ‰çš„è¡¨è¾¾å¼éƒ½ä¸å¯è¢«ä¼˜åŒ–ï¼Œæ•…åˆ†æžç»“æžœä¸€å®šæ˜¯safeçš„ï¼ˆå› ä¸ºå“ªæ€•æœ‰ä¸€ä¸ªå…¬å…±è¡¨è¾¾å¼ä¸ºè¢«æ£€æµ‹å‡ºæ¥ï¼Œé‚£ä¹Ÿä»…ä»…åªæ˜¯å°‘å‡ ä¸ªä¼˜åŒ–ï¼‰ã€‚ safe &amp; precision å›žé¡¾muståˆ†æžç»“æžœå¯ä»¥æœ‰æ¼æŠ¥ä½†æ˜¯ä¸å¯ä»¥æœ‰è¯¯æŠ¥å³false-negativeæˆ–è€…completeã€‚æˆ‘ç†è§£æ˜¯è¿™é‡Œçš„safeå’Œprecisionä¹Ÿæ˜¯é’ˆå¯¹ç¨‹åºè¿è¡Œç»“æžœè€Œè¨€çš„ï¼ŒâŠ¥å°‘å‡ ä¸ªä¼˜åŒ–ï¼ŒâŠ¤çš„ç¨‹åºä¸€å®šå‡ºçŽ°é—®é¢˜ã€‚å¦‚ä½•ä¿è¯safeæ˜¯ç”±è®¾è®¡è€…è‡ªå·±è®¾è®¡çš„Transfer Functionå†³å®šçš„ã€‚å¦ä¸€æ–¹é¢ç²¾åº¦é—®é¢˜é’ˆå¯¹åœ¨safeçš„å‰æä¸‹æ˜¯å¦å¯ä»¥å°½é‡å°‘æ¼æŠ¥ï¼Œå› ä¸ºä¸åŠ¨ç‚¹æœ‰å¾ˆå¤šè€Œæœ€ç»ˆæˆ‘ä»¬éœ€è¦çš„åªæ˜¯æœ€å¤§çš„é‚£ä¸ªã€‚ ç”±æ­¤å¯ä»¥çœ‹å‡ºmay/muståˆ†æžå®Œå…¨é’ˆå¯¹çš„æ˜¯ä¸åŒçš„åœºæ™¯ï¼Œä½†æ˜¯å…¶åˆ†æžç»“æžœçš„safeå’Œprecisionå´éƒ½æ˜¯é’ˆå¯¹ç¨‹åºè¿è¡Œæ—¶å’Œæœ€ç»ˆçš„ç»“æžœã€‚ another view è€å¸ˆåœ¨è¿™é‡Œæä¾›äº†å¦ä¸€ä¸ªè§’åº¦ï¼Œå°±æ˜¯åœ¨latticeä¸Šè¿­ä»£å‡½æ•°ï¼Œå…¶ä¸­Transfer Functionæœ¬èº«æ˜¯å›ºå®šçš„ï¼Œè€Œä¸¤ç§åˆ†æžçš„join/meet Functionæ ¹æ®latticeçš„æ€§è´¨å…¶å°±æ˜¯ä¸¤ä¸ªå…ƒç´ çš„least/greatest upper/lower boundï¼ŒåŠ ä¸Šåˆ†åˆ«ä»ŽâŠ¥å’ŒâŠ¤å¼€å§‹ï¼Œæ•…æ¯æ¬¡è¿­ä»£å‡½æ•°èµ°çš„éƒ½æ˜¯æœ€å°/å¤§çš„è·¯å¾„ï¼Œæ•…åˆ°è¾¾çš„ä¹Ÿæ˜¯æœ€å°/æœ€å¤§ä¸åŠ¨ç‚¹ã€‚ MOP and Distributivity å‰é¢è®¨è®ºäº†æ•°æ®æµåˆ†æžIterative Algorithmæœ€åŽåˆ°è¾¾çš„ä¸åŠ¨ç‚¹æ˜¯æœ€ç²¾ç¡®çš„ã€‚ä½†æ˜¯å¦‚ä½•è¡¡é‡è¿™ä¸ªç²¾åº¦ï¼Ÿè¿™ä¸€å°èŠ‚å¼•å…¥ä¸€ä¸ªå¾ˆç»å…¸çš„æ¦‚å¿µMeet-Over-All-Paths Solutionå³MOPã€‚ MOPæ¦‚å¿µå¼•å…¥CFGçš„æ¯ä¸€æ¡è·¯å¾„éƒ½æ˜¯ä»Žentryä¸€ç›´åˆ°å…¶æ‰§è¡Œç»“æŸã€‚ P = Entry âŸ¶ S1 âŸ¶ S2 âŸ¶... âŸ¶ Si MOPæ¯ä¸€æ¡pathçš„Transfer Functionæ˜¯è¯¥æ¡è·¯å¾„ä¸Šæ‰€æœ‰statementsçš„Transfer Functionçš„åˆåŠ›ï¼Œæœ€åŽåº”ç”¨meet operatoræ¥è®¡ç®—æ•°æ®æµå€¼: MOP[Si] = âŠ”/âŠ“ FP(OUT[Entry])ã€‚MOPä»…ä»…ä½œä¸ºä¸€ä¸ªç†è®ºä¸Šçš„æ¦‚å¿µå­˜åœ¨æ˜¯å› ä¸ºåº”ç”¨ä¸­å¾ˆå¤šè·¯å¾„æ˜¯not executableçš„ï¼ŒUnboundedçš„ä»¥åŠnot enumerableçš„ï¼Œæ•…å¯¹äºŽé‚£ç§æŒ‡æ•°çˆ†ç‚¸çš„ç¨‹åºMOPæ˜¯impracticalçš„ã€‚è¿™é‡Œä¸»è¦é€šè¿‡MOPæ¦‚å¿µå¯¹æ¯”Iterative Algorithmã€‚å¯¹äºŽåŒä¸€ä¸ªCFG: è¿­ä»£ç®—æ³•æ˜¯åœ¨æ¯ä¸€ä¸ªcontrol flowåº”ç”¨å‡½æ•°:IN[S4] = fS3(fS1(OUT[Entry]) âŠ” fS2(OUT[Entry])) è€ŒMOPåªä¼šåœ¨è·¯å¾„ç»“æŸä¹‹åŽåº”ç”¨å‡½æ•°:MOP[S4] = fS3(fS1(OUT[Entry])) âŠ” fS3(fS2(OUT[Entry])) ç®€åŒ–ä¸€ä¸‹å°±æ˜¯: Ours = F(x âŠ” y) MOP = F(x) âŠ” F(y) å¯ä»¥è¯æ˜Žè¿­ä»£ç®—æ³•çš„ç²¾åº¦è¦æ¯”MOPæ›´ä¸å‡†ã€‚åªæœ‰å½“Få‡½æ•°æ˜¯distributiveçš„æ—¶å€™æ‰èƒ½ä¿è¯F(xâŠ”y) = F(x) âŠ” F(y)å³ä¸¤ç§ç®—æ³•çš„ç²¾ç¡®åº¦æ˜¯ä¸€æ ·çš„ã€‚å‰é¢çš„æ‰€æœ‰Bit-vector/Gen/Killé—®é¢˜çš„æ•°æ®æµåˆ†æžç®—æ³•å®ƒä»¬çš„meet/joinå‡½æ•°éƒ½æ˜¯distributiveçš„ã€‚ Constant Propagation å¸¸é‡ä¼ æ’­æ˜¯ä¸€ä¸ªnon-distributiveçš„æ•°æ®æµåˆ†æžç®—æ³•ã€‚ Given a variable x at program point p, determine whether x is guaranteed to hold a constant value at p. æŒ‰ç…§æ•°æ®æµåˆ†æžæ¡†æž¶(D, L, F)æ¥è§£é‡Šçš„è¯ï¼Œè¯¥åˆ†æžä¸€å®šæ˜¯å‰å‘åˆ†æžforward-analysisï¼Œç”±äºŽä½œä¸ºä¼˜åŒ–ç®—æ³•å…¶å¿…é¡»ä¿è¯è¿è¡Œæ—¶ä¸å¯ä»¥å‡ºé”™æ•…æ˜¯muståˆ†æžã€‚å…¶latticeçš„domainæ˜¯ä¸€ä¸ªpair(x, v)å…¶ä¸­xæ˜¯å˜é‡è€Œvè¡¨ç¤ºå˜é‡çš„å€¼ï¼ˆæœ‰constant, undefinedï¼ŒnotAconstantä¸‰ç§é€‰é¡¹ï¼‰ï¼Œåˆ†æžçš„meet operatorå’Œä¹‹å‰çš„ç®—æ³•ä¸åŒâ€”â€”ä¸æ˜¯å•ä¸€çš„âŠ”/âŠ“ï¼š NAC âŠ“ v = NAC UNDEF âŠ“ v = v c âŠ“ v = ? c âŠ“ c = c c1 âŠ“ c2 = NAC ç»™å®šs: x = ...æ˜¯ä¸€ä¸ªèµ‹å€¼è¯­å¥ï¼Œå› æ­¤è¯¥è¯­å¥OUTåˆ™æ˜¯INçš„æ‰€æœ‰å˜é‡å‡æŽ‰x(å› ä¸ºxè¢«é‡æ–°èµ‹å€¼äº†)å†åŠ ä¸Šè¯¥è¯­å¥ä¸­æ–°genå‡ºæ¥çš„å˜é‡ã€‚æ•…å®šä¹‰å¸¸é‡ä¼ æ’­çš„Transfer FunctionF: OUT[s] = gen â‹ƒ (IN[s] - {(x, _)})ã€‚å…¶ä¸­genå‡½æ•°: s: x = c; //c is a constant âŸ¹ gen = {(x, c)} s: x = y; âŸ¹ gen = {(x, val(y))} x: x = y op z; âŸ¹ gen = {(x, f(y, z))} val(y) op val(z) // if val(y) and val(z) are constants NAC // if val(y) or val(z) is NAC UNDEF //UNDEF op UNDEF or UNDEF op NAC ä¸‹é¢çš„è¿™ä¸ªä¾‹å­ä¸­ï¼š ç”¨æ•°æ®æµåˆ†æžè¿­ä»£ç®—æ³•ä»¥åŠMOPç®—æ³•æ¥å®Œæˆå¸¸é‡ä¼ æ’­æ±‚å€¼ä¹‹åŽè¿›è¡Œä¸€æ¬¡å¯¹æ¯”: Ours: F(X âŠ“ Y) = {(a, NAC), (c, NAC), (c, NAC)} MOP: F(X) âŠ“ F(Y) = {(a, NAC), (b, NAC), (c, 10)} æŒ‰ç…§muståˆ†æžçš„ä¸åŠ¨ç‚¹ç†è®ºï¼Œåˆ†æžæ˜¯ä»ŽâŠ¤åˆ°âŠ¥ï¼ˆâŠ¤å°±æ˜¯UNDEFï¼ŒâŠ¥æ˜¯NACï¼‰è¿›è¡Œçš„ã€‚è€ŒOursçš„å€¼è¦æ¯”MOPçš„å€¼æ›´é è¿‘âŠ¥æ•…å…¶åˆ†æžåˆ™less preciseã€‚å› æ­¤F(XâŠ“Y)â‰  F(X)âŠ“ F(Y)è¿›è€ŒF(XâŠ“Y) â‹ž F(X)âŠ“ F(Y)ã€‚æ‰€ä»¥è¯¥åˆ†æžæ˜¯Nondistributiveçš„ã€‚ Worklist Algorithm åœ¨å®žé™…çš„æ•°æ®æµåˆ†æžä¸­ä¼šä½¿ç”¨è¿­ä»£ç®—æ³•çš„ä¼˜åŒ–ç‰ˆæœ¬å³Worklist Algorithmã€‚ è¿­ä»£ç®—æ³•çš„ä¸»è¦å¤æ‚åº¦åœ¨CFGä¸­ä¸€ä¸ªèŠ‚ç‚¹è¾“å‡ºæœ‰å˜åŒ–éƒ½éœ€è¦ä½¿å¾—æ•´ä¸ªCFGè¿­ä»£ï¼Œè€ŒWorklist Algorithmåˆ™æ˜¯è¿­ä»£ç®—æ³•çš„ä¸€ç§å‰ªæžä¼˜åŒ–ã€‚ 123456789101112&gt;OUT[entry] = nullptr;&gt;for(each basic block\entry)&gt; OUT[B] = nullptr;&gt;Worklist âŸµ all basic blocks&gt;while(Worklist is not empty) &gt; Pick a basic block B from Worklist&gt; old_OUT = OUT[B]&gt; IN[B] = âŠ”OUT[P]&gt; OUT[B] = gen_B â‹ƒ (IN[B] - kill_B)&gt; if(old_OUT â‰  OUT[B]) &gt; add all successors of B to Worklist&gt; è‡³æ­¤ï¼Œæ•°æ®æµåˆ†æžçš„å­¦ä¹ å‘Šä¸€æ®µè½ã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>PL</tag>
        <tag>Software-Analysis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[NJUé™æ€ç¨‹åºåˆ†æž(0-Introduction)]]></title>
    <url>%2F2021%2F05%2F02%2FNJU%E9%9D%99%E6%80%81%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90-0-Introduction%2F</url>
    <content type="text"><![CDATA[Abstract ç¼–è¯‘å™¨ä½œä¸ºå·¥ä¸šç•Œå¯¹PLç†è®ºçš„éƒ¨åˆ†å®žçŽ°â€”â€”å’Œç¼–ç¨‹è¯­è¨€ï¼Œè¿è¡Œæ—¶çŽ¯å¢ƒä¸€æ ·åªæ˜¯æœºå™¨è§£é‡Šä¸–ç•Œçš„ä¸€ä¸ªè§’åº¦ã€‚è€Œå½“æˆ‘è§£é”äº†ä»Žæ›´åŠ PLçš„æ–¹å¼çœ‹å¾…è®¡ç®—è¿™ä»¶äº‹æƒ…ä¹‹åŽï¼Œåˆæ‰“å¼€äº†ä¸€æ‰‡é€šå¾€æ–°ä¸–ç•Œçš„å¤§é—¨ã€‚è¿‡åŽ»çš„å‡ åå¹´é‡ŒProgramming Languageçš„å†…æ ¸å¹¶æ²¡æœ‰å˜åŒ–å¤šå°‘â€”â€”ä½†æ˜¯ç¨‹åºæœ¬èº«å´éšç€åº”ç”¨éœ€æ±‚å˜çš„æ›´åŠ åºžå¤§å’Œå¤æ‚ã€‚è€Œé™æ€ç¨‹åºåˆ†æžä½œä¸ºPLçš„é‡è¦åº”ç”¨ï¼Œå…¶ç›®çš„å°±åœ¨äºŽåœ¨ç¼–è¯‘æœŸç¡®ä¿ç¨‹åºçš„å¯é æ€§ï¼Œå®‰å…¨æ€§ç­‰å„ç§æ€§è´¨ã€‚ â€‹ Static Analysis analyzes a program P to reasono about its behaviors and determines whether it satisfies some properties before running P. â€‹ ä¸»è¦çš„å­¦ä¹ èµ„æºæ˜¯NJU-PASCALå›¢é˜Ÿçš„é™æ€åˆ†æžè¯¾ç¨‹ä»¥åŠé¾™ä¹¦å’Œé²¸ä¹¦ä¸­çš„éƒ¨åˆ†ç« èŠ‚ã€‚ Static-Analysis â€‹ PLçš„å¤§æ¡†æž¶å¤§ä½“ä¸Šå¯ä»¥åˆ†æˆä¸‰ä¸ªéƒ¨åˆ†: Theory åŒ…æ‹¬å¦‚ä½•è®¾è®¡ä¸€ä¸ªè¯­è¨€å†…æ ¸ï¼Œä¸€ä¸ªç±»åž‹ç³»ç»Ÿï¼Œå¦‚ä½•å®Œæˆè¯­ä¹‰åˆ†æžï¼Œå¦‚ä½•å½¢å¼åŒ–ç­‰ç­‰ä¸åŒçš„ç†è®ºï¼Œæ›´å¤šæ˜¯ä½œä¸ºå­¦æœ¯ç ”ç©¶çš„è¯¾é¢˜ Environment é’ˆå¯¹ç‰¹å®šåœºæ™¯è®¾è®¡çš„ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶çŽ¯å¢ƒç­‰ Application ç¨‹åºåˆ†æžï¼Œç¨‹åºåˆæˆï¼Œç¨‹åºéªŒè¯ â€‹ è€Œé™æ€ç¨‹åºåˆ†æžä¸»è¦å…³æ³¨åœ¨ç¨‹åºçš„Reliabilityæ¯”å¦‚åœ¨ç¨‹åºè¿è¡Œå‰æ£€æµ‹åˆ°ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå†…å­˜æ³„æ¼ç­‰é—®é¢˜é˜²æ­¢ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­æŠ¥è¿è¡Œæ—¶é”™è¯¯ï¼›Securityæ¯”å¦‚éšç§æ•°æ®æ³„éœ²ï¼Œæ³¨å…¥æ”»å‡»injection attackç­‰ï¼›Optimizationç¼–è¯‘ä¼˜åŒ–ç­‰æ–¹é¢ã€‚ Riceâ€˜s Theorem â€‹ Any non-trivial property of the behavior of programs in a recursively enumerable language is undecidable. â€‹ è¿™ä¸ªå®šç†æœ‰ç‚¹å“¥å¾·å°”ä¸å®Œå¤‡å®šç†çš„æ„Ÿè§‰â€”â€”ä¸å­˜åœ¨ä¸€ä¸ªå®Œç¾Žçš„åˆ†æžç®—èƒ½å‡†ç¡®é¢„æµ‹å‡ºç¨‹åºçš„å„ç§å…³é”®è¡Œä¸ºï¼Œå³No Silver Bulletã€‚è¿™ä¹Ÿå¼•å‡ºäº†åœ¨å®žè·µä¸­æœ€é‡è¦çš„ä¸€ä¸ªè¯„åˆ¤æ ‡å‡†Soundå’ŒCompleteã€‚ â€‹ è¿™é‡Œçš„recursively enumerableé€’å½’å¯æžšä¸¾æ˜¯å›¾çµå®Œå¤‡çš„å¦ä¸€ç§è¯´æ³•ï¼Œç®€å†™ä¸ºr.e.ã€‚ Sound and Complete â€‹ å‡è®¾ä¸€ä¸ªç¨‹åºä¸­å­˜åœ¨10ä¸ªunknown errorï¼Œä¸€å¥—åˆ†æžæ¡†æž¶ä¸å¯èƒ½ç²¾ç¡®å®šä½åˆ°è¿™åä¸ªã€‚è€Œæ˜¯åœ¨å…¶å€¼åŸŸèŒƒå›´å†…æ³¢åŠ¨â€”â€”ä¸ä»…ä»…åŒ…å«è¿™10çš„é›†åˆå°±æ˜¯Soundï¼ŒåªåŒ…å«è¿™10ä¸ªçš„å­é›†å°±æ˜¯Completeã€‚ â€‹ ä¼´éšç€è¿™ä¸€å¯¹æ¦‚å¿µè¿˜æœ‰ä¸€å¯¹â€”â€”false negativeså’Œfalse positivesã€‚ False negatives å°±æ˜¯Compromise soundnessä¹Ÿå°±æ˜¯ç¼©å°åŽŸæ¥åˆ†æžçš„é‡ï¼Œè¿™æ ·ä¼šæ›´åŠ çš„completeâ€”â€”ä¾¿ä¼šäº§ç”Ÿæ¼æŠ¥ False positives å°±æ˜¯Compromise completenessä¹Ÿå°±æ˜¯å¢žå¤§åŽŸæ¥åˆ†æžçš„é‡ï¼Œè¿™æ ·ä¼šæ›´åŠ çš„soundâ€”â€”ä¾¿ä¼šäº§ç”Ÿè¯¯æŠ¥ å…¶å®žè¿™é‡Œä¸ºä»€ä¹ˆè¦å¼•å…¥è¿™ä¸€å¯¹æ¦‚å¿µæˆ‘æ²¡æœ‰å¤ªç†è§£â€¦â€¦æœ‰ç‚¹å¾€å›žç»•çš„æ„æ€ã€‚ è¿™ä¸ªå›¾å¾—å¥½å¥½ç†è§£ä¸€ä¸‹ã€‚ åœ¨å®žè·µä¸­ï¼Œç”¨çš„æ›´å¤šçš„æ ‡å‡†æ˜¯compromising completenessä¹Ÿå°±æ˜¯è¦è®©ç»“æžœæ›´åŠ çš„soundä½†æ˜¯æŸå¤±äº†ç²¾ç¡®åº¦ã€‚æ¢å¥è¯è®²ï¼Œåˆ†æžçš„ç»“æžœä¸€å®šè¦å…¨é¢ï¼Œä½†ä¸ä¸€å®šç²¾ç¡®ã€‚ä¹Ÿå°±æ˜¯è¯´å®å¯è¯¯æŠ¥ä¸€äº›åˆ†æžè¡Œä¸ºï¼Œä¹Ÿä¸å…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶æŠ¥å¼‚å¸¸â€”â€”è¿™æ ·æ•´ä¸ªç³»ç»Ÿä»˜å‡ºä»£ä»·ä¼šæ›´é«˜ã€‚ ä¾‹å­ 12345678910111213141516171819&gt; class A&#123;&#125;;&gt; class Base&#123;&gt; A fld;&gt; &#125;;&gt; class B : A&#123;&#125;;&gt; class C : A&#123;&#125;;&gt; &gt; Base a = new Base();&gt; if(condition) &#123;&gt; B b = new B();&gt; a.fld = b;&gt; &#125;else &#123;&gt; C c = new D();&gt; a.fld = c;&gt; &#125;&gt; &gt; // case&gt; B bTmp = (B)a.fld;&gt; å¯ä»¥çœ‹åˆ°ä¸Šä¾‹ä¸­çš„caseä¸­è¿›è¡Œäº†ä¸€æ¬¡å¼ºåˆ¶è½¬æ¢ï¼Œå¦‚æžœæŽ§åˆ¶æµèµ°çš„æ˜¯!conditioné‚£ä¹ˆå°±ä¼šæŠ¥é”™ã€‚å¦‚æžœåˆ†æžå™¨æ˜¯soundçš„è¿™é‡Œå°±åº”è¯¥æ£€æµ‹å‡ºè¯¥ç¨‹åºçš„æŽ§åˆ¶æµé”™è¯¯â€”â€”ä»Žè€Œå‡å°‘äº†BUGã€‚ tradeoff â€‹ å› ä¸ºsoundä¼šåˆ†æžå‡ºæ¯”ç†è®ºæ›´å¤šçš„ç»“æžœï¼Œæ‰€ä»¥å¯¼è‡´åˆ†æžçš„é€Ÿåº¦ä¼šå˜æ…¢ã€‚ â€‹ Static Analysis ensure soundness, while making good trade-offs between analysis precision and analysis speedâ€”â€”åˆ†æžè¿‡ç¨‹çš„æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ç§é€Ÿåº¦å’Œç²¾åº¦ä¹‹é—´çš„æƒè¡¡ã€‚ To Conclude â€‹ å¤§éƒ¨åˆ†åˆ†æžæ–¹å¼å¯ä»¥æ€»ç»“ä¸ºä¸‹é¢çš„ä¸¤ä¸ªéƒ¨åˆ†ï¼š Abstraction å°±æ˜¯å°†å…·ä½“çš„ç¨‹åºç‰¹å¾å’Œè¡Œä¸ºè¿›ä¸€æ­¥æŠ½è±¡æˆåˆ†æžå™¨çš„å…ƒç¬¦å·ï¼Œå®Œæˆä¸€å®šæ„ä¹‰çš„æ‰€è°“å½¢å¼åŒ– Over-approximation transfer functions In static analysis, transfer functions define how to evaluate different program statements on abstract values. Its defined according to &quot;analysis problem&quot; and the &quot;semantics&quot; of different program statements. control flows ç¨‹åºçš„æœ¬è´¨å…¶å®žå°±æ˜¯è¯­å¥åŠè¯­å¥ä¹‹é—´çš„å…³è”ï¼Œæ˜ å°„åˆ°static analysisä¸­å°±æ˜¯ï¼ˆè¯­å¥ï¼‰transfer functionså’Œï¼ˆå…³è”ï¼‰control flowsã€‚åœ¨æŠ½è±¡çš„åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥é¢—ç²’åŒ–ç¨‹åºè¿è¡Œè¡Œä¸ºã€‚æ¯”å¦‚transfer functionså®šä¹‰ä¸ºç¨‹åºä¸­statementså’Œç¨‹åºå¼‚å¸¸è¡Œä¸ºçš„è¯­ä¹‰æ¯”å¦‚å£°æ˜Žè¯­å¥ï¼Œé™¤é›¶å¼‚å¸¸ç­‰ã€‚è€Œcontrol flowså®šä¹‰äº†ç¨‹åºçš„æŽ§åˆ¶æµæ¯”å¦‚ä¸€äº›if-elseåˆ†æ”¯ã€‚è¿™æ ·å°±èƒ½æ›´åŠ ç»†ç²’åº¦çš„å®Œæˆç¨‹åºè¡Œä¸ºçš„å»ºæ¨¡ï¼Œç„¶åŽåœ¨æ¨¡åž‹åŸºç¡€ä¸Šå®Œæˆåˆ†æžå™¨é¢„å®šçš„soundçš„åˆ†æžç»“æžœã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>PL</tag>
        <tag>Software-Analysis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å‡½æ•°å¼ç¼–ç¨‹ï¼ˆOcamlï¼‰]]></title>
    <url>%2F2021%2F04%2F18%2F%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%EF%BC%88Ocaml%EF%BC%89%2F</url>
    <content type="text"><![CDATA[Abstract â€‹ æœ€è¿‘åœ¨å®žéªŒå®¤å®žä¹ çš„è¿‡ç¨‹ä¸­å­¦åˆ°äº†å¾ˆå¤šæœ‰æ„æ€çš„ä¸œè¥¿ï¼Œå¯¹Programming Languagesä¹Ÿæœ‰äº†æ›´æ·±çš„äº†è§£ï¼ŒOcamlæ˜¯ä¸€é—¨æ”¯æŒå¤šèŒƒå¼çš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ã€‚ç¨‹åºæè¿°è®¡ç®—ï¼Œä½†æ˜¯åˆä¸ä»…ä»…æ˜¯è®¡ç®—ã€‚Ocamlçš„å­¦ä¹ å¸¦ç»™æˆ‘çš„ä¸ä»…ä»…æ˜¯è¯­è¨€æœ¬èº«ï¼Œè¿™ä¸ªç³»åˆ—è®°å½•äº†å…¶ä¸­çš„éƒ¨åˆ†å¿ƒå¾—: å…³äºŽscripting/imperative/object-oriented/functional PLçš„åŸºæœ¬æ¦‚å¿µ Higher-order Functions State-Full vs State-Free Computation Modelling Objects and Closures Exceptions/Continuations to Defer Control Polymorphism Partial Evaluation/Lazy Programming/Modules å…³äºŽreason about programsçš„æ–¹æ³• Type Checking Induction Operational Semantics QuickCheck å…³äºŽè®¾è®¡ä¸€é—¨è¯­è¨€çš„åŸºæœ¬è§„åˆ™ FP's Basic Concepts Ocaml is a statically typed functional programminng languageã€‚å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œfunctionæ°¸è¿œæ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œç¨‹åºä¸­åªæœ‰expressionçš„æ¦‚å¿µï¼Œé€šè¿‡functionsé€’å½’å¤„ç†valuesæ¥å®Œæˆcomputationsã€‚Ocamlé€šè¿‡pattern matchingæ¨¡å¼åŒ¹é…çš„æ–¹å¼æ¥å®šä¹‰é€’å½’æ•°æ®ç»“æž„å’Œå‡½æ•°ï¼Œè¿›è€Œå†™å‡ºæ›´ç®€æ´çš„ç¨‹åºã€‚ åœ¨å‡½æ•°å¼ä¸­è¿˜æœ‰ä¸€ä¸ªå’Œimperative PL.ä¸­ä¸åŒçš„æ¦‚å¿µç§°ä¸ºeffect-free programmingã€‚åœ¨å‘½ä»¤å¼è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ç»™variables/fieldsèµ‹å€¼æ¥ä¿®æ”¹ç¨‹åºçŠ¶æ€å¹¶å°†èµ‹å€¼è¡Œä¸ºçš„ç»“æžœçœ‹æˆæ˜¯effectsã€‚ä½†æ˜¯æ¯”å¦‚å‡½æ•°å¼å°±ä¸ä¼šexplicitlyçš„åˆ†é…å†…å­˜ï¼Œç”šè‡³æ²¡æœ‰exception handlingæ¥æ”¹å˜æŽ§åˆ¶æµçŠ¶æ€â€”â€”ä¸æ”¯æŒeffectè¢«ç§°ä¸ºpure functiionalæ¯”å¦‚Haskellã€‚Ocamlä¸æ˜¯çº¯å‡½æ•°å¼è¯­è¨€ã€‚æ‰€ä»¥æ”¯æŒeffectful/state-full programmingå’Œpure FPã€‚ æœ€åŽä¸€ä¸ªå…³é”®å­—å°±æ˜¯statically typedé™æ€ç±»åž‹ã€‚Types statically approximate the runtime behaviour of an expression.æ„æ€å°±æ˜¯static type checkingæœ¬èº«æ˜¯åœ¨ç¨‹åºè¿è¡Œä¹‹å‰è¿›è¡Œç±»åž‹æ£€æŸ¥â€”â€”é€šè¿‡syntatic structure of expressionsã€‚å®ƒå¯ä»¥ä¿è¯é€šè¿‡é™æ€ç±»åž‹æ£€æŸ¥çš„ç¨‹åºåœ¨è¿è¡Œæ—¶ä¸€å®šä¸ä¼šcore dumpã€‚è¿™æ ·çš„statically typed PL.æ¯”å¦‚Ocaml/Java/ML/Haskell/Scalaç­‰ä¹Ÿè¢«ç§°ä¸ºæ˜¯type-safeçš„ã€‚ Expressions, Names, Values and Types åœ¨å‡½æ•°å¼ä¸­æ²¡æœ‰è¯­å¥statementsï¼Œæœ€åŸºæœ¬çš„expressionå°±æ˜¯numbers/strings/booleansã€‚ 12345&gt; # 2 + 3;;&gt; - : int = 5&gt; # 4.0 /. 2.0;;&gt; - : float = 2.0&gt; ä¸Šé¢ä»£ç ä¸­çš„æ ¼å¼ä¸º&lt;name&gt; : &lt;type&gt; = &lt;value&gt; ã€‚æˆ‘ä»¬å°†;;ä¹‹å‰çš„å¼å­ç§°ä¸ºexpressionsï¼Œå°†æ•´ä¸ªè®¡ç®—è¿‡ç¨‹ç§°ä¸ºevaluationï¼Œè€Œå°†è®¡ç®—çš„ç»“æžœç§°ä¸ºvaluesã€‚ æ³¨æ„åœ¨Ocamlä¸­åŸºç¡€è¿ç®—ç¬¦å¹¶æ²¡æœ‰è¢«é‡è½½ï¼Œæ•…æµ®ç‚¹è¿ç®—éƒ½æ˜¯åœ¨åŽé¢æœ‰ä¸€ä¸ª,ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºOcamlæ˜¯é™æ€ç±»åž‹çš„ï¼Œä¸ä¼šåœ¨è¿è¡Œæ—¶åŽ»æ ¹æ®è¿ç®—ç¬¦å‚æ•°æ¥æŽ¨å¯¼é‡è½½çš„operatorsã€‚ é€šè¿‡ç±»åž‹æ£€æŸ¥çš„ç¨‹åºï¼Œå…¶evaluationè¦ä¹ˆæ›´æ–°åˆ°ä¸€ä¸ªæ–°çš„stateè¦ä¹ˆæŠ¥ä¸€ä¸ªbuilt-in runtime errorã€‚æ¯”å¦‚: 123&gt; # 3 / 0;;&gt; Exception: Division_by_zero&gt; Variables, Bindings and Functions Ocamlæ˜¯ä¸€ä¸ªcall-by-valueçš„è¯­è¨€â€”â€”it binds values to variable names not expressionsã€‚è¿™é‡Œæœ‰ä¸€ä¸ªbindingçš„æ¦‚å¿µï¼ŒåŒºåˆ†äºŽassignmentã€‚æˆ‘ä»¬åªæ˜¯åœ¨valueså’Œnameä¹‹é—´å»ºç«‹äº†â€œé“¾æŽ¥â€â€”â€”å¹¶æ²¡æœ‰æ–°çš„stateè¢«åˆ›å»ºâ€”â€”æˆ‘ç†è§£å’Œimperative PL.ä¸åŒçš„åº”è¯¥æ˜¯å†…å­˜æ¨¡åž‹æ¯”å¦‚Cä¸­å¯¹å±€éƒ¨å˜é‡æ˜¯æ”¾åœ¨æ ˆä¸Šçš„ä½†æ˜¯ç¡®å®žåˆ›å»ºäº†å†…å­˜ã€‚å½“ç„¶è¿™ç§â€œé“¾æŽ¥â€ä¹Ÿæ˜¯å¯ä»¥æ›´æ–°çš„ã€‚åœ¨Ocamlä¸­ç”¨letè¡¨è¾¾å¼æ¥å»ºç«‹ä¸€ä¸ªç»‘å®šã€‚ 12345&gt; # let x = 3 * 3;;&gt; val x : int = 9&gt; # let x = 42;;&gt; val x : int = 42&gt; å˜é‡çš„ä½œç”¨åŸŸæ˜¯æ ¹æ®binding stackæ¥ç¡®å®šçš„ã€‚å±€éƒ¨æˆ–è€…ä¸´æ—¶åˆ›å»ºçš„bindingéƒ½ä¼šè¢«pushè¿›binding stackä¸­ï¼Œåœ¨ä¸éœ€è¦çš„æ—¶å€™ä¼šè¢«GCæ¸…é™¤ã€‚ 1234567&gt; # let k = 4;;&gt; val k : int = 4&gt; # let k = 3 in k * k ;;&gt; - : int = 9&gt; # k;;&gt; - : int = 4&gt; è¿™é‡Œæœ‰ä¸€ä¸ªæ–°çš„let &lt;name&gt; = &lt;expression 1&gt; in &lt;expression 2&gt;ç»“æž„â€”â€”å°†expression1çš„valueç»‘å®šåˆ°nameä¸Šï¼Œç„¶åŽç»§ç»­ä½¿ç”¨è¿™ä¸ªæ–°çš„ç»‘å®šå¯¹expression 2è¿›è¡Œevalutionsã€‚ åœ¨å‡½æ•°å¼ä¸­letä¸ä»…å¯ä»¥ç»‘å®šåŸºæœ¬ç±»åž‹ï¼Œè¿˜å¯ä»¥ç»‘å®šå‡½æ•°ã€‚ 12345&gt; let area : float -&gt; float = function r -&gt; pi *. r *. r;;&gt; let area : float -&gt; float = fun r -&gt; 3.14 *. r *. r;;&gt; let area (r:float) = pi *. r *. r;;&gt; let a1 = area(2.0);;&gt; ä¸Šé¢çš„ä¸‰ç§å†™æ³•æ˜¯ç­‰ä»·çš„ï¼Œéƒ½å¾—åˆ°å‡½æ•°ç±»åž‹val area : float -&gt; float = &lt;fun&gt;ã€‚æœ‰æ„æ€çš„æ˜¯å‡½æ•°ä½œä¸ºä¸€ç§ç»‘å®šï¼Œä¹Ÿæ˜¯åœ¨binding stackä¸­çš„ï¼Œæ‰€ä»¥å®ƒåªèƒ½çœ‹åˆ°è¿‡åŽ»çš„ç»‘å®šï¼š 1234567891011&gt; # let (pi*float) = 3.0&gt; val pi : float = 3.14&gt; # let area (r:float) = pi *. r *.r;;&gt; val area : float -&gt; float = &lt;fun&gt;&gt; # let a1 = area(2.0);;&gt; val a1 : float = 12.0&gt; # let (pi*float) = 4.0&gt; val pi : float = 4.0&gt; # let a2 = area(2.0);;&gt; val a2 : float = 12.0&gt; æœ€åŽä»‹ç»ä¸€ä¸‹é€’å½’å‡½æ•°ã€‚åœ¨Ocamlä¸­é€’å½’å‡½æ•°ä½¿ç”¨let recæ¥å£°æ˜Žã€‚æ¯”å¦‚å®šä¹‰factorial: 123456&gt; # exception Domain;;&gt; # let rec fact n = &gt; if n &lt; 0 then raise Domain&gt; else if n = 0 then 1&gt; else n * fact(n - 1);;&gt; åœ¨å‡½æ•°å¼ä¸­æ‰€æœ‰çš„å‡½æ•°éƒ½å¯ä»¥è¢«å†™æˆå°¾é€’å½’çš„å½¢å¼ç„¶åŽè¿›ä¸€æ­¥ä¼˜åŒ–â€”â€”è¿™æ˜¯å› ä¸ºå°¾é€’å½’å‡½æ•°çš„æ ˆå¸§å¯ä»¥è¢«ä¼˜åŒ–æŽ‰ã€‚æ¯”å¦‚: 123456&gt; # let fact_tr n = &gt; let rec f n acc = &gt; if n = 0 then acc else f (n - 1) (n * acc)&gt; in&gt; f n 1&gt; Data Types and Pattern Matching è¿™ä¸€èŠ‚å¯ä»¥åœ¨Ocamlä¸­å®šä¹‰è‡ªå·±çš„é€’å½’/éžé€’å½’çš„æ•°æ®ç±»åž‹ã€‚ Ocamlä½¿ç”¨typeæ¥å®šä¹‰æœ‰é™æ— åºçš„éžé€’å½’é›†åˆï¼Œè¿™é‡Œä¸¾ä¸€ä¸ªæ‰‘å…‹ç‰Œçš„ä¾‹å­: 123456789101112&gt; # type suit = Clubs | Spades | Hearts | Diamonds;;&gt; type suit = Clubs | Spades | Hearts | Diamonds&gt; # type rank = Two | Three | Four | Five | Six | Seven | Eight | Nine | Ten | Jack | Queen | King | Ace;;&gt; # type card = rank * suit;;&gt; type card = rank * suit&gt; # type hand = Empty | Hand of card * hand;;&gt; type hand = Empty | Hand of card * hand&gt; # let rec dom (s1, s2) = match (s1, s2) with &gt; | (Spades, _) -&gt; true&gt; | (Hearts, Diamonds) -&gt; true&gt; | (s1, s2) -&gt; s1 = s2&gt; Ocamlä½¿ç”¨pattern matchingæ¨¡å¼åŒ¹é…æ¥æ“ä½œè¿™äº›æ•°æ®ç»“æž„ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªæ¦‚å¿µâ€”â€”patternså’Œconstructorsã€‚æ¯ä¸€ä¸ªpatternç”±ä¸åŒçš„constructorså¡«å……â€”â€”è¿™é‡Œçš„æž„é€ å™¨æŒ‡çš„æ˜¯æ¯ä¸€ä¸ªå’Œç±»åž‹å…ƒç´ åŒåçš„æž„é€ å™¨æ¯”å¦‚Clubsã€‚Ocamlè§„å®šæž„é€ å™¨é¦–å­—æ¯å¿…é¡»å¤§å†™ï¼Œä¸”åŒ¹é…æ˜¯ä»Žä¸Šåˆ°ä¸‹çš„é¡ºåºã€‚ è¿›ä¸€æ­¥çš„ï¼Œä¸ºäº†ç®€åŒ–ä»£ç è€Œæ”¯æŒinductivelyçš„deep patternæž„é€ å½¢å¼å¦‚ä¸‹: 12345&gt; # let rec add c1 c2 = match c1 c2 with&gt; | (Hearts, v1), (Hearts, v2) -&gt; v1 + v2&gt; | _, _ -&gt; 0;;&gt; val add : ('a -&gt; (suit * int) * (suit * int)) -&gt; 'a -&gt; int = &lt;fun&gt;&gt; è¿™é‡Œä¼šå‘çŽ°æž„é€ äº†ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ç±»åž‹('a -&gt; (suit*int)*(suit*int)) -&gt; 'a -&gt; intã€‚å…¶ä¸­type1 * type2ä¸ºä¸€ä¸ªpairï¼Œè€Œ`aä¸ºä»»æ„ç±»åž‹ã€‚ ä¸Šè¿°å‡½æ•°çš„åŸºæœ¬ç±»åž‹æŽ¨å¯¼è¿‡ç¨‹ä¸ºä¸¤ä¸ªä»»æ„ç±»åž‹ä¸ºè¾“å…¥å‚æ•°ï¼Œintä¸ºè¾“å‡ºã€‚å…¶ä¸­ä»»æ„ç±»åž‹ä¸º(suit*int)*(suit*int)çš„ã€‚ ä¸Šé¢æ‰‘å…‹ç‰Œçš„ä¾‹å­ä¸­handå®šä¹‰ä¸€ç»„æ— é™é€’å½’é›†åˆã€‚åœ¨handç±»åž‹ä¸­ï¼ŒEmptyå’ŒHandåˆ†åˆ«ä¸ºä¸¤ä¸ªconstructorsã€‚Emptyæ²¡æœ‰è¾“å…¥å‚æ•°ï¼Œè€ŒHandä»¥a tuple of a card and another handçš„ä¸€ä¸ªtupleä¸ºè¾“å…¥å‚æ•°ã€‚çœ‹ä¸‹é¢çš„å®žä¾‹åŒ–ä¾‹å­: 12345678910&gt; # let hand0: hand = Empty&gt; let hand1: hand = Hand((Ace, Hearts), Empty)&gt; let hand2: hand = Hand((Queen, Diamonds), hand1)&gt; let hand3:hand = &gt; Hand((Ace, Spades),&gt; Hand((Ten, Diamonds), &gt; Hand((Seven, Clubs),&gt; Hand((Queen, Spades),&gt; Hand((Eight, Clubs), Empty)))));;&gt; è¿™ä¸ªhandç±»åž‹å®žé™…ä¸Šå°±æ˜¯ä¸€æ£µé€€åŒ–çš„äºŒå‰æ ‘ï¼ˆåªèƒ½é å³ç”Ÿé•¿ï¼‰â€”â€”å¶å­æ˜¯Emptyï¼Œ è€ŒHandæž„é€ å™¨ä½¿ç”¨ä¸¤ä¸ªå‚æ•°æ¥å»ºæ ‘ã€‚ ä¸‹é¢æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¿™é‡Œå‡½æ•°çš„ç±»åž‹æ˜¯suit -&gt; hand -&gt; handï¼ŒåŠŸèƒ½æ˜¯ç»™å®šä¸€ä¸ªsuit -&gt; handçš„è¾“å…¥ï¼Œç„¶åŽä»Žhandä¸­æ‰¾æœ‰åŒ¹é…åˆ°suitç±»åž‹çš„handç„¶åŽè¿”å›žã€‚ 123456&gt; # let rec extract (s:suit) (h:hand) = match h with &gt; | Empty -&gt; Empty&gt; | Hand ((_, s') as c, h') -&gt;&gt; if s = s' then Hand(c, extract s h')&gt; else extract s h'&gt; ä¸Šä¸€ä¸ªå‡½æ•°ä¸­çš„Emptyå®žé™…ä¸Šå°±æ˜¯ä¸€ä¸ªç»ˆç»“ç¬¦ï¼Œæ„å‘³ç€å¦‚æžœhandç±»åž‹éƒ½ä¸åŒ¹é…çš„è¯å°±ç›´æŽ¥è¿”å›žEmptyã€‚ä½†æ˜¯å¦‚æžœæˆ‘è¦åŒ¹é…ä¸€ä¸ªcardçš„è¯ï¼Œæ²¡æœ‰åŒ¹é…ä¸Šè¯¥æ€Žä¹ˆè¿”å›žå‘¢ï¼ŸOcamlå¼•å…¥ä¸€ä¸ªoptional data typeã€‚æ¯”å¦‚ä¸‹é¢çš„å‡½æ•°: 12345678&gt; # type 'a option = None | Some of 'a&gt; type 'a option = None | Some of 'a&gt; # let rec find (r, h) = match h with&gt; | Empty -&gt; None&gt; | Hand((r', s'), h') -&gt; if r = r' then Some s'&gt; else find(r, h')&gt; val find: rank * hand -&gt; suit option = &lt;fun&gt;&gt; å…¶ä¸­option typeè¡¨ç¤ºç”±Someæž„é€ å™¨å®žçŽ°çš„ç±»åž‹ä¸º`açš„å…ƒç´ é›†åˆï¼Œæ˜¯ç¬¦åˆå¤šæ€çš„ä»»æ„ç±»åž‹ã€‚]]></content>
      <categories>
        <category>Ocaml</category>
      </categories>
      <tags>
        <tag>PL</tag>
        <tag>FP</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Lispè¯­è¨€å’ŒEmacs]]></title>
    <url>%2F2021%2F02%2F16%2FLisp%E8%AF%AD%E8%A8%80%E5%92%8CEmacs%2F</url>
    <content type="text"><![CDATA[Abstract â€‹ ç¬¬ä¸€æ¬¡æŽ¥è§¦EMACSæ˜¯å¤§äºŒçš„æ—¶å€™ï¼Œå½“æ—¶åªé¡¾ç€æ–°å¥‡çš„ç•Œé¢å’Œå¼ºå¤§çš„åŠŸèƒ½å´å¿½è§†äº†å…¶èƒŒåŽçœŸæ­£çš„ç†è®ºã€‚åŽæ¥æˆ‘å†™ä»£ç ä¹Ÿä¸€ç›´ä¸å–œæ¬¢IDEè¿™ç§ä¸œè¥¿ï¼Œä½†çŽ°åœ¨å›žè¿‡å¤´æ¥çœ‹ï¼Œè¿™è²Œä¼¼ä¹Ÿåªæ˜¯ä¸€ç§æµ®äºŽè¡¨é¢è€Œæ— å…³åŽŸç†çš„æ‰§æ‹—ã€‚ â€‹ è¿™æ¬¡é‡æ–°å›žå½’åˆ°Spacemacsï¼Œæˆ‘å¸Œæœ›ä»”ç»†ä»ŽLispçš„è§’åº¦ç†è§£è¿™æ¬¾ç¼–è¾‘å™¨ï¼Œä¸ç®¡æ˜¯å…¶æ’ä»¶ç‰¹æ€§è¿˜æ˜¯è¯­è¨€æœ¬èº«ã€‚]]></content>
      <categories>
        <category>Lisp</category>
      </categories>
      <tags>
        <tag>EMACS</tag>
        <tag>PL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[WebAssemblyå’ŒWabt]]></title>
    <url>%2F2020%2F11%2F12%2FWebAssembly%E5%92%8CWabt%2F</url>
    <content type="text"><![CDATA[Abstract æœ€è¿‘å‚åŠ deeplangçš„çš„è¿‡ç¨‹ä¸­ï¼ŒæŽ¥è§¦åˆ°äº†ä¸€äº›ç¼–è¯‘é¢†åŸŸçš„æ–°æŠ€æœ¯ï¼Œæ€»ç»“ä¸€ä¸‹å¸Œæœ›æœ‰æ—¶é—´äº†å¯ä»¥è¿›ä¸€æ­¥çš„æ·±å…¥äº†è§£ã€‚å‚è€ƒèµ„æ–™æ˜¯WebAssemblyæ ‡å‡†å…¥é—¨ã€‚ Points è¿‡åŽ»å¾ˆå¤šæŠ€æœ¯å°è¯•å°†C/C++ç¨‹åºç›´æŽ¥è¿è¡Œåœ¨æµè§ˆå™¨ä¸­ï¼Œæ¯”å¦‚TypeScript å°†C/C++ä»£ç è½¬æ¢ä¸ºJSã€‚ Emscripten è€Œè¿™ä¸ªé¡¹ç›®åˆ©ç”¨LLVMç¼–è¯‘å™¨å‰ç«¯ç¼–è¯‘C/C++ä»£ç ï¼Œç”ŸæˆLLVMå¹³å°ç‰¹æœ‰çš„è·¨å¹³å°ä¸­é—´è¯­è¨€ä»£ç ï¼Œæœ€ç»ˆå†å°†IRè½¬æ¢ä¸ºJavaScriptçš„asm.jså­é›†â€”â€”è¿™æ˜¯WebAssemblyçš„åŸºç¡€ã€‚ AOTç¼–è¯‘ JITç¼–è¯‘ JITçš„ä¼˜ç‚¹åœ¨äºŽProfile-Based Optimizationï¼Œæ ¹æ®è¿è¡Œæ—¶ä¿¡æ¯ç„¶åŽéšç€æ—¶é—´çš„æŽ¨ç§»å°½å¯èƒ½çš„å¾—åˆ°æœ€ä¼˜çš„ä»£ç ã€‚ è€ŒAOTçš„ä¼˜ç‚¹åœ¨äºŽæ— éœ€runtimeè¿è¡Œï¼Œç›´æŽ¥é™æ€é“¾æŽ¥è‡³æœ€ç»ˆçš„ç¨‹åºä¸­ã€‚ WebAssembly JavaScriptè¿è¡Œåœ¨å…¶è™šæ‹Ÿæœºä¸Šï¼Œè€ŒWebAssemblyä¹Ÿè¿è¡Œåœ¨å…¶è™šæ‹Ÿæœºä¸Šã€‚è€ŒçŽ°åœ¨Node.js 8.0ä¹‹åŽçš„ç‰ˆæœ¬ä¹Ÿå¯ä»¥è¿è¡ŒWebAssemblyâ€”â€”ä¹Ÿå°±æ˜¯è¯´WebAssemblyè™šæ‹Ÿæœºå¯ä»¥è„±ç¦»JSçš„çŽ¯å¢ƒæ”¯æŒï¼Œä¸ä»…ä»…è¿è¡Œåœ¨æµè§ˆå™¨ä¸­ã€‚ WebAssemblyæ¦‚è¿° å’ŒLLVM IRå¾ˆåƒï¼Œæœ‰ä¸¤ç§æ±‡ç¼–è¡¨ç¤ºâ€”â€”.watæ–‡æœ¬è¡¨ç¤ºå’Œ.wasmæœºå™¨è¡¨ç¤ºã€‚ å…³é”®æ¦‚å¿µ æ¨¡å— ç”±.wasmç¼–è¯‘è€Œæ¥çš„å¯æ‰§è¡Œæœºå™¨ç çš„äºŒè¿›åˆ¶å¯¹è±¡ã€‚ å†…å­˜ ç½‘é¡µçŽ¯å¢ƒä¸‹ï¼Œwasmçš„å†…å­˜ç”±JavaScriptä¸­çš„ArrayBufferå¯¹è±¡å®žçŽ°çš„ã€‚ è¡¨æ ¼ å¼•å…¥è¡¨æ ¼å¯¹è±¡ç”¨äºŽå­˜å‚¨å‡½æ•°å¼•ç”¨æ¥æ¨¡æ‹ŸC/C++æŒ‡é’ˆã€‚ å®žä¾‹ å¯¼å…¥å¯¹è±¡ è°ƒç”¨JSå‡½æ•° å¯¼å‡ºå¯¹è±¡ æä¾›æŽ¥å£ æŒ‡ä¸€ä¸ªæ¨¡å—åŠå…¶è¿è¡Œæ—¶çš„æ‰€æœ‰çŠ¶æ€ï¼ŒåŒ…æ‹¬å†…å­˜ï¼Œè¡¨æ ¼ä»¥åŠå¯¼å…¥å¯¹è±¡ç­‰ã€‚æ¨¡å—åªæœ‰è¢«å®žä¾‹åŒ–ä¹‹åŽæ‰å¯ä»¥è°ƒç”¨ã€‚ ç¨‹åºç”Ÿå‘½å‘¨æœŸ å°†watæˆ–è€…å…¶ä»–è¯­è¨€ç¼–è¯‘æˆ.wasmæ–‡ä»¶ ç½‘é¡µä¸­ä½¿ç”¨fetchç­‰èŽ·å–.wasmæ–‡ä»¶ emrun --no_browser --port 8080 . å°†æ–‡ä»¶è¿è¡Œåœ¨httpåè®®ä¸Š ç„¶åŽæ‰“å¼€http://localhost:8080/xxx.html å°†.wasmç¼–è¯‘ä¸ºæ¨¡å—ï¼Œç¼–è¯‘è¿‡ç¨‹ä¸­è¿›è¡Œåˆæ³•æ€§æ£€æŸ¥ å®žä¾‹åŒ–ï¼Œåˆå§‹åŒ–å¯¼å…¥å¯¹è±¡ï¼Œåˆ›å»ºæ¨¡å—å®žä¾‹ æ‰§è¡Œå®žä¾‹çš„å¯¼å‡ºå‡½æ•°ï¼Œå®Œæˆæ“ä½œ è™šæ‹Ÿæœºä½“ç³»ç»“æž„ ä¸€ä¸ªå…¨å±€ç±»åž‹æ•°ç»„(å‡½æ•°ç­¾å) ä¸€ä¸ªå…¨å±€å‡½æ•°æ•°ç»„ ä¸€ä¸ªå…¨å±€å˜é‡æ•°ç»„ ä¸€ä¸ªå…¨å±€è¡¨æ ¼å¯¹è±¡(å…ƒç´ å¼•ç”¨) ä¸€ä¸ªå…¨å±€å†…å­˜å¯¹è±¡ ä¸€ä¸ªè¿è¡Œæ—¶æ ˆ Hello World JavaScriptéƒ¨åˆ†hello.html 12345678910111213141516171819202122232425&lt;!doctype html&gt;&lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Show me the answer&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var wasmMem = new WebAssembly.Memory(&#123;initial:1&#125;); function printStr(offset, length)&#123; var bytes = new Uint8Array(wasmMem.buffer, offset, length); var string = new TextDecoder('utf-8').decode(bytes); console.log(string); &#125;; var importObj = &#123;js : &#123;print: printStr, mem: wasmMem&#125;&#125;; fetch('hello.wasm').then(response=&gt; response.arrayBuffer() ).then(bytes=&gt; WebAssembly.instantiate(bytes, importObj) ).then(result =&gt; result.instance.exports.hello() ); &lt;/script&gt; &lt;/body&gt;&lt;/html&gt; watéƒ¨åˆ†hello.wat 12345678910111213 ;; hello.wat(module ;; import js::print as js_print(); (import "js" "print" (func $js_print (param i32 i32))) (import "js" "mem" (memory 1)) ;;import js::mem as memory (data (i32.const 0) "ä½ å¥½ï¼Œwasm") (func (export "hello") i32.const 0 ;; pass offset 0 to js_print i32.const 13 ;; pass offset 13 to js_print call $js_print ) ) é¦–å…ˆå°†.watç¼–è¯‘æˆä¸º.wasm,éœ€è¦ç”¨åˆ°wabtå·¥å…·é›†ã€‚è¿˜éœ€è¦ä¸‹è½½Emscriptenå·¥å…·é›†ã€‚ç¼–è¯‘å¥½ä¹‹åŽé…ç½®çŽ¯å¢ƒå˜é‡ã€‚å°±å¯ä»¥æ‰§è¡Œäº†ã€‚ 12$ wat2wasm hello.wat -o hello.wasm$ emrun --no_browser --port 8080 . ç„¶åŽæ‰“å¼€http://localhost:8080/xxx.htmlï¼Œå¯åŠ¨Chromeä¸‹çš„å¼€å‘è€…æ¨¡å¼ï¼Œçœ‹åˆ°æ‰§è¡ŒæˆåŠŸã€‚ WebAssemblyæ ¸å¿ƒ åœ¨JSçŽ¯å¢ƒä¸­ æµè§ˆå™¨ä¸­çš„wasmè¿è¡Œåœ¨JSè™šæ‹Ÿæœºä¸Šï¼Œé¡µé¢å¯ä»¥é€šè¿‡ä¸€ç»„JSå¯¹è±¡è¿›è¡Œwasmæ¨¡å—çš„ç¼–è¯‘ï¼Œè½½å…¥ï¼Œé…ç½®ï¼Œè°ƒç”¨ç­‰æ“ä½œã€‚ åœ¨wasmä¸­çš„å‡ ä¸ªå…³é”®æ¦‚å¿µéƒ½æœ‰ä¸Žä¹‹å¯¹åº”çš„å¯¹è±¡ï¼š æ¨¡å—â€”â€”WebAssembly.Module å†…å­˜â€”â€”WebAssembly.Memory è¡¨æ ¼â€”â€”WebAssembly.Table å®žä¾‹â€”â€”WebAssembly.Instance WebAssemblyæ±‡ç¼–è¯­è¨€]]></content>
      <categories>
        <category>JavaScript</category>
      </categories>
      <tags>
        <tag>Compiler</tag>
        <tag>PL</tag>
        <tag>WebAssembly</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LLVMæ¼«è°ˆï¼ˆ2-Implementing a Languageï¼‰]]></title>
    <url>%2F2020%2F07%2F07%2FLLVM%E6%BC%AB%E8%B0%88%EF%BC%882-Implementing-a-Language%EF%BC%89%2F</url>
    <content type="text"><![CDATA[Abstract åŸºäºŽLLVMå®žçŽ°ç®€å•çš„ç¼–ç¨‹è¯­è¨€kaleidoscopeï¼Œæ¥æºäºŽLLVM9.0.0 tutorialã€‚ LLVMçš„å®˜æ–¹æ–‡æ¡£è¿˜æ˜¯å¾ˆä¸é”™çš„ï¼Œé˜…è¯»å®Œå…¶ä¸­çš„tutorialså°±èƒ½å¤§è‡´ä¸Šæ‰‹LLVMäº†ã€‚å®žçŽ°çš„ä»£ç å¯¹C++11è¦æ±‚æ¯”è¾ƒé«˜ï¼Œæˆ‘æ”¾åœ¨äº†Githubä¸Šã€‚ å®žçŽ°å…±åˆ†ä¸º10éƒ¨åˆ†ï¼š å®žçŽ°è¯æ³•åˆ†æžå™¨Lexer ä½¿ç”¨é€’å½’ä¸‹é™å’Œè¿ç®—ç¬¦ä¼˜å…ˆçº§è§£æžå®žçŽ°è¯­æ³•åˆ†æžå™¨Parser å°†ASTè½¬åŒ–æˆLLVM-IR æ·»åŠ JITå³æ—¶ç¼–è¯‘å’Œä¼˜åŒ–å™¨çš„æ”¯æŒ æ‰©å±•â€”â€”æŽ§åˆ¶æµï¼Œè¿™ä¸€ç« ä¼šå¼•å…¥SSAæ¦‚å¿µ æ‰©å±•â€”â€”ç”¨æˆ·å®šä¹‰è¿ç®—ç¬¦ æ‰©å±•â€”â€”è‡ªåŠ¨å˜é‡ï¼Œæ·±å…¥SSA ç›®æ ‡ä»£ç ç”Ÿæˆ æ‰©å±•â€”â€”æ·»åŠ è°ƒè¯•å™¨ æ·±å…¥â€”â€”GCï¼Œå¼‚å¸¸ç­‰ Parser ç¼–è¯‘åŽŸç† C++åŽŸç† LLVM-IR]]></content>
      <categories>
        <category>C++</category>
      </categories>
      <tags>
        <tag>Compiler</tag>
        <tag>LLVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LLVMæ¼«è°ˆï¼ˆ1-LLVMç¼–è¯‘æ¡†æž¶ï¼‰]]></title>
    <url>%2F2020%2F06%2F25%2FLLVM%E6%BC%AB%E8%B0%88%EF%BC%881-LLVM%E7%BC%96%E8%AF%91%E6%A1%86%E6%9E%B6%EF%BC%89%2F</url>
    <content type="text"><![CDATA[Abstract LLVMï¼Œè¿™ä¸ªæ˜Ÿçƒæœ€ç‰›é€¼çš„ç¼–è¯‘å™¨ã€‚ å…¶æ ¸å¿ƒè®¾è®¡ç†å¿µå°±æ˜¯ç»Ÿä¸€çš„åº•å±‚ä¸­é—´è¡¨è¾¾ä»¥åŠæ¨¡å—åŒ–çš„è½¯ä»¶å·¥ç¨‹åŒ–æ–¹æ³•ã€‚LLVMé‡‡ç”¨äº†å‰ç«¯-ä¼˜åŒ–å™¨-åŽç«¯çš„ç»„ç»‡å½¢å¼ï¼Œåªæ˜¯ä¸åŒçš„å‰ç«¯å’ŒåŽç«¯éƒ½é‡‡ç”¨ç»Ÿä¸€çš„åº•å±‚ä¸­é—´è¡¨ç¤ºæ ¼å¼ï¼ˆLLVM IRï¼‰æ¥æœ€å¤§å¯èƒ½å¤ç”¨ä¼˜åŒ–å™¨çš„ä»£ç ã€‚ åœ¨Chris Lattnerå°†å…¶å¼€æºåŽï¼ŒLLVMé€æ¸å‘å±•æˆä¸ºäº†æˆç†Ÿçš„ç¼–è¯‘æ¡†æž¶ï¼Œå…·æœ‰å¤§é‡åº“å’Œç¼–è¯‘é“¾å·¥å…·ã€‚ æˆ‘ä½¿ç”¨çš„å¹³å°æ˜¯macOS Mojave 10.14ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™è¦æ³¨æ„ç‰ˆæœ¬æ˜¯å¦å…¼å®¹ã€‚ ä¸€èˆ¬ç³»ç»Ÿä¼šé€šè¿‡æ‰“å°äºŒè¿›åˆ¶æ–‡ä»¶åç§°å’Œæ— æ³•åŠ è½½çš„åŠ¨æ€åº“çš„åç§°æ¥å‘çŽ°é“¾æŽ¥é”™è¯¯ã€‚å½“å±å¹•ä¸Šæ‰“å°åŠ¨æ€åº“åç§°æ—¶è¦äºˆä»¥æ³¨æ„ï¼Œè¿™è¯´æ˜Žç³»ç»ŸåŠ¨æ€é“¾æŽ¥å™¨å’ŒåŠ è½½å™¨æ— æ³•åŠ è½½è¯¥åº“ï¼Œå› ä¸ºè¯¥ç¨‹åºä¸Žå½“å‰ç³»ç»Ÿä¸å…¼å®¹ã€‚ æˆ‘ç¼–è¯‘LLVM 10.0.0çš„æ—¶å€™å‡ºé”™å¦‚ä¸‹ï¼š åŽæ¥å‘çŽ°è¿™ä¸ªç‰ˆæœ¬çš„Xcodeå·¥å…·é“¾æœ€é«˜åªæ”¯æŒLLVM 9.0.0ç‰ˆæœ¬ï¼Œç„¶åŽæ¢äº†ç‰ˆæœ¬æœ€åŽç¼–è¯‘æˆåŠŸã€‚ BUILD Subproject Deployed On My System Note llvm-core modern source- and target-independent optimizer, along with code generation support for many popular CPUs Clang &quot;LLVM native&quot; C/C++/Objective-C compiler front-end LLDB native debugger LLD native linker libcxx/libcxxabi standard conformant and high-performance implementation of the C++ Standard Library, compiler-rt highly tuned implementations of the low-level code generator support routines and implementations of run-time libraries llvm ä»¥ä¸Šçš„subprojecté€šè¿‡ä»¥ä¸‹ç¼–è¯‘æ–¹å¼å®Œæˆéƒ¨ç½²ï¼š 12345678//ought to download source of subprojects to local, besides $ git clone https://github.com/llvm/llvm-project.git $ mkdir /LLVM/llvm-build &amp;&amp; cd //LLVM/llvm-build$ cmake -G Ninja -DLLVM_ENABLE_PROJECTS='lldb;clang;compiler-rt;lld;' \ -DCMAKE_INSTALL_PREFIX='/LLVM/llvm-install' \ ~/where you put llvm-src$ ninja &amp;&amp; ninja install$ echo $? //check libcxx/libcxxabi è¿™é‡Œç†æ¸…æ¥šä¸€ä¸ªæ¦‚å¿µï¼š glicæ˜¯linuxæœ€é‡è¦çš„è¿è¡Œåº“ï¼Œå…¶å®žçŽ°æœ€åº•å±‚çš„APIä¾›å…¶ä»–åº“ä½¿ç”¨æ¯”å¦‚malloc/printfç­‰ã€‚ libstdc++æ˜¯ä¸€ä¸ªC++æ ‡å‡†åº“ï¼Œå¦‚æžœè·‘åœ¨linuxåˆ™ä¾èµ–Glibc libcxxæ˜¯LLVMä¸“é—¨å¼€å‘çš„ä¸€ä¸ªä»£æ›¿libstdc++çš„c++æ ‡å‡†åº“ compiler-rtæ˜¯LLVMå¼€å‘æ¥æ›¿ä»£libgcc,ä¸»è¦ç”¨äºŽä¸ºç¡¬ä»¶ä¸æ”¯æŒçš„ä½Žçº§åŠŸèƒ½æä¾›ç‰¹å®šäºŽç›®æ ‡çš„æ”¯æŒ clang++æž„å»ºå¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™ä½¿ç”¨libcxxæˆ–è€…libclc(OpenCLè¿è¡Œæ—¶åº“)ã€‚å…¶ä¸­libcxxå®žçŽ°ç”±åº“æœ¬èº«å’Œä¸€ä¸ªä½Žçº§å‡½æ•°å±‚libcxxabiç»„æˆï¼Œè¿™ä¸ªå‡½æ•°å±‚ç”¨æ¥å¤„ç†å¼‚å¸¸å’Œè¿è¡Œæ—¶ç±»åž‹ä¿¡æ¯(RTTI)ç­‰åŠŸèƒ½ï¼Œè¿™ç§åˆ†ç¦»å¼è®¾è®¡ä½¿å¾—libcxxabiæ›´å®¹æ˜“ç§»æ¤ã€‚ 1234567891011$ git clone https://github.com/llvm/llvm-project.git$ cd llvm-project$ mkdir /LLVM/libcxx-build &amp;&amp; cd /LLVM/libcxx-build$ cmake -G Ninja -DCMAKE_C_COMPILER=clang \ -DCMAKE_CXX_COMPILER=clang++ \ -DLLVM_ENABLE_PROJECTS="libcxx;libcxxabi" \ -DCMAKE_INSTALL_PREFIX='/LLVM/llvm-install' \ ~/where you put libcxx-src$ make # Build$ make check-cxx # Test$ make install-cxx install-cxxabi # Install warning å…¶ä¸­llvmå’Œlibcxxæˆ‘æ˜¯åˆ†å¼€ç¼–è¯‘çš„ï¼Œè€Œä¸”ç¼–è¯‘ç›®å½•å’Œå®‰è£…ç›®å½•éƒ½æ˜¯æŒ‡å®šçš„ç›®å½•ï¼Œé»˜è®¤å¾ˆå¯èƒ½ä¼šå®‰è£…åˆ°ç³»ç»Ÿè·¯å¾„ä¸‹ï¼Œä»Žè€Œå¸¦æ¥é”™è¯¯ã€‚ ~/Document/LLVM9.0.0/ llvm //llvmæºä»£ç  libcxx //libcxxæºä»£ç  /LLVM/ llvm-build //llvmç¼–è¯‘è·¯å¾„ llvm-install //llvmå®‰è£…è·¯å¾„ /LLVM/ libcxx-build //libcxxç¼–è¯‘è·¯å¾„ libcxx-install //libcxxå®‰è£…è·¯å¾„ Features æ ¸å¿ƒè®¾è®¡ LLVMä¸­æœ€æ ¸å¿ƒçš„å°±æ˜¯LLVM-IR ï¼š SSAè¡¨ç¤ºå’Œå…è®¸å¿«é€Ÿä¼˜åŒ–çš„æ— é™å¯„å­˜å™¨ é€šè¿‡å°†æ•´ä¸ªç¨‹åºå­˜å‚¨åœ¨ç£ç›˜IRè¡¨ç¤ºä¸­ï¼Œå®žçŽ°ä¾¿æ·çš„é“¾æŽ¥æ—¶ä¼˜åŒ– å½“ç„¶LLVMä¸ä»…ä»…åªæœ‰ä¸€ç§ä¸­é—´è¡¨ç¤ºå½¢å¼ï¼š å°†Cæˆ–C++è½¬æ¢ä¸ºLLVM-IRçš„æ—¶å€™ï¼ŒClangå°†ä½¿ç”¨æŠ½è±¡è¯­æ³•æ ‘ASTç»“æž„åœ¨å†…å­˜ä¸­è¡¨ç¤ºç¨‹åº å°†LLVM-IRè½¬æ¢ä¸ºç‰¹å®šäºŽæœºå™¨çš„æ±‡ç¼–è¯­è¨€çš„æ—¶å€™ï¼ŒLLVMé¦–å…ˆå°†ç¨‹åºè½¬æ¢ä¸ºæœ‰å‘æ— çŽ¯å›¾DAGæ ¼å¼ä»¥ä¾¿è¿›è¡ŒæŒ‡ä»¤é€‰æ‹©ï¼Œç„¶åŽå°†å…¶è½¬æ¢å›žä¸‰åœ°å€è¡¨ç¤ºä»¥è¿›è¡ŒæŒ‡ä»¤è°ƒåº¦ ä¸ºäº†å®žçŽ°æ±‡ç¼–å™¨å’Œé“¾æŽ¥å™¨ï¼ŒLLVMä½¿ç”¨ç¬¬å››ç§ä¸­é—´æ•°æ®ç»“æž„MCModuleåœ¨å¯¹è±¡æ–‡ä»¶çš„ä¸Šä¸‹æ–‡ä¸­ä¿å­˜æˆç¨‹åºè¡¨ç¤º åœ¨æ•´ä¸ªæ¡†æž¶ä¸­ï¼Œ&quot;åº“&quot;æ˜¯ä¸€ä¸ªå¾ˆæ ¸å¿ƒçš„æ¦‚å¿µã€‚å¾ˆå¤šäºŒè¿›åˆ¶å·¥å…·éƒ½å¯ä»¥ç›´æŽ¥è°ƒç”¨åº“æ¥å®žçŽ°ã€‚è€ŒClangä½œä¸ºç¼–è¯‘é©±åŠ¨ç¨‹åºåˆ™å¯ä»¥é€šè¿‡é“¾æŽ¥å°å·¥å…·çš„åº“æ¥å®žçŽ°å…¶åŠŸèƒ½â€”â€”ä»£ç é‡ç”¨ã€‚æ•…clangåœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ˜¯æœ€å¤§çš„ï¼Œå› ä¸ºå®ƒé“¾æŽ¥å¹¶åˆ©ç”¨äº†æ•´ä¸ªLLVMç”Ÿæ€ç³»ç»Ÿã€‚è€Œå¼€å‘è€…ä¸€èˆ¬éƒ½æ˜¯å°†LLVMå„ä¸ªç»„ä»¶çœ‹å‡ºæ˜¯åº“ã€‚ ç¼–è¯‘æµç¨‹ clang clangä½œä¸ºç¼–è¯‘å™¨é©±åŠ¨ç¨‹åºéšå¼çš„è°ƒç”¨ä»Žå‰ç«¯åˆ°é“¾æŽ¥å™¨çš„æ‰€æœ‰å·¥å…·ã€‚æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯åœ¨å†…å­˜ä¸­å®Œæˆçš„ï¼Œå¹¶ä¸ä¼šå°†ä¸­é—´æ–‡ä»¶è¾“å‡ºåˆ°ç£ç›˜ä¸­ã€‚ 12$ clang hello.c -o hello$ clang -### hello.c -o hello //å¯ä»¥æŸ¥çœ‹é©±åŠ¨ç¨‹åºè°ƒç”¨çš„æ‰€æœ‰å·¥å…· ç‹¬ç«‹å·¥å…· LLVMç‹¬ç«‹å·¥å…·ä¼šå°†ä¸­é—´æ–‡ä»¶è¾“å‡ºåˆ°ç£ç›˜ä¸Šã€‚ Tools Notes opt åœ¨IRçº§åˆ«å¯¹ç¨‹åºè¿›è¡Œä¼˜åŒ–çš„å·¥å…·ï¼Œè¾“å…¥å¿…é¡»æ˜¯LLVMä½ç æ–‡ä»¶(ç¼–ç çš„LLVM-IR)ï¼Œå¹¶ä¸”ç”Ÿæˆçš„è¾“å‡ºæ–‡ä»¶å¿…é¡»å…·æœ‰ç›¸åŒçš„ç±»åž‹ llc é€šè¿‡ç‰¹å®šåŽç«¯å°†LLVMä½ç è½¬æ¢ä¸ºç›®æ ‡æœºå™¨æ±‡ç¼–è¯­è¨€æ–‡ä»¶æˆ–ç›®æ ‡æ–‡ä»¶çš„å·¥å…·ï¼Œå¯ä»¥é€šè¿‡ä¼ é€’å‚æ•°æ¥é€‰æ‹©ä¼˜åŒ–çº§åˆ«ï¼Œæ‰“å¼€è°ƒè¯•é€‰é¡¹ä»¥åŠå¯ç”¨æˆ–ç¦ç”¨ç‰¹å®šä¸Žç›®æ ‡çš„ä¼˜åŒ– llvm-mc èƒ½å¤Ÿæ±‡ç¼–æŒ‡ä»¤å¹¶ç”Ÿæˆè¯¸å¦‚ELF,Mach-O,PEç­‰å¯¹é¦™æ ¼å¼çš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åæ±‡ç¼–ç›¸åŒçš„å¯¹è±¡ï¼Œä»Žè€Œè½¬å‚¨è¿™äº›æŒ‡ä»¤çš„æ±‡ç¼–ä¿¡æ¯å’Œå†…éƒ¨LLVMæœºå™¨æŒ‡ä»¤æ•°æ®ç»“æž„ lli æ˜¯LLVM IPçš„è§£é‡Šå™¨å’ŒJITç¼–è¯‘å™¨ llvm-link å°†å‡ ä¸ªLLVMä½ç é“¾æŽ¥åœ¨ä¸€èµ·ï¼Œä»¥äº§ç”Ÿä¸€ä¸ªåŒ…å«æ‰€æœ‰è¾“å…¥çš„LLVMä½ç  llvm-as å°†äººå·¥å¯è¯»çš„LLVM-IRæ–‡ä»¶(ç§°ä¸ºLLVMæ±‡ç¼–ç )è½¬æ¢ä¸ºLLVMä½ç  llvm-dis å°†LLVMä½ç è§£ç æˆä¸ºLLVMæ±‡ç¼–ç  -emit-llvm LLVMä½ç ï¼š ç¼–ç çš„LLVM-IR LLVMæ±‡ç¼–ç ï¼š äººå·¥å¯è¯»çš„LLVM-IR å‡è®¾main.cå’Œsum.c: 123456789101112131415161718$ vim main.c#include&lt;stdio.h&gt; int main(void) &#123; int r = sum(3, 4); printf("r = %d\n", r); return 0;&#125;$ vim sum.c int sum(int x, int y) &#123; return (x + y);&#125; å¦‚æžœç›´æŽ¥ä½¿ç”¨ç¼–è¯‘å™¨é©±åŠ¨ç¨‹åºClangçš„è¯ï¼š 1$ clang main.c sum.c -o sum å¦‚æžœä½¿ç”¨ç‹¬ç«‹å·¥å…·çš„è¯: 12$ clang -emit-llvm -c main.c -o main.bc$ clang -emit-llvm -c sum.c -o sum.bc å…¶ä¸­-emit-llvmç¼–è¯‘é€‰é¡¹å¯ä»¥è®©clangæ ¹æ®-cæˆ–è€…-Så‚æ•°æ¥ç”ŸæˆLLVMä½ç è¿˜æ˜¯LLVMæ±‡ç¼–ç ã€‚ -c ç”ŸæˆLLVMä½ç  -c -Sç”ŸæˆLLVMæ±‡ç¼–ç  12$ clang -emit-llvm -c -S main.c -o main.ll$ clang -emit-llvm -c -S sum.c -o sum.ll llc è¯¥å·¥å…·ä»Žæ¯ä¸ªLLVMä½ç æ–‡ä»¶å†…ç”Ÿæˆç‰¹å®šäºŽç›®æ ‡çš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ï¼Œå¹¶é€šè¿‡å°†å…¶é“¾æŽ¥åˆ°ç³»ç»Ÿé“¾æŽ¥å™¨æ¥æž„å»ºå¯æ‰§è¡Œæ–‡ä»¶ 123$ llc -filetype=obj main.bc -o main.o$ llc -filetype= obj sum.bc -o sum.o$ clang main.o sum.o -o sum llvm-link è¯¥å·¥å…·å°†å¤šä¸ªLLVMä½ç æ–‡ä»¶è¿žæŽ¥æˆä¸ºæœ€ç»ˆçš„LLVMä½ç æ–‡ä»¶ 123$ llvm-link main.bc sum.bc -o sum.linked.bc$ llc -filetype=obj sum.linked.bc -o sum.linked.o$ clang sum.linked.o -o sum å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„äºŒè¿›åˆ¶å·¥å…·éƒ½å›´ç»•å‡ ä¸ªä¸­é—´å½¢å¼çš„è¡¨ç¤ºå±•å¼€ï¼Œè¿™äº›ä¸­é—´è¡¨ç¤ºåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å å¾ˆé‡è¦çš„ä½œç”¨ã€‚]]></content>
      <categories>
        <category>C++</category>
      </categories>
      <tags>
        <tag>Compiler</tag>
        <tag>LLVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[LLVMæ¼«è°ˆï¼ˆ0-ç¼–è¯‘ç³»ç»Ÿæ¦‚è¿°ï¼‰]]></title>
    <url>%2F2020%2F06%2F02%2FLLVM%E6%BC%AB%E8%B0%88%EF%BC%880-%E7%BC%96%E8%AF%91%E7%B3%BB%E7%BB%9F%E6%A6%82%E8%BF%B0%EF%BC%89%2F</url>
    <content type="text"><![CDATA[Abstract ä»Žå¼€å§‹æŽ¥è§¦ç¼–è¯‘ç³»ç»Ÿçš„å­¦ä¹ å·²ç»å¿«åŠå¹´äº†ï¼Œæœ‰äº›å¿ƒå¾—æ€»ç»“ä¸€ä¸‹ã€‚ ä»€ä¹ˆæ˜¯ç¼–è¯‘ç³»ç»Ÿï¼Ÿæˆ‘æƒ³ä»Žä¸¤ä¸ªè§’åº¦è°ˆä¸€ä¸‹ï¼š é¦–å…ˆä»ŽæŠ€æœ¯è§’åº¦æ¥è®²ï¼Œå¹¿ä¹‰çš„ç¼–è¯‘ç³»ç»Ÿè´Ÿè´£å°†é«˜çº§è¯­è¨€è½¬æ¢æˆä¸ºCPUå¯æ‰§è¡Œçš„äºŒè¿›åˆ¶æœºå™¨ä»£ç ã€‚ç¼–è¯‘ç³»ç»ŸåŒ…æ‹¬ç¼–è¯‘å™¨ï¼Œ æ±‡ç¼–å™¨ï¼Œé™æ€/åŠ¨æ€é“¾æŽ¥å™¨ï¼Œæ“ä½œç³»ç»Ÿè£…è½½å™¨ä»¥åŠè¿è¡Œåº“ã€‚ ç¼–è¯‘å™¨ï¼š æ˜¯ç³»ç»Ÿå‰åŠéƒ¨åˆ†çš„æ ¸å¿ƒï¼Œè´Ÿè´£å°†æºæ–‡ä»¶.cè½¬æ¢æˆä¸ºæ±‡ç¼–æ–‡ä»¶.sã€‚ æ±‡ç¼–/é“¾æŽ¥/è£…è½½å™¨ï¼šæ˜¯ç³»ç»ŸåŽåŠéƒ¨åˆ†çš„æ ¸å¿ƒï¼Œä¸»è¦æ˜¯å°†.sè½¬æ¢ä¸ºäºŒè¿›åˆ¶ELFæ–‡ä»¶å¹¶è¿›ä¸€æ­¥å›´ç»•ELFå¤„ç†ã€‚ è¿è¡Œåº“ï¼šæ˜¯æ“ä½œç³»ç»Ÿå±‚é¢ç”¨æ¥æ”¯æŒé«˜çº§è¯­è¨€è¿è¡ŒçŽ¯å¢ƒæ¯”å¦‚å†…å­˜æ± ï¼Œæ ‡å‡†APIç­‰çš„åº“æ–‡ä»¶ã€‚ ç„¶åŽä»Žä¸“ä¸šçš„è§’åº¦æ¥è®²ï¼Œæˆ‘è§‰å¾—å¯ä»¥åˆ†ä¸ºç³»ç»Ÿå±‚é¢å’Œç®—æ³•ä¼˜åŒ–å±‚é¢ï¼Œç³»ç»Ÿå±‚é¢ä¸»è¦æ˜¯æ•´ä¸ªç¼–è¯‘æ¡†æž¶æ¯”å¦‚LLVMï¼Œæ ¸å¿ƒæ˜¯å’Œæ“ä½œç³»ç»Ÿäº¤äº’çš„éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†å†…å®¹æ˜¯ç¼–è¯‘å™¨å·¥ç¨‹å¸ˆçš„åŸºæœ¬åŠŸï¼Œéœ€è¦æŽŒæ¡ç»†èŠ‚ã€‚è€Œç®—æ³•ä¼˜åŒ–å±‚é¢æŒ‡çš„æ˜¯ç¼–è¯‘ä¼˜åŒ–â€”â€”ç¼–è¯‘å™¨å·¥ç¨‹å¸ˆçš„æœ€ç†æƒ³çš„æ–¹å‘å°±æ˜¯åšä¼˜åŒ–ï¼Œè¿™ä¸€éƒ¨åˆ†éœ€è¦ç²¾é€šï¼Œä»Žé™æ€å•èµ‹å€¼SSAç­‰ä¼ ç»Ÿçš„é™æ€åˆ†æžä¼˜åŒ–åˆ°çŽ°åœ¨ä¸»æµçš„æ·±åº¦å­¦ä¹ æŽ¨ç†å¼•æ“Žæ¯”å¦‚TVMç­‰ã€‚ æœ¬æ–‡ä¸»è¦æ˜¯å¯¹ç³»ç»Ÿå±‚é¢çš„å­¦ä¹ ï¼Œå¯¹ç³»ç»Ÿå±‚é¢çš„å­¦ä¹ æ­¢æ­¥äºŽå¯¹LLVMç¼–è¯‘æ¡†æž¶çš„ä½¿ç”¨å’Œæºä»£ç é˜…è¯»ã€‚ æ€è·¯ æœ¬æ–‡ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼Œç¼–è¯‘ï¼ŒELFä»¥åŠåº“æ–‡ä»¶ã€‚ é¦–å…ˆç®€å•ä»‹ç»ä¸€ä¸‹ç¼–è¯‘å™¨çš„æ•´ä½“æ¡†æž¶å’Œç¼–è¯‘æµç¨‹ã€‚ **æ ¸å¿ƒéƒ¨åˆ†æ˜¯å­¦ä¹ *nixæ“ä½œç³»ç»Ÿä¸‹çš„ELFæ–‡ä»¶çš„æ ¼å¼â€”â€”æ™®é€šc/c++é«˜çº§ç¨‹åºåœ¨ç›®æ ‡æ–‡ä»¶ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼›ç›®æ ‡æ–‡ä»¶æ˜¯å¦‚ä½•è¢«é“¾æŽ¥å™¨é“¾æŽ¥åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å½¢æˆå¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ã€‚ç›®æ ‡æ–‡ä»¶åœ¨é“¾æŽ¥æ—¶ç¬¦å·å¤„ç†ï¼Œé‡å®šä½å’Œåœ°å€åˆ†é…å¦‚ä½•è¿›è¡Œã€‚å¯æ‰§è¡Œæ–‡ä»¶å¦‚ä½•è¢«è£…è½½å¹¶ä¸”æ‰§è¡Œï¼Œå¯æ‰§è¡Œæ–‡ä»¶ä¸Žè¿›ç¨‹çš„è™šæ‹Ÿç©ºé—´ä¹‹é—´å¦‚ä½•æ˜ å°„ã€‚è®²è§£åŠ¨æ€é“¾æŽ¥ã€‚ ** æœ€åŽè®²è§£ä¸€ä¸‹è¿è¡Œåº“çš„åŽŸç†å’Œæ“ä½œç³»ç»Ÿä¸Žç¼–è¯‘ç³»ç»Ÿäº¤äº’çš„éƒ¨åˆ†ã€‚ ç¼–è¯‘å™¨ ç¼–è¯‘å™¨åˆ†ä¸ºå‰ç«¯å’ŒåŽç«¯ï¼Œç›´è§‚ä¸Šè®²å°±æ˜¯å°†æºè¯­è¨€å½¢å¼åŒ–çš„è¡¨ç¤ºå¹¶ç¿»è¯‘æˆä¸ºæ±‡ç¼–ç›®æ ‡è¯­è¨€ã€‚å‰ç«¯ä¸»è¦æœ‰ï¼š è¯æ³•åˆ†æžå™¨ è¯­æ³•åˆ†æžå™¨ï¼Œ è¯­ä¹‰åˆ†æžå™¨ ç­‰å®Œæˆæºè¯­è¨€çš„è¯­æ³•æŽ¨å¯¼ï¼Œè¯­ä¹‰å¤„ç†ï¼Œç„¶åŽå°†ç‰¹å®šä¿¡æ¯æ”¶é›†åˆ°ç¬¦å·è¡¨ä¸­ï¼Œä¸åŒçš„ç¼–è¯‘å™¨å‰ç«¯ä¼šç”Ÿæˆä¸åŒçš„ä¸­é—´è¡¨ç¤ºâ€”â€”æ¯”å¦‚LLVM IRå°±æ˜¯ä¸€ç§éžå¸¸é‡è¦çš„ä¸­é—´ä»£ç ã€‚ åŽç«¯ä¸»è¦æ˜¯ï¼š å¯„å­˜å™¨åˆ†é… æŒ‡ä»¤é€‰æ‹© æŒ‡ä»¤è°ƒåº¦ åŽç«¯å’Œç›®æ ‡æœºçš„å…³ç³»æ¯”è¾ƒç´§å¯†ï¼Œä¹Ÿæ˜¯ä¼˜åŒ–çš„é‡ç‚¹å¹³å°ã€‚ æ±‡ç¼–å™¨ å½“ç¼–è¯‘å™¨å°†æºæ–‡ä»¶ç¿»è¯‘æˆä¸ºæ±‡ç¼–è¯­è¨€ä¹‹åŽï¼Œ.sæ–‡ä»¶éœ€è¦è¿›ä¸€æ­¥çš„è¢«æ±‡ç¼–å™¨è¿›è¡Œè½¬æ¢æˆä¸ºå¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ï¼ˆRelocatable Fileï¼‰ã€‚ å› ä¸ºæ±‡ç¼–è¯­è¨€æœ¬è´¨ä¸Šå°±æ˜¯åŠ©è®°ç¬¦ï¼Œæ±‡ç¼–å™¨å°±æ˜¯å°†æ±‡ç¼–æ–‡ä»¶ç¿»è¯‘æˆä¸ºæœºå™¨å¯æ‰§è¡Œçš„åˆæ­¥çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™é‡Œçš„åˆæ­¥æ˜¯æ±‡ç¼–å™¨æ±‡ç¼–ä¹‹åŽç”Ÿæˆçš„.oæ–‡ä»¶è¿˜ä¸èƒ½ç›´æŽ¥åœ¨æ“ä½œç³»ç»Ÿä¸­è¿è¡Œï¼Œè¿™æ˜¯å› ä¸º.oæ–‡ä»¶ä¸­å¾ˆå¤šç¬¦å·å’Œå˜é‡çš„åœ°å€éƒ½æ²¡æœ‰ç¡®å®šâ€”â€”å±žäºŽç›¸å¯¹åœ°å€ï¼Œæ‰€ä»¥æ— æ³•åŠ è½½åˆ°è¿›ç¨‹åœ°å€ç©ºé—´ä¸­ï¼Œè€Œä¸”å…¶è¿è¡Œè¿˜éœ€è¦æ“ä½œç³»ç»Ÿæä¾›çš„è¿è¡Œåº“æä¾›æ”¯æŒï¼Œè¿™ä¸€åˆ‡éƒ½éœ€è¦é“¾æŽ¥å™¨æ¥å®Œæˆã€‚æ‰€ä»¥.oæ–‡ä»¶åˆç§°ä¸ºå¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ã€‚ ä»Ž.sæ–‡ä»¶ç¿»è¯‘æˆä¸º.oæ–‡ä»¶ï¼Œå¿…é¡»æŒ‰ç…§ç‰¹å®šæŒ‡ä»¤é›†çš„æœºå™¨ç ï¼Œè¿˜æœ‰ELFæ–‡ä»¶çš„æ ¼å¼æ¥è½¬æ¢ï¼Œå®žçŽ°èµ·æ¥ä¸æ˜¯å¾ˆéš¾â€”â€”éœ€è¦ç²¾é€šç›®æ ‡æœºå™¨çš„ä½“ç³»ç»“æž„ï¼Œä»¥åŠç›®æ ‡æœºå™¨çš„ELFæ–‡ä»¶æ ¼å¼ã€‚è¿™é‡Œä¸æ¶‰åŠä½“ç³»ç»“æž„çš„çŸ¥è¯†ã€‚ ELF ELFç®€ä»‹ å…¶å®žä»Žæ±‡ç¼–å™¨çš„å®žçŽ°ä¸­å°±å·²ç»ç”¨åˆ°äº†ELFçš„çŸ¥è¯†ã€‚ ELFå¯ä»¥è¯´æ˜¯ç¼–è¯‘ç³»ç»Ÿå·¥å…·é“¾ä¸­çš„æœ€é‡è¦çš„æ–‡ä»¶æ ¼å¼äº†ï¼Œç¦»å¼€ç¼–è¯‘å™¨ä¹‹åŽçš„æ‰€æœ‰ç¼–è¯‘æ­¥éª¤å‡ ä¹Žéƒ½å’ŒELFç›¸å…³æˆ–è€…å›´ç»•ELFå±•å¼€ï¼Œæ‰€ä»¥å¯¹å®ƒçš„ç ”ç©¶éžå¸¸æœ‰æ„ä¹‰ã€‚ æœ€æ—©æ˜¯ç”±Unix System V Release3æå‡ºäº†COFFçš„æ¦‚å¿µä»¥åŠä½¿ç”¨è§„èŒƒã€‚åŽæ¥WindowsåŸºäºŽCOFFæŒ‡å®šäº†PEæ ¼å¼æ ‡å‡†ï¼Œè€ŒLinuxä¹Ÿä»¥ELFä½œä¸ºåŸºæœ¬æ ¼å¼ã€‚COFFçš„ä¸»è¦è´¡çŒ®å°±æ˜¯æä¾›äº†â€œæ®µsegmentâ€çš„æ¦‚å¿µã€‚ ELFç±»åž‹ æ ¹æ®ELFæ–‡ä»¶æ ‡å‡†ï¼Œå¯ä»¥åˆ†ä¸ºä¸‹é¢4ç±»ï¼š ELFæ–‡ä»¶ç±»åž‹ è¯´æ˜Ž å®žä¾‹ å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶(Relocatable File) ç”±æ±‡ç¼–å™¨ç”Ÿæˆçš„.oæ–‡ä»¶ï¼Œåˆè¢«ç§°ä¸ºç›®æ ‡æ–‡ä»¶ï¼Œå› ä¸ºéœ€è¦è¿žæŽ¥é‡å®šä½å…¶æ–‡ä»¶ä¸­çš„ç¬¦å·åœ°å€æ‰€ä»¥å«Relocatableï¼›å¦å¤–ï¼Œé™æ€é“¾æŽ¥åº“.aå…¶å®žä¹Ÿæ˜¯ä½¿ç”¨arç¨‹åºå°†å¾ˆå¤š.oæ–‡ä»¶åŽ‹ç¼©å¹¶å¯¹å…¶è¿›è¡Œç´¢å¼•å’Œç¼–å·ã€‚æ‰€ä»¥ä¹Ÿç®—æ­¤ç±»åž‹ã€‚ Linuxä¸‹çš„.oæ–‡ä»¶ï¼Œ.aé™æ€åº“æ–‡ä»¶ï¼›Windowsä¸‹çš„.objï¼Œ.libé™æ€åº“æ–‡ä»¶ å¯æ‰§è¡Œæ–‡ä»¶(Executable File) æ˜¯å¯ä»¥ç›´æŽ¥æ‰§è¡Œçš„ç¨‹åºï¼Œåˆè¢«ç§°ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚ /usr/bashæ–‡ä»¶ï¼›Windowsä¸‹çš„.exe å…±äº«ç›®æ ‡æ–‡ä»¶(Shared Object File) å…±äº«å°±æ˜¯åŠ¨æ€é“¾æŽ¥çš„æœ¬è´¨ã€‚å…¶å¯ä»¥è¢«é“¾æŽ¥å™¨ç»§ç»­é“¾æŽ¥ç”Ÿæˆæ–°çš„ç›®æ ‡æ–‡ä»¶ï¼›ä¹Ÿå¯ä»¥å’Œå¯æ‰§è¡Œæ–‡ä»¶ç»“åˆï¼Œä½œä¸ºè¿›ç¨‹æ˜ åƒçš„ä¸€éƒ¨åˆ†æ¥è¿è¡Œã€‚ Linuxä¸‹çš„.soï¼›Windowsä¸‹çš„DLL æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶(Core Dump File) å½“è¿›ç¨‹æ„å¤–ç»ˆæ­¢çš„æ—¶å€™ï¼Œç³»ç»Ÿå¯ä»¥å°†è¯¥è¿›ç¨‹çš„åœ°å€ç©ºé—´åŠç»ˆæ­¢æ—¶çš„ä¸€äº›å…¶ä»–ä¿¡æ¯è½¬å‚¨åˆ°æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ä¸­ã€‚ Linuxä¸‹çš„core dump ELFæ ¼å¼ åˆ†æ®µ ä»¥ç›®æ ‡æ–‡ä»¶.oä¸ºä¾‹ä»‹ç»ï¼Œç›®æ ‡æ–‡ä»¶ä¸­çš„å†…å®¹è‡³å°‘å«æœ‰ç¼–è¯‘åŽçš„æœºå™¨æŒ‡ä»¤ä»£ç å’Œæ•°æ®ã€‚æŒ‰ç…§COFFçš„åŽ†å²è§„å®šï¼ŒELFæ ¼å¼ä¹Ÿæ˜¯æŒ‰ç…§æ®µ-segmentæ¥ç®¡ç†çš„ã€‚ä¸‹é¢æ˜¯ELFæ–‡ä»¶çš„åŸºæœ¬æ ¼å¼ï¼š ä»Žå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒELFçš„å¼€å¤´æ˜¯ELF Headerï¼Œæè¿°äº†æ•´ä¸ªæ–‡ä»¶çš„æ–‡ä»¶å±žæ€§ï¼ŒåŒ…æ‹¬æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œï¼Œæ˜¯é™æ€é“¾æŽ¥è¿˜æ˜¯åŠ¨æ€é“¾æŽ¥åŠå…¥å£åœ°å€ï¼ˆå¦‚æžœæ˜¯å¯æ‰§è¡Œæ–‡ä»¶çš„è¯ï¼‰ï¼Œç›®æ ‡ç¡¬ä»¶ï¼Œæ“ä½œç³»ç»Ÿç­‰ä¿¡æ¯ã€‚ELFä¸­ç¬¬äºŒé‡è¦çš„æ•°æ®ç»“æž„æ˜¯Section Header tableâ€”â€”æè¿°æ–‡ä»¶ä¸­å„ä¸ªæ®µçš„æ•°ç»„ã€‚æ®µè¡¨æè¿°äº†æ–‡ä»¶ä¸­å„ä¸ªæ®µåœ¨æ–‡ä»¶ä¸­çš„åç§»é‡ä»¥åŠæ®µçš„å±žæ€§ç­‰ï¼Œä»Žå…¶ä¸­å¯ä»¥å¾—åˆ°æ¯ä¸ªæ®µçš„æ‰€æœ‰ä¿¡æ¯ã€‚ELF HeaderåŽé¢å°±æ˜¯å„ä¸ªæ®µçš„å†…å®¹ã€‚åˆ†æ®µçš„ç›®çš„å¦‚ä¸‹ï¼š å½“æŒ‡ä»¤å’Œæ•°æ®åˆ†ç¦»çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥åˆ†é…ä¸åŒçš„è¯»å†™æƒé™ä¾¿äºŽç®¡ç† å½“æŒ‡ä»¤å’Œæ•°æ®åˆ†ç¦»çš„æ—¶å€™ï¼ŒCPUç¼“å­˜çš„å‘½ä¸­çŽ‡ä¼šæ›´é«˜ å½“æŒ‡ä»¤å’Œæ•°æ®åˆ†ç¦»çš„æ—¶å€™ï¼Œå¤šä¸ªè¿›ç¨‹å¯ä»¥å…±äº«åŒä¸€ä»½æŒ‡ä»¤ï¼ŒèŠ‚çœå¼€é”€ ELF Header æ˜¯ELFæ–‡ä»¶æœ€å¼€å¤´çš„ä¸€ä¸ªç»“æž„ä½“ã€‚å®ƒåŒ…å«äº†æè¿°æ•´ä¸ªæ–‡ä»¶çš„åŸºæœ¬å±žæ€§ã€‚å› ä¸ºELFæ–‡ä»¶åœ¨å„ä¸ªå¹³å°ä¸‹éƒ½é€šç”¨ï¼Œä¸ºäº†å¯¹æ¯ä¸ªæˆå‘˜çš„å¤§å°åšå‡ºæ˜Žç¡®çš„è§„å®šä»¥ä¾¿ä¿æŒå…¼å®¹æ€§ã€‚ELFä½¿ç”¨typedefå®šä¹‰äº†ä¸€å¥—è‡ªå·±çš„å˜é‡ä½“ç³»ç±»ä¼¼Elf32_Addrè¿™ç§ã€‚ä¸‹é¢ç®€å•åˆ—å‡ºæ–‡ä»¶å¤´ä¸­çš„å…³é”®ä¿¡æ¯ï¼š ELFé­”æ•°ï¼Œæ–‡ä»¶æœºå™¨å­—èŠ‚é•¿åº¦ï¼Œæ•°æ®å­˜å‚¨æ–¹å¼ï¼Œç‰ˆæœ¬ï¼Œè¿è¡Œå¹³å°ï¼Œ ABIç‰ˆæœ¬ï¼ŒELFé‡å®šä½ç±»åž‹ï¼Œç¡¬ä»¶å¹³å°ï¼Œå…¥å£åœ°å€ï¼ˆOSåŠ è½½çš„è™šæ‹Ÿåœ°å€ï¼Œå¯é‡å®šä½ç›®æ ‡æ–‡ä»¶è¯¥å€¼ä¸º0ï¼‰ï¼Œç¨‹åºå¤´å…¥å£å’Œé•¿åº¦ï¼Œ Section Header tableçš„ä½ç½®ï¼ˆä»¥åç§»é‡çš„æ–¹å¼ï¼‰å’Œé•¿åº¦åŠæ®µçš„æ•°é‡ é­”æ•°ï¼šå½“å¹´çš„UNIXæ˜¯åœ¨PDPå°åž‹æœºå™¨ä¸Šå¼€å‘çš„ï¼Œè€Œå½“æ—¶çš„ç³»ç»ŸåŠ è½½å¯æ‰§è¡Œæ–‡ä»¶ç›´æŽ¥ä»Žç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹è¿è¡Œï¼Œäººä»¬ä¸€èˆ¬å°†ç¬¬ä¸€æ¡æŒ‡ä»¤è®¾ç½®ä¸ºè·³è½¬æŒ‡ä»¤ï¼Œè¿™ä¸ªé­”æ•°å°±æ˜¯å½“æ—¶çš„JMPæŒ‡ä»¤ï¼Œä¸ºäº†å…¼å®¹æ€§è¢«ä¿ç•™ä¸‹æ¥ã€‚ Section Header table æ®µè¡¨æè¿°äº†ELFçš„å„ä¸ªæ®µsegmentçš„ä¿¡æ¯æ¯”å¦‚æ®µåï¼Œæ®µé•¿åº¦ï¼Œæ®µåç§»ä»¥åŠæ®µçš„è¯»å†™æƒé™ç­‰ã€‚ å®žçŽ°ä¸Šï¼Œä¸€èˆ¬ä¼šé‡‡å–ä¸€ä¸ªç»“æž„ä½“æ•°ç»„æ¥è¡¨ç¤ºæ®µè¡¨ã€‚ æ®µç±»åž‹ï¼š å¾ˆå¤šç±»åž‹æ¯”å¦‚.data,.textæˆ–è€….rel,.stringç­‰ æ®µæ ‡å¿—ä½ï¼šè¡¨ç¤ºè¯¥æ®µåœ¨è¿›ç¨‹å†…è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„å±žæ€§ Relocation Table ç›®æ ‡æ–‡ä»¶ä¸­ä»£ç æ®µå’Œæ•°æ®æ®µé‚£äº›å¯¹ç»å¯¹åœ°å€çš„å¼•ç”¨ï¼Œéœ€è¦åœ¨é“¾æŽ¥çš„æ—¶å€™é‡å®šä½ã€‚æ¯ä¸€ä¸ªéœ€è¦é‡å®šä½çš„ä½ç½®ï¼Œæœ€åŽéƒ½ä¼šæœ‰ä¸€ä¸ªç›¸åº”çš„é‡å®šä½è¡¨æ¯”å¦‚.rel.txt,.rel.dataç­‰ã€‚ Sections .data: ä¿å­˜åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡ .bss: ä¿å­˜æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡ .data: ä¿å­˜ä»£ç æ®µï¼Œç­‰ç­‰ æ•´ä¸ªELFæ–‡ä»¶æœ‰å¾ˆå¤šæ®µæ¯”å¦‚å­—ç¬¦ä¸²æ®µï¼Œè°ƒè¯•ä¿¡æ¯æ®µstripç­‰ã€‚åŒ…æ‹¬åœ¨ä¸åŒçš„å¹³å°æ ‡å‡†ä¸ŠELFæ ¼å¼éƒ½ä¸åŒï¼Œè¿™é‡Œä¸å±•å¼€è¯´äº†ã€‚ é“¾æŽ¥å™¨ é“¾æŽ¥çš„æœ¬è´¨å°±æ˜¯è¦æŠŠå¤šä¸ªä¸åŒçš„ç›®æ ‡æ–‡ä»¶ä¹‹é—´ç›¸äº’â€œç²˜â€åœ¨ä¸€èµ·â€”â€”å®žé™…ä¸Šå°±æ˜¯ç›®æ ‡æ–‡ä»¶ä¹‹é—´åœ°å€çš„å¼•ç”¨ï¼ŒåŠå¯¹å‡½æ•°å’Œå˜é‡çš„åœ°å€çš„å¼•ç”¨ã€‚ ç¬¦å· åœ¨é“¾æŽ¥è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€ä¸ªELFç›®æ ‡æ–‡ä»¶éƒ½ä¼šæœ‰ä¸€ä¸ªç›¸åº”çš„ç¬¦å·è¡¨ï¼Œè¿™ä¸ªç¬¦å·è¡¨å¯¹åº”ELFä¸­çš„ä¸€ä¸ªæ®µ.symtabï¼Œè¿™ä¸ªè¡¨é‡Œè®°å½•äº†ç›®æ ‡æ–‡ä»¶æ‰€ç”¨åˆ°çš„æ‰€æœ‰ç¬¦å·ï¼Œæ¯ä¸ªå®šä¹‰çš„ç¬¦å·æœ‰ä¸€ä¸ªç¬¦å·å€¼ï¼Œå¯¹äºŽå˜é‡å’Œå‡½æ•°æ¥è¯´è¯¥å€¼å°±æ˜¯å…¶åœ°å€ã€‚ ELFçš„ç¬¦å·å¯ä»¥å¤§è‡´åˆ†ä¸ºï¼š å®šä¹‰åœ¨ç›®æ ‡æ–‡ä»¶ä¸­çš„å…¨å±€ç¬¦å· åœ¨ç›®æ ‡æ–‡ä»¶å†…ä¸­å¼•ç”¨çš„å…¨å±€ç¬¦å·ï¼Œåˆç§°ä¸ºå¤–éƒ¨ç¬¦å· æ®µå å±€éƒ¨ç¬¦å· é“¾æŽ¥å™¨åœ¨ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™ï¼Œè‡ªè¡Œå®šä¹‰çš„ç‰¹æ®Šç¬¦å·æ¯”å¦‚ç¨‹åºèµ·å§‹åœ°å€__executable_start å…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯å…¨å±€ç¬¦å·ï¼Œå› ä¸ºå…¶ä»–çš„ç¬¦å·åªæ˜¯åœ¨ç›®æ ‡æ–‡ä»¶ä¸­å¯è§ï¼Œè€Œå…¨å±€ç¬¦å·çš„ä½œç”¨åŸŸæ˜¯è·¨æ–‡ä»¶çš„ã€‚ UNIXç³»ç»Ÿé€šè¿‡ç¬¦å·ä¿®é¥°å’Œå‡½æ•°ç­¾åæœºåˆ¶é˜²æ­¢ä¸åŒç›®æ ‡æ–‡ä»¶ä¸­çš„ç¬¦å·åç§°å†²çªã€‚ (å¼º/å¼±ç¬¦å·)(å®šä¹‰/å¼•ç”¨) ç¼–è¯‘å™¨é»˜è®¤å‡½æ•°å’Œåˆå§‹åŒ–äº†çš„å…¨å±€å˜é‡ä¸ºå¼ºç¬¦å·ï¼Œæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ä¸ºå¼±ç¬¦å·ã€‚å¼ºç¬¦å·å’Œå¼±ç¬¦å·éƒ½æ˜¯é’ˆå¯¹å®šä¹‰æ¥è¯´çš„ï¼Œä¸æ˜¯é’ˆå¯¹ç¬¦å·çš„å¼•ç”¨ã€‚ ä¸åŒçš„ç›®æ ‡æ–‡ä»¶ä¸­ä¸å…è®¸æœ‰åŒåçš„å¼ºç¬¦å· å¼ºç¬¦å·å¯ä»¥å±è”½å¼±ç¬¦å· è€Œå½“å¤–éƒ¨å˜é‡çš„ç¬¦å·å¼•ç”¨åœ¨ç›®æ ‡æ–‡ä»¶è¢«é“¾æŽ¥æˆä¸ºå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œå¦‚æžœæ˜¯å¼ºå¼•ç”¨ï¼Œå¦‚æžœå®šä¹‰ä¸å­˜åœ¨åˆ™æŠ¥é”™ï¼Œè€Œå¼±å¼•ç”¨ä¸ä¼šæŠ¥é”™ã€‚å¼º/å¼±å¼•ç”¨ä¸€èˆ¬ç”¨äºŽåº“æ–‡ä»¶çš„é“¾æŽ¥è¿‡ç¨‹ã€‚ é™æ€é“¾æŽ¥ é“¾æŽ¥å™¨ä¸€èˆ¬éƒ½é‡‡ç”¨Two-pass Linkingçš„æ–¹å¼ï¼š ç©ºé—´ä¸Žåœ°å€åˆ†é…ï¼š æ‰«ææ‰€æœ‰çš„è¾“å…¥æ–‡ä»¶ï¼ŒèŽ·å¾—å®ƒä»¬å„ä¸ªæ®µçš„é•¿åº¦ï¼Œå±žæ€§å’Œä½ç½®ï¼Œå¹¶å°†è¾“å…¥ç›®æ ‡æ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨ä¸­çš„æ‰€æœ‰ç¬¦å·å®šä¹‰å’Œç¬¦å·å¼•ç”¨æ”¶é›†èµ·æ¥ï¼Œç»Ÿä¸€æ”¾åˆ°ä¸€ä¸ªå…¨å±€ç¬¦å·è¡¨ã€‚ ç¬¦å·è§£æžä¸Žé‡å®šä½ï¼š è¯»å–è¾“å…¥æ–‡ä»¶ä¸­æ®µçš„æ•°æ®ï¼Œé‡å®šä½ä¿¡æ¯ï¼›è¿›è¡Œç¬¦å·è§£æžä¸Žé‡å®šä½ï¼Œè°ƒæ•´ä»£ç ä¸­çš„åœ°å€ã€‚ å„ä¸ªæ®µä¸­çš„ç¬¦å·åœ°å€ ä»£ç ä¸­çš„åœ°å€å¼•ç”¨ ç©ºé—´ä¸Žåœ°å€åˆ†é… é“¾æŽ¥å™¨èƒ½å¤ŸèŽ·å¾—æ‰€æœ‰è¾“å…¥ç›®æ ‡æ–‡ä»¶çš„æ®µé•¿åº¦ï¼Œå¹¶ä¸”å°†å®ƒä»¬åˆå¹¶ï¼Œè®¡ç®—å‡ºè¾“å‡ºæ–‡ä»¶ä¸­å„ä¸ªæ®µåˆå¹¶åŽçš„é•¿åº¦å’Œä½ç½®ï¼Œå¹¶å»ºç«‹æ˜ å°„å…³ç³»ã€‚ ç¬¦å·è§£æžä¸Žé‡å®šä½ è¿™é‡Œæœ‰ä¸¤éƒ¨åˆ†ï¼Œç¬¦å·çš„åœ°å€å’Œä»£ç ä¸­çš„åœ°å€ã€‚å…¶ä¸­é“¾æŽ¥å™¨åœ¨å®Œæˆåœ°å€å’Œç©ºé—´åˆ†é…ä¹‹åŽå°±å¯ä»¥ç¡®å®šæ‰€æœ‰ç¬¦å·çš„è™šæ‹Ÿåœ°å€äº†ï¼Œè€Œé“¾æŽ¥å™¨å°±å¯ä»¥æ ¹æ®ç¬¦å·çš„åœ°å€(é€šè¿‡æŸ¥æ‰¾ç”±æ‰€æœ‰è¾“å…¥ç›®æ ‡æ–‡ä»¶çš„ç¬¦å·è¡¨ç»„æˆçš„å…¨å±€ç¬¦å·è¡¨)å¯¹æ¯ä¸ªéœ€è¦é‡å®šä½çš„æŒ‡ä»¤â€”â€”å³ä¼šç”¨åˆ°å¤–éƒ¨ç¬¦å·çš„æŒ‡ä»¤è¿›è¡Œåœ°å€ä¿®æ­£ã€‚ é‡å®šä½è¡¨ é“¾æŽ¥å™¨é€šè¿‡ELFæ–‡ä»¶ä¸­çš„é‡å®šä½è¡¨æ¥å®ŒæˆæŒ‡ä»¤ä¸­åœ°å€çš„è°ƒæ•´ã€‚ ABI æŒ‡çš„æ˜¯å’ŒäºŒè¿›åˆ¶å…¼å®¹æ€§æœ‰å…³çš„å†…å®¹ï¼š å†…ç½®ç±»åž‹çš„å¤§å°å’Œåœ¨å­˜å‚¨å™¨ä¸­çš„æ”¾ç½®æ–¹å¼ï¼ˆå¤§ç«¯ï¼Œå°ç«¯ï¼Œå¯¹é½æ–¹å¼ç­‰ï¼‰ ç»„åˆç±»åž‹ï¼ˆç»“æž„ä½“ï¼Œæ•°ç»„ç­‰ï¼‰çš„å­˜å‚¨æ–¹å¼å’Œå†…å­˜åˆ†å¸ƒ å¤–éƒ¨ç¬¦å·ä¸Žç”¨æˆ·å®šä¹‰çš„ç¬¦å·ä¹‹é—´çš„å‘½åæ–¹å¼å’Œè§£æžæ–¹å¼ å‡½æ•°è°ƒç”¨æ–¹å¼ï¼Œæ¯”å¦‚å‚æ•°å…¥æ ˆé¡ºåºï¼Œè¿”å›žå€¼å¦‚ä½•ä¿å­˜ç­‰ å †æ ˆçš„åˆ†å¸ƒæ–¹å¼ï¼Œæ¯”å¦‚å‚æ•°å’Œå±€éƒ¨å˜é‡åœ¨å †æ ˆä¸­çš„ä½ç½®ï¼Œå‚æ•°ä¼ é€’æ–¹å¼ç­‰ å¯„å­˜å™¨ä½¿ç”¨çº¦å®š é™æ€é“¾æŽ¥åº“ é™æ€é“¾æŽ¥åº“å®žé™…ä¸Šå°±æ˜¯ä¸€ç»„ç›®æ ‡æ–‡ä»¶çš„é›†åˆã€‚å³å¾ˆå¤šç›®æ ‡æ–‡ä»¶ç»è¿‡åŽ‹ç¼©æ‰“åŒ…ä¹‹åŽçš„ä¸€ä¸ªæ–‡ä»¶ã€‚ è£…è½½ è™šæ‹Ÿåœ°å€ç©ºé—´ é¦–å…ˆ32ä½CPUæŒ‡çš„æ˜¯CPUçš„æ•°æ®çº¿æ˜¯32ä½çš„ï¼Œä½†æ˜¯å…¶åœ°å€çº¿ä¸ä¸€å®šåªæœ‰32ä½ï¼ŒPAEåœ°å€æ‰©å±•æ–¹å¼ä¿®æ”¹äº†é¡µæ˜ å°„çš„æ–¹å¼ä½¿å¾—å¯ä»¥è®¿é—®åˆ°æ›´å¤šçš„ç‰©ç†å†…å­˜ã€‚è€Œæ“ä½œç³»ç»Ÿæä¾›ä¸€ä¸ªçª—å£æ˜ å°„çš„æ–¹å¼ï¼Œå°†è¿™äº›é¢å¤–çš„å†…å­˜æ˜ å°„åˆ°è¿›ç¨‹åœ°å€ç©ºé—´ä¸­ã€‚åº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®éœ€è¦æ¥ç”³è¯·å’Œæ˜ å°„ï¼Œæ¯”å¦‚Linuxä¸­çš„mmapç³»ç»Ÿè°ƒç”¨ã€‚ å…³äºŽçŽ°ä»£æ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜ç®¡ç†æœºåˆ¶è¿™é‡Œä¸å±•å¼€ä»‹ç»ã€‚ å†…æ ¸è£…è½½ELFå¯æ‰§è¡Œæ–‡ä»¶ ä¸€å…±æœ‰å¦‚ä¸‹å››ä¸ªæ­¥éª¤ï¼š è¿›ç¨‹åˆ›å»º ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ åˆ›å»ºè™šæ‹Ÿç©ºé—´å®žé™…ä¸Šå¹¶ä¸æ˜¯åˆ›å»ºç©ºé—´è€Œæ˜¯åˆ›å»ºæ˜ å°„å‡½æ•°æ‰€éœ€è¦çš„ç›¸åº”çš„æ•°æ®ç»“æž„ã€‚åœ¨i386çš„Linuxä¸‹ï¼Œåˆ›å»ºè™šæ‹Ÿåœ°å€ç©ºé—´å®žé™…ä¸Šå°±æ˜¯åˆ†é…ä¸€ä¸ªé¡µç›®å½•å°±å¯ä»¥äº†ï¼Œç”šè‡³ä¸è®¾ç½®é¡µæ˜ å°„å…³ç³»â€”â€”è¿™äº›ç­‰åˆ°åŽé¢ç¨‹åºå‘ç”Ÿç¼ºé¡µä¸­æ–­çš„æ—¶å€™å†è¿›è¡Œè®¾ç½®ï¼ˆå½“ç¨‹åºå‘ç”Ÿäº†é¡µé”™è¯¯ï¼Œæ“ä½œç³»ç»Ÿå°†ä»Žç‰©ç†å†…å­˜ä¸­åˆ†é…ä¸€ä¸ªç‰©ç†é¡µï¼Œç„¶åŽå°†è¯¥â€œç¼ºé¡µâ€ä»Žç£ç›˜ä¸­è¯»å–åˆ°å†…å­˜ä¸­ï¼Œåœ¨è®¾ç½®ç¼ºé¡µå’Œç‰©ç†é¡µæ¡†çš„æ˜ å°„å…³ç³»ï¼‰ã€‚ è¿™ä¸€æ­¥æœ¬è´¨ä¸Šå°±æ˜¯å®Œæˆè™šæ‹Ÿç©ºé—´åˆ°ç‰©ç†å†…å­˜çš„æ˜ å°„å…³ç³»ã€‚ å®ŒæˆELFå’Œè¿›ç¨‹çš„æ˜ å°„ ç¬¬äºŒæ­¥æ˜¯è¯»å–å¯æ‰§è¡Œæ–‡ä»¶å¤´ï¼Œå¹¶ä¸”å»ºç«‹è™šæ‹Ÿç©ºé—´ä¸Žå¯æ‰§è¡Œæ–‡ä»¶çš„æ˜ å°„å…³ç³»ã€‚ å¾ˆæ˜Žæ˜¾ï¼Œè¿™ç§æ˜ å°„å…³ç³»æ˜¯ä¿å­˜åœ¨æ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ•°æ®ç»“æž„ï¼ˆç±»ä¼¼é¡µç›®å½•ï¼‰ã€‚Linuxä¸­å°†è¿›ç¨‹è™šæ‹Ÿç©ºé—´ä¸­çš„ä¸€ä¸ªæ®µå«åšè™šæ‹Ÿå†…å­˜åŒºåŸŸï¼ˆVMAï¼ŒVirtual Memory Areaï¼‰ã€‚æ“ä½œç³»ç»Ÿåœ¨å†…éƒ¨ä¿å­˜è¿™ç§VMAç»“æž„ï¼Œå°±æ˜¯å› ä¸ºå½“ç¨‹åºå‘ç”Ÿæ®µé”™è¯¯çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡æŸ¥æ‰¾è¿™æ ·ä¸€ä¸ªæ•°æ®ç»“æž„æ¥å®šä½é”™è¯¯é¡µåœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„ä½ç½®ã€‚ è¿è¡Œ ç¬¬ä¸‰æ­¥æ˜¯å°†CPUçš„æŒ‡ä»¤å¯„å­˜å™¨è®¾ç½®æˆå¯æ‰§è¡Œæ–‡ä»¶çš„å…¥å£åœ°å€ï¼Œå¯åŠ¨è¿è¡Œã€‚ æ“ä½œç³»ç»Ÿè¿›è¡Œå†…æ ¸å †æ ˆå’Œç”¨æˆ·å †æ ˆçš„åˆ‡æ¢ï¼ŒCPUè¿è¡Œæƒé™çš„åˆ‡æ¢ï¼Œç„¶åŽè®¾ç½®CPUçš„æŒ‡ä»¤å¯„å­˜å™¨å¹¶å°†æŽ§åˆ¶æƒäº¤ç»™è¿›ç¨‹ã€‚ ç¼ºé¡µä¸­æ–­ åœ¨ä¸Šè¿°æ­¥éª¤éƒ½å®Œæˆä¹‹åŽï¼Œå…¶å®žå¯æ‰§è¡Œæ–‡ä»¶çš„çœŸæ­£æŒ‡ä»¤å’Œæ•°æ®éƒ½æ²¡æœ‰è¢«è£…è½½è¿›å†…å­˜ä¸­ã€‚æ“ä½œç³»ç»Ÿåªæ˜¯é€šè¿‡å¯æ‰§è¡Œæ–‡ä»¶å¤´éƒ¨çš„ä¿¡æ¯å»ºç«‹èµ·æ¥å¯æ‰§è¡Œæ–‡ä»¶å’Œè¿›ç¨‹è™šå­˜ä¹‹é—´çš„æ˜ å°„å…³ç³»è€Œå·²ã€‚ å½“å‘ç”Ÿä¸€æ¬¡ç¼ºé¡µä¸­æ–­çš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿå°†æŸ¥è¯¢è¿™ä¸ªæ•°æ®ç»“æž„ï¼Œç„¶åŽæ‰¾åˆ°ç©ºé¡µé¢æ‰€åœ¨çš„VMA ï¼Œè®¡ç®—å‡ºç›¸åº”çš„é¡µé¢åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„åç§»ï¼Œç„¶åŽåœ¨ç‰©ç†å†…å­˜ä¸­åˆ†é…ä¸€ä¸ªç‰©ç†é¡µé¢ï¼Œå°†è¿›ç¨‹ä¸­è¯¥è™šæ‹Ÿé¡µä¸Žç‰©ç†é¡µä¹‹é—´å»ºç«‹æ˜ å°„å…³ç³»ï¼Œå®ŒæˆçœŸæ­£çš„è£…è½½ã€‚ è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´åˆ†å¸ƒ ELFæ–‡ä»¶é“¾æŽ¥è§†å›¾å’Œæ‰§è¡Œè§†å›¾ æ“ä½œç³»ç»Ÿè£…è½½ELFå¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™æ˜¯ä»¥æ®µsegmentä¸ºå•ä½çš„ï¼Œä¸€èˆ¬åªå…³å¿ƒè·Ÿè£…è½½æœ‰å…³çš„é—®é¢˜ï¼Œæœ€ä¸»è¦çš„æ˜¯æ®µçš„æƒé™(å¯è¯»ï¼Œå¯å†™ï¼Œå¯æ‰§è¡Œ)ã€‚ELFæ–‡ä»¶ä¸­ï¼Œæ®µçš„æƒé™å¾€å¾€åªæœ‰ä¸ºæ•°ä¸å¤šçš„å‡ ç§ç»„åˆï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¸‰ç§ï¼š ä»¥ä»£ç æ®µä¸ºä»£è¡¨çš„æƒé™ä¸ºå¯è¯»å¯æ‰§è¡Œçš„æ®µ ä»¥æ•°æ®æ®µå’ŒBSSæ®µä¸ºä»£è¡¨çš„æƒé™ä¸ºå¯è¯»å¯å†™çš„æ®µ ä»¥åªè¯»æ•°æ®æ®µä¸ºä»£è¡¨çš„æƒé™ä¸ºåªè¯»çš„æ®µ ä¸€èˆ¬å¯¹äºŽç›¸åŒæƒé™çš„æ®µï¼ŒæŠŠå®ƒä»¬åˆå¹¶åœ¨ä¸€èµ·ä½œä¸ºä¸€ä¸ªæ®µè¿›è¡Œæ˜ å°„â€”â€”æˆä¸ºsegmentã€‚å¤šä¸ªsectionsç»„åˆæˆä¸ºsegmentï¼Œè£…è½½çš„æ—¶å€™ä¸€ä¸ªsegmentåœ¨è¿›ç¨‹è™šæ‹Ÿç©ºé—´ä¸­åªæœ‰ä¸€ä¸ªå¯¹åº”çš„VMAï¼Œè¿™æ ·å¯ä»¥æ˜Žæ˜¾çš„å‡å°‘å†…éƒ¨ç¢Žç‰‡ï¼Œä»Žè€ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ã€‚ æ‰€ä»¥å¯¹äºŽç³»ç»Ÿæ¥è®²ï¼Œsectionæ˜¯é“¾æŽ¥è§†å›¾ï¼Œè€Œsegmentæ˜¯æ‰§è¡Œè§†å›¾ã€‚ åœ¨æ“ä½œç³»ç»Ÿè£…è½½çš„æ—¶å€™ï¼ŒVMAé™¤äº†ç”¨æ¥æ˜ å°„å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„å„ä¸ªsegmentä»¥å¤–ï¼Œäº‹å®žä¸Šè¿›ç¨‹è™šæ‹Ÿç©ºé—´ä¸­çš„å †æ ˆä¹Ÿæ˜¯ä»¥VMAçš„å½¢å¼å­˜åœ¨çš„ã€‚æ‰€ä»¥æ€»ç»“ä¸€ä¸‹ï¼Œæ“ä½œç³»ç»Ÿé€šè¿‡ç»™è¿›ç¨‹ç©ºé—´åˆ’åˆ†å‡ºä¸€ä¸ªä¸ªVMAæ¥ç®¡ç†è¿›ç¨‹çš„è™šæ‹Ÿç©ºé—´ï¼ŒåŸºæœ¬åŽŸåˆ™å°±æ˜¯ç›¸åŒæƒé™å±žæ€§çš„ï¼Œæœ‰ç›¸åŒæ˜ åƒæ–‡ä»¶çš„æ˜ å°„æˆä¸€ä¸ªVMAï¼Œä¸€ä¸ªè¿›ç¨‹åŸºæœ¬ä¸Šå¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ ç§VMAåŒºåŸŸï¼š ä»£ç VMAï¼Œæƒé™åªè¯»ã€å¯æ‰§è¡Œï¼›æœ‰æ˜ åƒæ–‡ä»¶ æ•°æ®VMAï¼Œæƒé™å¯è¯»å†™ï¼Œå¯æ‰§è¡Œï¼›æœ‰æ˜ åƒæ–‡ä»¶ å †VMAï¼Œæƒé™å¯è¯»å†™ï¼Œå¯æ‰§è¡Œï¼›æ— æ˜ åƒæ–‡ä»¶ï¼ŒåŒ¿åï¼Œå¯å‘ä¸Šæ‰©å±• æ ˆVMAï¼Œæƒé™å¯è¯»å†™ï¼Œä¸å¯æ‰§è¡Œï¼›æ— æ˜ åƒæ–‡ä»¶ï¼ŒåŒ¿åï¼Œå¯å‘ä¸‹æ‰©å±• æ®µåœ°å€å¯¹é½ å› ä¸ºè£…è½½è¿‡ç¨‹æ˜¯é€šè¿‡è™šæ‹Ÿå†…å­˜çš„é¡µæ˜ å°„æœºåˆ¶å®Œæˆçš„ã€‚å‡è®¾é¡µå¤§å°é»˜è®¤ä¸º4096Bytesï¼Œæ‰€ä»¥å¦‚æžœè¦å°†ä¸€æ®µç‰©ç†å†…å­˜å’Œè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¹‹é—´å»ºç«‹æ˜ å°„å…³ç³»ï¼Œè¿™æ®µå†…å­˜ç©ºé—´çš„é•¿åº¦å¿…é¡»æ˜¯4Kçš„æ•´æ•°å€ï¼Œå¹¶ä¸”è¿™æ®µç©ºé—´åœ¨ç‰©ç†å†…å­˜å’Œè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„èµ·å§‹åœ°å€å¿…é¡»æ˜¯4096çš„æ•´æ•°å€ã€‚ ç³»ç»Ÿä¸ºäº†é˜²æ­¢ç¢Žç‰‡åŒ–ï¼Œä¹Ÿä¼šé‡‡å–ä¸€äº›ä¼˜åŒ–çš„æ˜ å°„æ–¹æ¡ˆï¼Œè¿™é‡Œä¸æ·±å…¥äº†ã€‚ åŠ¨æ€é“¾æŽ¥ é™æ€é“¾æŽ¥æœ‰ç©ºé—´æµªè´¹å’Œæ›´æ–°å›°éš¾ä¸¤ä¸ªé—®é¢˜ã€‚ å…±äº«æ–‡ä»¶åœ¨å†…å­˜ä¸­åªå­˜åœ¨ä¸€ä»½ï¼Œè¿™æ ·ä¸ä»…ä»…èŠ‚çœå†…å­˜ï¼Œè¿˜å¢žåŠ CPUç¼“å­˜çš„å‘½ä¸­çŽ‡ã€‚ELFåŠ¨æ€é“¾æŽ¥æ–‡ä»¶ç§°ä¸º.soå…±äº«å¯¹è±¡æ–‡ä»¶ï¼Œè€ŒWindowsåŠ¨æ€é“¾æŽ¥åº“ç§°ä¸º.dllæ–‡ä»¶ã€‚ å½“ç¨‹åºè¢«è£…è½½çš„æ—¶å€™ï¼Œç³»ç»Ÿçš„åŠ¨æ€é“¾æŽ¥å™¨ä¼šå°†ç¨‹åºæ‰€éœ€è¦çš„æ‰€æœ‰åŠ¨æ€é“¾æŽ¥åº“è£…è½½åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œå¹¶ä¸”å°†ç¨‹åºä¸­æ‰€æœ‰æœªå†³è®®çš„ç¬¦å·ç»‘å®šåˆ°ç›¸åº”çš„åŠ¨æ€é“¾æŽ¥åº“ä¸­ï¼Œå¹¶è¿›è¡Œé‡å®šä½å·¥ä½œã€‚ä¹Ÿå°±æ˜¯è¯´åŠ¨æ€é“¾æŽ¥å™¨æŠŠé“¾æŽ¥è¿™ä¸ªè¿‡ç¨‹ä»Žæœ¬æ¥çš„ç¨‹åºè£…è½½å‰è¢«æŽ¨è¿Ÿåˆ°è£…è½½çš„æ—¶å€™ã€‚è¿™æ ·çš„è¯åŠ¨æ€é“¾æŽ¥ä¸Žé™æ€é“¾æŽ¥ç›¸æ¯”ï¼Œæ€§èƒ½æŸå¤±å¤§çº¦åœ¨5%ä»¥ä¸‹ã€‚è¿™ç‚¹æŸå¤±æ¢å–ç©ºé—´ä¸Šçš„èŠ‚çœå’Œç¨‹åºæž„å»ºå’Œå‡çº§æ—¶çš„çµæ´»æ€§ï¼Œæ˜¯æƒ³å½“å€¼å¾—çš„ã€‚ åœ°å€æ— å…³ä»£ç  ç”±æ€§è´¨å¯ä»¥çŸ¥é“å…±äº«å¯¹è±¡åœ¨ç¼–è¯‘çš„æ—¶å€™ä¸èƒ½å‡è®¾è‡ªå·±åœ¨è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„ä½ç½®ã€‚è€Œå¯æ‰§è¡Œæ–‡ä»¶åŸºæœ¬å¯ä»¥ç¡®å®šè‡ªå·±åœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„èµ·å§‹ä½ç½®ã€‚è¿™é‡Œæ³¨æ„åŠ¨æ€é“¾æŽ¥çš„æ¨¡å—æ¦‚å¿µï¼šå¯æ‰§è¡Œæ–‡ä»¶æ¨¡å—å’Œæ­£å¸¸é™æ€é“¾æŽ¥ä¸€æ ·ï¼Œè€Œå…±äº«å¯¹è±¡æ¨¡å—å³åŠ¨æ€é“¾æŽ¥åº“å°±ä¸è¡Œã€‚ é‚£å…±äº«å¯¹è±¡åœ¨è¢«åŠ è½½çš„æ—¶å€™ï¼Œå¦‚ä½•ç¡®å®šå®ƒåœ¨è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„ä½ç½®ï¼Ÿ è¿™é‡Œæå‡ºä¸€ä¸ªé—®é¢˜ï¼šå¦‚æžœç›´æŽ¥å°†ç›®æ ‡æ–‡ä»¶æŽ¨è¿Ÿåˆ°è£…è½½çš„æ—¶å€™å†é“¾æŽ¥å¯ä»¥å—ï¼Ÿ ç­”æ¡ˆæ˜¯ä¸è¡Œã€‚åŠ¨æ€é“¾æŽ¥æ¨¡å—è¢«è£…è½½æ˜ å°„åˆ°è™šæ‹Ÿç©ºé—´ä¹‹åŽï¼ŒæŒ‡ä»¤éƒ¨åˆ†æ˜¯åœ¨å¤šä¸ªè¿›ç¨‹ä¸­å…±äº«çš„ï¼Œç”±äºŽè£…è½½çš„æ—¶å€™é‡å®šä½çš„æ–¹æ³•éœ€è¦ä¿®æ”¹æŒ‡ä»¤ï¼ˆä¼šå½±å“ä»£ç æ®µä¸­çš„ç»å¯¹åœ°å€å¼•ç”¨ï¼‰ï¼Œæ‰€ä»¥æ²¡æœ‰åŠžæ³•åšåˆ°åŒä¸€ä»½æŒ‡ä»¤è¢«å¤šä¸ªè¿›ç¨‹å…±äº«ã€‚ æ‰€ä»¥æœ€ç»ˆçš„è§£å†³åŠžæ³•å°±æ˜¯ï¼šå°†å…±äº«çš„æŒ‡ä»¤éƒ¨åˆ†ä¸­é‚£äº›éœ€è¦è¢«ä¿®æ”¹çš„éƒ¨åˆ†åˆ†ç¦»å‡ºæ¥ï¼Œè·Ÿæ•°æ®éƒ¨åˆ†æ”¾åœ¨ä¸€èµ·ï¼Œè¿™æ ·æŒ‡ä»¤éƒ¨åˆ†å°±å¯ä»¥ä¿æŒä¸å˜ï¼Œè€Œæ•°æ®éƒ¨åˆ†å¯ä»¥åœ¨æ¯ä¸ªè¿›ç¨‹ä¸­æ‹¥æœ‰ä¸€ä»½å‰¯æœ¬â€”â€”æ‰€è°“åœ°å€æ— å…³ä»£ç (PIC, Pisition-independent Code)æŠ€æœ¯ã€‚ ä»£ç æ®µåœ°å€æ— å…³ä»£ç  è¿™é‡ŒæŠŠå…±äº«å¯¹è±¡æ¨¡å—ä¸­çš„åœ°å€å¼•ç”¨æŒ‰ç…§æ˜¯å¦è·¨æ¨¡å—åˆ†ä¸ºä¸¤ç±»ï¼šæ¨¡å—å†…éƒ¨å¼•ç”¨å’Œæ¨¡å—å¤–éƒ¨å¼•ç”¨ï¼›æŒ‰ç…§ä¸åŒçš„å¼•ç”¨æ–¹å¼æœ‰å¯ä»¥åˆ†ä¸ºæŒ‡ä»¤å¼•ç”¨å’Œæ•°æ®è®¿é—®ã€‚ æ¨¡å—å†…éƒ¨çš„å‡½æ•°è°ƒç”¨ï¼Œè·³è½¬ç­‰ æ¨¡å—å†…éƒ¨çš„æ•°æ®è®¿é—®ï¼Œæ¯”å¦‚æ¨¡å—ä¸­å®šä¹‰çš„å…¨å±€å˜é‡ï¼Œé™æ€å˜é‡ æ¨¡å—å¤–éƒ¨çš„å‡½æ•°è°ƒç”¨ï¼Œè·³è½¬ç­‰ æ¨¡å—å¤–éƒ¨çš„æ•°æ®è®¿é—®ï¼Œæ¯”å¦‚æ¨¡å—ä¸­å®šä¹‰çš„å…¨å±€å˜é‡ï¼Œé™æ€å˜é‡ è¿™é‡Œæä¸€ä¸‹æ¨¡å—é—´ï¼Œå› ä¸ºè¿™äº›å…¨å±€å˜é‡çš„åœ°å€æ˜¯è·Ÿæ¨¡å—è£…è½½åœ°å€æœ‰å…³çš„ã€‚ELFçš„åšæ³•å°±æ˜¯åœ¨æ•°æ®æ®µä¸­å»ºç«‹ä¸€ä¸ªæŒ‡å‘è¿™äº›å˜é‡çš„æŒ‡é’ˆæ•°ç»„ï¼Œä¹Ÿè¢«ç§°ä¸ºå…¨å±€åç¦»è¡¨(Global Offset Table GOT)ï¼Œå½“ä»£ç éœ€è¦å¼•ç”¨è¯¥å…¨å±€å˜é‡çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡GOTä¸­ç›¸å¯¹åº”çš„é¡¹é—´æŽ¥å¼•ç”¨ã€‚ é“¾æŽ¥å™¨åœ¨è£…è½½æ¨¡å—çš„æ—¶å€™ä¼šæŸ¥æ‰¾æ¯ä¸ªå˜é‡æ‰€åœ¨çš„åœ°å€ï¼Œç„¶åŽå¡«å……GOTä¸­çš„å„ä¸ªé¡¹ï¼Œä»¥ç¡®ä¿æ¯ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„åœ°å€æ­£ç¡®ã€‚GOTåœ¨æ•°æ®æ®µæ‰€ä»¥å¯è¢«ä¿®æ”¹ã€‚æ€»ç»“ä¸€ä¸‹ï¼š æŒ‡ä»¤è·³è½¬ï¼Œè°ƒç”¨ æ•°æ®è®¿é—® æ¨¡å—å†…éƒ¨ ç›¸å¯¹è·³è½¬å’Œè°ƒç”¨ ç›¸å¯¹åœ°å€è®¿é—® æ¨¡å—å¤–éƒ¨ é—´æŽ¥è·³è½¬å’Œè°ƒç”¨GOT é—´æŽ¥è®¿é—®GOT å…±äº«æ¨¡å—çš„å…¨å±€å˜é‡é—®é¢˜ è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå¦‚æžœä¸€ä¸ªæ¨¡å—å¼•ç”¨äº†ä¸€ä¸ªå®šä¹‰åœ¨å…±äº«å¯¹è±¡çš„å…¨å±€å˜é‡çš„æ—¶å€™ã€‚ç¼–è¯‘å™¨æ— æ³•åˆ¤æ–­è¯¥globalæ˜¯åœ¨åŒä¸€ä¸ªæ¨¡å—çš„å…¶ä»–ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œè¿˜æ˜¯å®šä¹‰åœ¨å¦ä¸€ä¸ªå…±äº«å¯¹è±¡ä¸­ã€‚ è§£å†³åŠžæ³•æ˜¯æ‰€æœ‰çš„å…¨å±€å˜é‡éƒ½é€šè¿‡GOTè®¿é—®ã€‚ æ•°æ®æ®µåœ°å€æ— å…³ä»£ç  æ•°æ®æ®µä¸­ä¹Ÿä¼šå‡ºçŽ°ç»å¯¹åœ°å€å¼•ç”¨çš„æƒ…å†µï¼š 123&gt; static int a;&gt; static int *p = &amp;a;&gt; è¿™é‡Œçš„æŒ‡é’ˆpå°±æ˜¯ä¸€ä¸ªç»å¯¹åœ°å€ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æžœå‘çŽ°æ•°æ®æ®µä¸­æœ‰ç»å¯¹åœ°å€å¼•ç”¨ï¼Œç¼–è¯‘å™¨å’Œé“¾æŽ¥å™¨ä¼šäº§ç”Ÿä¸€ä¸ªé‡å®šä½è¡¨ã€‚ å¯¹äºŽå¯æ‰§è¡Œæ–‡ä»¶æ¥è¯´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æžœå¯æ‰§è¡Œæ–‡ä»¶æ˜¯åŠ¨æ€é“¾æŽ¥çš„ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šä½¿ç”¨PICçš„æ–¹æ³•æ¥äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶çš„ä»£ç æ®µéƒ¨åˆ†ï¼Œä»¥ä¾¿äºŽä¸åŒçš„è¿›ç¨‹èƒ½å¤Ÿå…±äº«ä»£ç æ®µï¼ŒèŠ‚çœå†…å­˜ã€‚æ‰€ä»¥ä¸€èˆ¬åŠ¨æ€é“¾æŽ¥çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ä¼šæœ‰.gotæ®µã€‚ åŠ¨æ€é“¾æŽ¥è¿‡ç¨‹ åŠ¨æ€é“¾æŽ¥æƒ…å†µä¸‹ï¼Œå¯æ‰§è¡Œæ–‡ä»¶çš„è£…è½½ä¸Žé™æ€é“¾æŽ¥æƒ…å†µåŸºæœ¬ä¸€æ ·ã€‚é¦–å…ˆæ“ä½œç³»ç»Ÿä¼šè¯»å–å¯æ‰§è¡Œæ–‡ä»¶çš„å¤´éƒ¨ï¼Œæ£€æŸ¥æ–‡ä»¶çš„åˆæ³•æ€§ï¼Œç„¶åŽæ–‡ä»¶å¤´ä¸­è¯»å–æ¯ä¸ªâ€œSegmentâ€çš„è™šæ‹Ÿåœ°å€ï¼Œæ–‡ä»¶åœ°å€å’Œå±žæ€§ï¼Œå¹¶å°†å®ƒä»¬æ˜ å°„åˆ°è¿›ç¨‹è™šæ‹Ÿç©ºé—´çš„ç›¸åº”ä½ç½®ï¼Œè¿™äº›æ­¥éª¤è·Ÿå‰é¢çš„é™æ€é“¾æŽ¥æƒ…å†µä¸‹çš„è£…è½½åŸºæœ¬æ— å¼‚ã€‚åœ¨é™æ€é“¾æŽ¥æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»ŸæŽ¥ç€å°±å¯ä»¥æŠŠæŽ§åˆ¶æƒè½¬äº¤ç»™å¯æ‰§è¡Œæ–‡ä»¶çš„å…¥å£åœ°å€ï¼Œç„¶åŽç¨‹åºå¼€å§‹æ‰§è¡Œï¼Œä¸€åˆ‡å¾ˆé¡ºåˆ©ã€‚ ä½†æ˜¯åœ¨åŠ¨æ€é“¾æŽ¥ä¸‹ï¼Œæ“ä½œç³»ç»Ÿè¿˜ä¸èƒ½å†è£…è½½å®Œå¯æ‰§è¡Œæ–‡ä»¶ä¹‹åŽå°±æŠŠæŽ§åˆ¶æƒäº¤ç»™å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“å¯æ‰§è¡Œæ–‡ä»¶ä¾èµ–äºŽå¾ˆå¤šå…±äº«å¯¹è±¡ï¼Œè¿™æ—¶å€™å¯æ‰§è¡Œæ–‡ä»¶é‡Œå¯¹äºŽå¾ˆå¤šå¤–éƒ¨ç¬¦å·çš„å¼•ç”¨è¿˜å¤„äºŽæ— æ•ˆåœ°å€çš„çŠ¶æ€ï¼Œå³è¿˜æ²¡æœ‰è·Ÿç›¸åº”çš„å…±äº«å¯¹è±¡ä¸­çš„å®žé™…ä½ç½®é“¾æŽ¥èµ·æ¥ã€‚æ‰€ä»¥åœ¨æ˜ å°„å®Œå¯æ‰§è¡Œæ–‡ä»¶ä¹‹åŽï¼Œæ“ä½œç³»ç»Ÿä¼šå…¶ä¸­ä¸€ä¸ªåŠ¨æ€é“¾æŽ¥å™¨ã€‚ åŠ¨æ€é“¾æŽ¥åˆ†ä¸ºä¸‰æ­¥ï¼šå¯åŠ¨åŠ¨æ€é“¾æŽ¥å™¨æœ¬èº«ï¼Œç„¶åŽè£…è½½æ‰€æœ‰éœ€è¦çš„å…±äº«å¯¹è±¡ï¼Œæœ€åŽæ˜¯é‡å®šä½å’Œåˆå§‹åŒ–ã€‚ å…±äº«åº“ å› ä¸ºåŠ¨æ€é“¾æŽ¥çš„è¯¸å¤šä¼˜ç‚¹ï¼Œæ“ä½œç³»ç»Ÿä¸­ä¸€èˆ¬æœ‰å¾ˆå¤šå…±äº«å¯¹è±¡â€”â€”æŒ‰ç…§åˆç†çš„ç»„ç»‡å’Œä½¿ç”¨æ–¹å¼æž„å»ºèµ·æ¥çš„å…±äº«åº“ã€‚å…±äº«åº“çš„æ›´æ–°ä¼šå½±å“ABIçš„ä½¿ç”¨ã€‚ è¿è¡Œåº“ ç»è¿‡å‰é¢çš„ä»‹ç»ï¼ŒåŸºæœ¬ä¸Šç¼–è¯‘ç³»ç»Ÿçš„æ¦‚å¿µéƒ½ä»‹ç»å®Œäº†ã€‚ä¸‹é¢çš„éƒ¨åˆ†æ¶‰åŠæ“ä½œç³»ç»ŸæŽ¥å£ï¼Œä¹Ÿåªæ˜¯ç®€å•çš„ä»‹ç»ä¸€ä¸‹ã€‚ æ“ä½œç³»ç»Ÿè£…è½½ç¨‹åºä¹‹åŽï¼Œé¦–å…ˆè¿è¡Œçš„ä»£ç å¹¶ä¸æ˜¯mainçš„ç¬¬ä¸€è¡Œï¼Œè€Œæ˜¯æŸäº›åˆ«çš„ä»£ç ï¼Œè¿™äº›ä»£ç è´Ÿè´£å‡†å¤‡å¥½mainå‡½æ•°æ‰§è¡Œæ‰€éœ€è¦çš„çŽ¯å¢ƒï¼Œå¹¶ä¸”è´Ÿè´£è°ƒç”¨mainå‡½æ•°ï¼Œè¿™æ—¶å€™æ‰å¯ä»¥ç”³è¯·å†…å­˜ï¼Œä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œè§¦å‘å¼‚å¸¸ï¼Œè®¿é—®I/Oã€‚åœ¨å‡½æ•°è¿”å›žä¹‹åŽä¼šè®°å½•mainçš„è¿”å›žå€¼ï¼Œè°ƒç”¨atexitæ³¨å†Œçš„å‡½æ•°ï¼Œç„¶åŽç»“æŸè¿›ç¨‹ã€‚ è¿è¡Œè¿™äº›ä»£ç çš„å‡½æ•°æˆä¸ºå…¥å£å‡½æ•°æˆ–è€…å…¥å£ç‚¹ã€‚è¿™äº›éƒ½æ˜¯è¿è¡Œåº“çš„ä¸€éƒ¨åˆ†ã€‚ä¸ªäººç†è§£è¿è¡Œåº“çš„æ¦‚å¿µå°±æ˜¯æ“ä½œç³»ç»Ÿå’Œåº”ç”¨å±‚çš„æŽ¥å£ï¼ŒåŒºåˆ«äºŽç³»ç»Ÿè°ƒç”¨ï¼Œæ¯”å¦‚Glibcé‚£æ ·ã€‚ å¸¸ç”¨äºŒè¿›åˆ¶å·¥å…·(åŸºäºŽLLVM) å‘½ä»¤ è¯´æ˜Ž llvm-size æŸ¥çœ‹ELFæ–‡ä»¶çš„å„ä¸ªæ®µçš„å¤§å° llvm-readelf -h æŸ¥çœ‹ELF Header(éƒ¨åˆ†) llvm-readelf -S æŸ¥çœ‹ELF Header(å…¨éƒ¨) llvm-objdump -s å°†æ‰€æœ‰ELFæ®µä»¥åå…­è¿›åˆ¶çš„æ–¹å¼æ‰“å° llvm-objdump -d å°†æ‰€æœ‰æŒ‡ä»¤æ®µåæ±‡ç¼– å­—èŠ‚å¯»å€,å°ç«¯ llvm-nm æŸ¥çœ‹ELFæ–‡ä»¶çš„ç¬¦å·è¡¨ c++filt è§£æžå‡½æ•°ç­¾å ld a.o b.o -e main -o ab ç›´æŽ¥ä½¿ç”¨é“¾æŽ¥å™¨ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶abï¼ˆå°†mainå‡½æ•°ä½œä¸ºç¨‹åºå…¥å£ï¼‰ llvm-objdump -r æŸ¥çœ‹ç›®æ ‡æ–‡ä»¶çš„é‡å®šä½è¡¨ ar -t libc.a æŸ¥çœ‹é™æ€é“¾æŽ¥åº“åŒ…å«äº†é‚£äº›æ–‡ä»¶ clang -fPIC -shared lib.so lib.c ç¼–è¯‘ä¸€ä¸ªå…±äº«å¯¹è±¡æ–‡ä»¶]]></content>
      <categories>
        <category>C++</category>
      </categories>
      <tags>
        <tag>Compiler</tag>
        <tag>LLVM</tag>
        <tag>Linker</tag>
        <tag>Loader</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[GCC-RISCVäº¤å‰ç¼–è¯‘å·¥å…·é“¾]]></title>
    <url>%2F2020%2F02%2F16%2FGcc-RISCV%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91%E5%B7%A5%E5%85%B7%E9%93%BE%2F</url>
    <content type="text"><![CDATA[Absrtact æ—¨åœ¨x86å¹³å°ä¸Šç¼–è¯‘RISCVæž¶æž„çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ RISCVä½œä¸ºä¸€æ¬¾æžå…·ä½¿å‘½æ„Ÿçš„æŒ‡ä»¤é›†ï¼Œå…¶è½¯ä»¶æ ˆä¹Ÿæ˜¯éžå¸¸å®Œæ•´çš„ã€‚äº¤å‰ç¼–è¯‘çŽ¯å¢ƒå¯ä»¥åœ¨è¿™é‡Œä¸‹è½½ã€‚ äº¤å‰ç¼–è¯‘å·¥å…·é“¾åŒ…æ‹¬: GCCç¼–è¯‘å™¨ Cè¿è¡Œåº“ Glibc : gnuæ——ä¸‹çš„åº“ï¼Œä½œä¸ºlinuxçš„æ ‡å‡†åº“å’Œå†…æ ¸æ‰“äº¤é“ Newlibï¼š åœ¨åµŒå…¥å¼ä¸­ä½¿ç”¨å¹¿æ³› BuntilsäºŒè¿›åˆ¶å¥—ä»¶ GDBè°ƒè¯•å™¨ ä¸åŒç‰ˆæœ¬çš„å·¥å…·é“¾ Version Note Riscv-unknown-linux-gnu-gcc 132ä½æž¶æž„çš„2Linuxç‰ˆæœ¬ Riscv-unknown-elf-gcc 32ä½æž¶æž„çš„éžLinuxç‰ˆæœ¬ æ¯ä¸ªç‰ˆæœ¬éƒ½æœ‰32ä½æž¶æž„å’Œ64ä½æž¶æž„ï¼Œè¿™é‡Œçš„ä½æ•°å’Œè¿è¡Œæœ¬æœºçš„å­—é•¿æ— å…³ï¼ŒæŒ‡çš„æ˜¯æ²¡æœ‰é€šè¿‡-march=å’Œ-mabi=é€‰é¡¹æŒ‡å®šRISCVæž¶æž„çš„ä½å®½ Linuxç‰ˆæœ¬æŒ‡çš„æ˜¯è¯¥å·¥å…·é“¾ä½¿ç”¨Linuxç³»ç»Ÿä¸­è¿è¡Œçš„Glibcä½œä¸ºCè¿è¡Œåº“â€”â€”å¦å¤–çš„ä¸ªç‰ˆæœ¬åˆ™ä½¿ç”¨Newlibcåº“ äº¤å‰ç¼–è¯‘é€‰é¡¹ -march= â€‹ ç”±äºŽ\(RISCV\)ä¸ºæ¨¡å—åŒ–æŒ‡ä»¤ï¼Œè¯¥é€‰é¡¹æ”¯æŒä¸åŒçš„æ¨¡å—åŒ–æŒ‡ä»¤é›†ç»„åˆ,å…³äºŽ\(RISCV\)æ¨¡å—è§åŽé¢çš„ä»‹ç»: rv32i[m][a][f[d]][c] rv32g[c] rv64i[m][a][f[d]][c] rv64g[c] -mabi= â€‹ è¯¥é€‰é¡¹é€‰å®šäº†ç›®æ ‡å¹³å°æ‰€æ”¯æŒçš„ABIå‡½æ•°è°ƒç”¨: ilp32ï¼Œilp32fï¼Œilp32d 32ä½æž¶æž„(int-32ä½ long-32ä½ long long-64ä½) lp64ï¼Œlp64fï¼Œlp64d 64ä½æž¶æž„(int-32ä½ long-64ä½) åŽç¼€ suffix Note -- ä½¿ç”¨æµ®ç‚¹ç±»åž‹æ“ä½œç›´æŽ¥ä½¿ç”¨RISCVæµ®ç‚¹æŒ‡ä»¤è¿›è¡Œæ”¯æŒï¼Œä½†æ˜¯å½“æµ®ç‚¹æ•°ä½œä¸ºå‡½æ•°å‚æ•°è¿›è¡Œä¼ é€’æ—¶ï¼Œæ— è®ºæ˜¯å•ç²¾åº¦è¿˜æ˜¯åŒç²¾åº¦å‡éœ€è¦å­˜å‚¨å™¨ä¸­çš„å †æ ˆè¿›è¡Œä¼ é€’ -f ä½¿ç”¨æµ®ç‚¹ç±»åž‹æ“ä½œç›´æŽ¥ä½¿ç”¨RISCVæµ®ç‚¹æŒ‡ä»¤è¿›è¡Œæ”¯æŒï¼Œä½†æ˜¯å½“æµ®ç‚¹æ•°ä½œä¸ºå‡½æ•°å‚æ•°è¿›è¡Œä¼ é€’æ—¶ï¼Œå•ç²¾åº¦é€šè¿‡å¯„å­˜æ‹¿èµ·ä¼ é€’ï¼ŒåŒç²¾åº¦é€šè¿‡å†…å­˜å †æ ˆä¼ é€’ -d ä½¿ç”¨æµ®ç‚¹ç±»åž‹æ“ä½œç›´æŽ¥ä½¿ç”¨RISCVæµ®ç‚¹æŒ‡ä»¤è¿›è¡Œæ”¯æŒï¼Œä½†æ˜¯å½“æµ®ç‚¹æ•°ä½œä¸ºå‡½æ•°å‚æ•°è¿›è¡Œä¼ é€’æ—¶ï¼Œå•/åŒç²¾åº¦å‡å¯é€šè¿‡å¯„å­˜å™¨ä¼ é€’ åªæœ‰-march=æ”¯æŒæµ®ç‚¹æ‰©å±•ï¼Œ(-mabi=)æ‰å…è®¸åŠ ä¸Šf/dåŽç¼€ä»¥æ”¯æŒæµ®ç‚¹è¿ç®—ã€‚ RISCVæ±‡ç¼–è¯­è¨€ç®€ä»‹ æ€»ç»“ ç›®å‰äº¤å‰ç¼–è¯‘å¹³å°ä¸»è¦æœ‰ä¸¤éƒ¨åˆ†: riscv32-unknown-elf-gccå¹³å°ç¼–è¯‘ç”Ÿæˆ\(RISCV\)å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œqemu-riscv32å¹³å°è¿è¡ŒRISCVå¯æ‰§è¡Œæ–‡ä»¶ã€‚ qemuæ˜¯ä¸€æ¬¾å¾ˆå¼ºå¤§çš„è™šæ‹Ÿæœºï¼Œåˆ†ä¸ºç³»ç»Ÿæ¨¡å¼å’Œç”¨æˆ·æ¨¡å¼ï¼Œç”¨æˆ·æ¨¡å¼è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè€Œç³»ç»Ÿæ¨¡å¼æ¨¡æ‹Ÿç‰¹å®šæŒ‡ä»¤é›†ä»Žè€Œè¿è¡Œæ“ä½œç³»ç»Ÿé•œåƒæ–‡ä»¶ã€‚]]></content>
      <categories>
        <category>Assembly</category>
      </categories>
      <tags>
        <tag>RISCV</tag>
        <tag>Compiler</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»Žsyscallçš„è§’åº¦ç†è§£æ“ä½œç³»ç»Ÿ]]></title>
    <url>%2F2019%2F06%2F25%2F%E4%BB%8Esyscall%E7%9A%84%E8%A7%92%E5%BA%A6%E7%90%86%E8%A7%A3%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%2F</url>
    <content type="text"><![CDATA[Abstract æ“ä½œç³»ç»ŸæŽ§åˆ¶ç¡¬ä»¶èµ„æºå¹¶å®Œæˆåº•å±‚æŠ½è±¡ã€‚ UNIXå’ŒCçš„å‘å±•ä¸€è„‰ç›¸æ‰¿ã€‚20ä¸–çºª80å¹´ä»£ä»¥æ¥ï¼Œé’ˆå¯¹UNIXçš„å„ç§æ ‡å‡†åŒ–å·¥ä½œå¯¹å…¶å®žçŽ°æä¾›äº†å…·ä½“çš„é™åˆ¶ä»¥æ­¤æ¥å®Œå–„ç³»ç»Ÿä¸åŒå®žçŽ°ä¹‹é—´çš„å¯ç§»æ¤æ€§â€”â€”ISO-Cï¼ŒIEEE-POSIXä»¥åŠSingle UNIX Specificationç­‰ç­‰ã€‚ è¿™äº›æ ‡å‡†æœ¬è´¨ä¸Šæ˜¯åº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»ŸæŽ¥å£çš„å­é›†ã€‚ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„å…·ä½“å®žçŽ°é™¤äº†å†…æ ¸ä¹‹å¤–ï¼Œæœ€é‡è¦çš„å°±æ˜¯å¯¹APIçš„å°è£…ã€‚UNIXä¸€èˆ¬é€šè¿‡ç³»ç»Ÿè°ƒç”¨å’Œè¿è¡Œåº“çš„æ–¹å¼æ¥å®Œæˆåº”ç”¨ç¨‹åºæŽ¥å£ï¼Œæ¯”å¦‚GNUä¸ºLinuxå¼€å‘çš„Gblicå°±æ”¯æŒISO-Cå’ŒIEEE-POSIXç­‰æ ¸å¿ƒæ ‡å‡†ã€‚ ä¸ªäººè§‰å¾—ä»Žç³»ç»Ÿç¼–ç¨‹å’Œå†…å­˜çš„è§’åº¦åŽ»ç†è§£æ–‡ä»¶ç³»ç»Ÿå’Œè¿›ç¨‹/çº¿ç¨‹ç­‰OSæ ¸å¿ƒæ¦‚å¿µä¼šæ¯”è¾ƒæœ‰è¶£ã€‚ æ–‡ä»¶ç³»ç»Ÿ æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ç§æŒä¹…æ€§å­˜å‚¨çš„ç³»ç»ŸæŠ½è±¡ã€‚å¹¶æ¶‰åŠåˆ°ç£ç›˜ç©ºé—´å’Œå†…å­˜ç©ºé—´çš„IOæ“ä½œï¼Œæ¯”è¾ƒéš¾ç†è§£ï¼š æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼Œæ‰“å¼€æ–‡ä»¶è¡¨ï¼ŒièŠ‚ç‚¹æ˜¯æ–‡ä»¶å­˜å‚¨çš„æœ¬è´¨ï¼Œè€Œæ–‡ä»¶é•¿åº¦ï¼Œæ–‡ä»¶åç§»é‡ï¼Œæ–‡ä»¶æ‰€å ç£ç›˜ç©ºé—´ï¼Œæ–‡ä»¶ç”¨æˆ·æƒé™æ˜¯æ–‡ä»¶çš„é‡è¦å±žæ€§ã€‚å¯ä»¥ä»Ždupï¼Œlseekï¼Œstat/chmodç­‰å‡½æ•°ç†è§£ ç†è§£å†…æ ¸èŽ·å–æ–‡ä»¶çš„è¿‡ç¨‹æ˜¯æœ€æ ¸å¿ƒçš„ã€‚è¿™æ¶‰åŠåˆ°å†…æ ¸é¡µé«˜é€Ÿç¼“å­˜ï¼Œç”¨æˆ·åŒºé—´ç¼“å†²åŒºï¼Œæ ‡å‡†IOç¼“å†²åŒºç­‰æ ¸å¿ƒæ¦‚å¿µã€‚å¯ä»¥ä»Žread/writeï¼Œfgets/fputsï¼Œsync/flushå‡½æ•°ç†è§£ ä»Žç”¨æˆ·æ—¶é—´å’ŒCPUæ—¶é—´ç†è§£æ ‡å‡†IOå‡½æ•°å’Œread/writeç­‰ç³»ç»Ÿè°ƒç”¨ã€‚ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€è¦å¤§äºŽå‡½æ•°è°ƒç”¨ã€‚è€Œè¿™ä¸€åˆ‡éƒ½å–å†³äºŽåŒæ–¹ç¼“å†²åŒºçš„é€‰æ‹© è¿›ç¨‹ è¿›ç¨‹æ˜¯ç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºåœ¨æ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡åŠ¨æ€æ‰§è¡Œè¿‡ç¨‹ã€‚ å‡†å¤‡ å°±ç»ª é˜»å¡ž æ‰§è¡Œ ç»“æŸ å†…æ ¸ä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤ä¸€ä¸ªè¿›ç¨‹æŽ§åˆ¶å—ï¼Œä»Žfork/exit/waitç­‰å‡½æ•°å¯ä»¥ç†è§£è¿™äº›çŠ¶æ€ã€‚å¦å¤–fork/execåŒºåˆ†äº†çˆ¶å­è¿›ç¨‹åœ¨åˆ›å»ºå‰åŽæ‰€å…±äº«çš„èµ„æºï¼š ä»£ç æ®µï¼ˆä½†æ˜¯å­è¿›ç¨‹èŽ·å¾—çˆ¶è¿›ç¨‹æ•°æ®ç©ºé—´ï¼Œå †æ ˆç©ºé—´çš„å‰¯æœ¬ï¼‰ æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ å®žé™…IDï¼Œæœ‰æ•ˆIDï¼Œè®¾ç½®ID å­˜å‚¨æ˜ åƒ çº¿ç¨‹ æ¯ä¸ªçº¿ç¨‹éƒ½åŒ…å«åˆè¡¨ç¤ºæ‰§è¡ŒçŽ¯å¢ƒæ‰€å¿…éœ€çš„ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬è¿›ç¨‹ä¸­è¡¨ç¤ºçº¿ç¨‹çš„çº¿ç¨‹IDï¼Œä¸€ç»„å¯„å­˜å™¨å€¼ï¼Œæ ˆï¼Œè°ƒåº¦ä¼˜å…ˆçº§å’Œç­–ç•¥ï¼Œä¿¡å·å±è”½å­—ï¼Œerrnoå˜é‡ä»¥åŠçº¿ç¨‹ç§æœ‰æ•°æ®ã€‚ä¸€ä¸ªè¿›ç¨‹çš„çš„æ‰€æœ‰ä¿¡æ¯å¯¹è¯¥è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯å…±äº«çš„ï¼ŒåŒ…æ‹¬å¯æ‰§è¡Œç¨‹åºçš„ä»£ç ï¼Œç¨‹åºçš„å…¨å±€å†…å­˜å’Œå †å†…å­˜ï¼Œæ ˆä»¥åŠæ–‡ä»¶æè¿°ç¬¦ã€‚ è¿›ç¨‹æ˜¯èµ„æºåˆ†é…å•ä½ çº¿ç¨‹æ˜¯CPUè°ƒåº¦å•ä½ å¤šçº¿ç¨‹åˆ‡æ¢å› ä¸ºç›¸åŒé‚£é‚£ä¸ªçš„åœ°å€ç©ºé—´â€”â€”é¡µè¡¨ï¼Œå› æ­¤åˆ‡æ¢æ›´å¿«ã€‚]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>OS</tag>
        <tag>UNIX</tag>
        <tag>Syscall</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mit6.828(Fall 2018) Lab2]]></title>
    <url>%2F2018%2F11%2F22%2FMit6-828-Fall-2018-Lab2%2F</url>
    <content type="text"><![CDATA[Lab2 Before Lab Lab2çš„ä¸»è¦å†…å®¹:Physical Page Management,Virtual Memroy,Kernel Address Space;ä»£ç å®žçŽ°JOSä¸­çš„å†…å­˜åˆ†é¡µç®¡ç†åŠŸèƒ½ï¼Œæœ‰é¡µé¢ç®¡ç†å’Œé¡µè¡¨ç®¡ç†ä¸¤éƒ¨åˆ†ã€‚å’Œç†è®ºç›¸æ¯”ï¼Œä»£ç å®žçŽ°éœ€è¦è€ƒè™‘çš„ç»†èŠ‚çœŸæ˜¯å¤ªå¤šã€‚å®žéªŒæœ€ç»ˆçš„ç›®çš„æ˜¯é€šè¿‡å‡ ä¸ªæ£€æµ‹å‡½æ•°: Lab1å®Œæˆæ—¶æ•´ä¸ªJOSå†…å­˜å¸ƒå±€å¦‚ä¸‹å›¾: åˆ‡æ¢åˆå¹¶Gitåˆ†æ”¯çš„æ—¶å€™å¯èƒ½ä¼šå‡ºçŽ°å†²çªï¼Œéœ€è¦æ‰‹åŠ¨æ³¨é‡ŠæŽ‰Lab1ä¸­çš„ä¸€äº›æµ‹è¯•ä»£ç æ¥è§£å†³ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ memlayout.hå’Œpmap.h æŽŒæ¡è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„å‡½æ•°æ˜¯å®ŒæˆLab2å¿…ä¸å¯å°‘çš„æ¡ä»¶ï¼Œåœ¨æ­¤è¿›è¡Œæ€»ç»“ã€‚ #### pmap.h Lab2ä¸­éœ€è¦é‡ç‚¹å…³æ³¨çš„å¯¹è±¡æœ‰ä¸‰ä¸ª:ç‰©ç†å†…å­˜ï¼Œè™šæ‹Ÿå†…å­˜ï¼Œç©ºé—²é“¾è¡¨struct PageInfoã€‚è¯¥å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°å®žçŽ°äº†ä¸‰è€…ä¹‹é—´çš„ç›¸äº’è½¬åŒ–ã€‚ å¦å¤–è¿˜æœ‰å‡ ä¸ªå¤–éƒ¨å˜é‡ä¹Ÿéœ€è¦é‡ç‚¹å…³æ³¨ä¸€ä¸‹: * bootstack å†…æ ¸æ ˆ * pages æ‰€æœ‰ç‰©ç†å†…å­˜æŒ‰ç…§4KBåˆ’åˆ†çš„å¯¹åº”æ˜ å°„æ•°ç»„ * npage æ•°ç»„å…ƒç´ ä¸ªæ•° * kern_pgdir é¡µç›®å½• æ³¨æ„pagesä¸æ˜¯ç©ºé—²é“¾è¡¨ï¼Œä»…ä»…åªæ˜¯ä¸€ä¸ªæ•°ç»„è€Œå·²ã€‚è€Œpagesæ•°ç»„ç´¢å¼•å°±æ˜¯æ‰€æœ‰é¡µå¼ç‰©ç†å†…å­˜çš„ç´¢å¼•ã€‚æ‰€ä»¥struct PageInfo *ppå’Œç‰©ç†å†…å­˜å…³ç³»å¾ˆç´§å¯†ï¼š**(pp-pages)*4KBå°±æ˜¯è¯¥æ•°ç»„å…ƒç´ å¯¹åº”çš„ç‰©ç†é¡µé¢pageçš„ç‰©ç†åœ°å€**ï¼Œè¿™ä¹Ÿæ˜¯page2paå‡½æ•°çš„åŽŸåž‹ã€‚ memlayout.h ä»‹ç»äº†JOSè™šæ‹Ÿå†…å­˜çš„è¯¦ç»†å¸ƒå±€ï¼Œå®šä¹‰äº†æ‰€æœ‰éœ€è¦ä½¿ç”¨çš„å®ã€‚åœ¨Lab2ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆçš„æ˜¯å†…æ ¸éƒ¨åˆ†è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†çš„æ˜ å°„ã€‚æ‰€ä»¥é‡ç‚¹å…³æ³¨çš„æ˜¯UTOPä¹‹ä¸Šçš„å¸ƒå±€.å½“ç„¶éœ€è¦æ³¨æ„çš„ç»†èŠ‚å°±å¾ˆå¤šäº†ï¼Œæ¯”å¦‚å¤§å°ï¼Œæƒé™ï¼Œæ¯ä¸€éƒ¨åˆ†å†…å­˜çš„ä½œç”¨ç­‰ã€‚ ä¸Šå›¾åªæ˜¯ä¸€ä¸ªç®€åŒ–å›¾ï¼Œç»“åˆæºç çœ‹ä¼šå¥½å¾ˆå¤šï¼Œæ¯”å¦‚ä¸€äº›å’Œå¤§å°æœ‰å…³çš„å®å®šä¹‰: 1234#define PGSIZE 4096 // bytes mapped by a page#define KSTKSIZE (8*PGSIZE) // size of a kernel stack#define PTSIZE (PGSIZE*NPTENTRIES) // bytes mapped by a page directory entry#define NPTENTRIES 1024 // page table entries per page table å…¶ä¸­é˜´å½±éƒ¨åˆ†æŒ‡çš„æ˜¯page_init()å‡½æ•°ä¹‹å‰å·²ç»åˆå§‹åŒ–å¥½çš„ã€‚è¿™æ˜¯å› ä¸ºåœ¨page_init()å‡½æ•°ä¹‹å‰åˆ†é¡µæœºåˆ¶è¿˜æ²¡æœ‰å»ºç«‹å¥½ï¼Œæ‰€ä»¥åªèƒ½ç”¨å­—èŠ‚åˆ†é…çš„æ–¹æ³•åˆ†é…ç‰©ç†å†…å­˜ã€‚è¿™äº›é˜´å½±éƒ¨åˆ†çš„ç‰©ç†å†…å­˜éƒ½æ˜¯boot_alloc(uing32_t n)å‡½æ•°åˆ†é…çš„ï¼›è€Œpage_init()å‡½æ•°ä¹‹åŽï¼Œæ‰€æœ‰çš„ç‰©ç†å†…å­˜åˆ†é…éƒ½æ˜¯ä»¥é¡µPageä¸ºå•ä½ï¼Œæ‰€ä»¥å­—èŠ‚åˆ†é…å‡½æ•°boot_alloc()ä¹Ÿè¢«ç¦ç”¨äº†ã€‚ æ€»ç»“ æˆ‘è§‰å¾—æ•´ä¸ªLab2å°±æ˜¯åœ¨å®žçŽ°ä¸¤ç§æ˜ å°„ï¼šç‰©ç†å†…å­˜åˆ°ç©ºé—²é“¾è¡¨çš„æ˜ å°„å’Œè™šæ‹Ÿå†…å­˜åˆ°ç‰©ç†å†…å­˜çš„æ˜ å°„ã€‚è€Œä¸Šè¿°çš„ä¸¤ä¸ªå¤´æ–‡ä»¶åŸºæœ¬è®²æ¸…æ¥šäº†æ˜ å°„éœ€è¦å®žçŽ°çš„æ­¥éª¤å’ŒåŽŸç†ï¼Œåº”è¯¥åå¤é˜…è¯»ã€‚åˆæ­¤ä¹‹å¤–è¿˜åº”è¯¥å¯¹Cè¯­è¨€çš„å¼ºè½¬ï¼ŒæŒ‡é’ˆï¼Œä½è¿ç®—æœ‰ä¸€ä¸ªå¾ˆæ·±çš„äº†è§£ï¼Œæœ€å¥½å…ˆçœ‹ä¸€ä¸‹TCPLã€‚ Physical Page Management ç†è®ºè¯¾å¾ˆå¤§çš„ä¸€éƒ¨åˆ†ç¼ºå¤±å°±æ˜¯æ²¡æœ‰å¯¹ç‰©ç†å†…å­˜å¸ƒå±€è¿›è¡Œè®²è§£ã€‚è€Œæ²¡æœ‰ç‰©ç†å†…å­˜çš„åŸºç¡€ï¼Œæ˜ å°„ï¼ˆMappingï¼‰æ ¹æœ¬æ— ä»Žè°ˆèµ·ã€‚é¡µé¢ç®¡ç†åˆ†æžå¦‚ä¸‹: ä»Žä»£ç è§’åº¦çœ‹ï¼ŒLab2æŽ¥ä¸ŠLab1ä¸­kern/entry.Sè·³è½¬åˆ°kern/init.cä¸­çš„i386_init()å¼€å§‹æ‰§è¡Œã€‚å¯ä»¥å‘çŽ°mem_init()å‡½æ•°ï¼Œæ•´ä¸ªLab2å°±æ˜¯å®Œå–„è¿™ä¸ªå†…å­˜å‡½æ•°çš„è¿‡ç¨‹ã€‚è€Œç¬¬ä¸€éƒ¨åˆ†ç‰©ç†å†…å­˜å°±æ˜¯å®Œæˆå°†ç‰©ç†å†…å­˜æ˜ å°„åˆ°ç©ºé—²é“¾è¡¨ä¸Šã€‚ PartOneéœ€è¦å®Œæˆç‰©ç†å†…å­˜çš„ç®¡ç†ï¼Œå¹¶å®žçŽ°ç‰©ç†å†…å­˜çš„å¸ƒå±€ã€‚è¿™é‡Œçš„å¸ƒå±€æŒ‡çš„æ˜¯å¯¹ç©ºé—²é“¾è¡¨çš„ç®¡ç†ã€‚æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦åˆ›å»ºç©ºé—²é“¾è¡¨ï¼Œç„¶åŽç”¨ç©ºé—²é“¾è¡¨å¯¹è¿™ä¸€æ•´å—ç‰©ç†å†…å­˜è¿›è¡Œç®¡ç†ï¼Œå½“ç„¶ç®¡ç†çš„å•ä½æ˜¯Pageï¼ˆ4Kï¼‰ã€‚ åŸºæœ¬ä¸Šéœ€è¦å®žçŽ°çš„ä»£ç éƒ½åœ¨pmap.cä¸­ã€‚æˆ‘ä»¬ç”¨Taglistç»Ÿç­¹ä¸€ä¸‹è¯¥æ–‡ä»¶ä¸­æ‰€æœ‰çš„å‡½æ•°å’Œå®å®šä¹‰: boot_alloc å½¼æ—¶mem_init()å‡½æ•°ä¸­è¿˜åªæœ‰ä¸€ä¸ªå‡½æ•°â€”â€”â€”â€”i386_detect_memory()ã€‚ç”¨æ¥æ£€æµ‹ç‰©ç†å†…å­˜çš„ç¡¬ä»¶çŠ¶æ€åŠå…¶å‚æ•°ï¼Œå…¶ä¸­æœ‰å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„å˜é‡: 1234npages: æœªåˆ†é…npages_basemem: 160kern_pgdir: æœªåˆ†é…basemem: 640KB å…¶ä¸­basemem=640Kæ˜¯å› ä¸ºåœ¨inc/memlayout.hä¸­å®šä¹‰è¿‡ä¸€ä¸ªå®:#define IOPHYSMEM 0xA0000ã€‚åœ¨Lab1çš„å†…å­˜å¸ƒå±€ä¸­æœ‰è¯¦ç»†çš„åˆ†å¸ƒï¼Œåœ¨è¿™ä¸ªå®å®šä¹‰çš„åœ°å€å¾€ä¸Šæ˜¯ å®žæ¨¡å¼ä¸‹IDTå’Œç¬¬ä¸€éƒ¨åˆ†bootsectorã€‚æ‰€ä»¥å°†å®å®šä¹‰ä»¥ä¸‹åˆ°0x00000000çš„å†…å­˜ç§°ä¸ºbase_memã€‚è€Œè¿™éƒ¨åˆ†éœ€è¦è¢«æ˜ å°„åˆ°ç©ºé—²é“¾è¡¨ä¸­ï¼Œæ‰€ä»¥æŒ‰ç…§é¡µå¼å•ä½å¯ä»¥æ˜ å°„640K/4K=160ä¸ªpagesã€‚ æŽ¥ä¸‹æ¥å°±æ˜¯å®žçŽ°ä»£ç ã€‚å› ä¸ºä»£ç å¤ªå¤šä¸æ‰“ç®—è´´å‡ºæ¥ï¼Œä¸»è¦æ˜¯åšLabçš„æ€è·¯å¹¶åˆ†äº«ä¸€äº›å®Œå–„å†…å­˜å¸ƒå±€è¿‡ç¨‹ä¸­ç”»çš„è‰ç¨¿ã€‚ ä»Žmem_init()çš„è¿›åº¦æ¥çœ‹ï¼Œé¦–å…ˆéœ€è¦å®žçŽ°boot_alloc()å‡½æ•°ï¼Œç„¶åŽç”¨è¯¥å‡½æ•°ç›´æŽ¥åˆ†é…ç‰©ç†å†…å­˜ç»™kern_pgdirå’Œpagesä¸¤ä¸ªæ•°æ®ç»“æž„ã€‚è€Œboot_allocä¸­å€¼å¾—ä¸€æå°±æ˜¯extern char end[]å’Œå¯¹é½å‡½æ•°ROUNDUP(a, n)ã€‚åœ¨Lab1å®Œæˆä¹‹åŽï¼Œæˆ‘ä»¬å°†å†…æ ¸æ”¾åˆ°0x10000000è¿™ä¸ªä½ç½®ç›´åˆ°endç»“æŸï¼Œæ‰€ä»¥endæ˜¯é“¾æŽ¥å™¨åšé“¾æŽ¥æ—¶å†…æ ¸åŠ è½½ç»“æŸçš„åœ°å€ã€‚è€ŒROUNDUP(a, n)çš„åŠŸèƒ½æ˜¯å‘ä¸Šå¯¹é½ã€‚å› ä¸ºæˆ‘ä»¬çš„æ“ä½œéƒ½æ˜¯4KBå¯¹é½çš„ï¼Œæ‰€ä»¥éœ€è¦åœ¨endåŽé¢è¿›è¡Œå¯¹é½æ“ä½œã€‚è¯¦ç»†è§Lab1çš„å†…å­˜å¸ƒå±€ã€‚æœ€åŽå‡½æ•°è¿”å›žçš„æ˜¯å·²åˆ†é…å†…å­˜çš„è™šæ‹Ÿé¦–åœ°å€ã€‚ æŒ‡å¯¼ä¹¦ä¸­æŽ¨èä½¿ç”¨æ–­è¨€assertè¿›è¡Œè°ƒè¯•çš„æ–¹æ³•ã€‚ä¸è¿‡æˆ‘ä¸€èˆ¬ä½¿ç”¨è¾“å‡ºè°ƒè¯•cprintf+returnã€‚å½“åˆ†é…å¥½kern_pgdirå’Œpagesä¹‹åŽï¼Œæˆ‘ä»¬ä½¿ç”¨è¾“å‡ºè°ƒè¯•çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªæ•°æ®ç»“æž„çš„è™šæ‹Ÿåœ°å€: 1234567void boot_alloc() &#123; cprintf(&quot;before allocating nextfree is %x\n&quot;, nextfree); /* address allocator */ cprintf(&quot;after allocating nextfree is %x\n&quot;, nextfree);&#125; çœ‹ä¸€ä¸‹è¾“å‡ºç»“æžœ: ç„¶åŽå°±æ˜¯å®žçŽ°page_init()å‡½æ•°ã€‚æ­¤æ—¶æˆ‘ä»¬å·²ç»å»ºç«‹äº†ä¸€ä¸ªå’Œå…¨éƒ¨ç‰©ç†å†…å­˜ç›¸å¯¹åº”çš„æ•°ç»„pagesã€‚è¿™ä¸ºæŽ¥ä¸‹æ¥ç©ºé—²é“¾è¡¨çš„å®žçŽ°å¥ å®šäº†åŸºç¡€:page_init()å‡½æ•°å°±æ˜¯æŒ‰ç…§Hintsä¸­æç¤ºçš„ç‰©ç†å†…å­˜çš„åŸºæœ¬å¸ƒå±€ï¼Œæ‰¾åˆ°é‚£äº›ç©ºé—²çš„ç‰©ç†å†…å­˜å¹¶å°†å…¶å¯¹åº”çš„pagesæ•°ç»„å…ƒç´ é“¾æŽ¥èµ·æ¥å½¢æˆä¸€ä¸ªé“¾è¡¨ã€‚å¯èƒ½ä¸å¥½ç†è§£ï¼Œç›´æŽ¥ä¸Šå›¾: è¿™ä¸ªåŠŸèƒ½æ˜¯ç”±ä¸‹é¢ç®€å•çš„å‡ å¥Cè¯­è¨€å®žçŽ°çš„ï¼š 1234567Part of the code: for (i = 1; i &lt; npages_basemem; i++) &#123; pages[i].pp_ref = 0; pages[i].pp_link = page_free_list; page_free_list = &amp;pages[i]; &#125; page_initå‡½æ•°å®žçŽ°äº†ç©ºé—²é“¾è¡¨ã€‚è‡³æ­¤å†…å­˜çš„å¸ƒå±€å·²ç»å¾ˆæ¸…æ¥šäº†ï¼š page_alloc page_allocå‡½æ•°å®žçŽ°ç‰©ç†å†…å­˜çš„é¡µå¼åˆ†é…â€”â€”â€”â€”åˆ†é…ä¸€é¡µç©ºé—²çš„ç‰©ç†å†…å­˜ã€‚æ ¹æ®ä¸Šé¢çš„æ€è·¯:pagesæ•°ç»„å°±æ˜¯å…¨éƒ¨ç‰©ç†å†…å­˜çš„æ˜ å°„ï¼Œè€Œpage_free_listæ˜¯ç©ºé—²ç‰©ç†å†…å­˜çš„æ˜ å°„æ‰€ä»¥æ˜¯éƒ¨åˆ†pageså…ƒç´ é“¾æˆçš„ã€‚æ‰€ä»¥æˆ‘ä»¬å®žé™…ä¸Šå¯ä»¥é€šè¿‡page_free_listæŒ‡é’ˆæ¥ç¡®å®šå…·ä½“çš„ç‰©ç†åœ°å€:**(page_free_list-pages)*4K**ã€‚ å®žçŽ°å¾ˆç®€å•ï¼Œå½“ä¸­éœ€è¦æ³¨æ„çš„ç»†èŠ‚åˆå§‹åŒ–å‡½æ•°memset(void *v, int c, size_t n)ä¸­éœ€è¦çš„åœ°å€æ˜¯è™šæ‹Ÿåœ°å€ã€‚è¿™é‡Œå…ˆå‚è€ƒä¸€ä¸‹kern_pgdirçš„å®žçŽ°å’Œåˆå§‹åŒ–ã€‚ æ‰€ä»¥åœ¨å®žçŽ°ä¸­éœ€è¦å°†page_free_listæŒ‡å‘çš„pageså…ƒç´ æ˜ å°„åˆ°å…·ä½“çš„ç‰©ç†åœ°å€page2pa, ç„¶åŽå°†ç‰©ç†åœ°å€è½¬åŒ–ä¸ºè™šæ‹Ÿåœ°å€PADDRå¹¶è¿”å›žã€‚ ç»†èŠ‚ è‡³æ­¤ç‰©ç†æ˜ å°„åˆ°ç©ºé—²é“¾è¡¨çš„è¿‡ç¨‹å·²ç»å®žçŽ°ã€‚boot_allocå’Œpage_allocæœ€ç»ˆè¿”å›žçš„éƒ½æ˜¯è™šæ‹Ÿåœ°å€ã€‚è¿˜æœ‰ä¸€äº›å®å®šä¹‰å’Œå‡½æ•°æ¯”å¦‚PGNUM(la)ï¼Œmemset(void *v, int c, size_t n)çš„å‚æ•°ä¹Ÿæ˜¯è™šæ‹Ÿåœ°å€ã€‚åœ¨Lab2ä¸­ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜å°±æ˜¯åŒºåˆ†ç‰©ç†åœ°å€è¿˜æ˜¯è™šæ‹Ÿåœ°å€ã€‚ å› ä¸ºmmuçš„ç¼˜æ•…ï¼Œè®¿é—®å†…å­˜çš„æ—¶å€™ä¼šè¿›è¡Œä¸€æ¬¡çº¿æ€§åœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢ã€‚æ‰€ä¸èƒ½ç›´æŽ¥ä½¿ç”¨ç‰©ç†åœ°å€ã€‚æˆ‘ä»¬ç´¢æ€§æ‰€æœ‰è‡ªå®šä¹‰ç”¨åˆ°åœ°å€çš„åœ°æ–¹éƒ½ä½¿ç”¨è™šæ‹Ÿåœ°å€ï¼Œå¦‚æžœéœ€è¦ç‰©ç†åœ°å€å†ä½¿ç”¨PADDR(la)è½¬åŒ–ã€‚ Virtual Memory Question é¦–å…ˆåŒºåˆ†é€»è¾‘åœ°å€ï¼Œçº¿æ€§åœ°å€å’Œç‰©ç†åœ°å€çš„æ¦‚å¿µã€‚Lab2å±è”½äº†é€»è¾‘åœ°å€åˆ°çº¿æ€§åœ°å€çš„è½¬åŒ–ï¼Œä¹Ÿå°±æ˜¯GDTæ®µå¼å­˜å‚¨ç®¡ç†ã€‚ç›´æŽ¥ä»Žçº¿æ€§åœ°å€å¼€å§‹ã€‚ æŒ‡å¯¼ä¹¦ä¸­é‡ç‚¹è®²è§£äº†è™šæ‹Ÿå†…å­˜ï¼Œç‰©ç†å†…å­˜å’ŒæŒ‡é’ˆè¿™å‡ ä¸ªæ¦‚å¿µã€‚è§‰å¾—æœ‰ä¸€äº›æ„æ€ï¼Œå°±æŠŠç¿»è¯‘è´´ä¸Šäº†: å¦å¤–ï¼Œåœ¨ä¹‹åŽçš„Labä¸­ä¼šé‡åˆ°å¾ˆå¤šä¸€ä¸ªç‰©ç†é¡µé¢åŒæ—¶è¢«æ˜ å°„åˆ°å¥½å‡ å—è™šæ‹Ÿå†…å­˜ä¸­çš„æƒ…å†µã€‚JOSä½¿ç”¨struct PageInfo-&gt;pp_refæ¥ç®¡ç†é¡µç›®å½•å¯¹é¡µè¡¨é¡µçš„å¼•ç”¨çš„æ•°é‡ã€‚è§ä¸‹é¢ä»£ç : 1234mystery_t x;char* value = return_a_pointer();*value = 10;x = (mystery_t) value; æ ¹æ®ä¸Šé¢çš„åˆ†æžï¼ŒæŒ‡é’ˆvalueæ˜¯è™šæ‹Ÿåœ°å€ã€‚è€Œå¯¹valueè¿›è¡Œå¼ºè½¬å¹¶èµ‹å€¼çš„åªèƒ½æ˜¯è™šæ‹Ÿåœ°å€äº†ã€‚ pgdir_walk åœ¨å®žçŽ°ä¸‹é¢çš„ä»£ç ä¹‹å‰ï¼Œé»˜è®¤ç†Ÿæ‚‰inc/mmu.hä¸­çš„æ‰€æœ‰å†…å®¹ã€‚ è¯¥å‡½æ•°çš„ä½œç”¨å¾ˆå…³é”®ã€‚ç»™å®šä¸€ä¸ªè™šæ‹Ÿåœ°å€ï¼Œpgdir_walkå‡½æ•°è¿”å›žä¸€ä¸ªæŒ‡å‘è¯¥åœ°å€å¯¹åº”é¡µè¡¨é¡¹çš„æŒ‡é’ˆã€‚è€Œè¿™ä¸ªå‡½æ•°ä¸»è¦æ˜¯ä¸ºå®Œæˆä¸€éƒ¨åˆ†è™šæ‹Ÿåœ°å€åˆ°ä¸€éƒ¨åˆ†ç‰©ç†åœ°å€çš„æ˜ å°„å‡½æ•°boot_map_regionåšå‡†å¤‡çš„ã€‚æ‰€ä»¥åªéœ€è¦å®šä½åˆ°é¡µè¡¨é¡¹å°±å¯ä»¥ï¼Œè€Œä¸éœ€è¦åŠ ä¸ŠåŽ12ä½åç§»é‡ã€‚JOSçš„é¡µç›®å½•ï¼ˆè¡¨ï¼‰é¡¹PDE&amp;PTEçš„æ ¼å¼è§ä¸‹: è¯¥å‡½æ•°çš„åˆ†æžå¦‚ä¸‹: 12345678910111213141516171819pte_t *pgdir_walk(pde_t *pgdir, const void *va, int create)&#123; uintptr_t ptIndex = PTX(va); //PTXå–å‡ºé¡µè¡¨é¡¹çš„åç§»é‡ struct PageInfo * newAlloc; //ç©ºé—²é“¾è¡¨æŒ‡é’ˆ if(!(pgdir[PDX(va)] &amp; PTE_P)) &#123; //&amp;ä½è¿ç®—æ˜¯å–å‡ºPTE_Pè¿™ä¸€ä½ï¼Œçœ‹é¡µè¡¨æ˜¯å¦å­˜åœ¨ if(create) &#123; if((newAlloc = page_alloc(1)) == NULL) return NULL; newAlloc-&gt;pp_ref++; // |ä½è¿ç®—æ˜¯åˆå¹¶ä½ï¼› ã€20ã€‘+ã€12ã€‘åˆ†åˆ«ä¸ºé¡µç›®å½•é¡¹ï¼ˆæ³¨æ„ä¸æ˜¯é¡µè¡¨é¡¹ï¼‰20ä½çš„åœ°å€ï¼ŒåŽ12ä½çš„æ ‡å¿—ä½ pgdir[PDX(va)] = page2pa(newAlloc) | PTE_P | PTE_U | PTE_W; &#125;else &#123; return NULL; &#125; &#125; pte_t * pdPtr = KADDR(PTE_ADDR(pgdir[PDX(va)])); //å–å‡ºé¡µç›®å½•é¡¹çš„å‰20ä½ return pdPtr + ptIndex; //å…·ä½“çš„æŒ‡å‘å…·ä½“é¡µè¡¨é¡¹çš„æŒ‡é’ˆ&#125; å…¶ä¸­å¯¹é¡µè¡¨é¡¹è¿›è¡Œé‡æ–°æ˜ å°„æ˜¯å…³é”®çš„æ“ä½œï¼Œä¾¿äºŽç†è§£è¿˜å¯ä»¥å…ˆå–å‡ºå‰20ä½åœ°å€ç„¶åŽå†åŠ ä¸Šæ ‡å¿—ä½: 12345678910111213... if(create) &#123; if((newAlloc = page_alloc(1)) == NULL) return NULL; newAlloc-&gt;pp_ref++; pgdir[PDX(va)] = page2pa(newAlloc); test = KADDR(pgdir[PDX(va)]); //å…ˆå–å‡º20ä½ pgdir[PDX(va)] = page2pa(newAlloc) | PTE_P | PTE_U | PTE_W; return test + ptIndex;//ç›´æŽ¥è¿”å›ž &#125;else &#123; return NULL; &#125;... åˆ†é¡µæœºåˆ¶åŽŸç†è§ä¸‹å›¾ï¼Œè€Œpgdir_walkå‡½æ•°å®Œæˆçš„æ˜¯å‰ä¸¤éƒ¨åˆ†çš„ï¼Œæœ€åŽçš„offsetå¹¶ä¸åœ¨å…¶ä¸­: boot_map_region æŽ¥ä¸Špgdir_walkå‡½æ•°è¿”å›žè™šæ‹Ÿåœ°å€ç›¸å¯¹åº”çš„é¡µè¡¨é¡¹æŒ‡é’ˆã€‚æ³¨æ„è¯¥å‡½æ•°çš„å‚æ•°ä¸­æœ‰ä¸€é¡¹æ˜¯æƒé™permæ˜¯å’ŒPTE_Pä¸€èµ·çš„ï¼Œä¸€æ—¦æ˜ å°„å°±å­˜åœ¨äº†ã€‚å› ä¸ºæ˜¯é¡µè¡¨é¡¹æ‰€ä»¥æ˜¯4KBå¯¹é½çš„ï¼ˆå› ä¸ºå±è”½æŽ‰åŽ12ä½ï¼‰ã€‚æˆ‘ä»¬ä½¿ç”¨é¡µè¡¨é¡¹å®Œæˆè™šåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„: 1234567891011static voidboot_map_region(pde_t *pgdir, uintptr_t va, size_t size, physaddr_t pa, int perm)&#123; int i; for(i=0; i&lt;size/PGSIZE; i++, va+=PGSIZE, pa+=PGSIZE) &#123; //4K å¯¹é½ pte_t *pte = pgdir_walk(pgdir,(void*)va, 1); if(pte == NULL) panic(&quot;boot_map_region panic : out of memory!\n&quot;); *pte = pa | perm | PTE_P; //å®Œæˆæ˜ å°„ï¼Œå¹¶è®¾ç½®æ ‡å¿—ä½æ¥ç¡®å®šé¡µè¡¨æƒé™ &#125;&#125; åŽé¢å‡ ä¸ªå‡½æ•°å®žçŽ°éƒ½å¾ˆç®€å•ï¼Œä¸å†èµ˜è¿°ã€‚ è‡³æ­¤ï¼Œæˆ‘ä»¬å®žçŽ°äº†å†…å­˜é¡µå¼ç®¡ç†çš„é¡µè¡¨ç®¡ç†éƒ¨åˆ†ã€‚ Kernel Address Space Mapping å…³äºŽå­¦ä¹ JOSå¯¹è™šæ‹Ÿå†…å­˜ç©ºé—´çš„æ•´ä½“å¸ƒå±€ã€‚JOSæ˜¯32ä½çš„æ“ä½œç³»ç»Ÿï¼Œä¸€å…±æœ‰4Gçš„è™šæ‹Ÿç©ºé—´ã€‚ä»¥ULIMä¸ºåˆ†ç•Œçº¿ï¼Œç•Œé™ä»¥ä¸‹ä¸ºç”¨æˆ·ç©ºé—´ï¼Œä»¥ä¸Šä¸ºå†…æ ¸ç©ºé—´ã€‚å…¶ä¸­ä»ŽULIMåˆ°KERNBASEéƒ¨åˆ†ä½œä¸ºå†…æ ¸çš„ç³»ç»Ÿæ ˆå…±4Mç©ºé—´ã€‚å¯¹äºŽå†…å­˜è¯¦ç»†çš„å¸ƒå±€å¯ä»¥ä»Žinc/memlayout.hä¸­çœ‹åˆ°ï¼Œè¿™é‡Œçš„é‡ç‚¹æ˜¯å› ä¸ºå†…æ ¸å’Œç”¨æˆ·ç©ºé—´åŒæ—¶è¢«æ˜ å°„åˆ°ç‰©ç†å†…å­˜ä¸­ï¼Œæ‰€ä»¥éœ€è¦ä¸€ç§æ–¹å¼æ¥é¿å…ä¸¤è€…ä¹‹é—´ç›¸äº’è¯»å†™ã€‚è€Œä¸”JOSå’Œå…¶ä»–çŽ°ä»£æ“ä½œç³»ç»Ÿä¸åŒçš„æ˜¯ï¼Œæ•´ä¸ªOSåªæœ‰ä¸€ä¸ªé¡µç›®å½•kern_pgdirï¼ˆåº”è¯¥æ˜¯æ¯ä¸€ä¸ªè¿›ç¨‹æœ‰ä¸€å¥—å®Œæ•´çš„é¡µè¡¨ç³»ç»Ÿï¼‰ã€‚ æ–¹æ³•æ˜¯æƒé™ä½: å½“ä¸€ä¸ªç¨‹åºè¯•å›¾è®¿é—®ä¸€ä¸ªè™šæ‹Ÿåœ°å€çš„æ•°æ®çš„æ—¶å€™ï¼Œx86ç³»ç»Ÿçš„ä¿æŠ¤æœºåˆ¶è¿è¡Œä¸º: * å…ˆæ£€æŸ¥çŸ­æƒé™ä½DPLï¼Œä¸è¿‡å’Œé¡µå¼åˆ†é…æ— å…³ * å†æ£€æŸ¥é¡µç›®å½•ç›¸åº”è¡¨é¡¹çš„è®¿é—®æƒé™ï¼Œå¦‚æžœä¸è¿‡ä¹Ÿäº§ç”Ÿå¼‚å¸¸ * æœ€åŽæ£€æŸ¥äºŒçº§é¡µè¡¨ç›¸åº”é¡µè¡¨çš„è®¿é—®æƒé™ï¼Œä¸å¤Ÿå°±äº§ç”Ÿå¼‚å¸¸ x86å¯¹æƒé™çš„åŽŸåˆ™æ˜¯ä¸åœ¨é¡µç›®å½•è¿™ä¸€çŽ¯èŠ‚é™åˆ¶å¤ªå¤šï¼Œè®©æœ€ç»ˆçš„è®¿é—®æŽ§åˆ¶åœ¨äºŒçº§é¡µè¡¨è¿™ä¸€çŽ¯èŠ‚ä¸Šåœ¨è®¾ç½®ã€‚å®žé™…ä¸ŠIntelæ‰‹å†Œä¸Šç»™å‡ºäº†ä¸€ä¸ªé¡µç›®å½•åŠ é¡µè¡¨çš„è®¿é—®æŽ§åˆ¶çš„ç»„åˆæŽ§åˆ¶æ•ˆæžœ: å®žçŽ°mem_initå‡½æ•°çš„æœ€åŽä¸€éƒ¨åˆ†å†…å®¹ï¼Œå®žçŽ°JOSçš„è™šæ‹Ÿæ˜ å°„: é¦–å…ˆæˆ‘ä»¬å°†è™šæ‹Ÿåœ°å€ä¸­[UPAGES, sizeof(pages)]éƒ¨åˆ†æ˜ å°„åˆ°ç‰©ç†åœ°å€[pages, sizeof(pages)]ä¸Šã€‚ ç„¶åŽæˆ‘ä»¬å°†è™šæ‹Ÿåœ°å€ä¸­[KSTACKTOP-KSTKSIZE, KSTACKTOP]éƒ¨åˆ†æ˜ å°„åˆ°[bootstack, KSTKSIZE]ä¸Šã€‚ æœ€åŽå°†KERNBASEä»¥ä¸Šçš„è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°æ‰€æœ‰ç‰©ç†åœ°å€ä¸Šã€‚ è¿™é‡Œæ³¨æ„ä¸€ä¸‹ä¸€ä¸ªç»†èŠ‚: 123456void mem_init() &#123; ... // Permissions: kernel R, user R kern_pgdir[PDX(UVPT)] = PADDR(kern_pgdir) | PTE_U | PTE_P; ... &#125; è¿™æ˜¯åœ¨mem_initå‡½æ•°ç”³è¯·kern_pgdirä¹‹åŽå°±å‘ç”Ÿçš„æ˜ å°„ï¼Œè€Œè¿™å¥ä»£ç æœ¬è´¨ä¸Šå°±æ˜¯æ˜ å°„å‡½æ•°boot_map_regionã€‚ç›®çš„å¾ˆç®€å•â€”â€”â€”â€”å®Œæˆkern_pgdirè‡ªèº«åˆ°UVPTçš„æ˜ å°„ã€‚æˆ‘ä»¬ä¸éš¾æ˜Žç™½ï¼Œæ•´ä¸ªJOSåªæœ‰ä¸€ä¸ªé¡µç›®å½•ã€‚LabåŸºæœ¬ç»“æŸï¼Œè¿™æ—¶å€™çš„JOSå†…å­˜æ•´ä½“å¸ƒå±€å¦‚ä¸‹: Question ç¬¬ä¸€ä¸ªé—®é¢˜ä¸Šé¢åˆšå›žç­”è¿‡äº†ï¼Œå°±æ˜¯æ˜ å°„çš„ç»†èŠ‚é—®é¢˜ã€‚ åœ¨æ˜ å°„çš„æ—¶å€™è®¾ç½®äº†PTE_Uçš„ç”¨æˆ·æ‰æœ‰è¯»å†™æƒé™ã€‚ æˆ‘ä»¬çš„UPAGESæœ‰4MBçš„ç©ºé—´ï¼Œä¸€ä¸ªstruct PageInfoå¤§å°8Bã€‚æ‰€ä»¥èƒ½ç®¡ç†çš„ç‰©ç†å—ä¸º**4MB/8*4KB = 2GBã€‚ ç®¡ç†å†…å­˜çš„å¼€é”€ä¸€å…±æœ‰ç‰©ç†æ˜ å°„pages,é¡µç›®å½•,é¡µè¡¨ã€‚å¦‚æžœç¬¬ä¸‰ä¸ªé—®é¢˜æˆç«‹ä¹Ÿå°±æ˜¯è¯´ç‰©ç†å†…å­˜æœ€å¤§ä¸€å…±æœ‰2Gçš„è¯ï¼Œé‚£pageså¤§å°ä¸€å…±æœ‰2G/4K8=4Mã€‚è€Œé¡µç›®å½•kern_pgdirä¸€å…±æœ‰4KBå¤§å°ï¼›ç›¸åº”çš„é¡µè¡¨æ˜¯4MBã€‚ä¸€å…±æœ‰8MB+4KBã€‚ ##### entry.S è¿™éƒ¨åˆ†æ˜¯åœ¨Lab1çš„æ—¶å€™é—ç•™ä¸‹æ¥çš„é—®é¢˜ï¼Œå› ä¸ºåœ¨ç³»ç»Ÿåˆšå¯åŠ¨çš„æ—¶å€™åˆå§‹åŒ–è¿‡ä¸€ä¸ªé¡µç›®å½•entry_pgdirã€‚å…³äºŽç»†èŠ‚å¯ä»¥å‚çœ‹kern/entrypgdir.cå’Œkern/entry.Sã€‚è¿™é‡Œä»‹ç»ä¸€äº›QEMUçš„æ–°ç”¨æ³•æ¥è¿›è¡Œè°ƒè¯•ï¼ˆå…¶å®žä¹Ÿåœ¨Lab2ä¸­æ˜¯è¦æ±‚æŽŒæ¡çš„ï¼‰: xp/Nx paddr è¾“å‡ºä»Žpaddrç‰©ç†åœ°å€å¼€å§‹çš„Nä¸ªå­—èŠ‚çš„å€¼ * info register è¾“å‡ºå½“å‰å¯„å­˜å™¨çš„çŠ¶æ€ * info mem è¾“å‡ºå½“å‰å®Œæˆæ˜ å°„çš„è™šæ‹Ÿåœ°å€å’Œå¯¹åº”æƒé™ * info pg è¾“å‡ºå½“å‰é¡µè¡¨ï¼Œé¡µç›®å½•å’Œé¡µè¡¨é¡¹æ˜¯åˆ†å¼€çš„ å…¶å®žæˆ‘ä»¬ä»ŽLab1çš„æ—¶å€™å·²ç»è°ƒè¯•è¿‡ï¼Œmovl %eax,%cr0æ‰§è¡Œç»“æŸçš„æ—¶å€™æ‰“å¼€åˆ†é¡µæœºåˆ¶**ã€‚ä½†æ˜¯è¿™æ¬¡å¯ä»¥ç›´æŽ¥çœ‹åˆ°åˆ†é¡µçš„ç»“æžœå’Œæ˜ å°„çš„ç»“æžœè¿˜æ˜¯å¾ˆçˆ½çš„ï¼Œç»“åˆkern/entrypgdir.cæ¥çœ‹ä¸€ä¸‹ä¾¿å¾ˆå®¹æ˜“å›žç­”æœ€åŽä¸€ä¸ªé—®é¢˜: 1234567891011121314151617181920212223// The entry.S page directory maps the first 4MB of physical memory// starting at virtual address KERNBASE (that is, it maps virtual// addresses [KERNBASE, KERNBASE+4MB) to physical addresses [0, 4MB)).// We choose 4MB because that&apos;s how much we can map with one page// table and it&apos;s enough to get us through early boot. We also map// virtual addresses [0, 4MB) to physical addresses [0, 4MB); this// region is critical for a few instructions in entry.S and then we// never use it again.//// Page directories (and page tables), must start on a page boundary,// hence the &quot;__aligned__&quot; attribute. Also, because of restrictions// related to linking and static initializers, we use &quot;x + PTE_P&quot;// here, rather than the more standard &quot;x | PTE_P&quot;. Everywhere else// you should use &quot;|&quot; to combine flags.__attribute__((__aligned__(PGSIZE)))pde_t entry_pgdir[NPDENTRIES] = &#123; // Map VA&apos;s [0, 4MB) to PA&apos;s [0, 4MB) [0] = ((uintptr_t)entry_pgtable - KERNBASE) + PTE_P, // Map VA&apos;s [KERNBASE, KERNBASE+4MB) to PA&apos;s [0, 4MB) [KERNBASE&gt;&gt;PDXSHIFT] = ((uintptr_t)entry_pgtable - KERNBASE) + PTE_P + PTE_W&#125;; ä¸éš¾å‘çŽ°å…¶å®žåœ¨entry_pgdirä¸­å·²ç»å®Œæˆäº†0x00000000-0x00400000åˆ°0xf0000000-0xf0400000å’Œåˆ°0x00000000-0x00400000çš„æ˜ å°„ã€‚è€Œå®žçŽ°æ˜ å°„çš„æ–¹å¼ä¹Ÿæ˜¯ç›´æŽ¥è®²åœ°å€å†™åˆ°é¡µè¡¨é¡¹entry_pgdirä¸­ã€‚ é€šè¿‡è°ƒè¯•ï¼Œå‘çŽ°ä¸¤æ¬¡é¡µç›®å½•çš„åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œæ˜ å°„çš„åœ°å€éƒ½ä¸ä¸€æ ·: è‡³æ­¤Lab2å®Œæˆï¼ŒChallengeæ—¶é—´å…³ç³»ä¸åšäº†ã€‚è¿™æ˜¯æºä»£ç .]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>MIT 6.828</tag>
        <tag>OS</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mit6.828(Fall 2018) Shell]]></title>
    <url>%2F2018%2F11%2F17%2FMit6-828-Fall-2018-Shell%2F</url>
    <content type="text"><![CDATA[HW:Shell Abstract 6.828é™¤äº†Labä¹‹å¤–è¿˜æœ‰é’ˆå¯¹å°åž‹æ“ä½œç³»ç»ŸXV-6çš„Readingså’ŒHomeWorkã€‚æ•´ä¸ª6.828ä¹Ÿæ˜¯å›´ç»•è¿™ä¸¤æ¡çº¿ï¼ˆLabå’ŒHWï¼‰åœ¨èµ°ã€‚Lab1è®©æˆ‘é€‚åº”äº†JOSçš„å®žéªŒçŽ¯å¢ƒå’Œè°ƒè¯•æŠ€å·§ï¼Œä½†æ˜¯Shellå’ŒSystem Callsæ‰æ˜¯çœŸæ­£å±žäºŽæ“ä½œç³»ç»Ÿçš„çŸ¥è¯†ã€‚å…³äºŽXV-6çš„HomeWorkéƒ½æ˜¯å»ºç«‹åœ¨ReadingsåŸºç¡€ä¹‹ä¸Šçš„ï¼Œæœ¬æ¬¡HWéœ€è¦å®žçŽ°ä¸€ä¸ªå°åž‹çš„Shellï¼Œéœ€è¦é˜…è¯»çš„Readingsæœ‰: XV-6.Chapter.0ï¼ˆé‡ç‚¹èµ„æ–™ï¼‰ man fork, (3)execï¼Œopenï¼Œ close TCPL å­¦ä¹ è¿‡ç¨‹ä¸­æœ€æœ‰æ„æ€çš„å½“å±žæ–©èŽ·æ–°æŠ€èƒ½å’Œæ–°å·¥å…·äº†:)ä»‹ç»ä¸€ä¸ªæ–°çš„vimæ’ä»¶ç¥žå™¨â€”â€”â€”â€”Taglistã€‚ ç®€å•æ¥è®²ï¼Œå®ƒä»¥ç›®å½•æ ‘çš„å½¢å¼åˆ—å‡ºå½“å‰æ–‡ä»¶ä¸­çš„symbol:å‡½æ•°åï¼Œå®å®šä¹‰å’Œå˜é‡ã€‚å¸®åŠ©æˆ‘ä»¬ä»Žå®è§‚ä¸Šå¿«é€Ÿäº†è§£æºç ã€‚æœ¬èº«æ”¯æŒè·³è½¬ã€‚å®‰è£…manualä¸­è®²çš„å¾ˆæ¸…æ¥šï¼Œå°±ä¸å†èµ˜è¿°äº†ã€‚ä¸‹é¢æ˜¯æˆ‘çš„é…ç½®: 1234567nnoremap &lt;silent&gt; &lt;F8&gt; :TlistToggle&lt;CR&gt;&lt;CR&gt; &quot;æŒ‰f8å¼€å¯Taglistlet Tlist_Show_One_File=0 let Tlist_Exit_OnlyWindow=1 let Tlist_Use_Left_Window=1 let Tlist_File_Fold_Auto_Close=1 add the above Configs to your ~/.vimrc æ“ä½œç³»ç»Ÿè°ƒç”¨â€”â€”System Calls æ“ä½œç³»ç»Ÿçš„å·¥ä½œæ€»ç»“èµ·æ¥å°±æ˜¯æŠ½è±¡å’Œèµ„æºåˆ†é…ã€‚ èµ„æºæœ‰å†…å­˜åˆ†é…ï¼ŒCPUè°ƒåº¦ç­‰ã€‚è€ŒæŠ½è±¡æŒ‡çš„å°±æ˜¯ç³»ç»Ÿè°ƒç”¨ã€‚å®žéªŒéœ€è¦å®žçŽ°Shellä¸­çš„å‘½ä»¤ï¼Œé‡å®šå‘å’Œç®¡é“ã€‚æ¯ä¸€ä¸ªåŠŸèƒ½éƒ½æ˜¯ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨æ¥å®žçŽ°çš„ï¼Œæ‰€ä»¥å°†System Callsç§°ä¸ºæ“ä½œç³»ç»Ÿçš„æŽ¥å£ä¸€ç‚¹éƒ½ä¸è¿‡åˆ†ã€‚ Executing Simple Commands fork forkç³»ç»Ÿè°ƒç”¨åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¯¹äºŽçˆ¶è¿›ç¨‹è¿”å›žå­è¿›ç¨‹çš„pidï¼Œå¯¹äºŽå­è¿›ç¨‹è¿”å›ž0ã€‚è§ä¸‹é¢ä»£ç : 1234567891011int pid = fork(); //åˆ›å»ºäº†å­è¿›ç¨‹if(pid == 0) &#123; //çˆ¶å­è¿›ç¨‹éƒ½ä»Žè¿™é‡Œå¼€å§‹æ‰§è¡Œï¼Œå”¯ä¸€åŒºåˆ«å°±æ˜¯pidä¸ä¸€æ · printf(&quot;child: existing!\n&quot;); exit();&#125;else if(pid &gt; 0) &#123; printf(&quot;parent: %d&quot;, pid); wait(); //çˆ¶è¿›ç¨‹ç­‰å¾… printf(&quot;child is done\n&quot;);&#125;else &#123; fprintf(stdeer, &quot;fork error!\n&quot;);&#125; å…¶ä¸­wait()ç³»ç»Ÿè°ƒç”¨è¿”å›žä¸€ä¸ªé€€å‡ºçš„å­è¿›ç¨‹ã€‚ä¸Šé¢è¿™æ®µä»£ç å…¶å®žå°±æ˜¯æ•´ä¸ªShellæ‰§è¡ŒæŒ‡ä»¤çš„åŽŸç†:Shellæç¤ºç¬¦ç”±çˆ¶è¿›ç¨‹æä¾›ï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ‰§è¡ŒçœŸæ­£çš„å‘½ä»¤ï¼Œè€Œçˆ¶è¿›ç¨‹åˆ™wait()ç›´åˆ°å­è¿›ç¨‹è¿”å›ž,ç„¶åŽçˆ¶è¿›ç¨‹ç­‰å¾…ä¸‹ä¸€æ¡å‘½ä»¤ã€‚ æ‰§è¡Œæ•ˆæžœå¦‚ä¸‹: å›žåˆ°Shellä¸­æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹å­è¿›ç¨‹ä¸­çš„ä»£ç ï¼Œèƒ½å¤Ÿæ­£ç¡®æ‰§è¡Œç®€å•çš„å‘½ä»¤ã€‚æ¶‰åŠåˆ°exec()å‡½æ•°æ—ã€‚ #### exec execæä¾›äº†åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­æ‰§è¡Œå¦ä¸€ä¸ªè¿›ç¨‹çš„æ–¹æ³•: æ ¹æ®å‚æ•°æä¾›çš„æ–‡ä»¶è·¯å¾„å’Œåç§°æ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œã€‚æ‰§è¡Œç»“æŸä¹‹åŽåŽŸè°ƒç”¨è¿›ç¨‹çš„å†…å®¹é™¤è¿›ç¨‹å·ä¹‹å¤–å…¶ä»–çš„å…¨éƒ¨è¢«æ›¿æ¢ã€‚é€šå¸¸å’Œforkä¸€èµ·è”åˆå®žçŽ°è¿›ç¨‹ä¸­æ‰§è¡Œç¨‹åºã€‚execå‡½æ•°æ—æ˜¯ç”±6ä¸ªä»¥execå¼€å¤´çš„å‡½æ•°æž„æˆçš„ï¼Œè¿™6ä¸ªå‡½æ•°çš„ç”¨æ³•æ ¹æ®åç§°çš„ä¸åŒä¼šæœ‰äº›å¾®çš„åŒºåˆ«: æŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶çš„æ–¹å¼ å…¶ä¸­execlpï¼Œexecvpåœ¨æŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶çš„æ—¶å€™ä¸ç”¨å†™æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ ¹æ®çŽ¯å¢ƒå˜é‡â€œ\(PATHâ€æŸ¥æ‰¾ã€‚`env`å‘½ä»¤å¯ä»¥åˆ—å‡ºç³»ç»Ÿä¸­å½“å‰çš„\)PATHã€‚ å‚æ•°ä¼ é€’æ–¹å¼ å…¶ä¸­execlp,execl,execleè¿™ä¸‰ä¸ªç¬¬äº”ä¸ªå­—æ¯æ˜¯lçš„å‡½æ•°å‚æ•°åªèƒ½åˆ†åˆ«åˆ—å‡ºæ¥â€”â€”â€”â€”const char *argv...ã€‚è€Œexecv,execve,execvpè¿™ä¸‰ä¸ªç¬¬äº”ä¸ªå­—æ¯æ˜¯vçš„å‡½æ•°å‚æ•°å¯ä»¥æ•´ä½“æž„é€ æ•°ç»„ä¼ é€’â€”â€”â€”â€”char *const argv[]ã€‚æ‰€æœ‰çš„å‚æ•°éƒ½åº”è¯¥ä»¥NULLç»“å°¾ã€‚ çŽ¯å¢ƒå˜é‡ å…¶ä¸­execleå’Œexecleå¯ä»¥åœ¨ä½¿ç”¨æŒ‡å®šçš„çŽ¯å¢ƒå˜é‡ã€‚é€šè¿‡åœ¨å‚æ•°æœ«å°¾åŠ ä¸Šchar *const envp[]çš„æ–¹æ³•ã€‚ æ€»ç»“è§ä¸‹å›¾: execå‡½æ•°æ—ä½¿ç”¨æ³¨æ„äº‹é¡¹ å› ä¸ºexecå‡½æ•°ç»å¸¸è°ƒç”¨å¤±è´¥ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸Šåˆ¤æ–­è¯­å¥ æœ€åŽå‚æ•°ä¸€å®šç”¨NULLç»“å°¾ 1234567int exec() &#123; int ret; if( fork() == 0 )&#123; if((ret = execlp(&quot;ls&quot;, &quot;ls&quot;, &quot;-al&quot;, NULL)) &lt; 0) //å‚æ•°ä»¥NULLç»“æŸ fprintf(stderror, &quot;execlp error!\n&quot;); &#125;&#125; å®žçŽ°å‘½ä»¤ Shellä»£ç åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†:è¯æ³•åˆ†æžå’Œå‘½ä»¤æ‰§è¡Œï¼› å®žéªŒéœ€è¦ä¿®æ”¹runcmd()å‡½æ•°ä»£ç ï¼Œå®žçŽ°å…·ä½“çš„EXECã€‚éœ€è¦å…³æ³¨å‡½æ•°ç±»åž‹ï¼Œå‚æ•°ä¸¤ä¸ªç»†èŠ‚ã€‚æ ¹æ®è°ƒè¯•çŸ¥é“' 'ä¸ºEXECï¼Œè€Œexeccmdç»“æž„ä½“ä¸­argv[0]ä¸­å­˜å‚¨çš„æ˜¯å‘½ä»¤çš„åç§°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨execvpæ¥å®žçŽ°ï¼Œexecvpå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯æ‰§è¡Œæ–‡ä»¶çš„åç§°ï¼Œå¾€åŽçš„å‚æ•°å¯ä»¥ç”¨æ•°ç»„è¡¨ç¤ºï¼Œè¿™æ ·å¯ä»¥ä¿è¯è¯¥å‘½ä»¤çš„å¯å˜å‚æ•°å¾—åˆ°å®žçŽ°ã€‚ä»£ç å¦‚ä¸‹: 12345678910111213141516case &apos; &apos;: ecmd = (struct execcmd*)cmd; if(ecmd-&gt;argv[0] == 0) _exit(0); int pid, ret; if ((pid = fork()) == 0) &#123; if((ret = execvp(ecmd-&gt;argv[0], ecmd-&gt;argv)) &lt; 0) &#123; fprintf(stderr, &quot;Bash: command not found:%s\n&quot;, ecmd-&gt;argv[0]); exit(-1); &#125; exit(0); &#125; else if (pid &gt; 0) &#123; wait(0); &#125; break; æ³¨æ„å› ä¸ºæ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œæ‰€ä»¥è°ƒè¯•çš„æ—¶å€™ä¼šå‡ºçŽ°å¾ˆå¤šä¸å¯æ€è®®çš„çŽ°è±¡ã€‚å¯ä»¥å…ˆå°†fork()éƒ¨åˆ†æ³¨é‡ŠæŽ‰ï¼Œè¿›å…¥æ‰§è¡Œå‡½æ•°çœ‹ä¸€ä¸‹çŽ°è±¡ï¼Œç„¶åŽè¾“å‡ºè°ƒè¯•ã€‚æ‰§è¡Œæ•ˆæžœå¦‚ä¸‹: I/O Redirection æ–‡ä»¶æè¿°ç¬¦ æ–‡ä»¶æè¿°ç¬¦æ˜¯å¾ˆé‡è¦çš„æ¦‚å¿µï¼Œå®ƒä½¿å¾—é‡å®šå‘æˆä¸ºå¯èƒ½ã€‚File Descriptoræ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå¸¸å¸¸æŠŠå…¶æŒ‡å‘çš„å¯¹è±¡ç§°ä¸ºæ–‡ä»¶ã€‚æœ¬å®žéªŒä¸­éœ€è¦äº†è§£openï¼Œcreatï¼Œcloseï¼Œdup2ç­‰ç³»ç»Ÿè°ƒç”¨è¿”å›žå€¼å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å°†Shellæœ¬èº«çš„æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘å…¶ä»–çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»Žè€Œå®žçŽ°é‡å®šå‘ã€‚Shellä¿è¯åœ¨ä»»ä½•æ—¶å€™éƒ½æœ‰3ä¸ªæ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦â€”â€”â€”â€”0-æ ‡å‡†è¾“å…¥,1-æ ‡å‡†è¾“å‡º,2-é”™è¯¯è¾“å‡ºã€‚ ä¸‹é¢æ˜¯ä¼šç”¨åˆ°çš„å‡ ä¸ªç³»ç»Ÿè°ƒç”¨: * open(&quot;file_name&quot;, O_RDWR): æ‰“å¼€æ–‡ä»¶ï¼Œæ‰“å¼€æˆåŠŸè¿”å›žå€¼æœ€å°çš„æ–‡ä»¶æè¿°ç¬¦â€”â€”â€”â€”æ ‡å‡†è¾“å…¥0ï¼Œæ‰“å¼€å¤±è´¥è¿”å›ž-1 * create(&quot;file_name&quot;, 0777): åˆ›å»ºæ–‡ä»¶ï¼Œè¿”å›žå€¼åŒopen * close(fd): é‡Šæ”¾ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ * dup2(oldfd, newfd): å°†oldfdå¤åˆ¶ç»™newfd é‡å®šå‘ä¸éœ€è¦è€ƒè™‘å­è¿›ç¨‹çš„é—®é¢˜ï¼Œä½†è¿˜æ˜¯éœ€è¦æ·±å…¥äº†è§£forkå‡½æ•°çš„æœºç†ï¼Œä¸€æ—¦forkï¼Œçˆ¶è¿›ç¨‹æ‹¥æœ‰å’Œå­è¿›ç¨‹ä¸€æ¨¡ä¸€æ ·çš„æ–‡ä»¶æè¿°ç¬¦ã€‚è€Œé‡å®šå‘éœ€è¦è€ƒè™‘çš„æ˜¯åœ¨å­è¿›ç¨‹ä¸­å°†æ ‡å‡†è¾“å…¥ï¼ˆè¾“å‡ºï¼‰å®šå‘åˆ°å…¶ä»–æ–‡ä»¶å³å¯ã€‚ #### &lt; è¾“å…¥é‡å®šå‘ è¾ƒç®€å•ï¼Œä¸€æ—¦æ–‡ä»¶ä¸å­˜åœ¨ç›´æŽ¥æŠ¥é”™: 12345678910case &apos;&lt;&apos;: rcmd = (struct redircmd*)cmd; close(0);//å…³æŽ‰çˆ¶è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥ if(open(rcmd-&gt;file, O_RDONLY) &lt; 0) &#123; fprintf(stderr, &quot;Bash: No such file or directory: %s\n&quot;, rcmd-&gt;file); //è¾“å…¥ä¸å­˜åœ¨ç›´æŽ¥æŠ¥é”™ &#125;else &#123; //ä¸€æ—¦openå‡½æ•°æ‰§è¡ŒæˆåŠŸï¼Œå®ƒè¿”å›žå¾—æ–‡ä»¶æè¿°ç¬¦å°±æ˜¯0ï¼Œæ‰€ä»¥è¿™æ—¶å€™è¯¥æ–‡ä»¶å°±å˜æˆäº†è¾“å…¥,å®šå‘æˆåŠŸ runcmd(rcmd-&gt;cmd); //è¿™é‡Œå°±æ˜¯æ‰§è¡ŒEXECéƒ¨åˆ†ï¼Œæ‰€ä»¥forkçš„æ—¶å€™æ ‡å‡†è¾“å…¥ä¹Ÿæ˜¯å…³é—­çš„ï¼ˆå’Œçˆ¶è¿›ç¨‹ä¸€æ ·closeï¼‰ &#125; break; &gt; è¾“å‡ºé‡å®šå‘ å¦‚æžœæ–‡ä»¶ä¸å­˜åœ¨ã€‚åˆ›å»ºæ–°çš„æ–‡ä»¶æ—¶éœ€è¦æ³¨æ„æ–‡ä»¶çš„æƒé™ã€‚creatå‡½æ•°çš„å‚æ•°0777æƒé™ä¸º-rwx rwx rwxã€‚å…³äºŽumaskçš„çŸ¥è¯†è§è¿™é‡Œã€‚ 123456789101112131415case &apos;&gt;&apos;:rcmd = (struct redircmd*)cmd;int fd;if((fd = open(rcmd-&gt;file, O_RDWR)) &lt; 0) &#123; //fdä¸ºæ–°æ‰“å¼€æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ if((fd = creat(rcmd-&gt;file, 0777)) &lt; 0 ) &#123; fprintf(stderr, &quot;Bash: No such file or directory: %s\n&quot;, rcmd-&gt;file); &#125;else &#123; dup2(fd, 1); //å°†æ ‡å‡†è¾“å‡ºæŒ‡å‘åˆ°æ–°æ‰“å¼€çš„æ–‡ä»¶fdä¸Šï¼Œæ‰€ä»¥è¾“å‡ºå°±åˆ°äº†è¯¥æ–‡ä»¶ä¸Šï¼ˆå®žçŽ°äº†é‡å®šå‘ï¼‰ runcmd(rcmd-&gt;cmd); &#125;&#125;else &#123; dup2(fd, 1); runcmd(rcmd-&gt;cmd);&#125; break; æ‰§è¡Œæ•ˆæžœå¦‚ä¸‹: Implement pipes ç®¡é“æ˜¯ä¸€ä¸ªå°å°çš„å†…å’Œç¼“å†²åŒºï¼Œå®ƒä»¥æ–‡ä»¶æè¿°ç¬¦å¯¹çš„å½¢å¼æä¾›ç»™è¿›ç¨‹ï¼Œä»Žç®¡é“çš„ä¸€ç«¯å†™æ•°æ®å¯ä»¥ä»Žç®¡é“çš„å¦ä¸€ç«¯è¯»å–ã€‚ç³»ç»Ÿè°ƒç”¨pipeå°†æ•°ç»„int p[2]åˆå§‹åŒ–ä¸ºç®¡é“çš„æ–‡ä»¶æè¿°ç¬¦ã€‚æŽ¥ä¸‹æ¥åšçš„æ— éžå°±æ˜¯é‡å®šå‘äº†ã€‚ 12345678910111213141516 case &apos;|&apos;:pcmd = (struct pipecmd*)cmd;int p[2];pipe(p); //ç®¡é“åˆå§‹åŒ–if(fork() == 0) &#123; dup2(p[0], 0); //å°†æ ‡å‡†è¾“å…¥é‡å®šå‘åˆ°ç®¡é“çš„è¾“å…¥p[0]ä¸Š close(p[0]); close(p[1]); runcmd(pcmd-&gt;right);&#125;else &#123; dup2(p[1], 1); //è®²æ ‡æ³¨è¾“å‡ºé‡å®šå‘å¥¥ç®¡é“é¢è¾“å‡ºp[1]ä¸Š runcmd(pcmd-&gt;left); close(p[0]); close(p[1]);&#125;break; æ‰§è¡Œæ•ˆæžœå¦‚ä¸‹: Make grade 6.828å¯¹äºŽHWçš„æµ‹è¯•æ˜¯ç›´æŽ¥åœ¨ä¸»æœºä¸Šæµ‹è¯•çš„ï¼Œç¼–è¯‘Shellæ–‡ä»¶:gcc Shellå¾—åˆ°a.outã€‚å·²çŸ¥è¯¥æ–‡ä»¶t.sh: 123456ls &gt; ycat &lt; y | sort | uniq | wc &gt; y1cat y1rm y1ls | sort | uniq | wcrm y åœ¨ä¸»æœºä¸Šï¼Œæ‰§è¡Œ./a.out &lt; t.shä¸Žåœ¨ä¸»æœºShellä¸Šæ‰§è¡Œsource t.shå¯¹æ¯”ç»“æžœï¼Œå¦‚ä¸‹: æœ¬æ¬¡å®žéªŒçš„æºä»£ç åœ¨Githubä¸Šã€‚ ç¬¬ä¸€æ¬¡æŽ¥è§¦Linuxç³»ç»Ÿç¼–ç¨‹ï¼Œå¾ˆå¤šé›¶ç¢Žçš„çŸ¥è¯†å’Œç»†èŠ‚å­¦èµ·æ¥å¾ˆæ˜¯åƒåŠ›ã€‚ä¸è¿‡åœ¨ç‹¬ç«‹æžæ‡‚Shellçš„æœºåˆ¶ä¹‹åŽåˆè§‰å¾—å¾ˆçˆ½ï¼Œè¿˜æ˜¯å¾ˆæœŸå¾…ä¹‹åŽçš„æŒ‘æˆ˜:)]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>MIT 6.828</tag>
        <tag>OS</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mit6.828(Fall 2018) Lab1]]></title>
    <url>%2F2018%2F11%2F05%2FMit6-828-Fall2018-Lab1%2F</url>
    <content type="text"><![CDATA[Lab1 Before Lab Lab1ä¸€å…±æœ‰ä¸‰éƒ¨åˆ†:Bootstrap,BootLoader,Kernel;å‰ä¸¤éƒ¨åˆ†éƒ½æ˜¯GDBè°ƒè¯•ä¸ºä¸»ï¼Œç†Ÿæ‚‰GDBçš„è°ƒè¯•æŠ€å·§å’Œæ“ä½œç³»ç»Ÿçš„å¯åŠ¨æµç¨‹ã€‚æœ€åŽå®žçŽ°ä¸€å°éƒ¨åˆ†monitorä¸­test_backtraceçš„åŠŸèƒ½ã€‚ å¦‚æžœGDBè°ƒè¯•å‡ºé”™ï¼Œå¯èƒ½æ˜¯å› ä¸ºè°ƒè¯•å™¨æ²¡æœ‰é“¾æŽ¥åˆ°æ“ä½œç³»ç»Ÿä¸Šï¼š 123add add-auto-load-safe-path /Your Working Dir/.gdbinitline to your configuration file &quot;/root/.gdbinit&quot; PC Bootstrap Getting Started with x86 assembly Exercise 1 JOSä¸­ä½¿ç”¨AT&amp;Tæ ¼å¼çš„æ±‡ç¼–è¯­è¨€ï¼Œåœ¨Lab0ä¸­ä»‹ç»äº†ç›¸å…³èµ„æ–™ã€‚å®žéªŒè¦æ±‚ç†Ÿæ‚‰x86æ±‡ç¼–å’ŒInlineæ±‡ç¼–ä¸¤ç§å†™æ³•ã€‚ Simulating the x86 Lab1çš„å·¥ä½œç›®å½•: * /bootç›®å½•åŒ…å«å’Œå¯åŠ¨ç›¸å…³çš„æ–‡ä»¶ã€‚ * /kernç›®å½•åŒ…å«å†…æ ¸å’Œç›‘è§†å™¨ç›¸å…³çš„æ–‡ä»¶ã€‚ * /libç›®å½•åŒ…å«ä¸€äº›é“¾æŽ¥ä½¿ç”¨çš„åº“å‡½æ•°æ¯”å¦‚printfã€‚ * /incç›®å½•åŒ…å«å¤´æ–‡ä»¶ï¼Œç”³æ˜Žäº†éœ€è¦ä½¿ç”¨çš„æ•°æ®ç»“æž„ã€‚ * /objç›®å½•æ˜¯makeä¹‹åŽç›¸åº”çš„åæ±‡ç¼–ä»£ç ï¼Œä¾›è°ƒè¯•ä½¿ç”¨ã€‚ Lab1ä¸»è¦åˆ†æž/obj/kern/kern.asmå’Œobj/boot/boot.asmä¸¤ä¸ªæ–‡ä»¶ã€‚è¿™ä¸¤ä¸ªæ–‡ä»¶åˆ†åˆ«æ˜¯/bootå’Œ/kernç›®å½•ä¸‹çš„æ–‡ä»¶ç¼–è¯‘è¿žæŽ¥åŽçš„ç›®æ ‡æ–‡ä»¶è¢«åæ±‡ç¼–è€Œç”Ÿæˆçš„ã€‚ä¹‹æ‰€ä»¥è¿™æ ·åšæ˜¯å› ä¸ºåæ±‡ç¼–ä¹‹åŽå¯ä»¥çœ‹åˆ°æ¯ä¸€æ¡æŒ‡ä»¤åœ¨å†…å­˜ä¸­çš„ç»å¯¹åœ°å€ã€‚è¿™æ ·è°ƒè¯•çš„æ—¶å€™éžå¸¸æ–¹ä¾¿ã€‚è‡³äºŽå®žæ¨¡å¼å’Œä¿æŠ¤æ¨¡å¼ä¸‹çš„åœ°å€è½¬æ¢åœ¨åŽç»­çš„å®žéªŒä¸­ä¹Ÿä¼šé‡ç‚¹å…³æ³¨ã€‚ The PC's Physical Address Space æœ€æ—©çš„8086æœºå™¨åªæœ‰1Mbçš„å¯»å€ç©ºé—´ï¼ŒåŽé¢çš„80x86ç³»åˆ—æœºå™¨ä¸ºäº†å‘åŽå…¼å®¹æ‰€ä»¥è¡ç”Ÿå‡ºå®žæ¨¡å¼å’Œä¿æŠ¤æ¨¡å¼è¿™ä¸¤ç§æ¦‚å¿µï¼Œä½†æ˜¯BIOSä¸€ç›´éƒ½å­˜åœ¨äºŽä»Ž0x00000000åˆ°0x00100000è¿™1Mbçš„ç©ºé—´ä¸­ã€‚JOSçš„å†…å­˜å¸ƒå±€ä¹Ÿæ˜¯è§„å®šåªæœ‰0x00000000åˆ°0x10000000è¿™256MBå¤§å°çš„ç©ºé—´ï¼Œä½†æ˜¯é»˜è®¤åœ°å€çº¿æ˜¯32ä½çš„ã€‚è¿™ä¸ªå¾ˆé‡è¦ï¼Œå› ä¸ºåŽé¢å®žéªŒå¯¹JOSè¿›è¡Œè™šæ‹Ÿå†…å­˜åˆ†é…çš„æ—¶å€™é¡µæ¡†åœ°å€æœ€å¤§ä¹Ÿåªèƒ½æ˜¯0x10000000ï¼Œå†…æ ¸å¦‚ä½•å¤„ç†æ˜ å°„å°±æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚å…·ä½“å¸ƒå±€è§ä¸‹å›¾: The ROM BIOS Exercise 2 è¿™é‡Œä»‹ç»ä¸€ä¸‹å¸¸ç”¨çš„GDBè°ƒè¯•å‚æ•°: * si: å•æ­¥è°ƒè¯• * info register: æŸ¥çœ‹å½“å‰å„å¯„å­˜å™¨çš„å€¼ * x/Nx Addr: æŸ¥çœ‹å†…å­˜åœ°å€Addrä¹‹åŽNå­—çš„å†…å®¹ * x/Ni Addr: æŸ¥çœ‹å†…å­˜åœ°å€Addrä¹‹åŽçš„Næ¡åæ±‡ç¼–æŒ‡ä»¤ * x/Ni $eip: æŸ¥çœ‹CPUå½“å‰æ‰§è¡Œçš„ä¸‹Næ¡æŒ‡ä»¤ï¼ˆå…¶ä¸­$eipå¯ä»¥æ¢æˆä¸åŒçš„å¯„å­˜å™¨ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼‰ é€šè¿‡åˆ†æžå‰é¢çš„JOSå†…å­˜çš„å¸ƒå±€ï¼ŒBIOSä½œä¸ºå›ºä»¶å­˜åœ¨äºŽ0xf0000åˆ°0xfffffè¿™64KBçš„ç©ºé—´ä¸Šã€‚æ³¨æ„å¯åŠ¨ä¸ºå®žæ¨¡å¼ï¼ŒCPUçš„åœ°å€çº¿å¯»å€éƒ½æ˜¯20ä½çš„ã€‚å¯åŠ¨ä»¿çœŸå™¨ä¹‹åŽçœ‹åˆ°ç¬¬ä¸€æ¡ä»£ç åœåœ¨äº†0xffff0çš„åœ°å€ä¸Šï¼Œè¯´æ˜Žè¿™æ˜¯BIOSç¨‹åºçš„å…¥å£ã€‚0xffff0åˆ°BIOSç¨‹åºé¡¶éƒ¨0xfffffåªæœ‰16å­—èŠ‚çš„ç©ºé—´ï¼Œéœ€è¦æ›´å¤§çš„è¿è¡Œç©ºé—´ï¼Œå› æ­¤ç¬¬ä¸€æ¡æŒ‡ä»¤ljmp $0xf000,$0xe05bï¼›ä¹Ÿå°±æ˜¯è·³è½¬åˆ°0xfe05bè¿™ä¸ªåœ°å€æ­£å¼å¼€å§‹è¿è¡ŒBIOSçš„ç¨‹åºã€‚ BIOSæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¤æ‚çš„ç³»ç»Ÿï¼Œä½†æ˜¯å’ŒOSå…³ç³»ä¸å¤§ã€‚é€šè¿‡è°ƒè¯•BIOSçš„ä»£ç æˆ‘ä»¬çŸ¥é“äº†å®ƒçš„åŠŸèƒ½: * å»ºç«‹ä¸­æ–­å‘é‡è¡¨åŠç›¸åº”çš„ä¸­æ–­ä¾‹ç¨‹ * åˆå§‹åŒ–éƒ¨åˆ†ç¡¬ä»¶åŠè‡ªæ£€(POST) * æ¿€æ´»INT 19ä¸­æ–­æ¥åŠ è½½å¯åŠ¨ç›˜ç¬¬ä¸€æ‰‡åŒº512å­—èŠ‚çš„å†…å®¹åˆ°å†…å­˜(Linux) è¿™é‡Œåº”è¯¥è¯´æ˜Žç¬¬ä¸€æ‰‡åŒºçš„å†…å®¹æ˜¯/bootç›®å½•ä¸‹çš„å†…å®¹:boot.Så’Œmain.c,è¿™ä¸¤ä¸ªæ–‡ä»¶æœ€åŽè¢«ç¼–è¯‘é“¾æŽ¥æˆä¸ºå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶(è¿™é‡Œéœ€è¦ELFçš„çŸ¥è¯†)ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶å¤§å°å°±æ˜¯512å­—èŠ‚ï¼Œæ­£å¥½æ”¾åœ¨å¯åŠ¨ç›˜çš„ç¬¬ä¸€ä¸ªsectorä¸­,è¢«ç§°ä¸ºbootsectã€‚è€ŒBIOSçš„ä¸»è¦å·¥ä½œä¹‹ä¸€å°±æ˜¯å°†bootsectåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œæ‰§è¡Œå®Œä»»åŠ¡ä¹‹åŽï¼ŒBIOSè·³è½¬åˆ°bootsectçš„åˆå§‹ä½ç½®ã€‚è‡³æ­¤BIOSå°†æƒé™äº¤ç»™æ“ä½œç³»ç»Ÿï¼ŒOSç»§ç»­å®Œæˆå‰©ä¸‹çš„å¯åŠ¨è¿‡ç¨‹ã€‚ è¿™é‡Œå‘çŽ°äº†ä¸€ä¸ªå°é—®é¢˜:å°±æ˜¯åœ¨æŸ¥çœ‹/obj/bootç›®å½•çš„æ—¶å€™ï¼Œå‘çŽ°å‡ºçŽ°äº†boot.outå’Œbootä¸¤ä¸ªæ–‡ä»¶ï¼Œå¦‚ä¸‹: stripå‘½ä»¤å°†ELFæ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨ä¿¡æ¯ç­‰è°ƒè¯•ä¿¡æ¯åˆ æŽ‰ï¼Œå‡å°‘æ–‡ä»¶æœ¬èº«çš„å¤§å°ã€‚ç†è®ºä¸Šè®²bootsectæœ€åŽåº”è¯¥è¢«é“¾æŽ¥åˆ°å¯åŠ¨ç›˜kernelçš„ç¬¬ä¸€ä¸ªæ‰‡åŒºä¸Šï¼Œæ¢å¥è¯è®²æœ€åŽçš„æ“ä½œç³»ç»Ÿå¯åŠ¨ç›˜åªæœ‰ä¸€ä¸ªã€‚æŸ¥çœ‹/obj/bootç›®å½•ä¸‹ç”Ÿæˆçš„è¿™ä¸ªä¸¤ä¸ªæ–‡ä»¶:boot.outçš„æ ¼å¼ä¸ºå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ï¼Œbootæ˜¯x86 boot sectorçš„æ ¼å¼ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶ä¸­ä¸€å®šæœ‰ä¸€ä¸ªä½œä¸ºbootsecté“¾æŽ¥ä½¿ç”¨ã€‚è§ä¸‹å›¾: å¯æ˜¯ç»è¿‡åˆ†æžè¿™ä¸¤ä¸ªæ–‡ä»¶å¤§å°éƒ½æ˜¯8K,ç»è¿‡ä¼˜åŒ–ä¹‹åŽä¹Ÿè¦4Kå¤§å°ï¼Œå’Œ512Bytesç›¸å·®å¤ªè¿œã€‚è€Œä¸”æ–‡ä»¶bootè¿˜ä¸å¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶å·¥å…·åˆ†æžã€‚è¿™ä¸ªç»†èŠ‚æ–¹é¢åº”è¯¥å’Œé“¾æŽ¥å…³ç³»å¾ˆå¤§ï¼Œã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹è¿™æœ¬ä¹¦æ˜¯å›½å†…å°‘æœ‰çš„è®²é“¾æŽ¥è£…è½½çš„å¥½ä¹¦ï¼Œæœ‰æ—¶é—´å†æ‹œè¯»å§ã€‚ The Boot Loader Code åˆ†æžboot/boot.S åˆ†æžä¸€ä¸‹/boot/boot.Sè¿™ä¸ªæ–‡ä»¶: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172##############1.ç”³æ˜Žéƒ¨åˆ†###############.set PROT_MODE_CSEG, 0x8 .set PROT_MODE_DSEG, 0x10 .set CR0_PE_ON, 0x1 #################2.16ä½å®žæ¨¡å¼éƒ¨åˆ†##########.globl startstart: .code16 cli %ç¦æ­¢ä¸­æ–­ cld xorw %ax,%ax %æ¸…é›¶æ®µå¯„å­˜å™¨ movw %ax,%ds movw %ax,%es movw %ax,%ss ###å¼€å¯A20åœ°å€çº¿##seta20.1: inb $0x64,%al % å°†64å·ç«¯å£çš„å†…å®¹è¯»åˆ°%alå¯„å­˜å™¨ä¸­ testb $0x2,%al %æ£€æµ‹%alçš„ç¬¬äºŒä½æ˜¯å¦ä¸ºé›¶ï¼ˆä»£è¡¨è¾“å…¥ç¼“å†²åŒºæ˜¯å¦ä¸ºæ»¡ï¼Œå¯ä»¥å¯¹ç«¯å£ç»§ç»­è¯»å†™ï¼‰ jnz seta20.1 %ä¸ä¸ºé›¶åˆ™é‡å¤æ‰§è¡Œseta20.1 movb $0xd1,%al %å°†$0xd1å†™å…¥%alå¯„å­˜å™¨ outb %al,$0x64 %å°†%alå¯„å­˜å™¨çš„å€¼å†™å…¥64å·ç«¯å£seta20.2: %åŒæ ·çš„æ–¹å¼ inb $0x64,%al testb $0x2,%al jnz seta20.2 movb $0xdf,%al outb %al,$0x60 %ä¸¤ä¸ªç«¯å£è¯»å†™ æ¿€æ´»A20åœ°å€çº¿###å®žæ¨¡å¼â€”â€”â€”â€”&gt;ä¿æŠ¤æ¨¡å¼## lgdt gdtdesc %åŠ è½½GDT movl %cr0, %eax orl $CR0_PE_ON, %eax %å–å‡º%CR0å¯„å­˜å™¨çš„ç¬¬é›¶ä½å¹¶ç½®1 movl %eax, %cr0 %å®žæ¨¡å¼å‘ä¿æŠ¤æ¨¡å¼çš„è½¬æ¢ ljmp $PROT_MODE_CSEG, $protcseg ###########3.32ä½ä¿æŠ¤æ¨¡å¼éƒ¨åˆ†############# .code32protcseg: movw $PROT_MODE_DSEG, %ax movw %ax, %ds movw %ax, %es movw %ax, %fs movw %ax, %gs movw %ax, %ss movl $start, %esp call bootmainspin: %BUG Pointï¼ jmp spin###########4.æ•°æ®åŒº################.p2align 2 gdt: SEG_NULL SEG(STA_X|STA_R, 0x0, 0xffffffff) SEG(STA_W, 0x0, 0xffffffff) gdtdesc: .word 0x17 .long gdt ç”³æ˜Žéƒ¨åˆ†ä¸¤ä¸ªå®å®šä¹‰æ˜¯åœ¨ä¿æŠ¤æ¨¡å¼ä¸‹çš„æ®µæè¿°ç¬¦çš„ç”³æ˜Žï¼Œå¯¹äºŽä¿æŠ¤æ¨¡å¼åŽé¢è¿˜æœ‰ä»‹ç»ï¼Œè¿™é‡ŒæƒæŠŠå®ƒä»¬çœ‹æˆæ˜¯CSå’ŒDSæ®µå¯„å­˜å™¨ã€‚ å®žæ¨¡å¼éƒ¨åˆ†é¦–å…ˆå…³æŽ‰äº†ä¸­æ–­cliï¼Œå› ä¸ºæŽ¥ä¸‹æ¥å°±è¦è¿›è¡Œå®žæ¨¡å¼ä¸‹ä¸­æ–­æœåŠ¡ä¾‹ç¨‹å‘ä¿æŠ¤æ¨¡å¼ä¸‹IDTä¸­æ–­æè¿°ç¬¦çš„äº¤æŽ¥ã€‚æœŸé—´ç³»ç»Ÿæ— æ³•å“åº”æ­£å¸¸çš„ä¸­æ–­æœåŠ¡ã€‚cldå°†æ ‡å¿—ä½DFç½®é›¶ï¼ŒDFå’Œå­—ç¬¦ä¸²æ“ä½œç›¸å…³;æ¸…é›¶æ®µå¯„å­˜å™¨ã€‚å¹¶æ‰“å¼€äº†ç¬¬21ï¼ˆA20ï¼‰åˆ°ç¬¬32æ ¹åœ°å€çº¿ï¼Œåœ¨æ²¡æ‰“å¼€ä¹‹å‰é«˜äºŽ1MBçš„åœ°å€æ€»æ˜¯ä¼šâ€œå›žæ»šâ€åˆ°0ï¼Œè¿™ä¹Ÿæ˜¯Linuxæ£€æµ‹ä¿æŠ¤æ¨¡å¼å’Œå®žæ¨¡å¼çš„ä¸€ä¸ªæ–¹æ³•ã€‚æŽ¥ä¸‹æ¥åŠ è½½GDTï¼Œmovl %eax, %cr0è¿™å¥è¯æ˜¯å°†ç³»ç»ŸæŽ§åˆ¶å¯„å­˜å™¨%CR0çš„ç¬¬0ä½ï¼ˆPEä½ï¼‰ç½®ä¸€ï¼Œæ„å‘³ç€å¤„ç†å™¨å·¥ä½œæ–¹å¼å˜ä¸ºä¿æŠ¤æ¨¡å¼ã€‚è¿™é‡Œæ²¡æœ‰ç›´æŽ¥å¯¹%CR0è¿›è¡Œæ“ä½œï¼Œè€Œæ˜¯é€šè¿‡%eaxæ¥å®žçŽ°ä¸»è¦æ˜¯ä¸ºäº†ä¸ç ´åå¯„å­˜å™¨çš„å…¶ä»–ä½ï¼Œå€¼å¾—å€Ÿé‰´ã€‚æœ€åŽljmp $PROT_MODE_CSEG, $protcsegæ˜¯è·³è½¬æŒ‡ä»¤ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯çŽ°åœ¨å·²ç»æ˜¯ä¿æŠ¤æ¨¡å¼äº†ï¼Œè€Œåœ¨å®žæ¨¡å¼ä¸‹å’Œä¿æŠ¤æ¨¡å¼ä¸‹å¯¹äºŽåœ°å€çš„è½¬æ¢æ–¹å¼å·²ç»ä»Žæ®µå¯»å€å˜æˆGDTå¯»å€ã€‚è¿™é‡Œåªéœ€è¦çŸ¥é“è·³è½¬åˆ°äº†protcsegè¿™ä¸ªåœ°å€ã€‚ ä¿æŠ¤æ¨¡å¼åˆå§‹åŒ–äº†é‡è¦çš„æ®µå¯„å­˜å™¨ï¼Œç„¶åŽè·³è½¬åˆ°boot/main.c/bootmainå‡½æ•°ï¼Œå¼€å§‹å°†å¯åŠ¨ç›˜å‰©ä½™çš„å†…æ ¸éƒ¨åˆ†è½½å…¥å†…å­˜ã€‚æ³¨æ„åœ¨AT&amp;Tæ ¼å¼çš„æ±‡ç¼–è¯­è¨€ä¸­ï¼Œæ“ä½œæ•°çš„å­—é•¿æ˜¯ç”±æ“ä½œç¬¦çš„æœ€åŽä¸€ä¸ªå­—æ¯å†³å®šçš„ï¼ŒåŽç¼€'b','w','l'åˆ†åˆ«è¡¨ç¤ºå­—èŠ‚ï¼ˆbyte:8ä½ï¼‰ï¼Œå­—ï¼ˆword:16ä½ï¼‰å’Œé•¿å­—ï¼ˆlong:32ä½ï¼‰ã€‚ æ•°æ®åŒºéƒ¨åˆ†éƒ½æ˜¯åœ¨ä¿æŠ¤æ¨¡å¼ä¸‹å»ºç«‹GDTå…¨å±€æè¿°ç¬¦çš„æ—¶å€™ç›¸å…³çš„å®å®šä¹‰ã€‚ åˆ†æžboot/main.c åˆ†æžä¸€ä¸‹boot/main.cè¿™ä¸ªæ–‡ä»¶: 123456#define SECTSIZE 512#define ELFHDR ((struct Elf *) 0x100000)void readsect(void*, uint32_t);void readseg(uint32_t, uint32_t, uint32_t);void bootmain(void); å…ˆçœ‹è¿™ä¸¤ä¸ªå®å®šä¹‰ï¼ŒSECTSIZEæ˜¯ç£ç›˜ä¸€ä¸ªsectorçš„å¤§å°ï¼Œä¸€èˆ¬è¯»å†™æ“ä½œéƒ½è¦æ±‚åœ°å€å¯¹é½ï¼Œè¿™ä¸ªå®å®šä¹‰å°±ä¼šæ´¾ä¸Šç”¨åœºã€‚ELFHDRæ˜¯ä¸€ä¸ªæŒ‡å‘ELFæ–‡ä»¶ç»“æž„ä½“çš„æŒ‡é’ˆï¼Œä¸å¾—ä¸è¯´å¼ºè½¬æ˜¯Cè¯­è¨€æœ€æœ‰åŠ›çš„å·¥å…·ä¹‹ä¸€ï¼Œç”±æ­¤å¯çŸ¥0x100000ä¾¿æ˜¯å†…å­˜è½½å…¥çš„é¦–åœ°å€ã€‚è¿™ä¸ªåœ°å€ä¹Ÿæ˜¯BIOSç¨‹åºç»“æŸçš„åœ°æ–¹ï¼Œå¯è§JOSå¯¹äºŽå†…å­˜çš„è§„åˆ’åˆ†é…è¿˜æ˜¯å¾ˆç²¾ç¡®çš„ã€‚ 1234567891011121314voidreadseg(uint32_t pa, uint32_t count, uint32_t offset)&#123; //paæ˜¯åŠ è½½åœ°å€ countæ˜¯åŠ è½½æ–‡ä»¶å¤§å° offsetæ˜¯åœ¨å†…æ ¸æ–‡ä»¶ä¸­çš„åç§»é‡ uint32_t end_pa; end_pa = pa + count; //ç»“æŸåœ°å€ pa &amp;= ~(SECTSIZE - 1); //å°†åŠ è½½åœ°å€ä¸Žæœ€å°å•ä½512å¯¹é½ offset = (offset / SECTSIZE) + 1; //è®¡ç®—åŠ è½½éƒ¨åˆ†åœ¨å¯åŠ¨ç›˜ä¸­çš„å“ªä¸€ä¸ªsectorä¸­ï¼Œå› ä¸ºsectorä»Ž1å¼€å§‹ç®—èµ· while (pa &lt; end_pa) &#123; readsect((uint8_t*) pa, offset); pa += SECTSIZE; //è¿™å¥è¯è¡¨æ˜Ž æœ€ç»ˆåˆ†é…çš„å†…å­˜æœ‰å¯èƒ½æ˜¯å¤§äºŽå®žé™…éœ€è¦å†…å­˜çš„ï¼Œå› ä¸ºæ€»æ˜¯ä»¥512ä¸ºæœ€å°åˆ†é…å•å…ƒåˆ†é…çš„ offset++; &#125;&#125; readsegå‡½æ•°ä¸­çš„å¯¹é½ï¼Œçœ‹ä¸‹é¢è¿™ä¸ªsampleå‡½æ•°: 123456789101112131415#include&lt;stdio.h&gt;int main() &#123; long SECSIZE = 0x200; long pa = 0x30301; long to = 0x10387; to &amp;= ~(SECSIZE - 1); pa &amp;= ~(SECSIZE - 1); printf(&quot;secsize is : %lx\n&quot;, SECSIZE); printf(&quot;pa is : %lx\n&quot;, pa); printf(&quot;to is : %lx\n&quot;, to);&#125; ä¹‹æ‰€ä»¥éœ€è¦å¯¹é½ï¼Œå› ä¸ºç£ç›˜å’Œå†…å­˜ä¹‹é—´è¯»å†™å¦‚æžœæŒ‰ç…§è§„å®šçš„æœ€å°ç²’åº¦è¿›è¡Œï¼ŒCPUçš„è®¿é—®æ€§èƒ½ä¼šæé«˜ã€‚å…·ä½“è§IBM.alignmentã€‚ä¸Šè¿°å‡½æ•°çš„æ‰§è¡Œç»“æžœè§ä¸‹å›¾: readsectå‡½æ•°éƒ½æ˜¯ä¸€äº›ç«¯å£æ“ä½œã€‚ä¹Ÿæ²¡ä»”ç»†ç ”ç©¶Orzã€‚ä¸‹é¢ä¸»è¦çœ‹ä¸€ä¸‹bootmainå‡½æ•°å‰©ä¸‹çš„éƒ¨åˆ†: 12345 ph = (struct Proghdr *) ((uint8_t *) ELFHDR + ELFHDR-&gt;e_phoff); eph = ph + ELFHDR-&gt;e_phnum; for (; ph &lt; eph; ph++) readseg(ph-&gt;p_pa, ph-&gt;p_memsz, ph-&gt;p_offset);((void (*)(void)) (ELFHDR-&gt;e_entry))(); å…³äºŽJOSå¯¹äºŽELFæ–‡ä»¶çš„ç”³æ˜Žè§/inc/elf.hã€‚ä¸€å…±æœ‰ä¸‰ä¸ªç»“æž„ä½“ï¼ŒElfä»£è¡¨æ–‡ä»¶å¤´ï¼›Proghdrä»£è¡¨åŠ è½½æ—¶å€™segmentçš„ä¿¡æ¯ï¼›Secthdrä»£è¡¨è¿è¡Œæ—¶sectionçš„ä¿¡æ¯ï¼› åœ¨Lab0ä¸­ï¼Œæˆ‘ä»¬åˆ†æžè¿‡å¯¹ä¸€ä¸ªç¨‹åºåŠ è½½çš„æ—¶å€™æ˜¯ä»¥segmentsä¸ºæœ€å°ç²’åº¦çš„ã€‚æ‰€ä»¥æˆ‘ä»¬é‡ç‚¹å…³æ³¨Elfå’ŒProghdrè¿™ä¸¤ä¸ªç»“æž„ä½“çš„ç»†èŠ‚ã€‚ * e_phoff: segmentè¡¨åœ¨æ•´ä¸ªç¨‹åºä¸­çš„åç§»é‡ * e_phnum: segmentè¡¨é¡¹çš„ä¸ªæ•° * ph-&gt;p_pa: è¯¥segmentåœ¨å†…å­˜ä¸­çš„åŠ è½½åœ°å€ * ph-&gt;p_memsz: è¯¥segmentçš„å¤§å° * ph-&gt;p_offset: è¯¥segmentç›¸å¯¹äºŽè¡¨èµ·å§‹åœ°å€çš„åç§»é‡ æ‰€ä»¥phå°±æ˜¯segmentæ®µè¡¨çš„å¼€å§‹åœ°å€ã€‚è€Œephå°±æ˜¯segmentæ®µè¡¨çš„é¡¹æ•°ã€‚è¿™ä¸ªå¾ªçŽ¯æ˜¯æŠŠæ‰€æœ‰çš„segmentséƒ½åŠ è½½åˆ°ç›¸å¯¹åº”çš„å†…å­˜åœ°å€ä¸­ã€‚ åŠ è½½ç»“æŸåŽï¼Œå†æ¬¡è·³è½¬((void (*)(void)) (ELFHDR-&gt;e_entry))(),é€šè¿‡è°ƒè¯•åæ±‡ç¼–ä»£ç ï¼Œå‘çŽ°è·³è½¬çš„è¿™ä¸ªåœ°å€ä¸ºcall *0x10018,æ³¨æ„è¿™é‡Œæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå¯ä»¥çœ‹åˆ°å†…æ ¸å‡½æ•°çœŸæ­£çš„å…¥å£åœ¨0x0010000cã€‚æ‰€ä»¥æ­£ç¡®çš„æ“ä½œè§ä¸‹å›¾: Exercise 3 åœ¨ä¸Šé¢åˆ†æžçš„è¿‡ç¨‹åŸºæœ¬ä¸Šå›žç­”äº†æ‰€æœ‰çš„é—®é¢˜: * %CR0æ ‡å¿—ä½çš„æ”¹å˜æ„å‘³ç€å®žæ¨¡å¼åˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼ * call *0x10018æ˜¯æœ€åŽä¸€æ¡BootLoaderæ‰§è¡Œçš„æŒ‡ä»¤ï¼Œmovw $0x1234, 0x472æ˜¯å†…æ ¸ç¬¬ä¸€æ¡æŒ‡ä»¤ï¼Œè¿™æ¡æŒ‡ä»¤åœ¨0x0010000cè¿™ä¸ªå…¥å£åœ°å€ã€‚ * é€šè¿‡è¯»å–ELFæ–‡ä»¶ä¸­å…³äºŽåŠ è½½segmentsçš„ä¿¡æ¯ï¼Œå› ä¸ºmainå‡½æ•°æœ€å¼€å§‹åŠ è½½äº†8ä¸ªsectorsçš„å†…å®¹åˆ°å†…å­˜ä¸­ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°±æ˜¯å’ŒELFæ ¼å¼å’Œç»†èŠ‚ä¿¡æ¯æœ‰å…³ç³»ã€‚ Loading the Kernel Exercise 4 é‡æ¸©Cè¯­è¨€æŒ‡é’ˆï¼Œå®žéªŒä¸­æŽ¨èTCPLã€‚åˆ†æžå®žéªŒä¸­ç»™å‡ºçš„éƒ¨åˆ†ç¤ºä¾‹ä»£ç ï¼Œä½“ä¼šæŒ‡é’ˆçš„é­…åŠ›: 1234c = (int *) ((char *) c + 1);*c = 500;printf(&quot;5: a[0] = %d, a[1] = %d, a[2] = %d, a[3] = %d\n&quot;,a[0], a[1], a[2], a[3]); è¿™æ®µä»£ç å°†cå¼ºè½¬æˆä¸ºcharç±»åž‹çš„æŒ‡é’ˆä¹‹åŽåŠ ä¸€ï¼Œç„¶åŽèµ‹å€¼ä¸º500ï¼›é—®é¢˜å°±å‡ºçŽ°åœ¨charç±»åž‹å’Œintç±»åž‹çš„æŒ‡é’ˆå¤§å°æ˜¯ä¸ä¸€æ ·çš„ã€‚intç±»åž‹ä¸º4ä¸ªå­—èŠ‚ï¼Œè€Œcharç±»åž‹åªæœ‰1ä¸ªå­—èŠ‚;æ‰€ä»¥è¿™æ ·åŠ¿å¿…ä¼šå¯¼è‡´èµ‹å€¼çš„æ—¶å€™æ”¹å˜æ•°ç»„ä¸­åŽŸæ¥çš„å¸ƒå±€ã€‚å·²çŸ¥a[1]åŽŸæ¥çš„å€¼400ï¼Œ16è¿›åˆ¶ä¸º0x190;a[2]çš„å€¼åŽŸæ¥ä¸º301ï¼Œ16è¿›åˆ¶ä¸º0x12D;500çš„16è¿›åˆ¶ä¸º0x1F4;ä¸€ä¸ªåœ°å€å•å…ƒä¸ºä¸€ä¸ªå­—èŠ‚ï¼Œä¸ºè§ä¸‹å›¾: å¯ä»¥çœ‹åˆ°è¯»å†™æ“ä½œæ˜¯æŒ‰ç…§å­—èŠ‚ä¸ºæœ€å°å•å…ƒï¼Œæœ€åŽå¯¼è‡´a[1]çš„å€¼å˜æˆ0x1F490ä¹Ÿå°±æ˜¯åè¿›åˆ¶çš„128144ï¼›è€Œa[2]ç”±äºŽè¢«æŠ¹æŽ‰ä»¥ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥å˜æˆ0x100ä¹Ÿå°±æ˜¯256ã€‚ä¸‹å›¾æ˜¯æœ€ç»ˆçš„è¿è¡Œç»“æžœ: Exercise 5 å…³äºŽé“¾æŽ¥å™¨å’ŒåŠ è½½å™¨ï¼Œæœ€ç»å…¸çš„å½“ç„¶æ˜¯è¿™æœ¬loader and linkerã€‚è¿™æ˜¯ä¸­è¯‘æœ¬ll.Chã€‚ä¸è¿‡æˆ‘åšå®žéªŒçš„æ—¶å€™æ²¡æœ‰æƒ³æ˜Žç™½ä»–ä»¬ä¸ºä»€ä¹ˆè¦åœ¨è¿™é‡Œå¼•å…¥è¿™ä¸¤ä¸ªå¤æ‚çš„æ¦‚å¿µï¼›é¢˜ç›®å¾ˆç®€å•ï¼Œä½†æ˜¯ä¸çŸ¥é“LMAå’ŒVMAæ˜¯å’Œè™šæ‹Ÿå†…å­˜æœ‰å…³ç³»è¿˜æ˜¯å’Œé“¾æŽ¥å™¨ï¼ŒåŠ è½½å™¨æœ‰å…³ç³»ã€‚åŽæ¥ç”¨readelf -h kernelå‘çŽ°VMAå°±æ˜¯è™šæ‹Ÿåœ°å€ï¼Œæ‰€ä»¥è¿™é‡Œä»–ä»¬æ‰€è°“çš„linking addresså’Œloading addressåªæ˜¯å®žéªŒä¸­è‡ªè¡Œå®šä¹‰çš„å­—é¢æ„æ€åŠ è½½çš„åœ°å€å’Œæ‰§è¡Œçš„åœ°å€ï¼Œå’Œé“¾æŽ¥å™¨åŠ è½½å™¨æ²¡æœ‰å…³ç³»ï¼ï¼å¦å¤–åœ¨Lab0ä¸­å·²ç»åˆ†æžè¿‡åŠ è½½æ—¶å€™çš„sectionæ˜¯æ‰€æœ‰sectionsç»„åˆæˆçš„ä¸€ä¸ªèšåˆèŠ‚ï¼Œè¿™é‡Œä¸è€ƒè™‘é“¾æŽ¥æ—¶å€™çš„å•ä¸ªsectionçš„æ¦‚å¿µã€‚è¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥æ˜Žç™½å®žéªŒè®²è§£çš„æ€è·¯â€”â€”â€”â€”å¼•å…¥ä½¿ç”¨ELFä¸­segmentsçš„æ¦‚å¿µæ¥è§£é‡ŠåŠ è½½è¿‡ç¨‹ï¼Œè€ŒåŠ è½½è¿‡ç¨‹æ—¶å€™å·²ç»å¼€å¯äº†åˆ†é¡µæœºåˆ¶ï¼Œæ‰€ä»¥è¿™æ—¶å€™ç”¨loading addresså’Œlinking addressæ¥è§£é‡Š0xf0100000å’Œ0x00100000çš„åŒºåˆ«ã€‚è€Œå®žé™…ä¸Š0xf0100000å°±æ˜¯æ˜ å°„åˆ°0x00100000ä¸Šï¼Œç›¸å…³ç»†èŠ‚åœ¨Kerneléƒ¨åˆ†ä¼šç»§ç»­åˆ†æžã€‚ readelfå’Œobjdumpçš„æ“ä½œè§ä¸‹å›¾: å°†é“¾æŽ¥åœ°å€æ”¹æŽ‰ä¹‹åŽï¼Œç¬¬ä¸€æ¡æŠ¥é”™çš„åº”è¯¥æ˜¯å’Œé“¾æŽ¥åœ°å€ç›´æŽ¥ç›¸å…³çš„æŒ‡ä»¤ï¼Œè·³è½¬æŒ‡ä»¤ljmp $PROT_MODE_CSEG, $protcseg; Exercise 6 å‰é¢åˆ†æžè¿‡#define ELFHDR ((struct Elf *) 0x100000)æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå†…æ ¸çš„è£…è½½åœ°å€(load address)å°±æ˜¯0x00100000ï¼Œè€Œå†…æ ¸å¼€å§‹æ‰§è¡Œçš„åœ°å€åº”è¯¥æ˜¯e_entryä¹Ÿå°±æ˜¯0x0010000cã€‚ä»ŽBIOSåˆ°BootLoaderçš„æ—¶å€™ï¼Œå†…æ ¸è¿˜æ²¡æœ‰å¼€å§‹è£…è½½ã€‚æ‰€ä»¥0x00100000æ˜¯ç©ºçš„ã€‚ The Kernel Using virtual memory to work around position dependence Lab1ä¸­çš„åœ°å€æ˜ å°„: 0x00000000â€”â€”â€”â€”0x00400000æ˜ å°„åˆ°0x00000000â€”â€”â€”â€”0x00400000ï¼›0xf0000000â€”â€”â€”â€”0xf0400000æ˜ å°„åˆ°0x00000000â€”â€”â€”â€”0x00400000; åœ¨å®žéªŒè¿‡ç¨‹ä¸­å…³æ³¨äº†ä¸€ä¸‹åœ°å€: åœ¨æ‰§è¡Œåˆ°kern/entry.Sæ–‡ä»¶ä¹‹å‰ï¼Œæ‰€æœ‰çš„å†…å­˜åœ°å€éƒ½æ˜¯ç‰©ç†åœ°å€ï¼ˆä¹¦ä¸­ä»£è¨€ä¸ºçº¿æ€§åœ°å€ï¼Œä½†æ˜¯çº¿æ€§åœ°å€=ç‰©ç†åœ°å€æ‰€ä»¥æ²¡æœ‰å¤ªå¤§åŒºåˆ†ï¼‰ã€‚ç›´åˆ°%CR0å¯„å­˜å™¨çš„PGæ ‡å¿—ä½è¢«ç½®é›¶ã€‚è¿™æ—¶å€™åˆ†é¡µæœºåˆ¶æ‰è¢«æ¿€æ´»ã€‚0x00100000å’Œ0xf0100000éƒ½æ˜ å°„åˆ°0x00100000ï¼Œæ‰€æœ‰ä¸¤ä¸ªåœ°å€å­˜å‚¨çš„æ•°å€¼æ˜¯ä¸€æ ·çš„ã€‚è€Œåœ¨æ˜ å°„è¿˜æ²¡æœ‰å»ºå¥½ä¹‹å‰æ˜¯ä¸ä¸€æ ·çš„ã€‚ Exercise 7 %CR0å¯„å­˜å™¨PGä½æŽ§åˆ¶åˆ†é¡µæœºåˆ¶çš„å®žçŽ°ã€‚çœ‹åˆ°mov %eax, %cr0æ‰§è¡Œç»“æŸä¹‹åŽï¼Œç´¢å¼•åœ°å€å˜æˆäº†0xf0100010ã€‚åœ°å€æ˜ å°„ä¸å¯¹ï¼Œç¬¬ä¸€æ¡é”™è¯¯çš„æŒ‡ä»¤ä¸€å®šä¼šæ˜¯è·³è½¬æŒ‡ä»¤jmp *%eaxã€‚å…·ä½“çš„åˆ†é¡µç»†èŠ‚åœ¨Lab2ä¸­åˆ†æžã€‚å®žéªŒæ“ä½œè§ä¸‹å›¾: Code åˆ†æžkern/printf.c ä¸‹é¢åˆ†æžä¸€ä¸‹kern/printf.cè¿™ä¸ªæ–‡ä»¶: 12345678910111213141516171819202122static void putch(int ch, int *cnt)&#123; cputchar(ch);//æ˜¾ç¤ºå±è¾“å‡ºå‡½æ•°console *cnt++; //æ¯è¿›è¡Œä¸€æ¬¡æ˜¾ç¤ºå±è¾“å‡ºï¼Œå‚æ•°è‡ªåŠ &#125;int vcprintf(const char *fmt, va_list ap)&#123; int cnt = 0; //cntå°†è‡ªèº«æŒ‡é’ˆä¼ ç»™putch(int, int*)ï¼Œåœ¨å‡½æ•°é‡Œè¿›è¡Œè‡ªåŠ  vprintfmt((void*)putch, &amp;cnt, fmt, ap); //æ ¼å¼åˆ¤æ–­ return cnt; //è¿”å›žæœ€ç»ˆè¾“å‡ºçš„å‚æ•°ä¸ªæ•°&#125;int cprintf(const char *fmt, ...)&#123; va_list ap; int cnt; va_start(ap, fmt); cnt = vcprintf(fmt, ap);//å˜å‚ä¼ é€’ va_end(ap); return cnt; //è¿”å›žå‚æ•°ä¸ªæ•°&#125; cprintfæ˜¯ä¸»å‡½æ•°ï¼Œè¿™é‡Œç”¨åˆ°äº†Cè¯­è¨€çš„å˜å‚ç‰¹æ€§ã€‚å˜å‚åœ¨Cåº“stdarg.hä¸­å®šä¹‰è‡³å°‘è¦æœ‰ä¸€ä¸ªå›ºå®šçš„å‚æ•°:fun(const char *fmt, ...)ã€‚ä¸»è¦æœ‰ä¸‰ä¸ªå®ç»„æˆ: * va_list: ç”³æ˜Žå¯å˜å‚æ•°æŒ‡é’ˆapï¼Œä¾æ¬¡æŒ‡å‘çœç•¥å·è¡¨ç¤ºçš„å¯å˜å‚æ•° * va_start(ap, lastFix): åˆå§‹åŒ–apï¼Œå¼€å§‹æŒ‡å‘ç¬¬ä¸€ä¸ªå¯å˜å‚æ•° * va_arg(ap, type): å°†apæŒ‡å‘ä¸‹ä¸€ä¸ªå¯å˜å‚æ•° * va_end(ap): æ¸…é™¤apæŒ‡é’ˆï¼Œç»“æŸå‡½æ•° å¯ä»¥çœ‹åˆ°å˜å‚fmtå’Œå˜å‚æŒ‡é’ˆapè¢«ä¸€è·¯ä¼ åˆ°vcprintfâ€”â€”â€”&gt;vprintfmtã€‚åœ¨vprintfmtä¸­ä½¿ç”¨ã€‚è¯¥æ–‡ä»¶ä¸­é‡ç‚¹å…³æ³¨ä¸¤ä¸ªå‡½æ•°: * åœ¨lib/printfmt.cä¸­çš„å‡½æ•°: vprintfmt(void (*putch)(int, void*), void *putdat, const char *fmt, va_list ap) * åœ¨kern/console.cä¸­çš„å‡½æ•°: cputchar(int c) ç»è¿‡è§‚å¯Ÿä¹‹åŽå°±å¯ä»¥çŸ¥é“: vprintfmtå‡½æ•°åˆ¤æ–­å­—ç¬¦ä¸²è¾“å‡ºå‚æ•°çš„ç±»åž‹å¹¶è°ƒç”¨cputcharå‡½æ•°å°†ç›¸åº”çš„è¾“å‡ºæ˜¾ç¤ºåˆ°æ˜¾ç¤ºå±ä¸Šã€‚ åœ¨å‡½æ•°åˆ†æžä¹‹å‰å†ä»‹ç»ä¸€ä¸ªvimçš„æ–°æŠ€èƒ½:æœç´¢é«˜äº®:match Search /xxx/,å¯ä»¥å¯¹çŽ°åœ¨æ­£åœ¨å…³æ³¨çš„å…³é”®å­—è¿›è¡Œé«˜äº®æ˜¾ç¤ºï¼Œè°ƒè¯•çš„æ—¶å€™å¾ˆæœ‰ç”¨: åˆ†æžå‡½æ•°vprintfmt vprintfmtå‡½æ•°å…¶å®žå¾ˆç®€å•ï¼Œä¸»ä½“å°±æ˜¯ä¸€ä¸ªwhileå¾ªçŽ¯:åœ¨é‡åˆ°%ä¹‹å‰ç›´æŽ¥è¾“å‡ºï¼Œé‡åˆ°%ä¹‹åŽå¼€å§‹åˆ¤æ–­æ ¼å¼å¹¶è¾“å‡ºã€‚ åˆ†æžå‡½æ•°cputchar åœ¨vprintfmtå‡½æ•°ä¸­éœ€è¦æ³¨æ„ä¸€ä¸ªå˜é‡:ch = *(unsigned char *) fmt++ã€‚chä»£è¡¨äº†å½“å‰apæŒ‡é’ˆæŒ‡å‘çš„å˜å‚ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦è¾“å‡ºçš„å†…å®¹ã€‚cputchar(ch)ä¸­çš„å‚æ•°æ­£å¥½å°±æ˜¯è¿™ä¸ªchã€‚æˆ‘ä»¬ä½¿ç”¨Ctagsè·Ÿè¸ªè¿™ä¸ªchå‚æ•°ç»è¿‡çš„å‡½æ•°:putch(int ch, int *)â€”â€”â€”â€”&gt;cputchar(int ch)â€”â€”â€”â€”&gt;cons_putc(int ch)ã€‚çŽ°åœ¨åŸºæœ¬ä¸Šå¯ä»¥çœ‹æ¸…æ‰€æœ‰çš„æŽ§åˆ¶å°è¾“å‡ºæ“ä½œéƒ½æ˜¯å®šä¹‰åœ¨console.cæ–‡ä»¶ä¸­çš„ã€‚æˆ‘ä»¬ç›´æŽ¥åˆ†æžä¸€ä¸‹cons_putc(int ch)è¿™ä¸ªå‡½æ•°: 123456static void cons_putc(int c)&#123; serial_putc(c); lpt_putc(c); cga_putc(c);&#125; ä¸Šä¸‰ä¸ªå­å‡½æ•°éƒ½æ¶‰åŠåˆ°çš„å†…è”æ±‡ç¼–inb()å’Œoutb()ä¸¤ä¸ªå‡½æ•°åœ¨inc/x86.hä¸­æœ‰å®šä¹‰ã€‚å…¶ä¸­serial_putcæ˜¯ä¸²å£è¾“å‡ºï¼Œlpt_putcæ˜¯å¹¶å£è¾“å‡ºï¼Œè€Œcga_putcæ˜¯æ˜¾ç¤ºå±è¾“å‡ºï¼Œå…·ä½“ä¸ç»†åˆ†æžäº†: 123for (i = 0; !(inb(0x378+1) &amp; 0x80) &amp;&amp; i &lt; 12800; i++) delay(); //åˆ¤æ–­æ•°æ®ç¼“å†²åŒºå¯„å­˜å™¨æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™ä¸€ç›´å¾ªçŽ¯ outb(0x378+0, c); //å°†Cå‚æ•°ä»£è¡¨çš„å†…å®¹å†™åˆ°ç«¯å£ä¸­ å¦å¤–ï¼Œåœ¨cga_putc(c)å‡½æ•°ä¸­ï¼Œæœ‰ä¸€æ®µä»£ç : 1234567if (crt_pos &gt;= CRT_SIZE) &#123; int i; memmove(crt_buf, crt_buf + CRT_COLS, (CRT_SIZE - CRT_COLS) * sizeof(uint16_t)); for (i = CRT_SIZE - CRT_COLS; i &lt; CRT_SIZE; i++) crt_buf[i] = 0x0700 | &apos; &apos;; crt_pos -= CRT_COLS; &#125; æˆ‘ä»¬çŸ¥é“cga_putc(c)å‡½æ•°æ˜¯ç”¨äºŽæ˜¾ç¤ºå±è¾“å‡ºçš„å‡½æ•°ï¼Œè€ŒæŸ¥çœ‹è¿™å‡ ä¸ªå®å®šä¹‰: 1234static uint16_t crt_pos //å…‰æ ‡#define CRT_ROWS 25 //æ˜¾ç¤ºå±è¡Œ#define CRT_COLS 80 //æ˜¾ç¤ºå±åˆ—#define CRT_SIZE (CRT_ROWS * CRT_COLS) //æ˜¾ç¤ºå±é¢ç§¯ ç®€å•æ¥è®²å°±æ˜¯å¦‚æžœè¾“å‡ºæ»¡å±ä¹‹åŽï¼Œéœ€è¦é¡µé¢å‘ä¸Šæ»šåŠ¨ä¸€è¡Œã€‚ Formatted Printing to the Console Exercise 8 ç»è¿‡ä¸Šé¢çš„åˆ†æžä¹‹åŽï¼ŒçŸ¥é“æ ¼å¼åŒ–è¾“å‡ºæ˜¯åœ¨kern/printfmt.c/vprintfmt()è¿™ä¸ªå‡½æ•°ä¸­ã€‚æ‰¾åˆ°ç›¸åº”çš„ä½ç½®ä¿®æ”¹å°±è¡Œã€‚ Questions è¿™æ˜¯Exercise.8åŽé¢çš„ä¸€äº›é—®é¢˜ï¼Œå½“ç„¶å¾ˆç®€å•äº†: 1.cputchar(int c) 2.ä¸€å¥è¯ï¼Œå°±æ˜¯æ»¡å±æ—¶å€™çš„å¤„ç†æ–¹æ³• 3.ä¸»è¦æ˜¯å˜å‚æŒ‡é’ˆapå’Œæ ¼å¼åŒ–å˜å‚fmtçš„æŒ‡å‘é—®é¢˜ï¼Œä¹‹å‰åˆ†æžè¿‡ 4.å°†ä»£ç åŠ åˆ°kern/monitor.cä¸­ï¼Œè¾“å‡ºè§ä¸‹å›¾ã€‚å› ä¸º57616çš„åå…­è¿›åˆ¶å°±æ˜¯ellã€‚è€Œ0x0x00646c72åœ¨å°ç«¯å­˜å‚¨çš„æœºå™¨ä¸Šç”¨char*è¡¨ç¤ºå°±æ˜¯rld\0ã€‚å¦‚æžœæƒ³è¦ç”¨å¤§ç«¯å­˜å‚¨çš„è¯ï¼Œåªè¦åè¿‡æ¥å°±è¡Œ0x726c6400ã€‚ 5.æ ¹æ®å˜å‚çš„å®šä¹‰ï¼Œå¦‚æžœfmtå‚æ•°ä¸å¤Ÿï¼Œé‚£æœ€ç»ˆapæŒ‡é’ˆä¼šæŒ‡å‘ä¸€ä¸ªæœªçŸ¥å†…å­˜åŒºåŸŸã€‚æ‰€ä»¥è¾“å‡ºçš„æ•°ä¸ä¸€å®šã€‚è§ä¸‹å›¾: 6.å…³äºŽå˜å‚çš„å®šä¹‰æ˜¯åœ¨inc/stdarg.hä¸­,æˆ‘ä»¬çœ‹ä¸€ä¸‹va_argæ˜¯å¦‚ä½•ä¸€æ¬¡ä¸€æ¬¡å–å‡ºå˜å‚çš„: 1234#define va_arg(ap, type) __builtin_va_arg(ap, type) //Fall 2018#define va_arg(ap, type) \ (*(type *)((ap) += __va_size(type), (ap) - __va_size(type))) //Fall 2015 å¯ä»¥çœ‹åˆ°va_argæ˜¯é€šè¿‡åœ°å€å¾€åŽå¢žé•¿æ¥å–å‡ºä¸‹ä¸€ä¸ªå˜å‚çš„ã€‚è€Œæ­£å¸¸ç¼–è¯‘å™¨æ˜¯ä»Žå³å¾€å·¦çš„é¡ºåºå°†å‚æ•°å…¥æ ˆçš„ï¼ˆå› ä¸ºæ ˆæ˜¯ä»Žé«˜åœ°å€å‘ä½Žåœ°å€å»¶ä¼¸çš„ï¼‰ã€‚å¦‚æžœè¿™æ—¶å€™æ ˆçš„é¡ºåºå˜äº†ï¼Œé‚£åªéœ€è¦å°†va_argå‡½æ•°ä¸­çš„å¯¹åœ°å€çš„åŠ æ³•æ”¹ä¸ºå‡æ³•å°±è¡Œã€‚ The Stack Exercise 9 å…³äºŽæ ˆçš„å®šä¹‰åœ¨kern/entry.Sä¸­ã€‚è§ä¸‹å›¾: å› ä¸ºæ ˆæ˜¯ä»Žé«˜åœ°å€å‘ä½Žåœ°å€å»¶ä¼¸çš„ï¼Œæ‰€ä»¥mov $(bootstacktop) %espå°†æ ˆé¡¶åœ°å€èµ‹å€¼ç»™%espå¯„å­˜å™¨ã€‚è€Œåœ¨æ•°æ®æ®µä¸­å¯¹æ ˆå¤§å°çš„å®šä¹‰ä¹Ÿå¾ˆæ¸…æ¥šäº†â€”â€”â€”â€”KSTKSIZEæ˜¯ä¸€ä¸ªå®å®šä¹‰ï¼Œå¤§å°ä¸º8x4KB=32KBã€‚ Exercise 10 éœ€è¦æ·±å…¥äº†è§£æ ˆè°ƒç”¨çš„æœºåˆ¶ï¼Œå°±éœ€è¦äº†è§£stack pointer%espå’Œbase pointer%ebpè¿™ä¸¤ä¸ªå¯„å­˜å™¨çš„ç”¨æ³•ã€‚æˆ‘ä»¬é€šè¿‡è°ƒè¯•test_backtrace()å‡½æ•°æ¥æ·±å…¥äº†è§£ã€‚(å®žé™…ä¸Šåªè¦æœ‰å‡½æ•°è°ƒç”¨å°±ä¼šæœ‰æ ˆï¼Œä½†å¾ˆæ˜Žæ˜¾test_backtraceä¸æ˜¯ç¬¬ä¸€ä¸ªè°ƒç”¨çš„å‡½æ•°ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä»Žç¬¬ä¸€ä¸ªå‡½æ•°i386_initå¼€å§‹ï¼Œè¿™ä¸ªæ—¶å€™%espä¹Ÿåˆšåˆšå®Œæˆåˆå§‹åŒ–0xf0110000,æ„Ÿè§‰ä¼šæ›´çˆ½ä¸€äº›)ã€‚ test_backtraceå‡½æ•°çš„è°ƒç”¨å‘ç”Ÿåœ¨kern/init.c/i386_init()ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬ç¬¬ä¸€ä¸ªæ–­ç‚¹è®¾ç½®åœ¨0xf01000deã€‚ä»Žåæ±‡ç¼–ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¼€å§‹è°ƒç”¨test_backtraceä¹‹å‰ï¼Œè¿˜æœ‰ä¸¤æ¡æŒ‡ä»¤: 12movl $0x5, (%esp)call f0100040 &lt;test_backtrace&gt; åœ¨è¿˜æ²¡æœ‰å¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼ŒæŸ¥çœ‹ä¸€ä¸‹å¯„å­˜å™¨çš„çŠ¶æ€info registers:%espçš„å€¼ä¸º0xf010ffe0ï¼Œ%ebpçš„å€¼ä¸º0xf010fff8ã€‚ ç„¶åŽå¼€å§‹æ‰§è¡Œç¬¬ä¸€å¥ï¼Œå°†å‚æ•°5movlåˆ°æ ˆé¡¶ï¼Œæ³¨æ„è¿™é‡Œä¸æ˜¯åŽ‹æ ˆè€Œæ˜¯ç›´æŽ¥å­˜è¿›åŽ»çš„ï¼Œæ‰€ä»¥æ ˆæŒ‡é’ˆ%espæ˜¯ä¸ä¼šç§»åŠ¨çš„ã€‚ä½†æ˜¯è¿™æ—¶å€™æ ˆé¡¶å…ƒç´ åº”è¯¥æ˜¯0x5ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡info registerså‘½ä»¤å’Œx/8x $espæ¥åˆ†åˆ«éªŒè¯ï¼Œæ•ˆæžœå¦‚ä¸‹: åœ¨çœ‹ä¸€ä¸‹ç¬¬äºŒæ¡æŒ‡ä»¤call f0100040ã€‚callæŒ‡ä»¤å¯ä»¥åˆ†æˆä¸¤æ¡æŒ‡ä»¤:push %eipå’Œjmp 0xf0100040ã€‚æ‰€ä»¥çœ‹åˆ°pushæŒ‡ä»¤æ˜¯æ­£å®—çš„åŽ‹æ ˆæŒ‡ä»¤ï¼Œè¿™æ—¶å€™%espå¯„å­˜å™¨çš„å€¼æ˜¯è¦-4çš„ï¼Œè€Œä¸”é€’å‡æ»¡å †æ ˆçš„é¡ºåºæ˜¯å…ˆ-4ï¼Œå†åŽ‹æ ˆã€‚è¿™æ¬¡æ ˆé¡¶å…ƒç´ åº”è¯¥æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€0xf01000eaï¼Œè€Œä¸”%espçš„å€¼è¿˜å¾—-4ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡info registerså’Œx/8x $espæ¥åˆ†åˆ«éªŒè¯: ç¬¬ä¸‰æ¡æŒ‡ä»¤å°±æ­£å¼è¿›å…¥åˆ°test_backtraceå‡½æ•°å†…éƒ¨äº†ã€‚åˆ†æžä¸€ä¸‹å‡½æ•°å†…éƒ¨çš„è°ƒç”¨ä»£ç : 12345678910111213141516171819202122void test_backtrace(int x)&#123;f0100040: 55 push %ebpf0100041: 89 e5 mov %esp,%ebpf0100043: 53 push %ebxf0100044: 83 ec 14 sub $0x14,%espf0100047: 8b 5d 08 mov 0x8(%ebp),%ebx cprintf(&quot;entering test_backtrace %d\n&quot;, x);f010004a: 89 5c 24 04 mov %ebx,0x4(%esp)f010004e: c7 04 24 20 1a 10 f0 movl $0xf0101a20,(%esp)f0100055: e8 c1 09 00 00 call f0100a1b &lt;cprintf&gt; if (x &gt; 0)f010005a: 85 db test %ebx,%ebx f010005c: 7e 0d jle f010006b &lt;test_backtrace+0x2b&gt; test_backtrace(x-1);f010005e: 8d 43 ff lea -0x1(%ebx),%eaxf0100061: 89 04 24 mov %eax,(%esp)f0100064: e8 d7 ff ff ff call f0100040 &lt;test_backtrace&gt;f0100069: eb 1c jmp f0100087 &lt;test_backtrace+0x47&gt; else...&#125; åŸºæœ¬ä¸Šæ‰€æœ‰è¢«è°ƒç”¨çš„å‡½æ•°å¼€å¤´éƒ½ä¼šæœ‰è¿™ä¸¤æ¡æŒ‡ä»¤:push %ebp;mov %esp, %ebp; å®žéªŒæŒ‡å¯¼ä¹¦ä¸Šä¹Ÿè§£é‡Šäº†%ebpå¯„å­˜å™¨çš„ä½œç”¨:On entry to a C function, the function's prologue code normally saves the previous function's base pointer by pushing it onto the stack, and then copies the current esp value into ebp for the duration of the function.æ¯ä¸€ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ª%ebpå€¼ï¼Œä½œä¸ºå‡½æ•°çš„æ ˆå¸§ï¼Œéœ€è¦åœ¨æ¯æ¬¡è°ƒç”¨æ–°å‡½æ•°çš„æ—¶å€™åŽ‹æ ˆä»¥ä¿å­˜ä¸Šä¸€ä¸ªå‡½æ•°çš„è¿”å›žåœ°å€ã€‚ è¿™ä¸ªæ—¶å€™èŽ«åå…¶å¦™çš„åŽ‹æ ˆäº†ä¸€ä¸ªå¯„å­˜å™¨%ebxã€‚æˆ‘ä»¬å°†%ebxå…¨å±€é«˜äº®æ˜¾ç¤ºå‘çŽ°ï¼ŒåŽé¢ç´§æŽ¥ç€ä¼šæœ‰mov 0x8(%ebp), %ebxã€‚é‚£0x8(%ebp)å­˜å‚¨çš„åˆ°åº•æ˜¯å•¥ï¼Ÿä¸éš¾æƒ³åˆ°å°±æ˜¯å‚æ•°5ã€‚ç„¶åŽ%espæŒ‡é’ˆæŽ¥ç€æ‰©å±•å½“å‰å‡½æ•°çš„æ ˆç©ºé—´ã€‚å…³æ³¨ä¸€ä¸‹ç¬¬äºŒæ¬¡è°ƒç”¨test_backtrace()ï¼Œå‰ä¸€æ¡æŒ‡ä»¤mov %eax, (%esp)å’Œç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™å®Œå…¨ä¸€æ ·ï¼Œè€Œ%eaxä¸­å­˜çš„ä¹Ÿæ˜¯å‚æ•°5-1=4;å½“ç„¶è°ƒç”¨æŒ‡ä»¤callä¹Ÿéœ€è¦ä¸€æ¬¡åŽ‹æ ˆã€‚æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚æžœæ˜¯ä»Žpush %ebpå¼€å§‹ç®—èµ·æ˜¯å‡½æ•°æ ˆçš„å¼€å¤´çš„è¯ï¼Œé‚£æˆ‘ä»¬æ¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ä¼šèŠ±è´¹4ï¼ˆpush %ebpï¼‰+4(push %ebx)+20(sub $0x14,%esp)+4(call)ä¸€å…±æ˜¯32Byteså­—èŠ‚çš„ç©ºé—´ã€‚æ‰€ä»¥æ•´ä¸ªæ ˆçš„å¸ƒå±€è§ä¸‹å›¾: å½“ç„¶åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­è¿˜è°ƒç”¨äº†cprintf()è¿™ä¸ªå‡½æ•°ï¼Œä¸è¿‡20å­—èŠ‚ç”¨æ¥åˆ†é…æ ˆç©ºé—´ä¹Ÿå¤Ÿäº†ã€‚ ##### Exercise 11 ç»è¿‡ä¸Šé¢çš„åˆ†æžï¼Œæ ˆçš„å¸ƒå±€å·²ç»å¾ˆæ¸…æ¥šäº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦çŸ¥é“å¯¹äºŽread_ebp()å‡½æ•°æ¥è¯´è¯»å‡ºçš„æ˜¯å½“å‰%ebpæŒ‡é’ˆæŒ‡å‘çš„åœ°å€ï¼Œæ‰€ä»¥æŒ‰ç…§ä¸Šé¢æ ˆçš„å¸ƒå±€:(%ebp)--&gt;ä¸Šä¸€ä¸ª%ebp,0x4ï¼ˆ%ebpï¼‰--&gt;%eip,0x8(%ebp)--&gt;å‚æ•°1...å½“ç„¶è¿™é‡Œçš„å‚æ•°æ¯”5ä¸ªå°‘ã€‚ ä¸‹é¢å°±æ˜¯è€ƒéªŒCè¯­è¨€çš„æ—¶åˆ»ï¼Œä¸€å®šè¦æ³¨æ„æ ¼å¼: 1234567891011121314151617181920212223intmon_backtrace(int argc, char **argv, struct Trapframe *tf)&#123; // Your code here. /* parameter &quot;argc&quot; indicates numbers of paras passed by the command-line; parameter &quot;argv&quot; indicates specific paras accordingly. */ struct Eipdebuginfo info; cprintf(&quot;Stack backtrace:\n&quot;); uint32_t *ebp = (uint32_t*)read_ebp(); while(ebp) &#123; uint32_t eip = ebp[1]; cprintf(&quot; ebp %x eip %x args &quot;, ebp, eip); cprintf(&quot;%08.x &quot;, *(ebp+2));//è¿™é‡Œæä¸€ä¸‹æŒ‡é’ˆçš„ç”¨æ³•ï¼ŒæŒ‡å¯¼ä¹¦ä¸­æœ‰è®²è§£ cprintf(&quot;%08.x &quot;, *(ebp+3)); cprintf(&quot;%08.x &quot;, *(ebp+4)); cprintf(&quot;%08.x &quot;, *(ebp+5)); cprintf(&quot;%08.x\n&quot;, *(ebp+6)); ebp = (uint32_t*)*(ebp); &#125; return 0;&#125; Exercise 12 å¯¹æ¯ä¸€ä¸ª%eipï¼Œå°è¯•ç€ç»™å‡ºå…¶æ–‡ä»¶åç§°ï¼Œå‡½æ•°åç§°å’Œè¡Œå·ã€‚è¿™äº›ä¿¡æ¯éƒ½å±žäºŽè°ƒè¯•çš„ä¿¡æ¯ã€‚å®žéªŒè¦åšçš„æ˜¯æ‰¾åˆ°è¿™äº›è°ƒè¯•ä¿¡æ¯ï¼Œå¹¶æŒ‰ç…§è§„å®šæ ¼å¼å°†å®ƒä»¬è¾“å‡ºã€‚è¿™é‡Œéœ€è¦äº†è§£STABç¬¦å·è¡¨çš„æ¦‚å¿µã€‚ é¦–å…ˆæŸ¥çœ‹ä¸‹kern/kernel.ldé“¾æŽ¥è„šæœ¬ã€‚å‘çŽ°äº†æœ‰å…³_STAB_*çš„ä¸¤ä¸ªä¿¡æ¯â€”â€”â€”â€”.stabå’Œ.stabstrã€‚å…¶ä¸­stabæ˜¯ä»Šå¤©çš„é‡ç‚¹ã€‚kern/kdebug.cä¸­çš„å®å®šä¹‰è¯´æ˜Žäº†stabå’Œstabstrçš„å…³ç³»ã€‚ 1234extern const struct Stab __STAB_BEGIN__[]; // Beginning of stabs tableextern const struct Stab __STAB_END__[]; // End of stabs tableextern const char __STABSTR_BEGIN__[]; // Beginning of string tableextern const char __STABSTR_END__[]; // End of string table å†çœ‹ä¸€ä¸‹inc/stab.hå¯¹stabå®šä¹‰çš„æ•°æ®ç»“æž„: 12345678// Entries in the STABS table are formatted as follows.struct Stab &#123; uint32_t n_strx; // index into string table of name è¯¥é¡¹å¯¹åº”çš„åœ¨stabstrèŠ‚å†…çš„ç´¢å¼•åç§» uint8_t n_type; // type of symbol è¯¥é¡¹æè¿°çš„ç¬¦å·ç±»åž‹ é‡ç‚¹å…³æ³¨ uint8_t n_other; // misc info (usually empty) uint16_t n_desc; // description field æºæ–‡ä»¶çš„è¡Œå· é‡ç‚¹å…³æ³¨ uintptr_t n_value; // value of symbol åœ°å€å€¼ é‡ç‚¹å…³æ³¨&#125;; é€šè¿‡objdump -G obj/kern/kernelæ¥æŸ¥çœ‹å½“å‰ELFæ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨ä¿¡æ¯ã€‚è§ä¸‹å›¾: ä»”ç»†è§‚å¯Ÿä¸Šå›¾ï¼Œå‘çŽ°æ¯ä¸€åˆ—çš„åˆ†ç±»å°±æ˜¯æŒ‰ç…§stabæ•°æ®ç»“æž„åˆ†ç±»çš„ã€‚é‡ç‚¹å…³æ³¨ä¸€ä¸‹n_typeè¿™ä¸ªå…³é”®å­—ï¼Œå®ƒè¡¨ç¤ºè¯¥æè¿°é¡¹çš„ç¬¦å·ç±»åž‹ï¼Œä¸Šå›¾ä¸­å‡ºçŽ°æœ‰å¾ˆå¤šSOï¼ŒFUN...ç­‰ç¬¦å·ç±»åž‹ã€‚å°†è¿™äº›åˆ—å•ç‹¬åˆ—å‡ºæ¥è¿›è¡Œå¯¹æ¯”: å¾ˆæ˜Žæ˜¾SOæŒ‡çš„æ˜¯æ–‡ä»¶åï¼ŒFUNæŒ‡çš„æ˜¯å‡½æ•°åã€‚æ³¨æ„è¿™æ˜¯objdumpå¯¹åº”çš„ç¬¦å·è¡¨ï¼ŒJOSå¯¹ç¬¦å·è¡¨æœ‰è‡ªå·±å®šä¹‰çš„æ•°æ®ç»“æž„è§inc/stab.hã€‚è¾“å‡ºçš„é¡ºåºéƒ½æ˜¯æŒ‰ç…§åœ°å€æ¥æŽ’åºçš„ï¼Œå¾ˆæ•´é½ã€‚æ‰€ä»¥stab_binsearch()æŸ¥æ‰¾å‡½æ•°åŽŸç†ä¹Ÿå°±çŒœçš„å·®ä¸å¤šäº†ï¼Œè¿™äº›è°ƒè¯•ä¿¡æ¯å’Œç›¸åº”åœ°å€çš„å…³ç³»æ˜¯é€šè¿‡ç¬¦å·è¡¨æ¥è¿žæŽ¥çš„ã€‚å½“ç„¶æ‰€æœ‰çš„è¿™äº›çŸ¥è¯†éƒ½å¯ä»¥é€šè¿‡kern/kdebug.cè¿™ä¸ªæ–‡ä»¶ä¸­å¯¹stabçš„æ³¨é‡Šï¼ˆè§è¿‡æœ€å…¨çš„æ³¨é‡Šäº†ï¼‰å­¦ä¹ åˆ°ã€‚æ‰€ä»¥æˆ‘ä»¬æœ€åŽåˆ†æžä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶: æ•´ä¸ªæ–‡ä»¶ä¸€å…±æœ‰ä¸¤ä¸ªå‡½æ•°debuginfo_eipå’Œstab_binsearchã€‚JOSå»ºç«‹äº†ä¸€ä¸ªæ•°æ®ç»“æž„Eipdebuginfoç”¨æ¥å­˜æ”¾è°ƒè¯•ä¿¡æ¯ï¼Œdebuginfo_eipè°ƒç”¨stab_binsearchå‡½æ•°å®Œæˆä¸€ä¸ªå®žä¾‹åŒ–çš„Eipdebuginfoï¼Œæ‰€æœ‰çš„è¾“å‡ºä¿¡æ¯å…¶å®žæœ€åŽéƒ½å­˜å‚¨åœ¨è¿™ä¸ªå®žä¾‹ä¸­ã€‚ 12345678910struct Eipdebuginfo &#123; const char *eip_file; // Source code filename for EIP int eip_line; // Source code linenumber for EIP const char *eip_fn_name; // Name of function containing EIP int eip_fn_namelen; // Length of function name uintptr_t eip_fn_addr; // Address of start of function int eip_fn_narg; // Number of function arguments&#125;; stab_binsearch(const struct Stab *stabs, int *region_left, int *region_right, int type, uintptr_t addr)å‡½æ•°æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªäºŒåˆ†æŸ¥æ‰¾ã€‚typeæŒ‡çš„å°±æ˜¯ç¬¦å·è¡¨é¡¹çš„ç¬¦å·ç±»åž‹ï¼Œè¯¥å‡½æ•°æ¯æ¬¡æŸ¥æ‰¾çš„æ—¶å€™éƒ½éœ€è¦ç¡®å®šæŸ¥æ‰¾çš„ç¬¦å·ç±»åž‹ã€‚æˆ‘ä»¬éœ€è¦å®Œæˆçš„éƒ¨åˆ†æ˜¯è¡Œå·ï¼Œé€šè¿‡æ£€æŸ¥inc/stab.hæ–‡ä»¶ï¼Œå¾ˆå®¹æ˜“çŸ¥é“è¡Œå·çš„å®å®šä¹‰æ˜¯S_LINEã€‚äºŒåˆ†æŸ¥æ‰¾å¤±è´¥çš„æ ‡å¿—å°±æ˜¯LeftA &gt; rightAã€‚æ‰€ä»¥ä»£ç ä¹Ÿå¾ˆç®€å•äº†: 1234567// Your code here. stab_binsearch(stabs, &amp;lline, &amp;rline, N_SLINE, addr); if(lline &lt;= rline)&#123; info-&gt;eip_line = stabs[lline].n_desc; //ç¡®å®šè¡Œå· &#125;else &#123; return -1; &#125; æœ€åŽå°†monitorçš„å‘½ä»¤è¡¥å……å®Œæ•´å°±æ›´ç®€å•äº†: 12345678add :debuginfo_eip(eip, &amp;info); cprintf(&quot;\t%s:%d: %.*s+%d\n&quot;, info.eip_file, info.eip_line, info.eip_fn_namelen, info.eip_fn_name, info.eip_fn_addr);to kern/monitor.c/mon_backtrace()add : &#123;&quot;backtrace&quot;, &quot;Display each stack frame called&quot;, mon_backtrace &#125;,to kern/monitor/commands[] è¿è¡Œç»“æžœè§ä¸‹å›¾: å®žéªŒè¿‡ç¨‹ä¸­æœ‰å‡ å¤„ç»†èŠ‚æ¶‰åŠåˆ°ç¼–è¯‘å™¨çš„ä¼˜åŒ–ï¼Œå› ä¸ºè¿˜ä¸æ˜¯å¾ˆäº†è§£ç¼–è¯‘é“¾æŽ¥çš„ç»†èŠ‚å’ŒåŽŸç†ï¼Œæ‰€ä»¥è¢«æˆ‘å¿½ç•¥æŽ‰äº†ã€‚ è‡³æ­¤Lab1ç»“æŸã€‚]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>MIT 6.828</tag>
        <tag>OS</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mit6.828(Fall 2018) Lab0]]></title>
    <url>%2F2018%2F11%2F05%2FMit6-828-Fall-2018-Lab0%2F</url>
    <content type="text"><![CDATA[Lab0 Abstract ä»Ž8086æ±‡ç¼–å®žéªŒä¹‹åŽï¼Œå‰åŽä¸¤å‘¨çš„æ—¶é—´å‹‰å¼ºé€šè¿‡Lab1ã€‚ æœ€å¤§çš„æ„Ÿè§¦æ˜¯åŸºç¡€å¤ªå·®:å¯¹Cè¯­è¨€çš„ç†è§£ï¼Œå¯¹ç¨‹åºç¼–è¯‘é“¾æŽ¥æœ¬è´¨çš„ç†è§£ï¼Œå¯¹GDBç­‰å·¥å…·çš„ä½¿ç”¨â€¦â€¦å½“ç„¶ä¹ŸåŒ…æ‹¬å¼±å¼±çš„è‹±è¯­ç†è§£èƒ½åŠ›ã€‚å¯¼è‡´å®ŒæˆLab1ç”¨äº†è¿™ä¹ˆä¹…çš„æ—¶é—´ã€‚ ä½†æ˜¯è¿™æ¬¡è§¦åŠ¨ä¸­å´åˆå¤šäº†ä¸€ä¸è§å±±ä¸æ˜¯å±±ï¼Œè§å±±åˆæ˜¯å±±çš„æ„Ÿè§‰ã€‚ä¸»è¦ä½“çŽ°åœ¨æˆ‘å¯¹æ“ä½œç³»ç»Ÿçš„ç†è§£æœ€ç»ˆéƒ½å›žå½’åˆ°ä»£ç ä¸Šæ¥ã€‚æ¯”å¦‚printfå‡½æ•°çš„å®žçŽ°å°±æ¶‰åŠCè¯­è¨€ä¸­å˜å‚çš„ç‰¹æ€§ã€‚æœ‰ç†ç”±ç›¸ä¿¡è¿™ç§è¡€æµ“äºŽæ°´çš„å…³ç³»åœ¨åŽç»­çš„Labä¸­è¿˜ä¼šè¿›ä¸€æ­¥åŠ å¼ºï¼Œæ‰€ä»¥æˆ‘ä¹Ÿå¸Œæœ›è¿™ä¼šæ˜¯æˆ‘å­¦ä¹ OSæœ€å®Œç¾Žçš„æ–¹æ³•è®ºâ€”â€”â€”â€”â€”â€”Talk is cheap, show me the code.ã€‚ æˆªæ­¢åˆ°Lab1ï¼Œæ•´ä¸ªå­¦ä¹ çš„è¿‡ç¨‹æ˜¾å¾—å¾ˆæ¸…æ™°â€”â€”â€”â€”å°±æ˜¯é€šè¿‡è°ƒè¯•kernelçš„åæ±‡ç¼–ä»£ç æ¥ç†è§£è¿è¡ŒåŽŸç†å¹¶åŠ ä»¥ä¿®æ”¹ã€‚Lab0æ˜¯æˆ‘åœ¨å®žéªŒè¿‡ç¨‹ä¸­æŽ‰è¿›çš„å‘ï¼ŒæŸ¥é˜…çš„èµ„æ–™å’Œé€æ¸ç‚¹äº®çš„æŠ€èƒ½æ ‘ï¼Œç¼©çŸ­å®žéªŒå‰çš„å‡†å¤‡æ—¶é—´å¯¹ç†è§£OSæœ¬èº«è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚ 6.828å®žéªŒçŽ¯å¢ƒçš„æ­å»º è™šæ‹ŸæœºçŽ¯å¢ƒ: Ubuntu14.4 (32ä½) ä»¿çœŸå™¨: Qemu git clone https://github.com/mit-pdos/6.828-qemu.git qemu å®žéªŒä»£ç : Lab git clone https://pdos.csail.mit.edu/6.828/2018/jos.git lab &gt; è™šæ‹ŸæœºçŽ¯å¢ƒ32ä½ï¼Œå› ä¸ºJOSå°±æ˜¯32ä½çš„æ“ä½œç³»ç»Ÿã€‚ &gt; ä»¿çœŸå™¨ä½¿ç”¨MITè¿›è¡Œpatchedè¿‡çš„(è§ä¸Šé“¾æŽ¥)ã€‚åŽŸå› æ˜¯å®žéªŒä¸­åˆ†é¡µæœºåˆ¶æ˜¯æœ‰æ„ä¿®æ”¹è¿‡çš„ï¼Œä½¿ç”¨patched versionçš„è¯åœ¨åŽé¢Exerciseä¸­ä¸éœ€è¦æ‰‹åŠ¨è½¬æ¢åœ°å€ã€‚ &gt; å…³äºŽå®žéªŒä»£ç ï¼Œé»˜è®¤ç†Ÿæ‚‰Gitå’ŒMakeFileã€‚æ¯åšå®Œä¸€ä¸ªExerciseå¯ä»¥ä½¿ç”¨make gradeè¿›è¡Œæµ‹è¯•ã€‚ &gt; åœ¨æ•´ä¸ªå®žéªŒçŽ¯å¢ƒæ­å»ºçš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå› ä¸ºè™šæ‹Ÿæœºå‘åž‹ç‰ˆæœ¬çš„ä¸åŒè€Œå‡ºçŽ°ä¸åŒçš„é“¾æŽ¥åº“ä¸¢å¤±ï¼ŒGoogleä¸€ä¸‹ã€‚è¯¦ç»†çš„æ­å»ºè¿‡ç¨‹è§Tools Guide å…³äºŽ6.828 MITçš„OSè¯¾ç¨‹ã€‚å­¦ä¹ å…±æœ‰ä¸‰æ¡ä¸»çº¿:Lectures,Readings,Labsã€‚ å½“ç„¶æœ€é‡è¦çš„å°±æ˜¯Labsã€‚å…³äºŽå‰©ä½™çš„ä¸¤éƒ¨åˆ†ï¼Œä¸»è¦å›´ç»•ä¸€ä¸ªå«åšxv6çš„å°åž‹OSå±•å¼€çš„ã€‚ç®€å•æ¥è®²ï¼Œè¿™æ˜¯ä¸€ä¸ªéº»é›€è™½å°äº”è„ä¿±å…¨çš„OSã€‚æœ‰Documentså’ŒSource Codeä¸¤ä»½èµ„æ–™ã€‚çŸ¥ä¹Žä¸Šè¯„ä»·å¾ˆé«˜ï¼Œæœ‰äººå°†å…¶ç¿»è¯‘æˆä¸ºä¸­æ–‡ç‰ˆæœ¬ä¸Šä¼ è‡³Github.XV6_Chï¼Œä¼ è¯´çœ‹æ‡‚æºç ä¹‹åŽå¯ä»¥è¶…ç¥žâ€¦â€¦ åšLabçš„è¿‡ç¨‹ä¸­ï¼Œè¯¾ç¨‹ä¼šæä¾›å¤§é‡çš„Readingsæ¥é˜…è¯»ï¼Œå½“ç„¶éƒ½æ˜¯è‹±æ–‡çš„ã€‚è¯¦ç»†è§Referenceã€‚ 80386æ±‡ç¼–å’Œå†…è”æ±‡ç¼– AT&amp;T-80386 åœ¨ä¹‹å‰çš„æ±‡ç¼–å®žéªŒä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†16ä½çš„Intel-8086æ±‡ç¼–ã€‚è€Œåœ¨32ä½æœºå™¨ä¸Šéœ€è¦ä½¿ç”¨32ä½çš„80386æ±‡ç¼–è¯­è¨€ã€‚è™½ç„¶å¯¹äºŽLinuxæ¥è¯´ï¼Œ8086å’Œ80386çš„æœºå™¨æ˜¯æœ‰å¾ˆå¤§çš„å·®åˆ«çš„ï¼Œä¸»è¦ä½“çŽ°åœ¨å®žæ¨¡å¼å’Œä¿æŠ¤æ¨¡å¼ä¸Šã€‚ä½†æ˜¯å°±è¯­è¨€æœ¬èº«è€Œè¨€ï¼Œæ›´å¤šçš„æ˜¯é€’è¿›çš„å…³ç³»è€Œè¯­æ³•å·®åˆ«å¹¶ä¸å¤§ã€‚ç›®å‰è¿˜æ²¡æœ‰é‡åˆ°ä¿æŠ¤æ¨¡å¼ç›¸å…³çš„éšœç¢ã€‚ x86çš„æ±‡ç¼–ä¸»è¦æœ‰ä¸¤ç§æ ¼å¼:Intelå’ŒAT&amp;Tã€‚6.828ä½¿ç”¨çš„æ˜¯AT&amp;T,è€Œå®žé™…ä¸ŠLinuxä¸­çš„æ±‡ç¼–ä¹Ÿæ˜¯åŽè€…å±…å¤šã€‚æ±‡ç¼–è¯­è¨€æœ¬èº«ä¸»è¦æœ‰æŒ‡ä»¤é›†Instruction Setå’Œä¼ªæŒ‡ä»¤Directivesä¸¤å¤§éƒ¨åˆ†å†…å®¹ã€‚å½“ç„¶æœ€å…¨çš„æ–‡çŒ®æ˜¯Intelè‡ªå®¶çš„Documentsï¼Œä¸è¿‡æˆ‘è§‰å¾—æœ‰äº›å¤ªæ‚å’Œå¤šäº†ã€‚ä¸‹é¢çš„çš„èµ„æ–™åœ¨å®žéªŒè¿‡ç¨‹ä¸­å¸®äº†æˆ‘å¾ˆå¤šã€‚å€¼å¾—ç»†çœ‹ã€‚ MIT----pcasm-bookã€‚ Wikipedia----x86 Instruction Set Oracle----x86 Assembler Directives å†…è”æ±‡ç¼– å› ä¸ºæ“ä½œç³»ç»Ÿæœ¬èº«å°±æ˜¯å’Œç¡¬ä»¶æ‰“äº¤é“æœ€é¢‘ç¹çš„ç³»ç»Ÿè½¯ä»¶ï¼Œæœ‰äº›åœ°æ–¹éœ€è¦ä½¿ç”¨åˆ°æ±‡ç¼–æ¥ç®€å•ç²—æš´çš„å®Œæˆå·¥ä½œã€‚å†…è”æ±‡ç¼–å°±æ˜¯åµŒå…¥åœ¨Cè¯­è¨€ä¸­çš„æ±‡ç¼–è¯­è¨€ï¼Œæ ¼å¼å’ŒåŽŸæ¥çš„æœ‰å¾ˆå¤§çš„ä¸åŒã€‚ä¸è¿‡IBMçš„é‚£ä»½èµ„æ–™å¯ä»¥è§£å†³ä¸€å¤§åŠé—®é¢˜ï¼Œä¹Ÿæ˜¯éš¾å¾—çš„ä¸­æ–‡æ–‡æ¡£â€¦â€¦ MIT----Brennan's Guide to Inline Assembly IBM----æ±‡ç¼–è¯­è¨€å¼€å‘æŒ‡å— ELFæ–‡ä»¶ å®žåDissç½‘ä¸Šå„ç§å¯¹ELFçš„è®²è§£ï¼Œæ•…æ„å¼„æ··sectionå’Œsegmentçš„æ¦‚å¿µã€‚åŠ ä¸Šå¯¹äºŒè¿›åˆ¶å·¥å…·ä½¿ç”¨çš„ä¸ç†Ÿç»ƒï¼Œè®©æˆ‘ä¸€åº¦ä»¥ä¸ºé“¾æŽ¥çš„éš¾åº¦ç³»æ•°æ˜¯æ•´ä¸ªå®žéªŒè¿‡ç¨‹ä¸­æœ€é«˜çš„â€¦â€¦ç›´åˆ°æˆ‘çœ‹åˆ°CSAPPä¸­å…³äºŽé“¾æŽ¥éƒ¨åˆ†çš„è®²è§£ã€‚ ç¼–è¯‘é©±åŠ¨ç¨‹åº Compiler driveræŒ‡çš„æ˜¯ä»ŽCæ–‡ä»¶å˜æˆäºŒè¿›åˆ¶æ–‡ä»¶çš„æœºå™¨æ“ä½œè¿‡ç¨‹ã€‚æˆ‘ä»¬ä»Žä¸¤ä¸ªè§’åº¦ç†è§£è¿™ä¸ªè¿‡ç¨‹:æœºå™¨è¿è¡Œçš„è§’åº¦å’ŒCæ–‡ä»¶ç±»åž‹å˜åŒ–çš„è§’åº¦ã€‚ç¼–è¯‘å™¨å’Œæ±‡ç¼–å™¨å°†å¤šä¸ªCæ–‡ä»¶ç¼–è¯‘æˆç›¸åº”çš„å¤šä¸ªå¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯å¹³æ—¶çš„.oæ–‡ä»¶ï¼Œè¿™ç§æ–‡ä»¶ç”±ä¸åŒçš„ä»£ç èŠ‚å’Œæ•°æ®èŠ‚æž„æˆï¼ŒèŠ‚åœ¨åŽŸæ–‡ä¸­æ˜¯sectionã€‚è€Œé“¾æŽ¥å™¨å°†å¤šä¸ª.oæ–‡ä»¶é“¾æŽ¥æˆä¸ºä¸€ä¸ªå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä¹Ÿå°±æ˜¯å¹³æ—¶çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è§ä¸‹å›¾: ç†Ÿæ‚‰ä¸€ä¸ªç¨‹åºçš„ç¬¬ä¸€æ­¥æ˜¯å…³æ³¨å…¶è¾“å…¥è¾“å‡ºã€‚ä¸€å¥è¯æ€»ç»“é“¾æŽ¥å™¨çš„åŠŸèƒ½:ä»¥ä¸€ç»„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶å’Œå‘½ä»¤è¡Œå‚æ•°ä½œä¸ºè¾“å…¥ï¼Œç”Ÿæˆä¸€ä¸ªå®Œå…¨é“¾æŽ¥çš„å¯ä»¥åŠ è½½å’Œè¿è¡Œçš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä½œä¸ºè¾“å‡ºã€‚ ç«™åœ¨æœºå™¨çš„è§’åº¦ï¼Œç¼–è¯‘å™¨å’Œæ±‡ç¼–å™¨å°†ASCIIæ ¼å¼çš„Cæ–‡ä»¶ç¼–è¯‘æˆä¸ºå­—èŠ‚å—sectionçš„é›†åˆï¼Œè€Œé“¾æŽ¥å™¨åšçš„å°±æ˜¯å°†ä¸åŒå¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ä¸­çš„å„ç§sectionsåšå½’ç±»ï¼Œç¡®å®šè¢«é“¾æŽ¥å—çš„è¿è¡Œæ—¶çš„å†…å­˜ä½ç½®ã€‚è¿™æ˜¯é‡ç‚¹ï¼Œç›®æ ‡æ–‡ä»¶çº¯ç²¹æ˜¯å­—èŠ‚å—çš„é›†åˆï¼Œè€Œé“¾æŽ¥å™¨æœ¬èº«å¯¹ç¨‹åºä¹Ÿæ‰€çŸ¥ç”šå°‘ï¼Œå¥¹åšçš„ä»…ä»…æ˜¯å¯¹å­—èŠ‚æ–‡ä»¶åšå¤„ç†ï¼Œå°†å¤šä¸ªæ–‡ä»¶çš„å­—èŠ‚å—æ”¾åˆ°äº†ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚ é“¾æŽ¥è¿‡ç¨‹ é“¾æŽ¥å™¨åšä¸¤ä»¶äº‹: * ç¬¦å·è§£æž: è¾“å…¥æ–‡ä»¶çš„ç¬¦å·å¼•ç”¨éƒ½å¯¹åº”åˆ°å…¶å®šä¹‰ä¸Šã€‚ * é‡å®šä½: ç¼–è¯‘å™¨å’Œæ±‡ç¼–å™¨ç”Ÿæˆçš„æ–‡ä»¶åœ°å€éƒ½æ˜¯ä»Ž0å¼€å§‹çš„ï¼Œå¹¶æ²¡æœ‰å’Œå†…å­˜æŒ‚ä¸Šå…³ç³»ã€‚è€Œé“¾æŽ¥å™¨å°†è¿™äº›ä¸åŒçš„sectionå®šä½åˆ°å†…å­˜ä¸­çš„ä¸€ä¸ªåœ°å€ã€‚ä¹Ÿå°±æ˜¯å…¶åŠ è½½åœ°å€ã€‚ é‡ç‚¹å…³æ³¨ç¬¬äºŒæ­¥é‡å®šä½ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯å°†å¤šä¸ªå¯é‡å®šä½æ–‡ä»¶ä¸­åŒç±»åž‹çš„.sectionåˆå¹¶ä¸ºä¸€ä¸ªå¤§çš„èšåˆèŠ‚ã€‚ä½†æ˜¯æ³¨æ„è¿™æ—¶å€™è¿˜æ²¡æœ‰segmentçš„æ¦‚å¿µ,èšåˆèŠ‚è¿˜æ˜¯å«åš.sectionã€‚æˆ‘æŸ¥é˜…äº†CSAPPçš„è‹±æ–‡ç‰ˆï¼Œå…¨ä¹¦ç¬¬ä¸€æ¬¡æåˆ°segment æ˜¯åœ¨é“¾æŽ¥å™¨éƒ¨åˆ†çš„æœ€æœ«å°¾ï¼Œä¹Ÿå°±æ˜¯è®²é‡å®šä½çš„æ—¶å€™ã€‚ä¸‹é¢æ˜¯åŽŸæ–‡: æ˜Žæ˜¾çœ‹åˆ°segmentè¿˜æ˜¯å†…å­˜çš„æ¦‚å¿µè€Œéžå¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„éƒ¨åˆ†ã€‚æ‰€ä»¥ä»Žå¤´åˆ°å°¾é“¾æŽ¥è¿‡ç¨‹éƒ½æ²¡æœ‰ç”Ÿæˆè¿‡segmentè¿™æ ·ä¸€ç§ä¸œè¥¿ï¼Œå…¶åªæ˜¯å¤šä¸ªsectionså¯¹åº”äºŽå†…å­˜ä¸­çš„æ˜ å°„ã€‚å…¨ä¹¦å¯¹é“¾æŽ¥éƒ¨åˆ†çš„è®²è§£ä¹Ÿå¾ˆå°‘æåŠsegmentï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹é“¾æŽ¥çš„ç†è§£æœ€å°å•ä½åº”è¯¥æ˜¯sectionï¼Œé“¾æŽ¥è¿‡ç¨‹å°±æ˜¯å¯¹sectionè¿›è¡Œæ“ä½œ;è€Œæœ€åŽé‡å®šä½çš„æ—¶å€™å°†å¤šä¸ªå¤§çš„sectionæ˜ å°„åˆ°ä¸€æ®µå†…å­˜ä¸­ï¼Œæ˜ å°„çš„å•ä½æ‰æ˜¯segmentã€‚çŽ°åœ¨çœ‹ä¸‹å›¾å°±å¾ˆæ¸…æ¥šäº†: ä»Žæ–‡ä»¶ç±»åž‹çš„è§’åº¦æ¥çœ‹: ç›®å‰æˆ‘ä»¬è°ˆåˆ°çš„ELFæ–‡ä»¶æœ‰å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶å’Œå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶å·¥å…·ELFæ–‡ä»¶è¿›è¡Œåˆ†æžã€‚å…³äºŽé“¾æŽ¥æ›´æœ¬è´¨çš„è¿‡ç¨‹è¿˜æ˜¯å¾ˆå¤æ‚çš„ï¼ŒLab1åŽé¢ä¼šæœ‰ä¸€éƒ¨åˆ†å’Œç¬¦å·è¡¨ç›¸å…³çš„å®žéªŒï¼Œå»ºè®®å…ˆè¯¦ç»†çœ‹çœ‹CSAPPå’Œä¸‹é¢æä¾›çš„èµ„æ–™ã€‚ * MIT----The definitive standard for the ELF format * Wikipedia----Executable and Linkable Format * ELFä¸­æ–‡æ–‡æ¡£----ELF.Ch ### äºŒè¿›åˆ¶åˆ†æžå·¥å…· 6.828ä¸­ä¸»è¦ä½¿ç”¨objdumpï¼ŒåŸºæœ¬å·¥å…·å¯ä»¥é€šè¿‡manæ¥æŸ¥çœ‹ç”¨æ³•ï¼Œè¿™é‡Œåˆ—å‡ºå‡ ä¸ªæœ€å¸¸è§çš„å‚æ•°ã€‚ Objdump å¯¹ç›®æ ‡æ–‡ä»¶è¿›è¡Œåˆ†æžï¼Œåœ¨Linuxå¹³å°ä¸Šæœ‰ä¸‰ç§object file:Relocatable object File,Executable object File,Shared object Fileï¼Œä¸€ç›´æ²¡æžæ‡‚ä¸ºå•¥éƒ½å«object Fileã€‚ä¸è¿‡å› ä¸ºè¿™ä¸‰ç§ç›®æ ‡æ–‡ä»¶å¯¹åº”äºŽé“¾æŽ¥çš„ä¸åŒé˜¶æ®µï¼Œæ‰€ä»¥å¯¹äºŽé“¾æŽ¥è¿‡ç¨‹æœ¬è´¨çš„ç†è§£ç›´æŽ¥å½±å“è¿™é‡Œä½¿ç”¨è¿™ä¸ªäºŒè¿›åˆ¶åˆ†æžå·¥å…·ã€‚ -f Display file headers -d Disassembly -h Section headers -x All headers -S Display source code Nm åˆ—å‡ºç›®æ ‡æ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨å†…å®¹ï¼Œåº”è¯¥å’Œé‡å®šä½å…³ç³»å¯†åˆ‡ã€‚ é˜…è¯»æºç CLIå·¥å…· è™½ç„¶æˆ‘æ˜¯Emacså…šï¼Œä½†æ˜¯ä¸å¾—ä¸æ‰¿è®¤VIMåœ¨è¿›è¡Œæ–‡æœ¬æ“ä½œçš„æ—¶å€™è¿˜æ˜¯æ›´æ–¹ä¾¿:)ä¸€äº›ã€‚ VIM-Ctags è¿™ä¸ªå°±å¾ˆå¼ºå¤§äº†ï¼Œç”¨äºŽåœ¨tagsæ–‡ä»¶æ‰€åœ¨çš„æ ¹ç›®å½•ä¸‹å¯»æ‰¾å‡½æ•°å£°æ˜Žå’Œå®å®šä¹‰ï¼Œåœ¨é˜…è¯»æºç çš„æ—¶å€™åŸºæœ¬ä¸Šä¸çŸ¥é“çš„å®šä¹‰å’Œå…³é”®å­—éƒ½å¯ä»¥ä½¿ç”¨Ctagsæ¥è¿›è¡Œå®šä½ï¼Œéžå¸¸å®žç”¨ã€‚ å®‰è£…æˆåŠŸä¹‹åŽï¼Œåœ¨å·¥ç¨‹ç›®å½•ä¸‹é¢æ‰§è¡Œå‘½ä»¤ctags -R *å¯¹å½“å‰ç›®å½•é€’å½’å»ºç«‹ç´¢å¼•ï¼Œä¼šç”Ÿæˆtagsæ–‡ä»¶ã€‚åœ¨æºç ä¸­é‡åˆ°æœªè§è¿‡çš„å‡½æ•°ä¾¿å°†å…‰æ ‡æ”¾åœ¨å…¶ä¸ŠCtrl - }å³å¯è·³è½¬åˆ°å…¶å£°æ˜Žçš„ä½ç½®ã€‚Ctrl - oè‡ªåŠ¨è¿”å›žã€‚ VIM_TagList è¿™ä¸ªå®žé™…ä¸Šæ²¡æ€Žä¹ˆç”¨ï¼ŒåŠŸèƒ½æ˜¯åœ¨VIMä¸­æ‰“å¼€ç›®å½•æ ‘ï¼Œä¾¿äºŽç¨‹åºå‘˜æ“ä½œã€‚å¯ä»¥å…ˆç•™ä¸‹æ¥ï¼Œè¿›ä¸€æ­¥è§‚å¯Ÿã€‚ Tmux è¿™åˆæ˜¯ä¸€ä¸ªç¥žå™¨ï¼Œç»ˆç«¯åˆ†å±åŠŸèƒ½å¼ºå¤§ï¼Œæœ‰window,pannelç­‰æ¦‚å¿µã€‚å’Œon-my-zshé…åˆä½¿ç”¨ç®€ç›´äº†ã€‚ä¸æ„¿æ„æŠ˜è…¾çš„è¯ä¹Ÿå¯ä»¥åœ¨bashä¸‹ç›´æŽ¥ä½¿ç”¨ã€‚æˆ‘ä»¬åœ¨GDBè°ƒè¯•OSçš„æ—¶å€™ä½¿ç”¨å¥¹ä½œä¸ºåˆ†å±å·¥å…·ï¼Œéœ€è¦åœ¨å®¶ç›®å½•ä¸‹åŠ å…¥é…ç½®æ–‡ä»¶~/.tmux.confã€‚ VimGrep ç”¨äºŽåœ¨æŒ‡å®šç›®å½•ä¸‹è¿›è¡Œå…¨å±€æœç´¢å¹¶åœ¨å¦ä¸€ä¸ªçª—å£æ‰“å¼€;å…³é”®å­—sample;åœ¨vimå‘½ä»¤æ¨¡å¼ä¸‹æ‰§è¡Œå‘½ä»¤ï¼› * :vim/sample/% | copen å½“å‰æ–‡ä»¶æœç´¢ * :vim/sample/* | copen å½“å‰ç›®å½•æœç´¢ * :vim/sample/ ../** | copen ä»Žä¸Šä¸€çº§ç›®å½•å¼€å§‹é€’å½’æœç´¢ * :vim/sample path1/** path2/** | copen å¤šè·¯å¾„æœç´¢ * : cclose å…³é—­å½“å‰æœç´¢]]></content>
      <categories>
        <category>C</category>
      </categories>
      <tags>
        <tag>MIT 6.828</tag>
        <tag>OS</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ±‡ç¼–è¯­è¨€ï¼ˆçŽ‹çˆ½ï¼‰ch5]]></title>
    <url>%2F2018%2F10%2F16%2F%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%EF%BC%88%E7%8E%8B%E7%88%BD%EF%BC%89ch5%2F</url>
    <content type="text"><![CDATA[ç¬¬äº”éƒ¨åˆ†:ä¸­æ–­II Abstract CPUå®žçŽ°I/OåŠŸèƒ½çš„ä¸¤ä¸ªé—®é¢˜:ä»Žä½•å¤„èŽ·å¾—å¤–è®¾çš„è¾“å…¥ï¼Ÿå¦‚ä½•è§£å†³å¤–è®¾è¾“å…¥éšæ—¶å¯èƒ½å‘ç”Ÿçš„é—®é¢˜ï¼Ÿé¦–å…ˆå¤–è®¾èŠ¯ç‰‡å†…éƒ¨æœ‰è‹¥å¹²å¯„å­˜å™¨ï¼ŒCPUå°†è¿™äº›å¯„å­˜å™¨å½“åšç«¯å£æ¥è®¿é—®ã€‚å¤–è®¾çš„è¾“å…¥è¾“å‡ºä¸ç›´æŽ¥é€å…¥CPUå’Œå†…å­˜è€Œæ˜¯é€šè¿‡è¿™äº›å¯„å­˜å™¨ã€‚ç¬¬äºŒï¼ŒCPUé€šè¿‡å¤–ä¸­æ–­æŽ§åˆ¶I/Oçš„éšæ—¶æ€§ã€‚ ç«¯å£ CPUå¯ä»¥ç›´æŽ¥è¯»å†™ä¸‰ä¸ªåœ°æ–¹çš„æ•°æ®: * å†…éƒ¨å¯„å­˜å™¨ * å†…å­˜å•å…ƒ * ç«¯å£ CPUé€šè¿‡ç«¯å£åœ°å€æ¥å®šä½ä¸åŒçš„ç«¯å£ï¼Œæœ€å¤šå¯ä»¥å®šä½64KBä¸ªç«¯å£ï¼Œåˆ™ç«¯å£åœ°å€èŒƒå›´ä¸º0~65535ã€‚ç«¯å£çš„è¯»å†™æŒ‡ä»¤inå’Œoutã€‚åªèƒ½ä½¿ç”¨alå’Œaxæ¥å­˜æ”¾å¯¹ç«¯å£è¿›è¡Œè¯»å†™çš„æ•°æ®ã€‚ å¤–ä¸­æ–­ å¤–ä¸­æ–­æ˜¯ç”±ç›¸å…³èŠ¯ç‰‡å‘é€ç»™CPUä¸­çš„ã€‚åˆ†ä¸ºå¯å±è”½ä¸­æ–­å’Œä¸å¯å±è”½ä¸­æ–­ã€‚ä¸å¯å±è”½ä¸­æ–­æŒ‡é‚£äº›CPUä¸€å®šéœ€è¦å“åº”çš„ä¸­æ–­ï¼Œè¿™ç§ä¸­æ–­å¾ˆå°‘ï¼Œä¸­æ–­ç±»åž‹ç å›ºå®šä¸º2ã€‚å¤§å¤šæ•°å¤–ä¸­æ–­æŒ‡çš„æ˜¯å¯å±è”½ä¸­æ–­ã€‚ CPUè¦ä¸è¦å“åº”å¯å±è”½ä¸­æ–­å®Œå…¨å–å†³äºŽçŠ¶æ€å¯„å­˜å™¨çš„IFä½ã€‚ä¸º1åˆ™å“åº”ï¼Œå¦åˆ™ä¸å“åº”ã€‚8086ä¸­æ‰‹åŠ¨è®¾ç½®IFçš„æŒ‡ä»¤: * sti:è®¾ç½®ä¸º1 * cli:è®¾ç½®ä¸º0 å®žéªŒ ç¼–å†™9å·ä¸­æ–­ä¾‹ç¨‹ PCæœºé”®ç›˜çš„å¤„ç†è¿‡ç¨‹ é”®ç›˜ä¸­æœ‰ä¸€ä¸ªèŠ¯ç‰‡æ‰«ææ¯ä¸€ä¸ªé”®çš„çŠ¶æ€â€”â€”æŒ‰ä¸‹è¿˜æ˜¯æ¾å¼€ã€‚æŒ‰ä¸‹äº§ç”Ÿä¸€ä¸ªæ‰«æç ç§°ä¸ºé€šç ï¼Œæ¾å¼€ä¹Ÿäº§ç”Ÿä¸€ä¸ªæ‰«æç ç§°ä¸ºæ–­ç ã€‚æ–­ç =é€šç +80hã€‚æ‰«æç è¢«é€åˆ°60hç«¯å£ä¸­ã€‚ int 9hæ˜¯BIOSæä¾›çš„ä¸å¯å±è”½ä¸­æ–­ã€‚ä¸€æ—¦CPUæ”¶åˆ°è¯¥ä¿¡å·: * è¯»å‡º60hç«¯å£çš„æ‰«æç  * å¦‚æžœæ˜¯å­—ç¬¦é”®çš„æ‰«æç ï¼Œå°†è¯¥æ‰«æç å’Œæ‰€å¯¹åº”çš„å­—ç¬¦ç é€å…¥å†…å­˜ä¸­çš„BIOSé”®ç›˜ç¼“å­˜åŒº(16ä¸ªå­—å•å…ƒ)ã€‚å¦‚æžœæ˜¯æŽ§åˆ¶é”®(Ctrl)å’Œåˆ‡æ¢é”®(CapsLock)çš„æ‰«æç ï¼Œåˆ™å°†å…¶è½¬å˜ä¸ºçŠ¶æ€å­—èŠ‚å†™è¿›å†…å­˜ä¸­å­˜å‚¨çŠ¶æ€å­—èŠ‚çš„å•å…ƒã€‚ * å¯¹é”®ç›˜ç³»ç»Ÿè¿›è¡Œç›¸å…³çš„æŽ§åˆ¶ã€‚ å®žéªŒ åœ¨å±å¹•ä¸­é—´ä¾æ¬¡æ˜¾ç¤º&quot;a&quot;~&quot;z&quot;,åœ¨æ˜¾ç¤ºçš„è¿‡ç¨‹ä¸­æŒ‰ä¸‹Escé”®åŽæ”¹å˜é¢œè‰²ã€‚ å®žéªŒæœ‰æ„æ€çš„åœ°æ–¹åœ¨äºŽ:å› ä¸ºé”®ç›˜ä¸Šæ‰€æœ‰çš„é”®éƒ½ä¼šè§¦å‘int 9hä¸­æ–­ï¼Œéœ€è¦åœ¨ä¿è¯å…¶ä»–é”®æ— æ•ˆçš„æƒ…å†µä¸‹ï¼ŒEscé”®è§¦å‘ä¸­æ–­â€”â€”â€”â€”å°±ç›¸å½“äºŽå‡ºçŽ°äº†ä¸¤ä¸ªä¸­æ–­ä¾‹ç¨‹ï¼Œä¸¤ä¸ªä¸­æ–­å‘é‡ã€‚æ›´æœ‰è¶£çš„æ˜¯éœ€è¦è¿™ä¸¤ä¸ªä¸­æ–­åŒæ—¶æœ‰æ•ˆï¼Œåœ¨ä¸€ä¸ªint 9hä¸­æ–­ä¸‹ï¼ æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯ä½¿ç”¨if_elseåˆ¤æ–­æ‰«æç ã€‚å½“ç„¶æ±‡ç¼–ä¸­æ²¡æœ‰if_elseã€‚ ä¸­æ–­å‘é‡å’Œä¸­æ–­ä¾‹ç¨‹ é”®ç›˜æ— è®ºæ˜¯å“ªä¸€ä¸ªé”®å½“ç„¶åªä¼šè§¦å‘int 9hä¸­æ–­è¿™ä¸ªä¸ä¼šå˜ã€‚ä¸è¿‡å¾—åˆ†åˆ«å†™ä¾‹ç¨‹: 12345678910111213141516171819202122232425262728assume cs:code stack segment db 128 dup (0) stack ends data segment dw 0,0 data ends code segment start: mov ax,stack mov ss,ax mov sp,128 mov ax,data mov ds,ax mov ax,0 mov es,ax push es:[9*4] pop ds:[0] push es:[9*4+2] pop ds:[2] mov word ptr es:[9*4],offset int 9 mov es:[9*4+2],cs ä¸Šé¢çš„ä»£ç ä¸»è¦å°±æ˜¯è®¾ç½®äº†ä¸­æ–­å‘é‡è¡¨ã€‚å¯ä»¥çœ‹åˆ°è®²åŽŸæ¥çš„int 9hä¸­æ–­ä¾‹ç¨‹åœ°å€ä¿å­˜åœ¨ds:0,ds:2åœ°å€å¤„ï¼Œæ¢ä¸Šæ–°çš„ä¾‹ç¨‹åœ°å€cs:(offset int 9)ã€‚æ–°çš„ä¾‹ç¨‹ä»£ç : 12345678910111213141516171819202122int9: push ax push bx push es in al,60h pushf call dword ptr ds:[0] ;è¿™é‡Œçš„å®žé™…ä¸Šæ¨¡æ‹Ÿäº†int 9ä¸­æ–­ä¾‹ç¨‹çš„åŠŸèƒ½ï¼Œå®žçŽ°å­ç¨‹åºä¸­çš„è°ƒç”¨ cmp al,1 jne int9ret ;ä¸‹é¢æ˜¯Escä¾‹ç¨‹ä»£ç  mov ax,0b800h mov es,ax inc byte ptr es:[160*12+40*2+1] ;æ”¹å˜å±žæ€§å€¼ï¼Œæ”¹å˜é¢œè‰²int9ret:pop es pop bx pop ax iret å…¶ä¸­cmp al,1å’Œjne int9retå°±ç›¸å½“äºŽif_elseçš„åŠŸèƒ½ã€‚åœ¨ä¸»ç¨‹åºä¸­æœ‰äº†æ ˆï¼Œæ ˆåœ¨ä¸­æ–­ä¾‹ç¨‹ä¸­çš„ä¸»è¦ä½œç”¨å°±æ˜¯ä¿æŠ¤çŽ°åœºï¼Œåˆ†æžä¸€ä¸‹: * éœ€è¦ä¿æŠ¤æœ€å¼€å§‹çš„int 9hçš„ä¸­æ–­å‘é‡å· * å› ä¸ºåœ¨æ˜¾ç¤ºå­—ç¬¦çš„ä¸»ç¨‹åºä¸­ï¼Œax,es,bxéƒ½ä¿å­˜äº†é‡è¦çš„ä¸­é—´å‚æ•°ï¼Œæ‰€ä»¥éœ€è¦ä¿æŠ¤ é™¤æ­¤ä¹‹å¤–,æ ˆå¹¶æ²¡æœ‰èµ·åˆ°ä»€ä¹ˆä½œç”¨ã€‚è¿™æ ·çœ‹ä¸‹æ¥å…¶å®žæºç¨‹åºä¹Ÿç®€å•äº†ä¸å°‘ã€‚]]></content>
      <categories>
        <category>Assembly</category>
      </categories>
      <tags>
        <tag>i386</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ±‡ç¼–è¯­è¨€ï¼ˆçŽ‹çˆ½ï¼‰ch4]]></title>
    <url>%2F2018%2F10%2F12%2F%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%EF%BC%88%E7%8E%8B%E7%88%BD%EF%BC%89ch4%2F</url>
    <content type="text"><![CDATA[ç¬¬å››éƒ¨åˆ†:ä¸­æ–­I Abstract åœ¨ä¹‹å‰çš„å®žéªŒä¸­ï¼Œæˆ‘ä»¬æ‰€ç¼–å†™çš„æ±‡ç¼–ç¨‹åºä»Žç¼–è¯‘åˆ°è¿è¡Œå‡ºç»“æžœéƒ½å¾ˆé¡ºåˆ©ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜ å°„åˆ°CPUå±‚é¢å°±æ˜¯CS:IPçš„è·³è½¬å”¯ä¸€å–å†³äºŽæ±‡ç¼–ç¨‹åºå‘˜çš„ä»£ç ã€‚CSAPPå°†è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºç¨‹åºæŽ§åˆ¶æµã€‚è€Œä¸­æ–­åˆ™æ˜¯å°†è¿™ç§æµç¨‹æ‰“æ–­ï¼Œå»ºç«‹æ›´å¤æ‚çš„å¼‚å¸¸æŽ§åˆ¶æµã€‚ä¸­æ–­åˆ†ä¸ºå†…ä¸­æ–­å’Œå¤–ä¸­æ–­ä¸¤ç§ã€‚ å†…ä¸­æ–­ ä¸­æ–­äº§ç”Ÿ 8086CPUä½¿ç”¨ä¸­æ–­ç±»åž‹ç æ¥æ ‡è¯†ä¸­æ–­ä¿¡æ¯çš„æ¥æºã€‚ä¸­æ–­ç±»åž‹ç ä¸ºä¸€ä¸ªå­—èŠ‚åž‹æ•°æ®ï¼Œå¯ä»¥è¡¨ç¤º256ç§ä¸­æ–­ä¿¡æ¯çš„æ¥æºâ€”â€”â€”â€”å…·ä½“æŒ‡çš„æ˜¯äº§ç”Ÿä¸­æ–­ä¿¡æ¯çš„äº‹ä»¶ï¼Œç®€ç§°ä¸­æ–­æºã€‚ä¸‹é¢æ˜¯8086ä¸­4ç§å¸¸è§çš„ä¸­æ–­æºåŠå…¶ä¸­æ–­ç±»åž‹ç : * é™¤æ³•é”™è¯¯: 0 * å•æ­¥æ‰§è¡Œ: 1 * æ‰§è¡ŒintoæŒ‡ä»¤: 4 * æ‰§è¡Œint næŒ‡ä»¤: n ä¸­æ–­è¿‡ç¨‹ CPUèŽ·å¾—ä¸­æ–­ç±»åž‹ç ä¹‹åŽï¼Œéœ€è¦è·³è½¬åˆ°è¯¥ä¸­æ–­ç±»åž‹ç å¯¹åº”çš„ä¸­æ–­å¤„ç†ç¨‹åºä¸­è¿›è¡Œå¤„ç†ã€‚å¦‚ä½•è·³è½¬å‘¢ï¼Ÿä½¿ç”¨ä¸­æ–­å‘é‡è¡¨ã€‚è€Œè·³è½¬é€šå¸¸æ„å‘³ç€æ”¹å˜CPUçš„çŠ¶æ€ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨æ ˆæ¥ä¿å­˜çŽ°åœºã€‚æ‰€ä»¥è¯†åˆ«ï¼Œä¿å­˜å’Œè·³è½¬å°±æ˜¯ä¸­æ–­è¿‡ç¨‹ä¸»è¦å¹²çš„äº‹å„¿â€”â€”â€”â€”å…¶ä¸­è¯†åˆ«ç”±ç¡¬ä»¶å®Œæˆï¼ ä¸­æ–­å‘é‡è¡¨ä¿å­˜åœ¨å†…å­˜0000:0000åˆ°0000:03FFçš„è¿™1KBå•å…ƒé‡Œã€‚ä¸€ä¸ªè¡¨é¡¹å­˜æ”¾ä¸€ä¸ªä¸­æ–­å‘é‡â€”â€”â€”â€”ä¹Ÿå°±æ˜¯ä¸­æ–­å¤„ç†ç¨‹åºçš„åœ°å€å…¥å£ã€‚å 4ä¸ªå­—èŠ‚ï¼Œé«˜åœ°å€æ”¾æ®µåœ°å€ï¼Œä½Žåœ°å€æ”¾åç§»åœ°å€ã€‚ ##### è¯†åˆ« ä¸‹å›¾æ˜¯ä¸€å¼ 8086çš„å†…å­˜åˆ†å¸ƒå›¾: ä»Žå†…å­˜0å¼€å§‹ï¼Œæ‰€ä»¥å­˜å‚¨Nå·ä¸­æ–­æºå¯¹åº”çš„ä¸­æ–­å‘é‡çš„åç§»åœ°å€çš„å†…å­˜åœ°å€ä¸º:0000:4Nï¼Œå­˜å‚¨Nå·ä¸­æ–­æºå¯¹åº”çš„ä¸­æ–­å‘é‡çš„æ®µåœ°å€çš„å†…å­˜åœ°å€ä¸º:0000ï¼š4N+2ã€‚çœ‹ä¸‹å›¾: è·³è½¬å’Œä¿å­˜ èŽ·å¾—ä¸­æ–­ç±»åž‹ç  æ ‡å¿—å¯„å­˜å™¨çš„å€¼å…¥æ ˆ: pushf è®¾ç½®æ ‡å¿—å¯„å­˜å™¨ç¬¬8ä½TFå’Œç¬¬9ä½IFçš„å€¼ä½0: TF=0,IF=0 CSçš„å†…å®¹å…¥æ ˆ: push CS IPçš„å†…å®¹å…¥æ ˆ: push IP é€šè¿‡ä¸­æ–­ç±»åž‹ç èŽ·å–å…¥å£åœ°å€: (IP)=(N*4),(CS)=(N*4+2) æœ€åŽä¸€æ­¥æ‰§è¡Œç»“æŸåŽï¼ŒCPUå¼€å§‹æ‰§è¡Œç”±ç¨‹åºå‘˜ç¼–å†™çš„ä¸­æ–­å¤„ç†ç¨‹åº ä¸­æ–­å¤„ç† æ‰€è°“ä¸­æ–­å¤„ç†ç¨‹åºå°±æ˜¯æ“ä½œç³»ç»Ÿå¯¹å„ç§ä¸­æ–­çš„ååº”ã€‚ ç”±äºŽCPUéšæ—¶å¯èƒ½æ£€æµ‹åˆ°ä¸­æ–­ï¼Œæ‰€ä»¥ä¸­æ–­å¤„ç†ç¨‹åºå¿…é¡»ä¸€ç›´å­˜å‚¨åœ¨å†…å­˜æŸæ®µç©ºé—´ä¸­ã€‚ä¸‹é¢çš„å®žéªŒå°±æ˜¯é€šè¿‡æ¥å®žçŽ°å†…ä¸­æ–­å¤„ç†ç¨‹åºã€‚ ##### 0å·ä¸­æ–­ å³é™¤æ³•æº¢å‡ºé”™è¯¯ã€‚ 123mov ax, 1000hmov bh,1div bh è¯¥é™¤æ³•æŒ‡ä»¤åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿæº¢å‡ºé”™è¯¯ï¼Œå¯¼è‡´äº§ç”Ÿ0å·ä¸­æ–­ä»Žè€Œå¼•å‘ä¸­æ–­è¿‡ç¨‹ã€‚ å®žéªŒ ç¼–å†™0å·ä¸­æ–­çš„å¤„ç†ç¨‹åº ä¸­æ–­ç±»åž‹ç :0 ä¸­æ–­å¤„ç†ç¨‹åº: é€‰æ‹©0000ï¼š0200åˆ°0000ï¼š02ffè¿™256ä¸ªByteså†…å­˜çš„åŒºåŸŸæ¥å­˜æ”¾ ä¸­æ–­å‘é‡è¡¨: 0å·ä¸­æ–­çš„æ®µåœ°å€0000:0002åç§»åœ°å€0000:0000 ##### å®‰è£…å¤„ç†ç¨‹åºdo0 &gt; å¾—ç¡®ä¿ä¸­æ–­å¤„ç†ç¨‹åºä¸ä¼šå˜åŠ¨ï¼Œæ‰€ä»¥é€‰æ‹©ä¸€å—åˆé€‚çš„å†…å­˜åŒºåŸŸå°†å…¶å®‰è£…è¿›åŽ»ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546 assume cs:code code segment start: mov ax,cs mov ds,ax mov si,offset do0 ;è®¾ç½®ds:siæŒ‡å‘è¢«æ‹·è´çš„ç¨‹åºåœ°å€ mov ax,0 mov es,ax ;è®¾ç½®es:diæŒ‡å‘æ‹·è´çš„ç›®çš„åœ°å€ mov di,200h mov cx,offset do0end-offset do0 ;è®¾ç½®éœ€è¦æ‹·è´çš„ä»£ç é•¿åº¦åº¦ cld ;è®¾ç½®ä¼ è¾“æ–¹å‘ä¸ºæ­£ rep movsb /* è®¾ç½®ä¸­æ–­å‘é‡è¡¨ */ mov ax, 4c00h int 21h do0: jmp short do0start db &quot;overflow!&quot; do0start: mov ax,cs mov ds,ax mov si,200h ;è®¾ç½®ds:siæŒ‡å‘å­—ç¬¦ä¸² mov ax,0b800h mov es,ax mov di,12*160+36*2 ;è®¾ç½®es:diæŒ‡å‘æ˜¾å­˜ç©ºé—´çš„ä¸­é—´ä½ç½® mov cx,9 ;å­—ç¬¦ä¸²çš„é•¿åº¦ s: mov al,[si] mov es:[di],al inc si add di,2 loop s mov ax,4c00h int 21h do0end: nop code ends end start è®¾ç½®ä¸­æ–­å‘é‡å· å½“ä¸­æ–­å‘ç”Ÿçš„æ—¶å€™ï¼Œç¡®ä¿0å·ä¸­æ–­çš„å¤„ç†ç¨‹åºè·³è½¬åœ°å€æ˜¯ä¸Šä¸€ä¸ªè®¾ç½®å¥½çš„åœ°å€ã€‚ 1234mov ax,0mov es,axmov word ptr es:[0*4],200hmov word ptr es:[0*4+2], 0 éªŒè¯ æ³¨æ„ï¼Œåœ¨è·³è½¬åˆ°ä¸­æ–­å¤„ç†ç¨‹åºä¹‹å‰ï¼Œæ‰€æœ‰çš„CPUçŽ°åœºå·²ç»å…¥æ ˆä¿å­˜å¥½äº†ï¼Œè€Œè·³è½¬è¿‡ç¨‹æœ¬èº«ä¹Ÿæ˜¯ç¡¬ä»¶è¿‡ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰€åšçš„ä»…ä»…åªæ˜¯è®¾ç½®å¥½è·³è½¬çš„åœ°å€å’Œè¯¥åœ°å€ç›¸åº”çš„å¤„ç†ä»£ç ã€‚ ç»è¿‡å®žéªŒå‘çŽ°DOSBoxçš„å’Œä¼ ç»Ÿçš„DOSè¿˜æ˜¯æœ‰ä¸€äº›åŒºåˆ«çš„ï¼Œè¿™é‡Œç”¨ä¸€ä¸ªå°å®žéªŒéªŒè¯ä¸­æ–­:é¦–å…ˆæˆ‘ä»¬ç›´æŽ¥åœ¨debugä¸‹é¢å°†0å·ä¸­æ–­å‘é‡å·æ”¹å†™æˆä¸º0000:0200å¤„ï¼Œç„¶åŽåœ¨å¦ä¸€å—å†…å­˜0200:0000ä¸­å†™è¿›äº†ä¼šå¼•å‘0å·ä¸­æ–­çš„ä»£ç : ç„¶åŽä¿®æ”¹å¥½äº†CS:IPåœ°å€å¹¶å¼€å§‹æ‰§è¡Œ: ###### çŽ°è±¡ å•æ­¥æ‰§è¡Œ,å¯ä»¥çœ‹åˆ°CS:IPçš„å€¼åœ¨æ‰§è¡Œåˆ°div bhçš„æ—¶å€™ï¼Œç«‹é©¬ä»Ž0200:0005å˜æˆäº†0000:0002!,æˆ‘å†™çš„ä¸­æ–­å¤„ç†mov cx,ffffä¹Ÿè¢«æ‰§è¡Œï¼ç„¶åŽä¸€ç›´æ‰§è¡Œåˆ°ç»“æŸé€€å‡ºã€‚ å®žéªŒçš„æ•´ä¸ªè¿‡ç¨‹å®žé™…ä¸Šå°±æ˜¯åšäº†ä¸€ä¸ªè·³è½¬ï¼Œç„¶åŽæˆ‘ä»¬ä»”ç»†å¯¹æ¯”ä¸€ä¸‹è·³è½¬å‰åŽå¯„å­˜å™¨å€¼çš„å·®è·:ä¼šå‘çŽ°é™¤äº†CS:IPæœ‰å˜åŒ–ä¹‹å¤–ï¼ŒSS:SPå¤§å°ä¹Ÿæœ‰å˜åŒ–ï¼Œè¿™æ˜¯CPUä¿å­˜çŽ°åœºçš„ç¼˜æ•…â€”â€”â€”â€”ä»Ž00F7åˆ°00FDå…±3ä¸ªå­—å¯¹åº”CSï¼ŒIPå’ŒTFï¼›è€Œä¸”çŠ¶æ€å¯„å­˜å™¨EIä¹Ÿå˜ä¸ºDI,ä¼°è®¡ä¹Ÿå’ŒTFå’ŒIFç›¸å…³;å› ä¸ºæˆ‘ä»¬çš„ä¸­æ–­å¤„ç†ç›´æŽ¥é€€å‡ºç¨‹åºæ‰€ä»¥æ ˆä¸­çš„æ•°æ®æ²¡æœ‰æ´¾ä¸Šç”¨åœºï¼Œä¸è¿‡å¦‚æžœéœ€è¦è¿”å›žæºç¨‹åºåšä¸€äº›æ“ä½œçš„æ—¶å€™æ ˆå°±ä¼šèµ·åˆ°æ¢å¤çš„ä½œç”¨ã€‚æˆ‘è¿˜å°è¯•è¿‡åœ¨ä¸­æ–­äº§ç”Ÿçš„æ—¶å€™æŸ¥çœ‹æ ˆä¸­çš„å†…å®¹ï¼Œä½†æ˜¯æ¯æ¬¡æŒ‡ä»¤åˆšæ‰§è¡Œå°±è¢«å¼ºåˆ¶é€€å‡ºâ€¦â€¦ä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚ä¸è¿‡è¿™æ˜¯ä¸‹ä¸€ä¸ªå®žéªŒçš„å†…å®¹äº†ã€‚å¦å¤–ï¼Œè¿™é‡Œå¯ä»¥å›žè¿‡å¤´çœ‹ä¸€ä¸‹ch2ä¸­å…³äºŽæ ˆçš„é‚£ä¸ªçŒœæµ‹ï¼ŒåŸºæœ¬ä¸Šæ²¡æœ‰æ¯›ç—…ã€‚ 1å·ä¸­æ–­ åœ¨CPUä¿å­˜çŽ°åœºçš„æ—¶å€™ï¼Œå¯¹çŠ¶æ€å¯„å­˜å™¨åŽ‹æ ˆï¼Œå¹¶ä¸”å°†å…¶ä¸­ä¸¤ä¸ªçŠ¶æ€ä½è®¾ç½®ä¸ºé›¶:TF=0;IF=0;ä¸»è¦æ˜¯å› ä¸ºå½“CPUæ¯æ‰§è¡Œå®Œä¸€æ¡æŒ‡ä»¤çš„æ—¶å€™ï¼Œå°±ä¼šåŽ»æŸ¥çœ‹çŠ¶æ€å¯„å­˜å™¨çš„TFä½æ˜¯å¦ä¸º1ï¼Œå¦‚æžœæ˜¯åˆ™å¼•å‘1å·ä¸­æ–­â€”â€”â€”â€”å•æ­¥ä¸­æ–­ã€‚æ•´ä¸ªä¸­æ–­çš„è¿‡ç¨‹å’Œå…¶ä»–çš„æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œä½œè€…æåˆ°debug -tçš„å•æ­¥æ‰§è¡ŒåŠŸèƒ½ï¼Œå®žé™…ä¸Šå°±æ˜¯é€šè¿‡debugè°ƒç”¨1å·ä¸­æ–­å¯¹CPUè¿›è¡ŒæŽ§åˆ¶ã€‚è¿™é‡Œçš„æŽ§åˆ¶ä¸»è¦ä½“çŽ°åœ¨ä¸­æ–­å¤„ç†ç¨‹åºä¸Šâ€”â€”â€”â€”æ¯”å¦‚debug -tå°±æ˜¯è®¾ç½®å¯„å­˜å™¨çš„å€¼æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚é‚£ä¸ºä»€ä¹ˆè¦åœ¨å¤„ç†ä¹‹å‰åˆå°†TFè®¾ç½®ä¸ºé›¶å‘¢ï¼Ÿæ³¨æ„å‰é¢çš„æ¯æ‰§è¡Œå®Œä¸€æ¡æŒ‡ä»¤çš„æ„æ€ï¼ŒCPUåœ¨æ‰§è¡Œä¸­æ–­å¤„ç†ç¨‹åºçš„æ—¶å€™æ˜¯ä¸èƒ½å“åº”å…¶ä»–ä¸­æ–­çš„ï¼ŒTF=0æ˜¯é˜²æ­¢åœ¨è¿‡ç¨‹ä¸­é€’å½’çš„é™·å…¥ã€‚ ä½†æ˜¯åœ¨æœ‰äº›ç‰¹æ®Šæƒ…å†µä¸‹ä¸­æ–­çš„äº§ç”Ÿï¼ŒCPUä¸è§å¾—é©¬ä¸Šå¤„ç†ã€‚æ¯”å¦‚mov ss, axå’ŒMOV sp, 10è¿™ä¸¤æ¡è®¾ç½®å †æ ˆçš„æŒ‡ä»¤ï¼Œåœ¨å‰é¢çš„å®žéªŒä¸­å‡ºçŽ°è¿‡ã€‚ int æŒ‡ä»¤ ä¸­æ–­ä¾‹ç¨‹ int næ˜¯ä¸€ç§å¾ˆé‡è¦çš„å†…ä¸­æ–­ã€‚næ˜¯ä¸­æ–­ç±»åž‹ç ï¼Œè¯¥æ¡æŒ‡ä»¤åŠŸèƒ½å°±æ˜¯å¯ä»¥å¼•å‘ä¸­æ–­è¿‡ç¨‹ã€‚æ‰§è¡Œå¦‚ä¸‹: * å–ç»ˆç«¯ç±»åž‹ç n * æ ‡å¿—å¯„å­˜å™¨å…¥æ ˆï¼ŒIF=0,TF=0 * push cs,push ip * (IP)=(n4),(CS)=(n4+2) æ³¨æ„ä¸€ä¸‹è¿™é‡Œçš„åŽ‹æ ˆé¡ºåºï¼ŒåŽé¢çš„å®žéªŒä¸­ä¼šæœ‰ç”¨åˆ°ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¼šå°†ä¸€äº›å…·æœ‰ä¸€å®šåŠŸèƒ½çš„å­ç¨‹åºï¼Œä»¥ä¸­æ–­å¤„ç†ç¨‹åºçš„æ–¹å¼æä¾›ç»™åº”ç”¨ç¨‹åºè°ƒç”¨ï¼Œé€šå¸¸å°±æ˜¯ä½¿ç”¨intæŒ‡ä»¤ã€‚å°†è¿™äº›è‡ªå·±ç¼–å†™çš„ä¸­æ–­å¤„ç†ç¨‹åºå«åšä¸­æ–­ä¾‹ç¨‹ã€‚ ç¼–å†™loopä¸­æ–­ä¾‹ç¨‹ åœ¨å±å¹•ä¸­é—´æ˜¾ç¤º80ä¸ªâ€œï¼â€ã€‚ è¿™ä¸ªç¨‹åºä¸€çœ‹å°±çŸ¥é“éœ€è¦ä½¿ç”¨åˆ°loopæŒ‡ä»¤ï¼Œä½†æ˜¯è¯¥æŒ‡ä»¤åˆ°åº•æ˜¯å¦‚ä½•å®žçŽ°çš„å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“è·³è½¬æŒ‡ä»¤å®žé™…ä¸Šå°±æ˜¯æ”¹å˜CS:IPçš„å€¼ï¼Œè€Œç»™å®šæ¬¡æ•°çš„è·³è½¬å’Œç»™å®šç›®æ ‡çš„è·³è½¬åˆåœ¨ä¸€èµ·å°±ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚ è·³è½¬æŒ‡ä»¤æ˜¯é ä¸¤ä¸ªæ ‡å·ä¹‹é—´çš„ç›¸å¯¹ä½ç§»è€Œä¸æ˜¯é æ ‡å·çš„åœ°å€è¿™ä¸€ç‚¹å¾ˆé‡è¦ã€‚æˆ‘ä»¬ç”¨cxå­˜æ”¾å¾ªçŽ¯æ¬¡æ•°ï¼Œç”¨bxå­˜æ”¾ç›¸å¯¹ä½ç§»ã€‚å…ˆçœ‹ä¸€ä¸‹ä¾‹ç¨‹ä»£ç : 123456789101112131415161718192021assume cs:codecode segment start:mov ax,0b800h mov es,ax mov di,160*12 mov bx,offset s-offset se mov cx,80s: mov byte ptr es:[di],&apos;!&apos; add di,2 /* int 7chä¾‹ç¨‹ä»£ç :å¦‚æžœï¼ˆcxï¼‰!=0,è·³è½¬åˆ°æ ‡å·så¤„ */se: nop mov ax,4c00 int 21h code endsend start è‡³æ­¤ï¼Œåº”è¯¥å·²ç»å®Œå…¨å¯ä»¥çœ‹æ‡‚è¿™äº›æ±‡ç¼–ç¨‹åºã€‚å¯æ˜¯æ ¸å¿ƒçš„åŠŸèƒ½å‘¢ï¼Ÿå¦‚ä¸‹: è·³è½¬åˆ°æ ‡å·så¤„éœ€è¦çŸ¥é“sçš„æ®µåœ°å€å’Œåç§»åœ°å€ã€‚å…ˆæ¥åˆ†æžä¸€ä¸‹åœ¨æ‰§è¡Œint 7chä¹‹åŽå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿç”»å¾—ä¸å¥½å‡‘æ´»ç€çœ‹å§:) x86ä¸­çš„æ ˆæ˜¯ä¸€ä¸ªæ»¡å †æ ˆã€‚é¦–å…ˆæ ‡å¿—å¯„å­˜å™¨å…¥æ ˆï¼Œç„¶åŽå¯¹seæ ‡å·çš„CS:IPåŽ‹æ ˆã€‚å› ä¸ºä»£ç åªæœ‰ä¸€ä¸ªæ®µï¼Œæ‰€ä»¥seçš„æ®µåœ°å€å’Œsçš„æ®µåœ°å€ä¸€æ ·ã€‚è€Œbxä¸­å­˜å‚¨äº†s-seï¼Œæ‰€ä»¥å¯¹äºŽsæ¥è¯´:bx+seå°±æ˜¯å®ƒè‡ªå·±çš„åç§»é‡ã€‚è€Œseçš„åç§»é‡å°±æ˜¯æ ˆä¸­çš„IPã€‚æ‰€ä»¥æ€è·¯é¡ºä¸‹æ¥äº†ã€‚å¯ä»¥å†™ä»£ç äº†ã€‚ 1234567lp: push bp mov bp,sp dec cx ;cx-- jcxz lpret ;if(cx=0) (cs:ip)=lpret add [bp+2],bx ;é‡ç‚¹lpret: pop bp iret ä¸Šè¿°ä»£ç ä¸­add [bp+2],bxå°±æ˜¯å‰é¢åˆšé¡ºä¸‹æ¥çš„ç®—æ³•å®žçŽ°ã€‚å°†æ ˆä¸­çš„IPä¿®æ”¹ç§°ä¸ºsçš„åç§»åœ°å€ã€‚è¿™é‡Œçš„é‡ç‚¹æ˜¯iretæŒ‡ä»¤ï¼Œè¿™ä¸ªæŒ‡ä»¤å’Œè·³è½¬æŒ‡ä»¤ç»å¸¸ç»„åˆåœ¨ä¸€èµ·å…±åŒä½¿ç”¨ï¼Œç›¸å½“äºŽpop ip,pop cs,popfè¿™ä¸‰æ¡æŒ‡ä»¤çš„å’Œã€‚ä¸Šè¿°ä»£ç å°±æ˜¯åœ¨æ ˆä¸­ä¿®æ”¹å¥½CS:IPçš„å€¼ï¼Œç„¶åŽä½¿ç”¨iretå‡ºæ ˆæ‰§è¡Œã€‚ ç»“æžœ æœ¬æ¬¡å®žéªŒçš„è¿‡ç¨‹å®žé™…ä¸Šå°±æ˜¯åˆ†ä¸ºä¸¤éƒ¨åˆ†:å®‰è£…ä¾‹ç¨‹å’Œæ‰§è¡Œä¾‹ç¨‹ã€‚ ###### å®‰è£…ä¾‹ç¨‹ å¯¹äºŽ7chä¸­æ–­ç±»åž‹ç æ¥è¯´ï¼Œå¯¹åº”çš„ä¸­æ–­ä¾‹ç¨‹åœ°å€åº”è¯¥åœ¨0000:01f0ã€‚æˆ‘ä»¬é¦–å…ˆå°†ä¸­æ–­ä¾‹ç¨‹å†™è¿›è¯¥åœ°å€ï¼Œç„¶åŽä¿®æ”¹ä¸­æ–­å‘é‡è¡¨é¡¹ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738assume cs:code code segmentstart: mov ax,cs mov ds,ax mov si,offset do0 mov ax,0 mov es,ax mov di,200h mov cx,offset do0end-offset do0 ;å°†ä¸­æ–­ä¾‹ç¨‹å†™è¿›å¯¹åº”çš„åœ°å€ä¸­ cld rep movsb mov ax,0 ;è¿™4è¡Œä»£ç ä¿®æ”¹ä¸­æ–­å‘é‡è¡¨ mov es,ax mov word ptr es:[7ch*4],200h mov word ptr es:[7ch*4+2],0 mov ax,4c00h int 21hdo0: ;è¿™æ˜¯ä¸­æ–­ä¾‹ç¨‹ push bp mov bp,sp dec cx jcxz lpret add [bp+2],bxlpret: pop bp iret do0end: nop code endsend start æˆ‘ä»¬å°†ä¸Šè¿°ä»£ç ä¿å­˜ä¸ºsample.asmç„¶åŽç¼–è¯‘è¿žæŽ¥ã€‚ç„¶åŽæ‰§è¡Œsample.exe: ä¸Šå›¾åˆ†åˆ«æ˜¯åœ°å€0000:0200å¤„çš„ä¸­æ–­ä¾‹ç¨‹ï¼Œå’Œ0000:01f0å¤„çš„ä¸­æ–­å‘é‡è¡¨ã€‚å¯ä»¥çœ‹åˆ°æˆåŠŸå†™å…¥å†…å­˜ã€‚ æ‰§è¡Œä¾‹ç¨‹ æ‰§è¡Œç¨‹åºå°±æ˜¯è°ƒç”¨int 7chè¿™ä¸ªä¾‹ç¨‹çœ‹æ˜¯å¦æœ‰æ•ˆã€‚æˆ‘ä»¬å°†æ‰§è¡Œç¨‹åºä¿å­˜ä¸ºdemo.asmç¼–è¯‘è¿žæŽ¥ã€‚ 12345678910111213141516171819assume cs:codecode segmentstart: mov ax,0b800h mov es,ax mov di,160*12 ;ç¡®å®šæ˜¾å­˜çš„åœ°å€ mov bx,offset s-offset se mov cx,80s: mov byte ptr es:[di],&apos;!&apos; add di,2 int 7ch ;åœ¨è¿™é‡ŒintæŒ‡ä»¤å……å½“äº†loopçš„åŠŸèƒ½se: nop mov ax,4c00h int 21h code endsend start ç„¶åŽæ‰§è¡Œdemo.exe,çœ‹çŽ°è±¡: æ€»ç»“ è¿™æ˜¯æœ€ç®€å•çš„ä¸€ä¸ªä¾‹ç¨‹ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥å› æ­¤å¾—çŸ¥è·³è½¬æŒ‡ä»¤å’Œæ ˆçš„é‡è¦æ€§! BIOSå’ŒDOSæ‰€æä¾›çš„ä¸­æ–­ä¾‹ç¨‹ å…³äºŽBIOSå’ŒDOSå·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œä»Žè®¡ç®—æœºåŠ ç”µå¼€å§‹ï¼ŒCS:IPä¼šè‡ªåŠ¨è·³è½¬åˆ°ffff:0000çš„åœ°å€æ‰§è¡Œç¨‹åºï¼Œåˆ°åº•æ‰§è¡Œçš„æ˜¯å•¥ï¼Ÿæœ‰ä¸¤å¤§éƒ¨åˆ†:è‡ªæ£€ç¨‹åºå’Œåˆå§‹åŒ–ç¨‹åºã€‚åˆå§‹åŒ–ç¨‹åºå°†å»ºç«‹BIOSæ‰€æ”¯æŒçš„ä¸­æ–­å‘é‡ã€‚BIOSä¸­çš„ä¸­æ–­ä¾‹ç¨‹ä¸»è¦æœ‰: * å¤–éƒ¨ä¸­æ–­å’Œå†…éƒ¨ä¸­æ–­çš„ä¸­æ–­ä¾‹ç¨‹ * ç”¨äºŽå¯¹ç¡¬ä»¶è®¾å¤‡è¿›è¡ŒI/Oæ“ä½œçš„ä¸­æ–­ä¾‹ç¨‹ * å…¶ä»–å’Œç¡¬ä»¶ç³»ç»Ÿç›¸å…³çš„ä¸­æ–­ä¾‹ç¨‹ è‡ªæ£€å’Œåˆå§‹åŒ–å®Œæˆä¹‹åŽï¼Œè°ƒç”¨int 19hè¿›è¡Œæ“ä½œç³»ç»Ÿçš„å¼•å¯¼ã€‚è€ŒDOSä¹Ÿæœ‰è‡ªå·±çš„ä¸­æ–­ä¾‹ç¨‹ï¼Œè¿™äº›ä¸­æ–­ä¾‹ç¨‹æ˜¯æ“ä½œç³»ç»Ÿæä¾›ç»™ç¨‹åºå‘˜çš„èµ„æºã€‚å¦å¤–ï¼ŒDOSå’Œç¡¬ä»¶è®¾å¤‡ç›¸å…³çš„ä¸­æ–­ä¾‹ç¨‹ä¸€èˆ¬éƒ½æ˜¯è°ƒç”¨äº†BIOSçš„ä¸­æ–­ä¾‹ç¨‹ã€‚æ¯ä¸€ä¸ªä¸­æ–­ä¾‹ç¨‹éƒ½æ˜¯ç”±å¾ˆå¤šçš„å­ç¨‹åºæž„æˆçš„ã€‚ä¸ç®¡æ˜¯BIOSè¿˜æ˜¯DOSçš„ä¸­æ–­ä¾‹ç¨‹éƒ½é€šè¿‡ahæ¥ä¼ é€’å†…éƒ¨å­ç¨‹åºçš„ç¼–å·ã€‚ ##### BIOSä¸­æ–­ä¾‹ç¨‹ int 10hç”¨æ¥è®¾ç½®å’Œå­—ç¬¦å’Œå…‰æ ‡ã€‚è§ä»£ç : çœ‹çŽ°è±¡: ä¸‹é¢æ˜¯ä»£ç : 1234567891011121314151617181920assume cs:codecode segment mov ah,2 ;ç½®å…‰æ ‡ mov bh,0 ;ç¬¬0é¡µ mov dh,5 ;è¡Œå· mov dl,12 ;åˆ—å· int 10h mov ah,9 ;åœ¨å…‰æ ‡ä½ç½®æ˜¾ç¤ºå­—ç¬¦ mov al, &apos;a&apos; ;å­—ç¬¦ mov bl,11001010b ;é¢œè‰²å±žæ€§ mov bh,0 ;ç¬¬0é¡µ mov cx,5 ;å­—ç¬¦é‡å¤ä¸ªæ•° int 10h mov ax,4c00h int 21h code ends end DOSä¸­æ–­ä¾‹ç¨‹ DOSä¸­æ–­int 21hï¼Œä¹‹å‰ä¸€ç›´ä½¿ç”¨4ch00å‚æ•°å³ç¨‹åºè¿”å›žåŠŸèƒ½ã€‚ å‚æ•°ah=9è¡¨ç¤ºè°ƒç”¨ç¬¬21hå·ä¸­æ–­ä¾‹ç¨‹çš„9å·å­ç¨‹åº:åœ¨å…‰æ ‡ä½ç½®ä¸Šæ˜¾ç¤ºå­—ç¬¦ä¸².çœ‹çŽ°è±¡: ä¸‹é¢æ˜¯ä»£ç : 1234567891011121314151617181920212223assume cs:codedata segment db &apos;Dos is shit!&apos;,&apos;$&apos; data endscode segmentstart: mov ah,2 mov bh,0 mov dl,12 int 10h ;BIOS ä¸­æ–­ä¾‹ç¨‹ mov ax,data mov ds,ax mov dx,0 mov ah,9 int 21h ;DOSä¸­æ–­ä¾‹ç¨‹ mov ax,4c00h int 21hcode endsend start]]></content>
      <categories>
        <category>Assembly</category>
      </categories>
      <tags>
        <tag>i386</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ±‡ç¼–è¯­è¨€ï¼ˆçŽ‹çˆ½ï¼‰ch3]]></title>
    <url>%2F2018%2F10%2F11%2F%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%EF%BC%88%E7%8E%8B%E7%88%BD%EF%BC%89ch3%2F</url>
    <content type="text"><![CDATA[ç¬¬ä¸‰éƒ¨åˆ†:æŒ‡ä»¤æ ¸å¿ƒ Abstract å†…å­˜å¯»å€ å†…å­˜æ˜¯å•¥ï¼Ÿè®¡ç®—æœºä»Žè¯žç”Ÿä¹‹åˆï¼Œå°±é¢ä¸´ç€CPUå’ŒI/Oä¹‹é—´ï¼Œä¸Žå­˜å‚¨å™¨ä¹‹é—´è¶Šæ¥è¶Šæ˜Žæ˜¾çš„é€Ÿåº¦çŸ›ç›¾ã€‚æ­£æ˜¯å› æ­¤æ‰è¯žç”Ÿäº†å†…å­˜ï¼Œcacheç­‰ä¸€ç³»åˆ—ç¼“å†²çš„åŠ é€Ÿè®¾å¤‡ã€‚ä½ å¯ä»¥ç†è§£ä¸ºå†…å­˜æ˜¯CPUèŽ·å–è¿è¡Œä»£ç çš„å”¯ä¸€é€”å¾„ï¼Œæ³¨æ„è¿™é‡Œçš„å†…å­˜æŒ‡çš„æ˜¯å†…å­˜åœ°å€ç©ºé—´ã€‚ CPUå¦‚ä½•è®¿é—®å†…å­˜ï¼Ÿå½“ç„¶æ˜¯ä½¿ç”¨å¯„å­˜å™¨;é‚£å¯„å­˜å™¨å¦‚ä½•è®¿é—®å†…å­˜ï¼Ÿè¿™å°±æ¶‰åŠåˆ°å†…å­˜å¯»å€çš„çŸ¥è¯†ã€‚ å¯»å€çš„æ–¹å¼æœ‰å¾ˆå¤šç§ç±» ï¼Œä¸è¿‡å½’ç»“åˆ°åº•éƒ½æ˜¯æ®µåœ°å€+åç§»åœ°å€ã€‚æ®µåœ°å€å­˜å‚¨åœ¨æ®µå¯„å­˜å™¨ä¸­ï¼Œè€Œåç§»åœ°å€çš„æ–¹å¼å°±æœ‰å¾ˆå¤šç§ã€‚è§ä¸‹å›¾: éœ€è¦æ³¨æ„çš„æ˜¯: * ä¸Šå›¾ä¸­çš„idataè¡¨ç¤ºç«‹å³æ•°ï¼Œ[]è¡¨ç¤ºåç§»åœ°å€ã€‚(ax)è¡¨ç¤ºå¯„å­˜å™¨axçš„å†…å®¹ã€‚ * []ä¸­çš„é™¤äº†ç«‹å³æ•°ä¹‹å¤–ï¼Œåªæœ‰bx,si,diå’Œbpå››ä¸ªå¯„å­˜å™¨å¯ä»¥è¿›è¡Œå¯»å€ï¼Œå…¶ä»–çš„å¯„å­˜å™¨ä¸è¡Œã€‚ * [bp]çš„æ®µå¯„å­˜å™¨é»˜è®¤æ˜¯ssã€‚ * ç¼–è¯‘å™¨masmå’Œè°ƒè¯•å™¨debugä¸¤ä¸ªå·¥å…·å¯¹äºŽmov ax,[idata]ä¸­çš„idataå¤„ç†ä¸åŒï¼Œç¼–è¯‘å™¨ä¼šå°†å…¶è¯†åˆ«ä¸ºidata,æ‰€ä»¥åœ¨ä½¿ç”¨ç¼–è¯‘å™¨çš„æ—¶å€™è¿™ç§å½¢å¼åº”è¯¥å†™æˆmov ax,ds:[idata] æ•°æ®å¤„ç†(æ€»ç»“æ€§è´¨) è®¡ç®—æœºå¤„ç†çš„æœ€ç»ˆè¿˜æ˜¯æ•°æ®ï¼Œé‚£ä¹ˆå°±æœ‰ä¸¤ä¸ªæœ€åŸºæœ¬çš„é—®é¢˜: * å¤„ç†çš„æ•°æ®åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿ * è¦å¤„ç†çš„æ•°æ®æœ‰å¤šé•¿ï¼Ÿ ##### é—®é¢˜ä¸€ ç»å¤§éƒ¨åˆ†æœºå™¨æŒ‡ä»¤éƒ½æ˜¯è¿›è¡Œæ•°æ®å¤„ç†çš„æŒ‡ä»¤ï¼Œå¤„ç†å¤§è‡´åˆ†ä¸ºä¸‰ç±»:è¯»å–ï¼Œå†™å…¥ï¼Œè¿ç®—ã€‚åœ¨æœºå™¨æŒ‡ä»¤è¿™ä¸€å±‚æ¥è¯´å¹¶ä¸å…³å¿ƒæ•°æ®çš„å€¼ï¼Œè€Œå…³å¿ƒæŒ‡ä»¤æ‰§è¡Œå‰ä¸€ç§’ï¼Œå°†è¦å¤„ç†çš„æ•°æ®æ‰€åœ¨çš„ä½ç½®ã€‚æŒ‡ä»¤åœ¨æ‰§è¡Œä¹‹å‰ï¼Œæ‰€è¦å¤„ç†çš„æ•°æ®å¯ä»¥åœ¨ä¸‰ä¸ªåœ°æ–¹:CPUå†…éƒ¨ï¼Œå¯„å­˜å™¨ï¼Œç«¯å£ã€‚ ##### é—®é¢˜äºŒ 8086æŒ‡ä»¤å¯ä»¥å¤„ç†ä¸¤ç§å°ºå¯¸çš„æ•°æ®:Byteå’ŒWordã€‚æ‰€ä»¥åœ¨æœºå™¨æŒ‡ä»¤ä¸­éœ€è¦æŒ‡æ˜Žæ˜¯å­—æ“ä½œå’Œå­—èŠ‚æ“ä½œã€‚ * é€šè¿‡å¯„å­˜å™¨æŒ‡æ˜Ž:axï¼Œalç­‰ * ç”¨æ“ä½œç¬¦X ptræŒ‡æ˜Žå†…å­˜å•å…ƒçš„é•¿åº¦ï¼ŒXæ˜¯wordæˆ–è€…byteã€‚æ¯”å¦‚:mov byte ptr ds:[0],1ã€‚ * è¿˜æœ‰ä¸€äº›é»˜è®¤çš„æ“ä½œæ¯”å¦‚æ ˆæ“ä½œé»˜è®¤ä¸ºå­—æ“ä½œã€‚ æŒ‡ä»¤è¯¦è§£ ä¼ªæŒ‡ä»¤è¡¥å…… db å®šä¹‰å­—èŠ‚åž‹æ•°æ® dw å®šä¹‰å­—åž‹æ•°æ® dd å®šä¹‰åŒå­—èŠ‚åž‹æ•°æ® dup å’Œå‰é¢ä¸‰ä¸ªä¼ªæŒ‡ä»¤ç»“åˆä½¿ç”¨ï¼Œç”¨æ¥è¿›è¡Œæ•°æ®çš„é‡å¤ã€‚db 3 dup(1,2,3)è¡¨ç¤ºå®šä¹‰çš„ä¸‰ä¸ªå­—èŠ‚åž‹æ•°æ®åˆ†åˆ«ä¸º1,2,3ã€‚ LOOPå¾ªçŽ¯æŒ‡ä»¤ ä¸»è¦è¿›è¡Œä¸¤æ­¥æ“ä½œï¼Œï¼ˆcxï¼‰=(cx)-1ï¼Œåˆ¤æ–­cxä¸­çš„å€¼ã€‚ä¸ä¸ºé›¶åˆ™è½¬è‡³æ ‡å·å¤„æ‰§è¡Œç¨‹åºï¼Œå¦‚æžœä¸ºé›¶åˆ™å‘ä¸‹æ‰§è¡Œã€‚å¯è§cxä¸­çš„å€¼å½±å“äº†loopæŒ‡ä»¤çš„æ‰§è¡Œç»“æžœã€‚ 1234mov cx,å¾ªçŽ¯æ¬¡æ•°s: å¾ªçŽ¯æ‰§è¡Œçš„ç¨‹åºæ®µ loop s JMPè½¬ç§»æŒ‡ä»¤ å¯ä»¥ä¿®æ”¹IPï¼Œæˆ–åŒæ—¶ä¿®æ”¹CSå’ŒIPçš„æŒ‡ä»¤ç»Ÿç§°ä¸ºè½¬ç§»æŒ‡ä»¤ã€‚æ¦‚æ‹¬åœ°è®²ï¼Œè½¬ç§»æŒ‡ä»¤å°±æ˜¯å¯ä»¥æŽ§åˆ¶CPUæ‰§è¡Œå†…å­˜ä¸­æŸå¤„ä»£ç çš„çš„æŒ‡ä»¤ã€‚ æ ¹æ®ä¿®æ”¹çš„æ–¹å¼ï¼Œåªä¿®æ”¹IPçš„ç§°ä¸ºæ®µå†…è½¬ç§»ï¼Œä¿®æ”¹IPå’ŒCSçš„ç§°ä¸ºæ®µé—´è½¬ç§»ã€‚ç”±äºŽè½¬ç§»æŒ‡ä»¤å¯¹IPçš„ä¿®æ”¹èŒƒå›´ä¸åŒï¼Œæ®µå†…è½¬ç§»åˆåˆ†ä¸º:çŸ­è½¬ç§»ï¼ˆ8ä½ï¼‰å’Œè¿‘è½¬ç§»ï¼ˆ16ä½ï¼‰ã€‚ä¸åŒçš„è½¬ç§»æ–¹å¼ï¼Œå…¶åŸºæœ¬çš„åŽŸç†ç¡®å®žç›¸åŒçš„ã€‚ ###### 1-JMP short offset è½¬ç§»æŒ‡ä»¤å€¼å¾—æ³¨æ„çš„ç‚¹å°±æ˜¯offsetæŒ‡çš„ä¸æ˜¯ç¡®å®šçš„åœ°å€ï¼Œè€Œæ˜¯ä»Žæ ‡å·åˆ°æŒ‡ä»¤ä¹‹é—´çš„ä½ç§»ã€‚ (IP)=(IP)+8ä½ä½ç§»ï¼Œæ®µå†…çŸ­è½¬ç§»çš„ä½ç§»èŒƒå›´ä½8ä½æœ‰ç¬¦å·æ•°ï¼Œç”¨è¡¥ç è¡¨ç¤ºã€‚offsetå¤„çš„åœ°å€-JMPæŒ‡ä»¤åŽçš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åœ°å€ã€‚ ###### 1-JMP near ptr offset (IP)=(IP)+16ä½ä½ç§» ,æ®µå†…è¿‘è½¬ç§»çš„ä½ç§»èŒƒå›´æ˜¯16ä½æœ‰ç¬¦å·æ•°ï¼Œç”¨è¡¥ç è¡¨ç¤ºã€‚åŽŸç†å’Œå‰è€…ä¸€æ ·ã€‚ ###### 2-JMP far ptr offset å‰é¢çš„å‡ ç§ç±»åž‹åœ°å€éƒ½æ˜¯é€šè¿‡offsetå’Œä½ç§»ï¼Œè€ŒæŽ¥ä¸‹æ¥çš„å‡ ç§æ˜¯åœ¨å¯„å­˜å™¨å’Œå†…å­˜ä¸­çš„ç»™å®šIPæˆ–è€…CSã€‚å†…å­˜åœ°å€å•å…ƒå¯ä»¥ç”¨ä»»æ„çš„å¯»å€æ–¹å¼å¾—åˆ°ã€‚ ï¼ˆCSï¼‰=æ ‡å·æ‰€åœ¨æ®µçš„æ®µåœ°å€ï¼Œï¼ˆIPï¼‰=æ ‡å·æ‰€åœ¨æ®µä¸­çš„åç§»åœ°å€ ã€‚æ®µé—´è½¬ç§»ï¼Œä¼šå‘çŽ°å…¶è·³è½¬åœ°å€å®žé™…ä¸Šæ˜¯åœ¨æŒ‡ä»¤ä¸­çš„offsetçš„åœ°å€ã€‚å’Œå‰ä¸¤ä¸ªè¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚ ###### 2-JMP 16ä½reg æœ€åŸºç¡€çš„è·³è½¬æŒ‡ä»¤ï¼Œåªæ˜¯ä¿®æ”¹IP=16ä½çš„å¯„å­˜å™¨ä¸­å†…å®¹ã€‚ ###### 2-JMP word ptr å†…å­˜å•å…ƒåœ°å€ æ¯”å¦‚:jmp word ptr ds:[0]ä¸­ptråŽé¢çš„å°±æ˜¯ä¸€ä¸ªåœ°å€ï¼Œjmp word ds:[0],0åŽé¢è·Ÿä¸¤ä¸ªåœ°å€ã€‚æ³¨æ„ï¼ˆCSï¼‰=(å†…å­˜åœ°å€å•å…ƒ+2)ï¼Œï¼ˆIPï¼‰=ï¼ˆå†…å­˜åœ°å€å•å…ƒï¼‰ã€‚ ###### 2-jcxz è¯¥æŒ‡ä»¤ä¸ºæœ‰æ¡ä»¶è½¬ç§»æŒ‡ä»¤ï¼Œæ‰€æœ‰çš„æœ‰æ¡ä»¶è½¬ç§»æŒ‡ä»¤éƒ½æ˜¯çŸ­è½¬ç§»ã€‚æ–¹å¼ä¸º: if((cx)==0)jmp short offset å¦å¤–ï¼Œæ‰€æœ‰çš„loopå¾ªçŽ¯æŒ‡ä»¤éƒ½æ˜¯çŸ­è½¬ç§»ã€‚ CALLå’ŒRETæŒ‡ä»¤ ret(è¿‘è½¬ç§») ä¹¦ä¸­è¯´retæŒ‡ä»¤ç”¨æ ˆä¸­çš„æ•°æ®ä¿®æ”¹IPä¸­çš„å†…å®¹ã€‚ä¹‹å‰å¯¹æ ˆæœ‰ä¸€ä¸ªåˆ†ç±»ï¼Œè¿™é‡Œçš„æ ˆæ˜¯æ»¡é€’å‡å †æ ˆã€‚æ‰€ä»¥ç”±æ­¤å¯çŸ¥å †æ ˆæŒ‡é’ˆSPä¸€ç›´æŒ‡å‘æœ€åŽä¸€ä¸ªåŽ‹æ ˆçš„æ•°æ®ã€‚retæŒ‡ä»¤å®žé™…ä¸ŠæŠŠå †æ ˆä¸­çš„æœ€åŽä¸€ä¸ªæ•°æ®ä½œä¸ºè‡ªå·±è·³è½¬çš„åç§»åœ°å€ã€‚æ–¹å¼å¦‚ä¸‹: (IP)=((ss)*16+(sp)),(sp)=(sp)+2 ä»Žä¸Šé¢ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥è¿™ä¸¤æ¡æŒ‡ä»¤ç­‰åŒäºŽ:pop IP retf(è¿œè½¬ç§») ä¹¦ä¸­è¯´retfæŒ‡ä»¤ç”¨æ ˆä¸­çš„æ•°æ®ä¿®æ”¹IPå’ŒCSä¸­çš„å†…å®¹ã€‚ç±»ä¼¼: (IP)=((ss)*16+(sp)),(sp)=(sp)+2 ï¼ˆCSï¼‰=ï¼ˆï¼ˆssï¼‰*16+(sp)ï¼‰,(sp)=(sp)+2 è¿™å››æ¡æŒ‡ä»¤ç­‰åŒäºŽ:pop IP,pop CS callæŒ‡ä»¤ callæŒ‡ä»¤ä¸èƒ½å®žçŽ°çŸ­è½¬ç§»ï¼Œä½†æ˜¯å…¶è½¬ç§»çš„åŽŸç†å’ŒjmpæŒ‡ä»¤ç›¸åŒã€‚å¦‚ä¸‹ï¼š (sp)=(sp)-2,((ss)*16+(sp))=(IP),(IP)=(IP)+16ä½ä½ç§»è¿™å‡ æ¡æŒ‡ä»¤ç›¸å½“äºŽ: push IPå’Œjmp near ptr offset callå’ŒretæŒ‡ä»¤(å­ç¨‹åº) å…ˆçœ‹ä¸€æ®µä»£ç : 12345678910111213assume cs:codecode segmentstart: mov ax,1 mov cx,3 call s mov bx,ax mov ax,4c00h int 21h s: add ax,ax loop s retcode endsend start ç¨‹åºæ‰§è¡Œåˆ°call sçš„æ—¶å€™ï¼ŒIPæŒ‡å‘äº†åŽé¢çš„ä¸€æ¡æŒ‡ä»¤ï¼Œç„¶åŽCPUæ‰§è¡Œcall sæŒ‡ä»¤â€”â€”â€”â€”å°†å½“å‰çš„IPï¼ˆmov bx,axçš„åœ°å€ï¼‰åŽ‹æ ˆï¼Œç„¶åŽä¿®æ”¹ä¸ºsåœ°å€ã€‚ç„¶åŽå­ç¨‹åºå¼€å§‹æ‰§è¡Œï¼Œæ‰§è¡Œç»“æŸä¹‹åŽæ‰§è¡ŒretæŒ‡ä»¤â€”â€”â€”â€”ä»Žæ ˆä¸­å¼¹å‡ºä¸€ä¸ªå€¼ï¼Œå°†CS:IPçš„å€¼æŒ‡å‘mov bx,axã€‚ç„¶åŽè¿”å›žä¸ºåŽŸæ¥çš„åœ°å€ã€‚è¿™ä¸¤æ¡æŒ‡ä»¤ä¸ºå­ç¨‹åºçš„è°ƒç”¨æä¾›äº†å¯èƒ½ã€‚ æ ‡å¿—å¯„å­˜å™¨ å¯„å­˜å™¨æ˜¯æ±‡ç¼–ç¨‹åºå‘˜è§£å†³é—®é¢˜çš„æœ€æœ‰åˆ©çš„æ‰‹æ®µï¼Œä¸ä»…ä»…åœ¨äºŽå¯ä»¥å­˜å‚¨æ•°æ®ï¼Œè¿˜å…·æœ‰è¾…åŠ©æŒ‡ä»¤æ‰§è¡Œçš„åŠŸèƒ½ã€‚æ ‡å¿—å¯„å­˜å™¨å°±æ˜¯å¦‚æ­¤ï¼Œç”¨æ¥å­˜å‚¨CPUæ‰§è¡ŒæŒ‡ä»¤çš„æŸäº›æ‰§è¡Œç»“æžœã€‚å­˜å‚¨çš„ä¿¡æ¯ç§°ä¸ºâ€œç¨‹åºçŠ¶æ€å­—PSWâ€ã€‚çŠ¶æ€å¯„å­˜å™¨çš„æ¯ä¸€ä½éƒ½æœ‰å…·ä½“çš„å«ä¹‰ã€‚ä¸‹é¢åˆ†åˆ«ä»‹ç»: ##### ZFæ ‡å¿— é›¶æ ‡å¿—ä½ï¼Œç›¸å…³æŒ‡ä»¤æ‰§è¡Œç»“æŸå¦‚æžœç»“æžœä¸º0ï¼Œzf=1ï¼›å¦‚æžœä¸ä¸º0ï¼Œzf=0. PFæ ‡å¿— å¥‡å¶æ ‡å¿—ä½ï¼Œç›¸å…³æŒ‡ä»¤æ‰§è¡Œç»“æŸå¦‚æžœç»“æžœçš„æ‰€æœ‰bitä½ä¸­1çš„ä¸ªæ•°ä¸ºå¶æ•°ï¼Œpf=1,å¦åˆ™pf=0. SFæ ‡å¿— ç¬¦å·æ ‡å¿—ä½ï¼Œç›¸å…³æŒ‡ä»¤æ‰§è¡Œç»“æŸå¦‚æžœç»“æžœä¸ºè´Ÿï¼Œsf=1ï¼›å¦åˆ™sf=0ã€‚è¯¥æ ‡å¿—æ˜¯CPUå¯¹æœ‰ç¬¦å·æ•°è®¡ç®—ç»“æžœçš„ä¸€ç§è®°å½•ã€‚ CFæ ‡å¿— è¿›ä½æ ‡å¿—ä½ï¼Œåœ¨è¿›è¡Œæ— ç¬¦å·æ•°è¿ç®—çš„æ—¶å€™ï¼Œå®ƒè®°å½•äº†è¿ç®—ç»“æžœçš„æœ€é«˜æœ‰æ•ˆä½å‘æ›´é«˜ä½çš„è¿›ä½å€¼ï¼Œæˆ–ä»Žæ›´é«˜ä½çš„å€Ÿä½å€¼ã€‚ OFæ ‡å¿— æº¢å‡ºæ ‡å¿—ä½ï¼Œåœ¨è¿›è¡Œæœ‰ç¬¦å·æ•°è¿ç®—çš„æ—¶å€™ï¼Œè®°å½•äº†æ˜¯å¦å‘ç”Ÿæº¢å‡ºã€‚ æ ‡å¿—å¯„å­˜å™¨åœ¨Debugä¸­çš„ä½¿ç”¨ æ ‡å¿—å¯„å­˜å™¨æ˜¯æŒ‰ç…§æœ‰æ„ä¹‰çš„å„ä¸ªæ ‡å¿—ä½å•ç‹¬è¡¨ç¤ºçš„ã€‚å¦‚ä¸‹ã€‚ ä¸‹å›¾æ˜¯å·²çŸ¥çš„æ ‡å¿—ä½çš„è¡¨ç¤º: #### å…¶ä»–æŒ‡ä»¤ï¼ˆæ€»ç»“æ€§è´¨ï¼‰ è¿˜æœ‰å¾ˆå¤šçš„æŒ‡ä»¤æ¯”å¦‚MOV,CMPï¼Œabcç­‰ã€‚ä½†è¿™é‡Œå¹¶ä¸æ‰“ç®—è¯¦ç»†è®²è§£æ¯ä¸€æ¡æŒ‡ä»¤ï¼Œå°±åƒä¹¦ä¸­æ‰€è¯´:æ±‡ç¼–è¯­è¨€åªæ˜¯è½½ä½“ï¼Œç›®çš„åœ¨äºŽç†è§£æœºå™¨è¿è¡Œçš„åŽŸç†å’Œæ–¹å¼ã€‚ è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº†å¯„å­˜å™¨ï¼Œå†…å­˜,æ±‡ç¼–æŒ‡ä»¤ï¼Œå¹¶ä¸”æŽŒæ¡äº†ä¸€ä¸ªæ­£å¸¸çš„ç¨‹åºæŽ§åˆ¶æµåœ¨æœºå™¨å±‚é¢çš„è¿è¡Œè¿‡ç¨‹ã€‚æŽ¥ä¸‹æ¥çš„å†…å®¹ï¼Œå°±å±žäºŽæ“ä½œç³»ç»Ÿçš„å±‚é¢ï¼Œå¼•å…¥å¼‚å¸¸æŽ§åˆ¶æµï¼Œä¹Ÿå°±æ˜¯åœ¨æ­£å¸¸çš„æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰å¤–ç•Œå¹²æ‰°çš„æƒ…å†µï¼Œè¿™æ˜¯ç†è§£æ•´ä¸ªOSçš„é‡ç‚¹ï¼Œä¹Ÿæ˜¯æˆ‘å†™è¿™å‡ ç¯‡æŠ€æœ¯åšå®¢çš„ä¸»è¦å­¦ä¹ ç›®çš„ã€‚(mit6.828ä¸­çš„æ±‡ç¼–å¤§åŒå°å¼‚ï¼Œåªæ˜¯æŒ‡ä»¤é›†æ¢æˆäº†AT&amp;Tçš„æ ¼å¼)ã€‚ å®žéªŒ7 å¯»å€æ–¹å¼åœ¨ç»“æž„åŒ–æ•°æ®è®¿é—®ä¸­çš„åº”ç”¨ å®žéªŒ9 æ ¹æ®ææ–™ç¼–ç¨‹ å®žéªŒ10 ç¼–å†™å­ç¨‹åº]]></content>
      <categories>
        <category>Assembly</category>
      </categories>
      <tags>
        <tag>i386</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ±‡ç¼–è¯­è¨€ï¼ˆçŽ‹çˆ½ï¼‰ch2]]></title>
    <url>%2F2018%2F10%2F04%2F%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%EF%BC%88%E7%8E%8B%E7%88%BD%EF%BC%89ch2%2F</url>
    <content type="text"><![CDATA[ç¬¬äºŒéƒ¨åˆ†:æ±‡ç¼–ç»“æž„ Abstract æ±‡ç¼–è¯­è¨€çš„ç»“æž„ å¯„å­˜å™¨å’Œå†…å­˜ä¹‹é—´ æ±‡ç¼–è¯­è¨€æ˜¯ç”±ä¸åŒçš„æ®µæž„æˆçš„ï¼Œè¿™äº›æ®µçš„åŠŸèƒ½å„å¼‚ä¸è¿‡ä¸»è¦åˆ†ä¸ºæŒ‡ä»¤å’Œæ•°æ®ä¸¤éƒ¨åˆ†ã€‚è¿è¡Œæ±‡ç¼–ä»£ç çš„æ„æ€å°±æ˜¯å°†æ±‡ç¼–ä»£ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œé€šè¿‡å¯„å­˜å™¨å®Œæˆå†…å­˜å’ŒCPUä¹‹é—´çš„äº¤äº’ã€‚ä»Žè¿™ä¸ªè§’åº¦çœ‹å¯„å­˜å™¨å°±æ˜¯æ±‡ç¼–çš„ä¸€ç§æ‰‹æ®µã€‚ä½†æ˜¯å¯„å­˜å™¨å’Œå†…å­˜å®žé™…ä¸Šæ˜¯ä¸¤ä¸ªå®Œå…¨ä¸ä¸€æ ·çš„ç¡¬ä»¶è®¾å¤‡ï¼Œæš‚æ—¶å…ˆä¸è€ƒè™‘æ€§èƒ½å’Œé€ŸçŽ‡å·®çš„é—®é¢˜ã€‚æŒ‡ä»¤å’Œæ•°æ®åˆ°åº•æ˜¯å¦‚ä½•åœ¨ä¸åŒçš„å­˜å‚¨å•å…ƒä¹‹é—´ä¼ é€’çš„ã€‚ å­—èŠ‚å­˜å‚¨å’Œå­—å­˜å‚¨å°±æ˜¯ä¸¤ç§è§£å†³åŠžæ³•ï¼Œåœ¨8086ä¸­å¯„å­˜å™¨æ˜¯16ä½çš„(16ä½ä¸ºä¸€å­—)ï¼Œè€Œå­˜å‚¨å™¨çš„æœ€å°å­˜å‚¨å•å…ƒæ˜¯8ä½ä¹Ÿå°±æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥å¦‚æžœåœ¨ä¸€äº›è¯»å†™ä¸­éœ€è¦ç”¨åˆ°å­—å­˜å‚¨è€Œä¸æ˜¯å­—èŠ‚å­˜å‚¨çš„è¯ï¼Œå°±éœ€è¦ä¸¤å—è¿žç»­çš„å†…å­˜å•å…ƒæ‰èƒ½å®Œæˆæ•°æ®çš„ä¼ è¾“ï¼Œè€Œä¸”æ˜¯é«˜åœ°å€å­˜æ”¾å­—çš„é«˜ä½å­—èŠ‚ï¼Œä½Žåœ°å€å­˜æ”¾å­—çš„ä½Žä½å­—èŠ‚ã€‚ è¦è¯»å†™ä¸€å—å†…å­˜å•å…ƒçš„æ—¶å€™ï¼Œå¿…é¡»å…ˆè¦ç»™å‡ºè¿™ä¸ªå†…å­˜å•å…ƒçš„åœ°å€ã€‚åœ¨å®žéªŒ1ä¸­æˆ‘ä»¬çŸ¥é“äº†CPUä½¿ç”¨æ®µåœ°å€+åç§»åœ°å€çš„æ–¹å¼æ¥è¿›è¡Œå¯»å€ã€‚è€Œå®žçŽ°è¿™äº›åŠŸèƒ½çš„å°±æ˜¯ä¸€äº›å…·æœ‰ç‰¹æ®ŠåŠŸèƒ½çš„å¯„å­˜å™¨ã€‚è¿™é‡Œæåˆ°çš„æ˜¯æœ€ç®€å•çš„ä¹Ÿæœ€å¸¸ä½¿ç”¨çš„ä¸¤ç§ç±»åž‹: * CS+IPâ€”â€”â€”â€”åœ¨ä»»æ„æ—¶åˆ»CPUå°†CS:IPæŒ‡å‘çš„å†…å®¹å½“åšæŒ‡ä»¤æ‰§è¡Œã€‚ * DS+[idata]â€”â€”â€”â€”DSé€šå¸¸ç”¨æ¥å­˜æ”¾éœ€è¦è®¿é—®çš„æ•°æ®çš„æ®µåœ°å€ã€‚ è¿™é‡Œä¸»è¦ä»‹ç»æ±‡ç¼–è¯­è¨€çš„ç»“æž„ï¼Œå¯¹åº”åˆ°å¯„å­˜å™¨å’Œå†…å­˜å¯»å€çš„æ–¹å¼åŽé¢ä¼šè®²ã€‚ ##### æ•°æ®æ®µ å°†ä¸€æ®µå†…å­˜å½“åšæ•°æ®æ®µï¼Œæ˜¯æˆ‘ä»¬åœ¨ç¼–ç¨‹çš„æ—¶å€™çš„ä¸€ç§å®‰æŽ’ï¼Œå¯ä»¥åœ¨å…·ä½“æ“ä½œçš„æ—¶å€™ï¼Œç”¨dså­˜æ”¾æ•°æ®çš„æ®µåœ°å€ï¼Œå†æ ¹æ®ç›¸å…³æŒ‡ä»¤è®¿é—®æ•°æ®æ®µä¸­çš„å…·ä½“å•å…ƒã€‚ ä»£ç æ®µ ä»Žç¡¬ä»¶è§’åº¦è®²ï¼ŒCPUåªè®¤è¢«CS:IPæŒ‡å‘çš„å†…å­˜å•å…ƒä¸­çš„å†…å®¹ä¸ºæŒ‡ä»¤ã€‚è¦è®©CPUæ‰§è¡Œæˆ‘ä»¬æ”¾åœ¨ä»£ç æ®µçš„æŒ‡ä»¤ï¼Œå¿…é¡»è¦å°†CS:IPæŒ‡å‘æ‰€å®šä¹‰çš„ä»£ç æ®µä¸­çš„ç¬¬ä¸€æ¡æŒ‡ä»¤çš„é¦–åœ°å€ã€‚ æ ˆæ®µ æ ˆæ˜¯ä¸€ç§å…ˆè¿›åŽå‡ºçš„æ•°æ®ç»“æž„ï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„æ ˆçš„æ¦‚å¿µã€‚è¿™é‡Œè®²åˆ°çš„æ ˆæŒ‡çš„æ˜¯å†…å­˜åŒºåŸŸã€‚ä»Žæ“ä½œç³»ç»Ÿçš„è§’åº¦è®²ä¸€ä¸ªçº¿ç¨‹éœ€è¦åˆ†é…ä¸€ä¸ªæ ˆ(stack)ã€‚ç›¸å¯¹åº”çš„ä¸€ä¸ªè¿›ç¨‹éœ€è¦åˆ†é…ä¸€ä¸ªå †(heap)ã€‚æ ˆçš„å¤§å°åœ¨åˆ†é…çš„æ—¶å€™å°±å·²ç»ç¡®å®šå¥½äº†ï¼Œå…¶ä½œç”¨ä¸»è¦æ˜¯å­˜æ”¾ä¸€äº›å±€éƒ¨å’Œç¡®å®šçš„å˜é‡å’Œæ•°æ®ã€‚ å…³äºŽæ ˆä¹Ÿæœ‰ä¸¤ä¸ªå¯„å­˜å™¨:SS:SPã€‚æ¢å¥è¯è®²CPUå¦‚ä½•çŸ¥é“ä¸€æ®µå†…å­˜åŒºåŸŸæ˜¯ä¸æ˜¯æ ˆï¼Ÿæ ˆé¡¶çš„æ®µåœ°å€æ”¾åœ¨SSä¸­ï¼Œè€Œåç§»åœ°å€æ”¾åœ¨SPä¸­ã€‚ä»»æ„æ—¶åˆ»ï¼ŒSS:SPæŒ‡å‘æ ˆé¡¶å…ƒç´ ã€‚è¿™æ˜¯è§„å®šã€‚ å¦å¤–ï¼Œä¸Šå¾®æœºåŽŸç†è¯¾çš„æ—¶å€™ï¼Œè€å¸ˆè®²åˆ°æ ˆçš„åˆ†ç±»: * å‘é«˜åœ°å€ç”Ÿé•¿çš„ç§°ä¸ºé€’å¢žå †æ ˆã€‚ * å‘åœ°åœ°å€ç”Ÿé•¿çš„ç§°ä¸ºé€’å‡å †æ ˆã€‚ åœ°å€å»¶ä¼¸ä¸»è¦çš„å½±å“å°±æ˜¯å†…å­˜ä¸­çš„å¤§ç«¯å¯»å€å’Œå°ç«¯å¯»å€ã€‚ &lt;img src=&quot;4.png&quot; width=&quot;50%&quot; height=&quot;50%&quot; alt=&quot;&quot;&gt; å †æ ˆæŒ‡é’ˆæŒ‡å‘æœ€åŽåŽ‹å…¥å †æ ˆçš„æœ‰æ•ˆæ•°æ®é¡¹ï¼Œå«åšæ»¡å †æ ˆã€‚ å †æ ˆæŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå¾…åŽ‹å…¥æ•°æ®çš„ç©ºä½ç½®ï¼Œå«åšç©ºå †æ ˆã€‚ æ ˆæŒ‡ä»¤ åœ¨i386çš„æŒ‡ä»¤é›†ä¸­ï¼Œæ ˆæ“ä½œéƒ½æ˜¯ä»¥å­—ä¸ºå•ä½çš„ã€‚ ###### pushæ‰§è¡Œè¿‡ç¨‹ 1. SP=SP-2; 2. å‘SP:SSæŒ‡å‘çš„å†…å­˜å­—å•å…ƒä¸­é€å…¥æ•°æ®; ###### popæ‰§è¡Œè¿‡ç¨‹ 1. ä»ŽSP:SSæŒ‡å‘çš„å†…å­˜å­—å•å…ƒä¸­è¯»å–æ•°æ®; 2. SP=SP+2; æ®µçš„æ¦‚å¿µ ä¹‹å‰è®¨è®ºè¿‡å…³äºŽæ®µè¿™ä¸ªæ¦‚å¿µã€‚æˆ‘è®¤ä¸ºï¼Œè¿˜æ˜¯å› ä¸ºåœ¨ç¼–ç¨‹çš„æ—¶å€™å¯ä»¥é€šè¿‡ä¸€ä¸ªç³»ç»ŸåŒ–çš„ç»“æž„æ¥ç»Ÿä¸€æ±‡ç¼–è¯­è¨€çš„å®žçŽ°é€»è¾‘ã€‚ä½¿å¾—è¿™äº›æŒ‡ä»¤çœ‹ä¸ŠåŽ»ä¾¿äºŽç®¡ç†å’Œåè°ƒåˆä½œã€‚è‡³äºŽå…¶ç‰©ç†å®žçŽ°ï¼Œå…¶å®žå°±æ˜¯CPUçš„å¯»å€æ–¹å¼å†³å®šçš„ã€‚ä¹¦æœ¬ä¸­æœ‰ä¸€æ®µè¯ç‰¹åˆ«ç»å…¸ï¼Œæˆ‘æ‘˜æŠ„å¦‚ä¸‹: 123456789101112131415161718192021222324æ¯”å¦‚æˆ‘ä»¬å°†10000H~1001Få®‰æŽ’ä¸ºä»£ç æ®µï¼Œå¹¶åœ¨é‡Œé¢å­˜å‚¨å¦‚ä¸‹ä»£ç : MOV ax,1000H MOV ss,axMOV sp,0020H //åˆå§‹åŒ–æ ˆé¡¶MOV ax,csMOV ds,ax //è®¾ç½®æ•°æ®æ®µæ®µåœ°å€MOV ax,[0]add ax,[2]add bx,[4]add bx,[6]push axpush bxpop axpop bx è®¾ç½®CS=1000ï¼ŒIP=0.è¿™æ®µä»£ç å°±ä¼šè¢«æ‰§è¡Œï¼Œä½†æ˜¯å¯ä»¥çœ‹åˆ°åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆå°† 10000H~1001FHå®‰æŽ’ä¸ºæ ˆæ®µå’Œæ•°æ®æ®µã€‚ å¯è§ä¸ç®¡æˆ‘ä»¬å¦‚ä½•å®‰æŽ’ï¼ŒCPUå°†å†…å­˜ä¸­çš„æŸæ®µå†…å­˜å½“åšä»£ç ï¼Œæ˜¯å› CS:IPæŒ‡å‘äº†é‚£é‡Œã€‚ CPUå°†æŸæ®µå†…å­˜å½“åšæ ˆï¼Œæ˜¯å› ä¸ºSS:SPæŒ‡å‘äº†é‚£é‡Œã€‚æˆ‘ä»¬ä¸€å®šè¦æ¸…æ¥šï¼Œä»€ä¹ˆæ˜¯æˆ‘ä»¬çš„å®‰æŽ’ï¼Œ ä»¥åŠå¦‚ä½•è®©CPUæŒ‰æˆ‘ä»¬çš„å®‰æŽ’è¡Œäº‹ã€‚è¦éžå¸¸æ¸…æ¥šCPUçš„å·¥ä½œæœºç†ï¼Œæ‰èƒ½åœ¨æŽ§åˆ¶CPUæŒ‰ç…§æˆ‘ä»¬ çš„å®‰æŽ’è¿è¡Œçš„æ—¶å€™åšåˆ°æ¸¸åˆƒæœ‰ä½™ã€‚ ä¸€æ®µå†…å­˜ï¼Œå¯ä»¥æ—¢æ˜¯ä»£ç çš„å­˜å‚¨ç©ºé—´ï¼Œåˆæ˜¯æ•°æ®çš„å­˜å‚¨ç©ºé—´ï¼Œè¿˜å¯ä»¥æ˜¯æ ˆç©ºé—´ï¼Œä¹Ÿå¯ä»¥ä»€ä¹ˆéƒ½ä¸æ˜¯ã€‚ å…³é”®æ˜¯åœ¨äºŽCPUä¸­å¯„å­˜å™¨çš„è®¾ç½®ï¼ŒæœºCSï¼ŒIPï¼ŒSSï¼ŒSPï¼ŒDSçš„æŒ‡å‘ã€‚ å¤šä¸ªæ®µçš„ç»Ÿä¸€ ä»¥å‰å†™çš„æ±‡ç¼–éƒ½æ˜¯å•ä¸ªæ®µï¼Œå¹¶ä¸”ä¸»è¦æ˜¯ä»£ç æ®µã€‚å¦‚æžœå†…å­˜ä¸­çš„ä¸€æ®µæ±‡ç¼–ä»£ç éœ€è¦åŒ…å«å¤šä¸ªæ•°æ®æ®µï¼Œä»£ç æ®µï¼Œæ ˆæ®µã€‚è¯¥å¦‚ä½•è®¾è®¡æ‰èƒ½ä¿è¯ç¨‹åºæ­£å¸¸è¿è¡Œå‘¢ï¼Ÿ æˆ‘ä»¬åº”è¯¥æœ‰ä¸€ä¸ªæ¦‚å¿µï¼Œå°±æ˜¯æ‰€è°“å’ŒCPUå¯¹åº”çš„ç¨‹åºä¸€å®šæ˜¯CS:IPæŒ‡å‘çš„å†…å­˜åœ°å€ã€‚æ‰€ä»¥å®žé™…ä¸Šè¿™ä¸ªé—®é¢˜æ˜¯åœ¨é—®ä¿è¯CS:IPæ­£ç¡®æŒ‡å‘ç¨‹åºçš„å‰æä¸‹ï¼Œå¦‚ä½•è®©æ•°æ®æ®µï¼Œæ ˆæ®µåˆç†çš„åŠ è¿›æ¥ï¼Ÿ è¿™é‡Œæœ‰ä¸ªä¼ªæŒ‡ä»¤çš„æ¦‚å¿µï¼Œä¼ªæŒ‡ä»¤ä¸»è¦æ˜¯ä¸ºæ±‡ç¼–å™¨æä¾›ä¸€äº›ç¼–è¯‘çš„å‰æä¿¡æ¯æ¯”å¦‚ä»Žå“ªé‡Œå¼€å§‹æ‰§è¡Œä»£ç ï¼Œå…¶ä»–çš„æ®µçš„èµ·å§‹åœ°å€åœ¨å“ªé‡Œã€‚æ‰€ä»¥é—®é¢˜ä¹Ÿå°±è§£å†³äº†ã€‚ å¦‚ä½•ä¿è¯CS:IPæŒ‡å‘ä»£ç æ®µ: endå’Œend start å¦‚ä½•å®šä¹‰ä¸€ä¸ªæ®µ: code segmentå’Œcode ends å¦‚ä½•å°†æ®µå¯„å­˜å™¨å’Œæ®µç›¸å¯¹åº”: assume cs:code æ±‡ç¼–è¯­è¨€çš„ç¼–è¯‘ã€è¿žæŽ¥è¿‡ç¨‹åŠå…¶å·¥å…·çš„ä½¿ç”¨ è¿™éƒ¨åˆ†è¯¦ç»†è§ä¹¦ä¸Šã€‚ æºç¨‹åºç»„æˆ ä¸€ä¸ªæ±‡ç¼–ç¨‹åºçš„æºç¨‹åºç”±æ±‡ç¼–æŒ‡ä»¤å’Œä¼ªæŒ‡ä»¤æž„æˆã€‚æ±‡ç¼–æŒ‡ä»¤æŒ‡çš„æ˜¯ç¼–è¯‘æˆä¸ºæœºå™¨æŒ‡ä»¤æœ€ç»ˆä¸ºCPUæ‰€æ‰§è¡Œçš„ä»£ç ã€‚ä¼ªæŒ‡ä»¤æ²¡æœ‰ç›¸å¯¹åº”çš„æœºå™¨æŒ‡ä»¤ï¼Œä¸»è¦æ˜¯ç”±ç¼–è¯‘å™¨æ¥æ‰§è¡Œçš„æŒ‡ä»¤ã€‚ ç¼–è¯‘ã€é“¾æŽ¥ã€æ‰§è¡Œ æºç¨‹åºç»è¿‡ç¼–è¯‘æˆä¸ºå¯é‡å®šä½æ–‡ä»¶ï¼Œç„¶åŽç»è¿‡é“¾æŽ¥æˆä¸ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚å¯æ‰§è¡Œæ–‡ä»¶æ˜¯å¯ä»¥ç›´æŽ¥åœ¨æ“ä½œç³»ç»Ÿä¸­æ‰§è¡Œçš„ã€‚ä¸Šè¿°ä¸¤ç§æ–‡ä»¶éƒ½å±žäºŽELFæ ¼å¼çš„æ–‡ä»¶ï¼ŒELFæ˜¯Linuxä¸‹é¢çš„ä¸€ç§æ–‡ä»¶æ ¼å¼ï¼Œå…·ä½“çš„ç»†èŠ‚åœ¨åŽé¢çš„æ“ä½œç³»ç»Ÿä¸­ä¼šè°ˆåˆ°ï¼Œè¿™é‡Œåªæ˜¯äº†è§£ã€‚ ç¼–ç¨‹ï¼ˆeditï¼‰â€”â€”â€”â€”&gt;1.asmâ€”â€”â€”â€”&gt;ç¼–è¯‘(masm)â€”â€”â€”â€”&gt;1.objâ€”â€”â€”â€”&gt;é“¾æŽ¥(link)â€”â€”â€”â€”&gt;1.exeâ€”â€”â€”â€”&gt;åŠ è½½(shell)â€”â€”â€”â€”&gt;å†…å­˜ä¸­çš„ç¨‹åºâ€”â€”â€”â€”&gt;è¿è¡Œ(CPU) å·¥å…·è¿›é˜¶ debug -d ç¬¬ä¸€ä¸ªå®žéªŒä¸­ä½¿ç”¨çš„debugå·¥å…·ï¼Œé€šè¿‡å„ç§å‚æ•°æ¥å¯¹å¯„å­˜å™¨å’Œå†…å­˜è¿›è¡Œè¯»å†™ã€‚æ¯”å¦‚d æ®µåœ°å€:åç§»åœ°å€æŒ‡ä»¤ä¼šåˆ—å‡ºæŒ‡å®šå†…å­˜å•å…ƒä¸­çš„å†…å®¹ã€‚ä½†æ˜¯debugä¹Ÿæ˜¯ä¸€ä¸ªç¨‹åºï¼Œè€Œèƒ½å®šä½å†…å­˜åœ°å€çš„æ–¹å¼åœ¨8086ä¸­åªæœ‰æ®µå¯„å­˜å™¨å¯ä»¥åšåˆ°,å®žé™…ä¸Šdebugå°±æ˜¯é€šè¿‡å°†åœ°å€å†™å…¥æ®µå¯„å­˜å™¨ä¸­çš„æ–¹å¼æ¥è¿›è¡Œå†…å­˜å¯»å€ã€‚è¿™ä¸ªåŽŸç†é€‚ç”¨äºŽæ‰€æœ‰çš„å‚æ•°ã€‚ è€Œä½¿ç”¨çš„è¿™ä¸ªæ®µå¯„å­˜å™¨æ­£æ˜¯DSå¯„å­˜å™¨ã€‚ æ ¹æ®è¿™ä¸ªåŽŸç†ï¼Œå°±å¯ä»¥é€šè¿‡ä¿®æ”¹å¯„å­˜å™¨æ¥è¿›é˜¶ä½¿ç”¨è¿™äº›å‘½ä»¤ï¼Œæ¯”å¦‚:-r ds,:1000,-d ds:0è¿™æ®µä»£ç å°±è¡¨ç¤ºæŸ¥çœ‹ä»Ž1000ï¼š0å¼€å§‹çš„å†…å­˜ç©ºé—´ä¸­çš„å†…å®¹ã€‚è¿™é‡Œä¸»è¦æ˜¯è®¤è¯†åˆ°æ®µå¯„å­˜å™¨DSçš„å¯»å€åŠŸèƒ½ï¼Œä¸ºä¹‹åŽçš„å¯»å€æ–¹å¼æ‰“åŸºç¡€ã€‚ debug -p åœ¨æ•´ä¸ªå®žéªŒä¸­ï¼Œdebugå·¥å…·æ˜¯ç»å¸¸è¦ä½¿ç”¨çš„ã€‚debugæœ‰ä¸¤ç§ç”¨æ³•ï¼Œä¸€ç§å°±æ˜¯ä½¿ç”¨aå‚æ•°ç›´æŽ¥å†™å…¥ç¨‹åºç„¶åŽè°ƒè¯•ã€‚è¿˜æœ‰ä¸€ç§å°±æ˜¯ç›´æŽ¥è°ƒè¯•exeæ–‡ä»¶ã€‚ ç¬¬ä¸€ç§ä¹‹å‰ä¸€ç›´åœ¨ç”¨ï¼Œç¬¬äºŒç§æ–¹å¼åŠ è½½çš„è¿‡ç¨‹æœ‰ä¸€äº›ä¸ä¸€æ ·ï¼Œdsæ®µå¯„å­˜å™¨ä¸­å­˜æ”¾ç€è¯¥ç¨‹åºçš„æ®µåœ°å€ï¼Œå› ä¸ºåç§»ä¸ºé›¶æ‰€ä»¥DS:0å°±æ˜¯æ‰€åŠ è½½ç¨‹åºçš„é¦–åœ°å€ã€‚è€ŒåŠ è½½è¿›æ¥çš„ç¨‹åºå‰256å­—èŠ‚å­˜æ”¾çš„æ˜¯ä¸€æ®µé€šä¿¡ç¨‹åºï¼Œæ‰€ä»¥çœŸæ­£çš„ä»£ç æ˜¯åœ¨(DS+10H:0):0å¼€å§‹çš„ã€‚ æ¯ä¸€æ®µæ±‡ç¼–æŒ‡ä»¤éƒ½éœ€è¦ä»¥mov ax,4c00Hï¼Œint 21Hç»“å°¾ã€‚åœ¨è°ƒè¯•åˆ°int 21Hçš„æ—¶å€™éœ€è¦ä½¿ç”¨På‘½ä»¤æ‰§è¡Œã€‚å‡ºçŽ°Program terminated normallyç¨‹åºæ­£å¸¸é€€å‡ºã€‚ å®žéªŒ2 ç”¨æœºå™¨æŒ‡ä»¤å’Œæ±‡ç¼–æŒ‡ä»¤ç¼–ç¨‹ è¿™ä¸ªå®žéªŒå¾ˆæœ‰æ„æ€ï¼Œä¸€å…±æœ‰ä¸¤éƒ¨åˆ†: #### ç¬¬ä¸€éƒ¨åˆ† ä½¿ç”¨aå°†ä¸‹é¢çš„æ±‡ç¼–æŒ‡ä»¤å†™å…¥å†…å­˜ï¼Œç„¶åŽä½¿ç”¨Tå‘½ä»¤è°ƒè¯•ã€‚å¦‚ä¸‹: 1234567mov ax,2000mov ss,axmov sp,10mov ax,3123push axmov ax,3366push ax ä¼šå‘çŽ°åœ¨å•æ­¥è°ƒè¯•çš„æ—¶å€™ï¼Œåœ¨mov ss,axä¹‹åŽçš„ä¸‹ä¸€æ¡æŒ‡ä»¤ç«Ÿç„¶ä¸æ˜¯mov sp,10ã€‚ä½†æ˜¯æŸ¥çœ‹å¯„å­˜å™¨çš„æ—¶å€™å‘çŽ°å®žé™…ä¸Šè¿™æ¡æ‰§è¡Œå·²ç»è¢«æ‰§è¡Œç»“æŸäº†ã€‚è¿™æ˜¯ç¬¬ä¸€ä¸ªçŽ°è±¡ã€‚ ç¬¬äºŒéƒ¨åˆ† å¯¹ä¸Šé¢çš„ä»£ç ç»§ç»­è°ƒè¯•ï¼Œå¦‚ä¸‹ï¼š ä¼šå‘çŽ°æœ€å¼€å§‹å¯¹æ ˆåˆå§‹åŒ–ä¹‹åŽï¼Œåˆ°æ‰§è¡Œåˆ°mov ss,axæŒ‡ä»¤çš„æ—¶å€™ï¼ŒæŸ¥çœ‹åŽŸæ¥çš„æ ˆæ®µå†…å®¹ç«Ÿç„¶ä¸å†æ˜¯é›¶ï¼Œä¸”è¿™äº›æ•°å­—è¿˜éƒ½æ˜¯å’Œæ®µå¯„å­˜å™¨ç›¸å…³çš„ã€‚ æ€»ç»“ ä¸‹å›¾æ˜¯æŽ¥ä¸‹æ¥çš„æ¯ä¸€æ­¥åŽæ ˆæ®µä¸­çš„å†…å­˜å˜åŒ–ã€‚ å¯ä»¥çœ‹åˆ°çš„çŽ°è±¡æ˜¯:å¼€å§‹çš„æ—¶å€™æ ˆä¸­æ˜¯æ²¡æœ‰æ•°æ®çš„ï¼Œæ ˆæ¡¢SPæŒ‡å‘2000:0010çš„ä½ç½®ã€‚ åœ¨mov ss,axå’Œmov sp,10è¿™ä¸¤æ­¥æ‰§è¡Œç»“æŸä¹‹åŽï¼Œå‘çŽ°æ ˆä¸­å·²ç»æœ‰æ•°æ®äº†ï¼Œè¿™é‡Œç§°ä¸ºåˆå§‹åŒ–ã€‚åˆå§‹åŒ–çš„ä¸€å…±æœ‰6å­—èŠ‚çš„æ•°æ®:4ä¸ªå­—èŠ‚ä¸ºCS:IPï¼Œè¿˜æœ‰ä¸¤å­—èŠ‚åœ¨æ ˆåº•ç¡®å®šä¸º01A3Hã€‚ ä¹‹åŽçš„æ¯ä¸€æ¡æ ˆæ“ä½œçš„æŒ‡ä»¤æ‰§è¡Œç»“æŸä¹‹åŽæ ˆä¸­çš„CS:IPå€¼ä¹Ÿä¼šè·Ÿç€å˜åŒ–ï¼Œè¿™è¯´æ˜Žæ¯ä¸€æ¬¡æŒ‡ä»¤éƒ½æœ‰å¯èƒ½äº§ç”Ÿä¸€æ¬¡ä¸­æ–­ã€‚ ä½†æ˜¯åœ¨æ ˆåº•çš„01A3Hä¸€ç›´æ²¡æœ‰å˜åŒ–ä¼°è®¡åº”è¯¥æ˜¯ä¸­æ–­ç›¸å…³ã€‚åœ¨æ­£å¼åŽ‹æ ˆæ“ä½œçš„è¿‡ç¨‹ä¸­å‘çŽ°æœ€å¼€å§‹åˆå§‹åŒ–è¿‡çš„é‚£äº›æ•°æ®å¹¶æ²¡æœ‰è¢«åŽ‹åˆ°æ ˆåº•ï¼Œè¿™å°±æ„å‘³ç€å †æ ˆæŒ‡é’ˆSPåº”è¯¥è¿˜åœ¨æ ˆåº•ï¼Œç„¶åŽçœŸæ­£æœ‰æ•°æ®é¡¹åŽ‹æ ˆçš„æ—¶å€™æ‰ä¼šSP-=2æ“ä½œã€‚ ##### å°å®žéªŒ å°±ä¸Šé¢çš„ä¸‰ä¸ªçŽ°è±¡ï¼Œæˆ‘åœ¨æƒ³ä»…ä»…æ˜¯åˆå§‹åŒ–çš„è¿‡ç¨‹å°±å·²ç»å æ®äº†ä¸€å¤§åŠæ ˆç©ºé—´ï¼Œé‚£å¦‚æžœå°†æ ˆå¤§å°è°ƒæ•´æˆä¸º8å­—èŠ‚çš„ã€‚é‚£ä¼šå‡ºçŽ°ä»€ä¹ˆæƒ…å†µï¼Ÿ æˆ‘å°†mov sp,10æ”¹æˆmov sp,08ï¼›ç„¶åŽå‡†å¤‡äº†8å­—èŠ‚æ•°æ®ï¼Œæ‰€ä»¥æ ˆä¼šè¢«åŽ‹æ»¡ã€‚è¿™æ—¶å€™æˆ‘æƒ³çœ‹çœ‹çŽ°è±¡ã€‚ è¿™æ˜¯ä¸€å¼ åˆå§‹åŒ–çš„å›¾: è¿™æ˜¯æœ«å°¾åŽ‹æ ˆæ»¡äº†çš„å›¾: å› ä¸ºä¹¦ä¸Šå…³äºŽä¸­æ–­çš„è¯¦ç»†è®²è§£åœ¨ç¬¬å››éƒ¨åˆ†ï¼Œæ‰€ä»¥è¿™é‡Œåªæ˜¯ä¸€ä¸ªçŒœæµ‹ã€‚çŽ°è±¡ä¸­éšç€æ ˆä¸æ–­è¢«åŽ‹æ»¡ï¼Œä¹‹å‰åˆå§‹åŒ–çš„é‚£äº›æ•°æ®éƒ½è¢«æŒ¤å‡ºåŽ»äº†ï¼Œå…·ä½“åŽ»å“ªäº†ä¸çŸ¥é“ã€‚é‚£6ä¸ªå­—èŠ‚çš„æ•°æ®åˆ°åº•æœ‰ä»€ä¹ˆç”¨ä¹Ÿä¸çŸ¥é“ã€‚ ##### çŒœæµ‹ ä¸è¿‡å¯ä»¥çŸ¥é“çš„æ˜¯åˆå§‹åŒ–æ ˆå¸§çš„æ—¶å€™ä¼šæœ‰å‚æ•°åŽ‹åˆ°æ ˆé‡Œï¼Œå‚æ•°æœ‰CS:IPå’Œä¸­æ–­å‘é‡å·ï¼Œå…¶ä¸­CS:IPè¿˜åœ¨ä¸æ–­å˜åŒ–ã€‚è€Œéšç€æ ˆä¸­çš„æ•°æ®è¶Šæ¥è¶Šå¤šï¼Œæ ˆä¸­çš„è¿™6ä¸ªå­—èŠ‚çš„å‚æ•°è¢«æ…¢æ…¢æŒ¤å‡ºã€‚éš¾é“è¿™6ä¸ªå­—èŠ‚ä¸é‡è¦å—ï¼Œæˆ–è€…è¯´åªæ˜¯åœ¨åˆå§‹åŒ–çš„æ—¶å€™ç”¨äº†ä¸€ä¸‹ï¼Ÿä½†æ˜¯è¿‡ç¨‹ä¸­è¿™äº›å‚æ•°ä¸€ç›´ä¹Ÿåœ¨å˜åŒ–ï¼Œæ‰€ä»¥ä¸å¯èƒ½ä¸é‡è¦.ä¸è¿‡è¿™äº›æ•°æ®ä¹‹æ‰€ä»¥æ”¾åˆ°æ ˆä¸­çš„åŽŸå› ä¸€å®šä¸æ˜¯ä¸ºäº†å­˜å‚¨ï¼Œå¦åˆ™å°±ä¸ä¼šè¢«éšä¾¿æŒ¤å‡ºã€‚ ç»“åˆç¬¬ä¸€éƒ¨åˆ†å®žéªŒï¼Œmov sp,10æ˜¯ç´§è·Ÿç€å‰ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œçš„ï¼Œæ‰€ä»¥æˆ‘èƒ½æƒ³åˆ°çš„å”¯ä¸€ä¸€ä¸ªåˆç†çš„è§£é‡Šå°±æ˜¯:è¿™äº›å‚æ•°æ˜¯åœ¨æŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­ç›´æŽ¥ä½¿ç”¨çš„ï¼Œè€Œæ‰§è¡Œè¿‡ç¨‹å¯¹shellå±è”½ä¸å¯è§ï¼Œæ‰€ä»¥åœ¨æ ˆä¸­æ•°æ®è¶Šæ¥è¶Šå¤šçš„æ—¶å€™è¿™äº›å‚æ•°è¿˜å¯ä»¥éšæ„çš„ç§»åŠ¨ä½ç½®å¹¶ä¸”è¢«æŠ›å¼ƒï¼Œè¿™äº›å‚æ•°æ˜¯è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å‚æ•°ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ä¸­æ–­ï¼è‡³äºŽä¸­æ–­åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œåˆ°ç¬¬4ç« å†è¯¦ç»†å­¦ä¹ å§ã€‚ å®žéªŒ3 ç”¨ç¼–ç¨‹ã€ç¼–è¯‘ã€è¿žæŽ¥ã€è·Ÿè¸ª æœ€åŽä¸€ä¸ªå®žéªŒæŸ¥çœ‹PSPï¼ˆå°±æ˜¯åŠ è½½å¼€å§‹å‰256å­—èŠ‚ï¼‰çš„å†…å®¹ã€‚ ä½¿ç”¨uæ¥æŸ¥çœ‹æ±‡ç¼–å¥½åƒåˆå’Œä¸­æ–­æœ‰å…³ç³»ã€‚]]></content>
      <categories>
        <category>Assembly</category>
      </categories>
      <tags>
        <tag>i386</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ±‡ç¼–è¯­è¨€ï¼ˆçŽ‹çˆ½ï¼‰ch1]]></title>
    <url>%2F2018%2F10%2F02%2F%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%EF%BC%88%E7%8E%8B%E7%88%BD%EF%BC%89ch1%2F</url>
    <content type="text"><![CDATA[ç¬¬ä¸€éƒ¨åˆ†:ç¡¬ä»¶æ¨¡åž‹ Abstract ç¡¬ä»¶åŸºç¡€ å…¨ä¹¦çš„æ ¸å¿ƒåœ¨ä½¿ç”¨æ±‡ç¼–è¯­è¨€è¿›è¡Œç¼–ç¨‹ï¼Œè€å¸ˆåœ¨ç¬¬ä¸€ç« å°±æŠ½è±¡å‡ºäº†å®Œæ•´çš„ç¼–ç¨‹æ¨¡åž‹ä¾›æ±‡ç¼–ç¨‹åºå‘˜å‚è€ƒâ€”â€”â€”â€”å†¯è¯ºä¾æ›¼ç»“æž„ã€‚ CPUåªæ˜¯ä¸€ä¸ªè¿ç®—å•å…ƒï¼Œåªæœ‰æä¾›äº†æ•°æ®å’ŒæŒ‡ä»¤æ‰å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œè€Œæ•°æ®å’ŒæŒ‡ä»¤å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚é‚£CPUå’Œå†…å­˜å¦‚ä½•è¿›è¡Œäº¤äº’ï¼Ÿ å­˜å‚¨å•å…ƒçš„åœ°å€ï¼ˆåœ°å€ï¼‰ è¯»/å†™æ“ä½œï¼ˆæŽ§åˆ¶ï¼‰ è¯»/å†™çš„å…·ä½“æ•°æ®ï¼ˆæ•°æ®ï¼‰ ç­”æ¡ˆæ˜¯æ€»çº¿ï¼Œåœ°å€æ€»çº¿å†³å®šäº†CPUçš„å¯»å€èƒ½åŠ›ï¼›æ•°æ®æ€»çº¿å†³å®šäº†CPUä¸€æ¬¡èƒ½å¤Ÿå¤„ç†å¤šå°‘æ•°æ®ï¼›æŽ§åˆ¶æ€»çº¿å†³å®šäº†CPUå¯¹å¤–éƒ¨å™¨ä»¶çš„æŽ§åˆ¶èƒ½åŠ›ã€‚è¿™é‡Œçš„å¤–éƒ¨å™¨ä»¶æŒ‡çš„æ˜¯é™¤å†…å­˜å¤–çš„å…¶ä»–å­˜å‚¨å•å…ƒæ¯”å¦‚VGAç­‰ã€‚æ‰€ä»¥åœ¨æ¨¡åž‹å†…éƒ¨å®žé™…ä¸Šè¿˜æœ‰ä¸€å±‚æŠ½è±¡â€”â€”â€”â€”é‚£å°±æ˜¯ç”±ç³»ç»Ÿä¸­æ‰€æœ‰çš„å­˜å‚¨å•å…ƒç»„æˆçš„ç»Ÿä¸€çš„é€»è¾‘å­˜å‚¨å™¨ã€‚å®žé™…ä¸ŠCPUé¢å‘çš„å°±æ˜¯è¿™ä¸ªé€»è¾‘å­˜å‚¨å™¨ï¼Œä¹¦ä¸­å«å®ƒå†…å­˜åœ°å€ç©ºé—´ã€‚ ä»¥ä¸Šå°±æ˜¯æ•´ä¸ªä¹¦ä¸­æŠ½è±¡å‡ºæ¥æœ€ç®€å•çš„ç¼–ç¨‹æ¨¡åž‹ï¼ŒçŽ‹çˆ½è€å¸ˆåœ¨ä¸€å¼€å§‹å°±å®šä¸‹è¿™æœ¬ä¹¦çš„åŸºè°ƒâ€”â€”â€”â€”ä¸æ˜¯è®²CPUå’Œå¤–è®¾çš„ç‰©ç†ç»“æž„ã€Šå¾®æœºåŽŸç†å’ŒæŽ¥å£ã€‹ï¼Œä¹Ÿä¸æ˜¯è®²æ•´ä¸ªè®¡ç®—æœºç³»ç»Ÿçš„ç»“æž„å’ŒåŠŸèƒ½ã€Šç»„æˆåŽŸç†ã€‹ã€‚å­¦ä¹ æ±‡ç¼–è¯­è¨€æ˜¯åˆ©ç”¨å›ºæœ‰çš„ç¡¬ä»¶ä½“ç³»å’Œç‰¹æœ‰çš„æŒ‡ä»¤é›†è¿›è¡Œç¼–ç¨‹ä»Žè€Œå¯¹ç¡¬ä»¶ç³»ç»Ÿè¿›è¡ŒæŽ§åˆ¶ã€‚ å›ºæœ‰çš„ç¡¬ä»¶ä½“ç³»æŒ‡çš„æ˜¯è¿™å¥—CPU+RAMçš„è®¡ç®—æœºæ¨¡åž‹æ˜¯å›¾çµï¼Œå†¯è¯ºä¾æ›¼è¿™äº›å…ˆé©±ä»¬æ€»ç»“å‡ºæ¥çš„ä¸€å¥—æœ€é€‚åˆçš„ç»“æž„ã€‚è€Œç‰¹æœ‰çš„æŒ‡ä»¤é›†åˆ™æ˜¯è¯´ä¸åŒçš„CPUæœ‰ä¸åŒçš„æ±‡ç¼–è¯­è¨€ï¼Œç”¨x86çš„æ±‡ç¼–è¯­è¨€çš„åŽŸå› ä¸»è¦æ˜¯å› ä¸ºè¿™å¥—æŒ‡ä»¤é›†åªæœ‰14ä¸ªå¯„å­˜å™¨å’Œ1MB(20ä½åœ°å€æ€»çº¿)å¯»å€ç©ºé—´ï¼Œæ¯”è¾ƒå®¹æ˜“æŽŒæ¡ã€‚ æŒ‡ä»¤å’Œæ•°æ® å­¦ä¹ ç»„æˆçš„æ—¶å€™å°±å¯¹è¿™ä¸¤ä¸ªæ¦‚å¿µå¾ˆæ¨¡ç³Šï¼Œä½†æ˜¯åšå®žéªŒçš„è¿‡ç¨‹ä¸­å…¶å®žå‘çŽ°ï¼šå…¶å®žCPUçœ‹åˆ°çš„ä¸œè¥¿å°±æ˜¯ä¸€å †01è€Œå·²ï¼ŒçœŸæ­£å°†è¿™å †01èµ‹äºˆæ„ä¹‰çš„è¿˜æ˜¯æˆ‘ä»¬ã€‚æ¢å¥è¯è¯´å°±æ˜¯æ•°æ®å’ŒæŒ‡ä»¤åªæ˜¯ä¸€ä¸ªåº”ç”¨ä¸Šçš„æ¦‚å¿µï¼Œä½ å°†å®ƒæ”¾åˆ°PCä¸­å®ƒå°±æ˜¯åœ°å€ï¼Œè€Œå°†å®ƒæ”¾åˆ°å¦å¤–ä¸€ä¸ªå¯„å­˜å™¨ä¸­å®ƒå¯èƒ½å°±ç›´æŽ¥è¢«ç”¨æ¥è¿ç®—äº†ã€‚ ä»ŽåŽŸç†ä¸Šçœ‹ï¼Œä¸»è¦æ˜¯ä¸åŒçš„å¯„å­˜å™¨å¯¹è¿™äº›æ•°æ®èµ‹äºˆäº†ä¸åŒçš„åŠŸèƒ½ã€‚CPUçš„å·¥ä½œç”¨ä¸€å¥è¯æ¥æ¦‚æ‹¬å°±æ˜¯ä»Žç‰¹å®šçš„å¯„å­˜å™¨ä¸­å–å‡ºdata1ä½œä¸ºåœ°å€ï¼Œç„¶åŽæŠŠå†…å­˜ä¸­è¿™ä¸ªåœ°å€ç›¸å¯¹åº”çš„data2ä½œä¸ºæŒ‡ä»¤è¿›è¡Œè®¡ç®—ã€‚ä½†æ˜¯å¦‚æžœæˆ‘æŠŠdata1å’Œdata2äº’æ¢ä¸€ä¸‹ï¼Œå…¶å®žä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯éœ€è¦è€ƒè™‘åˆ°çš„æ˜¯data2æ‰€ä»£è¡¨çš„åœ°å€æ˜¯ä¸æ˜¯åœ¨å†…å­˜åœ°å€ç©ºé—´çš„èŒƒå›´ä¹‹å†…ï¼Œæˆ‘çš„ç†è§£æ˜¯å¯„å­˜å™¨ï¼Œæ€»çº¿ï¼Œå†…å­˜ä¸­å­˜å‚¨æ•°æ®çš„ä½æ•°æœ‰å¯èƒ½éƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚ä½†æ˜¯è¯´åˆ°åº•å®ƒä»¬åªæ˜¯æ¥å­˜å‚¨æ•°æ®çš„ï¼Œå†™é”™æœ€åçš„æƒ…å†µä¹Ÿå°±æ˜¯CPUè·‘å´©äº†ã€‚ å¯„å­˜å™¨ 8086CPUæœ‰14ä¸ªå¯„å­˜å™¨ï¼Œéƒ½æ˜¯16ä½çš„ã€‚ä½†æ˜¯è¿™16ä½çš„å¯„å­˜å™¨ä¹Ÿå¯ä»¥ç‹¬ç«‹ä½œä¸ºä¸¤ä¸ª8ä½çš„å¯„å­˜å™¨ä½¿ç”¨ã€‚ å¯„å­˜å™¨å’Œå†…å­˜æ˜¯æ±‡ç¼–ç¨‹åºçŒ¿çœ¼ä¸­æœ€ç›´è§‚çš„è®¡ç®—æœºæ ·å­ã€‚ ##### æ±‡ç¼–å±‚é¢çš„CPU * è¿ç®—å™¨è¿›è¡Œä¿¡æ¯å¤„ç† * å¯„å­˜å™¨è¿›è¡Œä¿¡æ¯å­˜å‚¨ * æŽ§åˆ¶å™¨æŽ§åˆ¶å„ç§å™¨ä»¶è¿›è¡Œå·¥ä½œ * å†…éƒ¨æ€»çº¿è¿žæŽ¥å„ç§å™¨ä»¶ï¼Œåœ¨å®ƒä»¬ä¹‹é—´è¿›è¡Œæ•°æ®çš„ä¼ é€ 8086æž¶æž„ï¼ˆ16ä½æœºï¼‰ å…·ä½“æ·±ç©¶åˆ°ç‰©ç†å®žçŽ°å°±æ˜¯ã€Šç»„æˆåŽŸç†ã€‹çŸ¥è¯†äº†ã€‚ * è¿ç®—å™¨ä¸€æ¬¡æœ€å¤šå¯ä»¥å¤„ç†16ä½æ•°æ® * å¯„å­˜å™¨çš„æœ€å¤§å®½åº¦ä¸º16ä½ * å¯„å­˜å™¨å’Œè¿ç®—å™¨ä¹‹é—´çš„é€šè·¯ä¸º16ä½ æ±‡ç¼–å±‚é¢çš„å†…å­˜ CPUåœ¨è®¿é—®å†…å­˜å•å…ƒçš„æ—¶å€™ï¼Œéœ€è¦çŸ¥é“å†…å­˜å•å…ƒçš„åœ°å€ã€‚æ‰€æœ‰çš„å†…å­˜å•å…ƒæž„æˆçš„å­˜å‚¨ç©ºé—´æ˜¯ä¸€ä¸ªä¸€ç»´çš„çº¿æ€§ç©ºé—´ï¼Œæ¯ä¸€ä¸ªå†…å­˜ç©ºé—´åœ¨è¿™ä¸ªç©ºé—´ä¸Šéƒ½æœ‰å”¯ä¸€çš„åœ°å€ï¼Œè¿™ä¸ªæƒŸä¸€çš„åœ°å€å°±å«åšç‰©ç†åœ°å€ã€‚ CPUé¦–å…ˆåœ¨å†…éƒ¨å½¢æˆè¿™ä¸ªç‰©ç†åœ°å€ï¼Œç„¶åŽé€šè¿‡åœ°å€æ€»çº¿é€å…¥å­˜å‚¨å™¨ã€‚è¿™ä¸ªåœ°å€ä¸€å®šæ˜¯ä¸€ä¸ªå†…å­˜å•å…ƒçš„ç‰©ç†åœ°å€ã€‚ä¸åŒçš„CPUæž¶æž„å½¢æˆåœ°å€çš„æ–¹å¼ä¸ä¸€æ ·ã€‚ CS:IP å‰é¢æåˆ°äº†8086CPUå†…éƒ¨éœ€è¦å½¢æˆç‰©ç†åœ°å€ï¼Œä½†æ˜¯8086æ˜¯16ä½æœºâ€”â€”â€”â€”åªèƒ½å¤„ç†å’Œä¼ è¾“16ä½çš„åœ°å€ï¼Œä½†æ˜¯8086çš„åœ°å€æ€»çº¿æœ‰20ä½ï¼Œæ‰€ä»¥éœ€è¦ä¸¤ä¸ª16ä½æ¥å…±åŒå½¢æˆä¸€ä¸ª20ä½çš„åœ°å€ã€‚ 14ä¸ªå¯„å­˜å™¨ä¸­ï¼ŒCSæ˜¯æ®µå¯„å­˜å™¨ï¼Œå­˜æ”¾åŸºåœ°å€ã€‚è€ŒIPå­˜æ”¾åç§»é‡ã€‚å…¬å¼:CSx16+IPã€‚ é¦–å…ˆéœ€è¦æ˜Žç™½çš„å°±æ˜¯ï¼Œä¸€ä¸ªå†…å­˜å•å…ƒæ˜¯8ä½äºŒè¿›åˆ¶ä¹Ÿå«ä¸€ä¸ªå­—èŠ‚ã€‚è€Œåå…­è¿›åˆ¶çš„ä¸€ä½å¯ä»¥è¡¨ç¤ºæˆä¸ºäºŒè¿›åˆ¶çš„4ä½ã€‚å®Œå…¨åªæ˜¯ä¸ºäº†æ–¹ä¾¿æ‰å†™æˆ16è¿›åˆ¶çš„ã€‚20ä½çš„åœ°å€ï¼ˆ5ä½16è¿›åˆ¶ï¼‰å¯ä»¥å†™æˆ4C780Hï¼ŒåŽé¢çš„Hè¡¨ç¤º16è¿›åˆ¶ã€‚ä¸€ä¸ªXè¿›åˆ¶çš„æ•°æ®å·¦ç§»ä¸€ä½ï¼Œç›¸å½“äºŽä¹˜ä»¥Xã€‚æ‰€ä»¥ä¸ºäº†è®°èµ·æ¥æ–¹ä¾¿ä¸€äº›å¯ä»¥è®°æˆCSå¯„å­˜å™¨çš„æ•°æ®å·¦ç§»ä¸€ä½+IPå¯„å­˜å™¨çš„å€¼ã€‚ä½†æ˜¯ä¸¤ä¸ªå¯„å­˜å™¨åªæœ‰16ä½ï¼ˆ4ä½16è¿›åˆ¶)ï¼Œåˆ°åŽé¢è®¡ç®—çš„æ—¶å€™éœ€è¦æ³¨æ„è¿™ä¸¤ä¸ªå‰æï¼Œé¿å…æº¢å‡ºã€‚ ä¹¦ä¸­ç‰¹åˆ«å¼ºè°ƒäº†å¯¹æ®µçš„ç†è§£ã€‚è¿™é‡Œçš„æ®µå¹¶ä¸æ˜¯æŒ‡å†…å­˜è¢«ç‰©ç†ä¸Šåˆ†æˆä¸€æ®µä¸€æ®µçš„ã€‚è€Œæ˜¯å› ä¸ºCPUåœ¨ç®¡ç†å†…å­˜çš„æ—¶å€™ï¼Œä½¿ç”¨CSx16+IPçš„æ–¹å¼æ¥è¿›è¡Œç®¡ç†ã€‚æ‰€ä»¥å¯ä»¥å°†åœ°å€è¿žç»­ï¼Œèµ·å§‹åœ°å€ä¸º16çš„å€æ•°çš„ä¸€ç»„å†…å­˜å•å…ƒçœ‹æˆæ˜¯ä¸€ä¸ªæ®µã€‚é‡ç‚¹åœ¨äºŽä¸æ˜¯æ‰€æœ‰çš„èµ·å§‹åœ°å€éƒ½å¯ä»¥ä½œä¸ºæ®µåœ°å€â€”â€”â€”â€”è¿™æ˜¯å› ä¸ºCSx16å†³å®šçš„ã€‚è€Œä¸”å› ä¸ºIPæ˜¯16ä½çš„æ‰€ä»¥æ¯ä¸€ä¸ªæ®µçš„é•¿åº¦æœ€å¤§ä¸º64KBã€‚ æ‰§è¡Œè¿‡ç¨‹ åœ¨8086æœºä¸­ï¼Œä»»æ„æ—¶åˆ»CPUå°†CS:IPæŒ‡å‘çš„å†…å®¹å½“åšæŒ‡ä»¤æ‰§è¡Œã€‚æ±‡ç¼–ä¸­ä½¿ç”¨jmp æ®µåœ°å€:åç§»åœ°å€å¯¹CS:IPè¿›è¡Œä¿®æ”¹ã€‚æˆ–è€…ä½¿ç”¨jmp å¯„å­˜å™¨æ¥ä¿®æ”¹IPçš„å€¼ã€‚ ###### 8086çš„å·¥ä½œè¿‡ç¨‹ * ä»ŽCS:IPæŒ‡å‘çš„å†…å­˜å•å…ƒä¸­è¯»å–æŒ‡ä»¤ï¼Œè¯»å–çš„æŒ‡ä»¤è¿›å…¥æŒ‡ä»¤ç¼“å­˜å™¨ã€‚ * IPæŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚ * æ‰§è¡ŒæŒ‡ä»¤,ä»ŽCS:IPä¸­å–æŒ‡ä»¤ï¼Œé‡å¤ä¸Šé¢çš„è¿‡ç¨‹ã€‚ ä¹¦ä¸­åˆ’çº¿ æ±‡ç¼–è¯­è¨€å’Œæœºå™¨è¯­è¨€çš„å·®åˆ«åœ¨äºŽæŒ‡ä»¤çš„è¡¨ç¤ºæ–¹æ³•ä¸Šã€‚ å¾®æœºå­˜å‚¨å™¨çš„å®¹é‡æ˜¯ä»¥å­—èŠ‚ä¸ºæœ€å°å•ä½çš„æ¥è®¡ç®—çš„ã€‚ åœ¨å†…å­˜å’Œç£ç›˜ä¸Šï¼Œæ•°æ®å’ŒæŒ‡ä»¤æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚ åœ¨æ±‡ç¼–è¯­è¨€è¿™é—¨è¯¾ä¸­ï¼Œæˆ‘ä»¬æ‰€é¢å¯¹çš„æ˜¯å†…å­˜åœ°å€ç©ºé—´ã€‚CPUå‘è¿™æ®µåœ°å€ä¸­è¯»å†™æ•°æ®å®žé™…ä¸Šå°±æ˜¯å‘ç›¸åº”çš„ç‰©ç†å­˜å‚¨å™¨ä¸­è¯»å†™æ•°æ®ã€‚ å†…å­˜åœ°å€ç©ºé—´çš„å¤§å°å—åˆ°CPUåœ°å€æ€»çº¿å®½åº¦çš„é™åˆ¶ã€‚ å®žéªŒ1 æŸ¥çœ‹CPUå’Œå†…å­˜ï¼Œç”¨æœºå™¨æŒ‡ä»¤å’Œæ±‡ç¼–æŒ‡ä»¤ç¼–ç¨‹ å·¥å…·ä»‹ç» debugæ˜¯DOS,Windowséƒ½æä¾›çš„å®žæ¨¡å¼ï¼ˆ8086æ–¹å¼ï¼‰ç¨‹åºçš„è°ƒè¯•å·¥å…·ã€‚ä¸‹é¢æ˜¯æœ¬æ¬¡å®žéªŒå°†ä¼šç”¨åˆ°çš„å‚æ•°: ##### r (è¯»å†™å¯„å­˜å™¨) * ræŸ¥çœ‹æ‰€æœ‰çš„å¯„å­˜å™¨çš„å€¼ * r å¯„å­˜å™¨åç§°ä¿®æ”¹åˆ¶å®šå¯„å­˜å™¨çš„å€¼ d ï¼ˆè¯»å†™å†…å­˜ï¼‰ d æ®µåœ°å€:åç§»åœ°å€ åˆ—å‡ºä»ŽæŒ‡å®šå†…å­˜å•å…ƒå¼€å§‹çš„128ä¸ªå†…å­˜å•å…ƒçš„å†…å®¹ d æ®µåœ°å€:èµ·å§‹åç§»åœ°å€ ç»“å°¾åç§»åœ°å€åˆ—å‡ºåœ¨åç§»åœ°å€èŒƒå›´ä¹‹å†…çš„å†…å­˜å•å…ƒçš„å†…å®¹ e ï¼ˆè¯»å†™å†…å­˜ï¼‰ e æ®µåœ°å€:åç§»åœ°å€ data1 data2 data3â€¦â€¦ä»Žç‰¹å®šå•å…ƒå¼€å§‹è®²æ•°æ®å†™å…¥å†…å­˜ e æ®µåœ°å€:åç§»åœ°å€ å›žè½¦è¡¨ç¤ºæŒ¨ä¸ªå„¿ä¿®æ”¹å†…å­˜ï¼Œç©ºæ ¼è¡¨ç¤ºé»˜è®¤ä¸ä¿®æ”¹ï¼Œå›žè½¦è¡¨ç¤ºä¿®æ”¹ç»“æŸ e+u+t ä½¿ç”¨eå‚æ•°å‘å†…å­˜ä¸­å†™å…¥æœºå™¨ç  ä½¿ç”¨u æ®µåœ°å€:åç§»åœ°å€å¯ä»¥å°†å†…å­˜ä¸­æœºå™¨ç ç¿»è¯‘æˆä¸ºæ±‡ç¼–è¯­è¨€ tå‚æ•°æ‰§è¡ŒCS:IPæŒ‡å‘çš„å†…å­˜åœ°å€å•å…ƒçš„ä»»ä½•æŒ‡ä»¤ï¼Œæ³¨æ„ä¿®æ”¹å‚æ•° a a æ®µåœ°å€:åç§»åœ°å€å¯ä»¥ç›´æŽ¥ä½¿ç”¨æ±‡ç¼–çš„æ ¼å¼å†™å…¥æœºå™¨æŒ‡ä»¤ å®žéªŒä»»åŠ¡ ä¸€å…±æœ‰4ä¸ªå®žéªŒã€‚å†™å‡ºæ¥çš„éƒ½æ˜¯æˆ‘è§‰å¾—å¾ˆæœ‰æ„æ€ä¸”å€¼å¾—è®¨è®ºçš„å®žéªŒã€‚ ç¬¬äºŒä¸ªå®žéªŒ ç»™å‡ºèµ·å§‹åœ°å€ä¸º2000:0000çš„ä¸‰æ¡æŒ‡ä»¤ï¼Œä½¿ç”¨è¿™ä¸‰æ¡æŒ‡ä»¤è®¡ç®—2çš„8æ¬¡æ–¹ã€‚ &lt;img src=&quot;2.png&quot; width=&quot;50%&quot; height=&quot;50%&quot; alt=&quot;&quot;&gt; æœ‰æ„æ€çš„æ˜¯è¿™ä¸ªç®—æ³•ï¼Œa += aï¼›å¦‚æžœè¿™é‡Œçš„aæ˜¯2çš„è¯ï¼Œå®žé™…ä¸Ša+aç­‰äºŽax2æ‰€ä»¥å¯ä»¥2çš„8æ¬¡æ–¹å¯ä»¥é€šè¿‡8æ¬¡è¿™æ ·çš„åŠ æ³•å®Œæˆï¼Œä½†æ˜¯å¦‚æžœaæ˜¯å…¶ä»–çš„å€¼å°±ä¸è¡Œäº†ã€‚ æœ€åŽä¸¤ä¸ªå®žéªŒ ä½¿ç”¨eå‚æ•°å¯¹ç‰¹å®šçš„å†…å­˜å•å…ƒè¿›è¡Œè¯»å†™ã€‚ è¿™ä¸¤ä¸ªå®žéªŒé—´æŽ¥åœ°è¯æ˜Žäº†å†…å­˜åœ°å€ç©ºé—´çš„å­˜åœ¨ã€‚ æˆ‘åœ¨å‘å†…å­˜B810:0000ä¸­å†™æ•°æ®çš„æ—¶å€™ï¼Œå‘çŽ°æ˜¾ç¤ºå™¨ä¸Šä¼šå‡ºçŽ°æœ‰é¢œè‰²çš„å­—ç¬¦å’Œè¡¨æƒ…åŒ…ï¼ŒçŒœæƒ³è¿™ä¸ªåœ°å€åº”è¯¥æ˜¯æ˜¾å­˜çš„ç‰©ç†åœ°å€ã€‚è¿™ä¹Ÿè¯´æ˜Žè¿™é‡Œçš„å†…å­˜ä¸ä»…ä»…æŒ‡çš„æ˜¯ä¸»å­˜å‚¨å™¨ï¼Œè¿˜æœ‰å…¶ä»–çš„å’ŒCPUç›´æŽ¥ç›¸è¿žçš„RAMã€‚ â€‹]]></content>
      <categories>
        <category>Assembly</category>
      </categories>
      <tags>
        <tag>i386</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ±‡ç¼–è¯­è¨€ï¼ˆçŽ‹çˆ½ï¼‰ch0]]></title>
    <url>%2F2018%2F10%2F02%2F%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%EF%BC%88%E7%8E%8B%E7%88%BD%EF%BC%89ch0%2F</url>
    <content type="text"><![CDATA[Abstract çŽ‹çˆ½è€å¸ˆçš„ã€Šæ±‡ç¼–è¯­è¨€ã€‹æ˜¯å›½å†…çš„ç»å…¸æ•™æã€‚ å­¦ä¹ æ±‡ç¼–æ˜¯ä¸ºäº†èŽ·å¾—åº•å±‚ç¼–ç¨‹çš„ä½“éªŒå’Œç†è§£æœºå™¨è¿è¡Œç¨‹åºçš„æœºç†ã€‚æ‰€ä»¥ç»å…¸çš„åšæ³•å¾€å¾€ä¸æ˜¯åªé’ˆå¯¹äºŽæŸä¸€ç§æŒ‡ä»¤é›†ï¼Œè€Œæ˜¯ä»¥ä¸€ç§æŒ‡ä»¤é›†ä¸ºæ‰‹æ®µæ¥æ·±å…¥ç†è§£æœºå™¨å·¥ä½œçš„åŽŸç†ï¼Œä½“ä¼šä¸€ä¸ªæ²¡æœ‰æ“ä½œç³»ç»Ÿçš„ç¼–ç¨‹å¼€å‘çŽ¯å¢ƒã€‚æ­£å¦‚ä¹¦ä¸­æ‰€è®²:ç¼–ç¨‹çš„å¹³å°æ˜¯ç¡¬ä»¶è€Œä¸æ˜¯æ“ä½œç³»ç»Ÿã€‚æˆ–è®¸è¿™ä¹Ÿæ˜¯æ±‡ç¼–è¯­è¨€çœŸæ­£çš„ä»·å€¼æ‰€åœ¨å§ã€‚ å®žéªŒçŽ¯å¢ƒ å…¨ä¹¦çš„å®žéªŒéƒ½æ˜¯åœ¨8086CPUçš„ä½“ç³»ç»“æž„ä¸‹å±•å¼€çš„ï¼Œè¿™ä¹Ÿæ˜¯Intelç¬¬ä¸€å—16ä½çš„å¤„ç†å™¨ã€‚ æˆ‘ä»¬æœ‰ä¸¤ç§åŠžæ³•åœ¨è‡ªå·±çš„è®¡ç®—æœºä¸Šæ¨¡æ‹Ÿ8086:ä¸€ç§æ˜¯ä½¿ç”¨WindowsXPç³»ç»Ÿã€‚ä¸€ç§æ˜¯é‡‡ç”¨DOSBoxæ¨¡æ‹Ÿå™¨ï¼Œç¬¬äºŒç§æ¯”è¾ƒæ–¹ä¾¿ã€‚è¿™é‡Œæ˜¯é“¾æŽ¥ã€‚ æœ¬ä¹¦æœ‰17ä¸ªå®žéªŒï¼Œ2ä¸ªè¯¾ç¨‹è®¾è®¡ï¼Œ5ä¸ªç ”ç©¶è¯•éªŒã€‚æˆ‘ä¸»è¦æ˜¯ä»¥å…¶ä¸­ä¸€äº›å®žéªŒä¸ºç« èŠ‚å±•å¼€å­¦ä¹ ã€‚ å…¨ä¹¦æž¶æž„ åœ¨æˆ‘çœ‹æ¥ï¼Œå…¨ä¹¦åº”è¯¥å¯ä»¥åˆ†ä¸ºè¿™ä¹ˆå‡ ä¸ªéƒ¨åˆ†: * ç¡¬ä»¶æ¨¡åž‹Chapter.(1ã€2)â€”â€”â€”â€”å‘Šè¯‰ä½ æ±‡ç¼–ç¼–ç¨‹å°±æ˜¯ç¨‹åºå‘˜ä»¥æŒ‡ä»¤ä¸ºæ‰‹æ®µåœ¨CPUçš„å¯„å­˜å™¨å’Œå†…å­˜åœ°å€ç©ºé—´ä¹‹é—´è¿›è¡Œæ•°æ®è¯»å†™çš„çš„è¿‡ç¨‹ã€‚ * æ±‡ç¼–ç»“æž„Chapter.(3ã€4)â€”â€”â€”â€”ä»‹ç»äº†å®Œæ•´çš„æ±‡ç¼–ç¨‹åºçš„ç»„æˆéƒ¨åˆ†:æ•°æ®æ®µï¼Œä»£ç æ®µã€æ ˆæ®µã€‚ç¬¬4ç« ä»‹ç»äº†æ±‡ç¼–ç¨‹åºç¼–è¯‘çš„å…¨è¿‡ç¨‹å’ŒåŸºæœ¬å·¥å…·çš„ä½¿ç”¨ã€‚ * æŒ‡ä»¤æ ¸å¿ƒChapter.(511)â€”â€”â€”â€”ä»Žç¬¬5ç« ä½œè€…å¼€å§‹å¼•è¿›ä¸€äº›æ–°çš„æŒ‡ä»¤ï¼Œå¹¶ä¸”å±•å¼€æ¥è®²æ±‡ç¼–ç¨‹åºè®¾è®¡çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚ä»‹ç»äº†é‡ç‚¹çš„æŒ‡ä»¤æ¯”å¦‚æ“ä½œæŒ‡ä»¤,è·³è½¬æŒ‡ä»¤ï¼Œæ¯”è¾ƒæŒ‡ä»¤ç­‰åŠå…¶ç”¨æ³•ç­‰ï¼Œå¹¶æ·±å…¥ä»‹ç»äº†å†…å­˜å¯»å€çš„å„ç§èŠ±å¼ç”¨æ³•ã€‚ * æ“ä½œç³»ç»Ÿå±‚é¢çš„åº”ç”¨Chapter.(1217)å’Œæ“ä½œç³»ç»Ÿç›¸å…³çš„æ¦‚å¿µæ¯”å¦‚ä¸­æ–­ç­‰ã€‚ æ•´ä¸ªå­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œå¯„å­˜å™¨å’Œå†…å­˜åœ°å€ç©ºé—´çš„è¯»å†™æ˜¯è´¯ç©¿å…¨ä¹¦çš„æ ¸å¿ƒï¼Œå› ä¸ºæ‰€æœ‰çš„æ“ä½œæœ€ç»ˆéƒ½æ˜¯äº§ç”Ÿäº†å¯¹å†…å­˜æˆ–è€…æŸä¸€ä¸ªå¯„å­˜å™¨çš„è¯»å†™ã€‚è€Œå®Œæˆè¿™ä¸€åˆ‡è¯»å†™åŠŸèƒ½çš„å°±æ˜¯æ±‡ç¼–æŒ‡ä»¤ã€‚è¿™ä¹Ÿæ˜¯æœºå™¨ç¡¬ä»¶çš„çœŸæ­£å·¥ä½œåŽŸç†ã€‚ è™½ç„¶è¿™äº›éƒ¨åˆ†éƒ½å¯ä»¥æ‹†å¼€æ¥äº†è§£ï¼Œä½†æ˜¯å®žé™…ä¸Šæ¯ä¸€éƒ¨åˆ†è¿˜æœ‰å¾ˆå¤šçš„ç»†èŠ‚å’Œæ‰¿ä¸Šå¯ä¸‹çš„æ¦‚å¿µï¼Œæˆ‘ä¹Ÿæ˜¯ç«™åœ¨æˆ‘ç†è§£çš„è§’åº¦å¯¹è¿™äº›å†…å®¹è¿›è¡Œäº†åˆ’åˆ†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯:å…¨ä¹¦è¿˜æœ‰å¾ˆå¤šçš„ç»†èŠ‚æ¯”å¦‚ä¸åŒçš„å­˜å‚¨å•å…ƒå’Œæ•°æ®å¤„ç†æ–¹å¼ï¼Œè¿™äº›éƒ½ä¸æ˜¯å•ç‹¬æŸä¸€ä¸ªç« èŠ‚å¯ä»¥å®Œæˆçš„è€Œæ˜¯è´¯ç©¿å…¨ä¹¦å®žéªŒçš„å‰æã€‚æ‰€ä»¥è¿˜æ˜¯éœ€è¦é€šè¯»ä¸€éå…¨ä¹¦æ¥é¡ºè¿™äº›æ¦‚å¿µã€‚ æ­å»ºå®žéªŒæ¡ä»¶ å°†ä¸‹è½½å¥½çš„çŽ¯å¢ƒåŒ…æ”¾åœ¨~/x86ï¼Œä½œä¸ºæˆ‘ä»¬çš„å·¥ä½œç›®å½•ã€‚ æ‰“å¼€DOSBoxæ¨¡æ‹Ÿå™¨ã€‚ æŒ‚è½½Cç›˜:mount C ~/x86ã€‚ è¿›å…¥Cç›˜:C:ã€‚ å¼€å§‹å®žéªŒ:debugã€‚ é€€å‡ºç¨‹åºquitï¼Œé€€å‡ºæ¨¡æ‹Ÿå™¨exitã€‚ å®‰è£…æˆåŠŸå±•ç¤º â€‹]]></content>
      <categories>
        <category>Assembly</category>
      </categories>
      <tags>
        <tag>i386</tag>
      </tags>
  </entry>
</search>
